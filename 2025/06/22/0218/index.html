<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>计算机网络 | Polarwanderer</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="preconnect" href="https://fonts.loli.net" crossorigin><link rel="preconnect" href="https://gstatic.loli.net" crossorigin><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Noto+Serif+SC:wght@400;500;600;700&amp;display=swap"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">计算机网络</h1><a id="logo" href="/.">Polarwanderer</a><p class="description">相逢的人会再相逢。</p></div><div id="nav-menu"><a href="/."><i class="fa fa-home">Home</i></a><a href="/thoughts/"><i class="fa fa-lightbulb-o"> Thoughts</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">计算机网络</h1><div class="post-meta">2025-06-22<span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 28.6k</span><span class="post-meta-item-text"> Words</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 100</span><span class="post-meta-item-text"> Minutes</span></span></span></div><a class="disqus-comment-count" href="/2025/06/22/0218/#waline"><span class="waline-comment-count" id="/2025/06/22/0218/"></span><span> Comment</span></a><div class="post-content"><h1 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h1><h2 id="网络层核心功能与拥塞控制"><a href="#网络层核心功能与拥塞控制" class="headerlink" title="网络层核心功能与拥塞控制"></a>网络层核心功能与拥塞控制</h2><h3 id="网络层核心功能详解"><a href="#网络层核心功能详解" class="headerlink" title="网络层核心功能详解"></a>网络层核心功能详解</h3><p>网络层（Network Layer）作为OSI模型的第三层，是实现端到端通信的枢纽。其核心功能确保数据包能够在复杂的网络环境中从源主机穿越多个网络到达目的主机。</p><table><thead><tr><th align="left">核心功能</th><th align="left">详细阐述</th><th align="left">实现技术&#x2F;协议</th></tr></thead><tbody><tr><td align="left"><strong>路由选择 (Routing)</strong></td><td align="left">决定数据包从源到目的的传输路径。路由器根据路由算法计算出最佳路径，并生成路由表，用于指导分组转发。这是网络层的“决策”过程。</td><td align="left">OSPF, BGP, RIP, IS-IS</td></tr><tr><td align="left"><strong>分组转发 (Forwarding)</strong></td><td align="left">当一个数据包到达路由器时，路由器根据其转发表（Forwarding Table）查找出接口，并将数据包从该接口传输出去。这是网络层的“执行”过程。</td><td align="left">IP地址查找、转发表查询</td></tr><tr><td align="left"><strong>异构网络互联</strong></td><td align="left">将不同类型的网络（如以太网、Wi-Fi、蜂窝网络）连接起来，形成一个统一的、逻辑上的互联网。网络层通过IP协议屏蔽了底层物理网络的差异。</td><td align="left">IP协议、路由器、网关</td></tr><tr><td align="left"><strong>寻址与地址管理</strong></td><td align="left">为网络中的每一台主机和路由器分配唯一的地址（IP地址），确保数据包能够被准确地送达目的地。</td><td align="left">IPv4, IPv6, DHCP, ICMP</td></tr></tbody></table><h3 id="网络层拥塞控制机制"><a href="#网络层拥塞控制机制" class="headerlink" title="网络层拥塞控制机制"></a>网络层拥塞控制机制</h3><p><strong>拥塞（Congestion）</strong> 是指网络中因资源（如带宽、处理器、缓存）需求超过可用能力而导致服务质量急剧下降的现象。网络层的拥塞控制旨在预防和缓解拥塞，确保网络高效稳定运行。</p><h4 id="拥塞的成因与影响"><a href="#拥塞的成因与影响" class="headerlink" title="拥塞的成因与影响"></a>拥塞的成因与影响</h4><table><thead><tr><th align="left">成因</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>多点对单点流量</strong></td><td align="left">多个发送方同时向一个接收方发送大量数据，导致接收方链路或路由器拥塞。</td></tr><tr><td align="left"><strong>链路带宽不足</strong></td><td align="left">数据到达速率超过了出向链路的传输能力。</td></tr><tr><td align="left"><strong>路由器处理能力有限</strong></td><td align="left">路由器CPU或内存不足，无法及时处理和转发数据包，导致队列溢出和丢包。</td></tr><tr><td align="left"><strong>网络结构不合理</strong></td><td align="left">网络拓扑设计存在瓶颈，导致流量集中在少数链路上。</td></tr></tbody></table><p>拥塞会导致<strong>分组丢失、时延增加、吞吐量下降</strong>，严重时甚至引发<strong>拥塞崩溃（Congestion Collapse）</strong>，即网络吞吐量随负载增加而急剧下降至接近于零。</p><h4 id="拥塞控制的基本方法"><a href="#拥塞控制的基本方法" class="headerlink" title="拥塞控制的基本方法"></a>拥塞控制的基本方法</h4><p>网络层的拥塞控制可以分为<strong>开环控制</strong>和<strong>闭环控制</strong>两大类。</p><table><thead><tr><th align="left">控制类型</th><th align="left">描述</th><th align="left">优点</th><th align="left">缺点</th></tr></thead><tbody><tr><td align="left"><strong>开环控制 (Open-Loop)</strong></td><td align="left">在设计阶段就考虑拥塞问题，通过静态策略来避免拥塞。一旦系统启动，不再根据当前网络状态进行调整。</td><td align="left">简单，无额外开销</td><td align="left">无法适应网络动态变化</td></tr><tr><td align="left"><strong>闭环控制 (Closed-Loop)</strong></td><td align="left">基于网络状态的实时反馈来动态调整。系统通过监测拥塞信号（如丢包、时延）来采取相应措施。</td><td align="left">适应性强，效果好</td><td align="left">实现复杂，有反馈时延</td></tr></tbody></table><h4 id="典型拥塞控制算法"><a href="#典型拥塞控制算法" class="headerlink" title="典型拥塞控制算法"></a>典型拥塞控制算法</h4><p>网络层拥塞控制的经典算法主要体现在流量整形和调度上。</p><ol><li><p><strong>流量整形 (Traffic Shaping)</strong><br>流量整形通过平滑数据包的发送速率来限制流量的突发性，从而使网络流量更加平稳可预测。</p><ul><li><p><strong>漏桶算法 (Leaky Bucket)</strong><br>该算法将数据包视为水滴，放入一个固定容量的桶中。桶底有一个小孔，以恒定的速率漏水（发送数据包）。</p><ul><li><strong>优点</strong>：强制输出速率恒定，消除流量突发。</li><li><strong>缺点</strong>：即使网络空闲，输出速率也不能提高，无法利用网络空闲资源。</li></ul><table><thead><tr><th align="left">漏桶参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>桶容量 (Bucket Size)</strong></td><td align="left">允许的突发数据量上限。</td></tr><tr><td align="left"><strong>漏水速率 (Leak Rate)</strong></td><td align="left">数据包的恒定发送速率。</td></tr></tbody></table></li><li><p><strong>令牌桶算法 (Token Bucket)</strong><br>系统以恒定速率向桶中放入令牌（Token）。发送数据包时，必须消耗与数据包大小相当的令牌。</p><ul><li><strong>优点</strong>：允许一定程度的突发，只要桶中有足够的令牌。当网络空闲时，可以累积令牌用于后续的突发传输。</li><li><strong>缺点</strong>：实现比漏桶复杂。</li></ul><table><thead><tr><th align="left">令牌桶参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>桶容量 (Bucket Size)</strong></td><td align="left">允许累积的最大令牌数，决定了最大突发量。</td></tr></tbody></table></li></ul></li></ol><p>| <strong>令牌生成速率 (Token Rate)</strong> | 平均发送速率。 |</p><ol start="2"><li><p><strong>分组调度 (Packet Scheduling)</strong><br>当多个数据包在路由器队列中等待发送时，分组调度算法决定下一个被发送的数据包。</p><ul><li><strong>公平排队 (Fair Queuing, FQ)</strong><br>为每个流（Flow）维护一个独立的队列，并循环地从每个非空队列中取出一个数据包进行发送，从而保证各个流之间能够公平地共享链路带宽。<ul><li><strong>优点</strong>：隔离不同流，防止一个高流量的流影响其他流。</li><li><strong>缺点</strong>：计算复杂，开销较大。</li></ul></li></ul></li></ol><h3 id="TCP-IP体系中的网络层服务"><a href="#TCP-IP体系中的网络层服务" class="headerlink" title="TCP&#x2F;IP体系中的网络层服务"></a>TCP&#x2F;IP体系中的网络层服务</h3><p>TCP&#x2F;IP体系的网络层提供**无连接的、尽力而为（Best-Effort）**的数据报服务。</p><table><thead><tr><th align="left">服务特征</th><th align="left">描述</th><th align="left">影响与设计哲学</th></tr></thead><tbody><tr><td align="left"><strong>无连接 (Connectionless)</strong></td><td align="left">发送数据前无需建立连接，每个数据包（IP数据报）被独立处理和路由。</td><td align="left">简化了网络核心，提高了灵活性和鲁棒性。</td></tr><tr><td align="left"><strong>不可靠 (Unreliable)</strong></td><td align="left">不保证数据包的可靠交付，可能出现<strong>丢失、重复、失序</strong>等问题。</td><td align="left">将可靠性保障的责任转移到端系统（传输层，如TCP）。</td></tr><tr><td align="left"><strong>尽力而为 (Best-Effort)</strong></td><td align="left">网络不提供任何服务质量（QoS）承诺，但会尽最大努力传输数据包。</td><td align="left">使得网络能够适应各种应用和底层硬件，是互联网成功的关键原则之一。</td></tr></tbody></table><h2 id="路由算法与协议"><a href="#路由算法与协议" class="headerlink" title="路由算法与协议"></a>路由算法与协议</h2><p>路由算法是网络层软件的核心，其性能好坏直接影响网络的服务质量。路由算法的目标是为数据包确定一条从源到目的地的“最佳”路径。最佳路径通常指跳数最少、时延最小或成本最低的路径。</p><p>路由算法可以分为两大类：<strong>静态路由</strong>和<strong>动态路由</strong>。</p><ul><li><strong>静态路由</strong>：由网络管理员手动配置路由信息。适用于拓扑结构简单且稳定的小型网络。</li><li><strong>动态路由</strong>：路由器之间通过路由协议交换信息，自动计算并更新路由表。适用于复杂和动态变化的网络环境。</li></ul><p>动态路由算法主要分为<strong>距离向量算法</strong>和<strong>链路状态算法</strong>两大家族。</p><h3 id="距离向量算法-Distance-Vector"><a href="#距离向量算法-Distance-Vector" class="headerlink" title="距离向量算法 (Distance-Vector)"></a>距离向量算法 (Distance-Vector)</h3><p>距离向量算法是一种分散式的路由算法。每个路由器仅维护一张路由表，其中包含到所有其他节点的“距离”（成本）和下一跳路由器。路由器周期性地与<strong>直接相邻</strong>的路由器交换整个路由表。</p><p>核心思想：<strong>贝尔曼-福特算法 (Bellman-Ford)</strong>。每个路由器根据邻居发来的路由信息，更新自己的路由表。更新公式如下：</p><p><code>Dx(y) = min&#123; c(x,v) + Dv(y) &#125;</code> for each neighbor <code>v</code></p><ul><li><code>Dx(y)</code>: 节点x到节点y的最小成本路径。</li><li><code>c(x,v)</code>: 从x到邻居v的链路成本。</li><li><code>Dv(y)</code>: 邻居v的路由表中，到目的y的最小成本。</li></ul><h4 id="算法特点"><a href="#算法特点" class="headerlink" title="算法特点"></a>算法特点</h4><table><thead><tr><th align="left">特点</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>信息交换</strong></td><td align="left">只与相邻路由器交换信息。</td></tr><tr><td align="left"><strong>交换内容</strong></td><td align="left">交换整个路由表。</td></tr><tr><td align="left"><strong>更新周期</strong></td><td align="left">周期性更新（如每30秒）。</td></tr><tr><td align="left"><strong>“好消息传得快，坏消息传得慢”</strong></td><td align="left">当网络链路成本降低时，信息能很快传播；但当链路成本增加或断开时（无穷大），可能导致<strong>路由环路</strong>和<strong>无穷计数</strong>问题。</td></tr></tbody></table><h4 id="典型协议：RIP"><a href="#典型协议：RIP" class="headerlink" title="典型协议：RIP"></a>典型协议：RIP</h4><p><strong>路由信息协议 (Routing Information Protocol, RIP)</strong> 是最早的内部网关协议之一，基于距离向量算法。</p><ul><li><strong>成本度量</strong>：跳数（Hop Count），最大为15。16表示不可达。</li><li><strong>更新机制</strong>：每30秒与邻居交换一次路由表。</li><li><strong>缺点</strong>：最大跳数限制了网络规模，收敛速度慢，容易产生路由环路。</li></ul><h3 id="链路状态算法-Link-State"><a href="#链路状态算法-Link-State" class="headerlink" title="链路状态算法 (Link-State)"></a>链路状态算法 (Link-State)</h3><p>链路状态算法中，每个路由器都试图获取网络的完整拓扑信息。它通过向网络中所有其他路由器广播自己的链路状态信息（与哪些邻居相连以及链路成本）来实现这一点。</p><p>核心思想：<strong>迪杰斯特拉算法 (Dijkstra)</strong>。每个路由器在拥有了完整的网络拓扑图后，以自己为根节点，计算到所有其他节点的最短路径。</p><h4 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h4><ol><li><strong>发现邻居</strong>：路由器启动时，向邻居发送Hello包，建立邻接关系。</li><li><strong>测量成本</strong>：测量到每个邻居的链路成本（如延迟、带宽）。</li><li><strong>构建链路状态包 (LSP)</strong>：将自己的身份、邻居列表和链路成本打包成LSP。</li><li><strong>广播LSP</strong>：通过**泛洪（Flooding）**方式将LSP发送给网络中所有其他路由器。</li><li><strong>计算最短路径</strong>：每个路由器根据收集到的所有LSP，构建出完整的网络拓扑图，并使用Dijkstra算法计算最短路径。</li></ol><h4 id="Dijkstra算法伪代码"><a href="#Dijkstra算法伪代码" class="headerlink" title="Dijkstra算法伪代码"></a>Dijkstra算法伪代码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function Dijkstra(Graph, source):</span><br><span class="line"></span><br><span class="line">    create vertex set Q</span><br><span class="line"></span><br><span class="line">    for each vertex v in Graph:</span><br><span class="line">        dist[v] = INFINITY</span><br><span class="line">        prev[v] = UNDEFINED</span><br><span class="line">        add v to Q</span><br><span class="line">    dist[source] = 0</span><br><span class="line"></span><br><span class="line">    while Q is not empty:</span><br><span class="line">        u = vertex in Q with min dist[u]</span><br><span class="line">        remove u from Q</span><br><span class="line"></span><br><span class="line">        for each neighbor v of u:</span><br><span class="line">            alt = dist[u] + length(u, v)</span><br><span class="line">            if alt &lt; dist[v]:</span><br><span class="line">                dist[v] = alt</span><br><span class="line">                prev[v] = u</span><br><span class="line"></span><br><span class="line">    return dist[], prev[]</span><br></pre></td></tr></table></figure><h4 id="典型协议：OSPF"><a href="#典型协议：OSPF" class="headerlink" title="典型协议：OSPF"></a>典型协议：OSPF</h4><p><strong>开放最短路径优先 (Open Shortest Path First, OSPF)</strong> 是目前应用最广泛的内部网关协议，基于链路状态算法。</p><ul><li><strong>成本度量</strong>：基于带宽计算，与链路带宽成反比。</li><li><strong>更新机制</strong>：当链路状态发生变化时才进行触发式更新，效率高。</li><li><strong>区域划分</strong>：支持将大型网络划分为多个区域（Area），减少了路由信息的交换量，提高了可扩展性。</li></ul><h3 id="距离向量-vs-链路状态"><a href="#距离向量-vs-链路状态" class="headerlink" title="距离向量 vs. 链路状态"></a>距离向量 vs. 链路状态</h3><table><thead><tr><th align="left">对比维度</th><th align="left">距离向量 (DV)</th><th align="left">链路状态 (LS)</th></tr></thead><tbody><tr><td align="left"><strong>拓扑认知</strong></td><td align="left">只了解邻居，对全局拓扑无知</td><td align="left">拥有完整的网络拓扑图</td></tr><tr><td align="left"><strong>信息交换</strong></td><td align="left">与邻居交换路由表</td><td align="left">向全网广播链路状态</td></tr><tr><td align="left"><strong>算法复杂度</strong></td><td align="left">简单，但可能收敛慢</td><td align="left">复杂 (Dijkstra)，但收敛快</td></tr><tr><td align="left"><strong>收敛速度</strong></td><td align="left">慢，可能存在无穷计数问题</td><td align="left">快，触发式更新</td></tr><tr><td align="left"><strong>可扩展性</strong></td><td align="left">差，受网络规模限制</td><td align="left">好，通过区域划分支持大型网络</td></tr><tr><td align="left"><strong>典型协议</strong></td><td align="left">RIP, IGRP</td><td align="left">OSPF, IS-IS</td></tr></tbody></table><h3 id="路径向量协议：BGP"><a href="#路径向量协议：BGP" class="headerlink" title="路径向量协议：BGP"></a>路径向量协议：BGP</h3><p><strong>边界网关协议 (Border Gateway Protocol, BGP)</strong> 是互联网的核心，用于在不同的<strong>自治系统 (Autonomous System, AS)</strong> 之间交换路由信息。它不关心路径的成本，而是关心路径本身。</p><ul><li><strong>核心功能</strong>：在AS之间寻找一条“可达”且“无环”的路径。</li><li><strong>路径属性</strong>：BGP的路由决策基于多种路径属性，如AS-PATH（AS路径）、NEXT-HOP（下一跳）等，通过复杂的策略来选择最佳路由。</li><li><strong>可靠传输</strong>：BGP使用TCP作为其传输层协议，保证了路由信息的可靠交换。</li></ul><h2 id="网络层服务模型"><a href="#网络层服务模型" class="headerlink" title="网络层服务模型"></a>网络层服务模型</h2><h3 id="服务类型概述"><a href="#服务类型概述" class="headerlink" title="服务类型概述"></a>服务类型概述</h3><p>网络层可以为上层提供两种不同的服务模型，每种模型都有其特定的应用场景和技术特点。</p><h3 id="虚电路服务（Virtual-Circuit-Service）"><a href="#虚电路服务（Virtual-Circuit-Service）" class="headerlink" title="虚电路服务（Virtual Circuit Service）"></a>虚电路服务（Virtual Circuit Service）</h3><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><p><strong>虚电路</strong>：一条逻辑上的连接路径，分组沿着这条路径按存储转发方式传送。</p><table><thead><tr><th>特征类别</th><th>具体表现</th><th>技术实现</th><th>应用效果</th></tr></thead><tbody><tr><td><strong>逻辑连接</strong></td><td>建立端到端的逻辑通信路径</td><td>虚电路标识和状态维护</td><td>提供连接感知</td></tr><tr><td><strong>路径固定</strong></td><td>所有分组沿相同路径传输</td><td>路径预先计算和保留</td><td>保证传输顺序</td></tr><tr><td><strong>状态维护</strong></td><td>网络设备维护连接状态信息</td><td>虚电路表和状态机</td><td>支持流量控制</td></tr></tbody></table><h4 id="工作流程-1"><a href="#工作流程-1" class="headerlink" title="工作流程"></a>工作流程</h4><table><thead><tr><th>阶段</th><th>主要操作</th><th>网络行为</th><th>资源分配</th></tr></thead><tbody><tr><td><strong>建立连接</strong></td><td>协商通信参数，建立虚电路</td><td>路径计算和资源预留</td><td>分配虚电路号</td></tr><tr><td><strong>数据传输</strong></td><td>分组按序沿固定路径传输</td><td>基于虚电路号转发</td><td>维护连接状态</td></tr><tr><td><strong>释放连接</strong></td><td>清理连接状态，释放资源</td><td>删除路径信息</td><td>回收虚电路号</td></tr></tbody></table><h3 id="数据报服务（Datagram-Service）"><a href="#数据报服务（Datagram-Service）" class="headerlink" title="数据报服务（Datagram Service）"></a>数据报服务（Datagram Service）</h3><h4 id="基本概念-1"><a href="#基本概念-1" class="headerlink" title="基本概念"></a>基本概念</h4><p><strong>数据报服务</strong>：网络层提供简单灵活的、无连接的、尽最大努力交付的服务模式。</p><table><thead><tr><th>服务特征</th><th>具体表现</th><th>设计理念</th><th>技术优势</th></tr></thead><tbody><tr><td><strong>无连接性</strong></td><td>发送前无需建立连接</td><td>简化网络层设计</td><td>降低网络复杂度</td></tr><tr><td><strong>独立转发</strong></td><td>每个分组独立选择路由</td><td>分布式路由决策</td><td>提高网络灵活性</td></tr><tr><td><strong>尽力交付</strong></td><td>网络尽最大努力传输分组</td><td>简单的转发机制</td><td>适应多种网络环境</td></tr></tbody></table><h4 id="服务质量特征"><a href="#服务质量特征" class="headerlink" title="服务质量特征"></a>服务质量特征</h4><p><strong>“尽最大努力”的含义</strong>：</p><table><thead><tr><th>问题类型</th><th>可能发生的情况</th><th>网络层处理</th><th>解决层次</th></tr></thead><tbody><tr><td><strong>分组出错</strong></td><td>传输过程中数据损坏</td><td>一般不通知源主机</td><td>上层协议处理</td></tr><tr><td><strong>分组丢失</strong></td><td>网络拥塞或设备故障导致丢包</td><td>静默丢弃</td><td>传输层重传</td></tr><tr><td><strong>分组重复</strong></td><td>网络故障恢复导致重复传输</td><td>不进行去重处理</td><td>传输层去重</td></tr><tr><td><strong>分组失序</strong></td><td>不同路径导致到达顺序混乱</td><td>不保证顺序</td><td>传输层重排序</td></tr></tbody></table><h4 id="设计优势"><a href="#设计优势" class="headerlink" title="设计优势"></a>设计优势</h4><table><thead><tr><th>优势类别</th><th>具体表现</th><th>技术基础</th><th>应用价值</th></tr></thead><tbody><tr><td><strong>成本低廉</strong></td><td>网络设备简单，造价降低</td><td>无状态转发设计</td><td>降低网络建设成本</td></tr><tr><td><strong>运行灵活</strong></td><td>适应动态网络环境变化</td><td>自适应路由机制</td><td>提高网络鲁棒性</td></tr><tr><td><strong>应用广泛</strong></td><td>支持多种类型的网络应用</td><td>通用的服务接口</td><td>促进互联网发展</td></tr></tbody></table><h3 id="IPv4与IPv6协议对比"><a href="#IPv4与IPv6协议对比" class="headerlink" title="IPv4与IPv6协议对比"></a>IPv4与IPv6协议对比</h3><p>随着互联网的快速发展，IPv4地址资源逐渐枯竭，IPv6作为其继任者被设计出来以应对未来的网络需求。两者在设计理念和技术实现上有显著差异。</p><h4 id="核心设计差异"><a href="#核心设计差异" class="headerlink" title="核心设计差异"></a>核心设计差异</h4><table><thead><tr><th align="left">对比维度</th><th align="left">IPv4 (Internet Protocol version 4)</th><th align="left">IPv6 (Internet Protocol version 6)</th><th align="left">演进优势</th></tr></thead><tbody><tr><td align="left"><strong>地址长度</strong></td><td align="left">32位 (约43亿个地址)</td><td align="left">128位 (理论上无限的地址空间)</td><td align="left"><strong>根本解决地址耗尽问题</strong></td></tr><tr><td align="left"><strong>地址表示</strong></td><td align="left">点分十进制 (如 <code>192.168.1.1</code>)</td><td align="left">冒号十六进制 (如 <code>2001:0db8:85a3::8a2e:0370:7334</code>)</td><td align="left">更适合大规模地址管理</td></tr><tr><td align="left"><strong>报头结构</strong></td><td align="left">20字节固定部分 + 可变选项</td><td align="left">40字节固定报头 + 扩展报头</td><td align="left"><strong>简化报头，提高路由器处理效率</strong></td></tr><tr><td align="left"><strong>地址配置</strong></td><td align="left">手动配置、DHCP</td><td align="left"><strong>无状态地址自动配置 (SLAAC)</strong>、DHCPv6</td><td align="left"><strong>即插即用，简化网络管理</strong></td></tr><tr><td align="left"><strong>安全性</strong></td><td align="left">可选的IPsec协议</td><td align="left"><strong>强制内置IPsec支持</strong></td><td align="left"><strong>原生提供端到端安全保障</strong></td></tr><tr><td align="left"><strong>服务质量(QoS)</strong></td><td align="left">通过区分服务(DiffServ)字段支持</td><td align="left">通过流标签(Flow Label)字段优化</td><td align="left"><strong>更精细化的流量控制</strong></td></tr><tr><td align="left"><strong>分片处理</strong></td><td align="left">路由器和源主机均可分片</td><td align="left"><strong>仅源主机可分片</strong></td><td align="left"><strong>减轻路由器负担，提升转发性能</strong></td></tr><tr><td align="left"><strong>广播支持</strong></td><td align="left">支持广播 (Broadcast)</td><td align="left"><strong>不支持广播</strong>，由任播(Anycast)和组播(Multicast)替代</td><td align="left">减少网络风暴，提高网络效率</td></tr></tbody></table><h4 id="IPv4报头结构"><a href="#IPv4报头结构" class="headerlink" title="IPv4报头结构"></a>IPv4报头结构</h4><p>IPv4报头由20字节的固定部分和最多40字节的可选字段组成。</p><table><thead><tr><th align="left">字段</th><th align="left">位数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>版本 (Version)</strong></td><td align="left">4</td><td align="left">IP协议版本号，对IPv4恒为4。</td></tr><tr><td align="left"><strong>首部长度 (IHL)</strong></td><td align="left">4</td><td align="left">报头长度，单位为4字节，最小为5 (20字节)。</td></tr><tr><td align="left"><strong>区分服务 (DS)</strong></td><td align="left">8</td><td align="left">用于服务质量(QoS)，替代了旧的TOS字段。</td></tr><tr><td align="left"><strong>总长度 (Total Length)</strong></td><td align="left">16</td><td align="left">整个IP数据报的长度（报头+数据），单位为字节。</td></tr><tr><td align="left"><strong>标识 (Identification)</strong></td><td align="left">16</td><td align="left">唯一标识一个数据报的所有分片。</td></tr><tr><td align="left"><strong>标志 (Flags)</strong></td><td align="left">3</td><td align="left">控制分片，如DF(Don’t Fragment), MF(More Fragments)。</td></tr><tr><td align="left"><strong>片偏移 (Fragment Offset)</strong></td><td align="left">13</td><td align="left">分片在原始数据报中的位置。</td></tr><tr><td align="left"><strong>生存时间 (TTL)</strong></td><td align="left">8</td><td align="left">数据报在网络中可通过的最大跳数，每经过一个路由器减1。</td></tr><tr><td align="left"><strong>协议 (Protocol)</strong></td><td align="left">8</td><td align="left">上层协议类型 (如TCP&#x3D;6, UDP&#x3D;17)。</td></tr><tr><td align="left"><strong>首部检验和 (Checksum)</strong></td><td align="left">16</td><td align="left">用于校验报头在传输中是否出错。</td></tr><tr><td align="left"><strong>源地址 (Source Address)</strong></td><td align="left">32</td><td align="left">发送方的IPv4地址。</td></tr><tr><td align="left"><strong>目的地址 (Destination Address)</strong></td><td align="left">32</td><td align="left">接收方的IPv4地址。</td></tr><tr><td align="left"><strong>选项 (Options)</strong></td><td align="left">可变</td><td align="left">用于网络测试、安全等，长度可变，最多40字节。</td></tr></tbody></table><h4 id="IPv6报头结构"><a href="#IPv6报头结构" class="headerlink" title="IPv6报头结构"></a>IPv6报头结构</h4><p>IPv6采用40字节的固定报头，将不常用的功能移至扩展报头，大大简化了基本报头结构。</p><table><thead><tr><th align="left">字段</th><th align="left">位数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>版本 (Version)</strong></td><td align="left">4</td><td align="left">IP协议版本号，对IPv6恒为6。</td></tr><tr><td align="left"><strong>流量类别 (Traffic Class)</strong></td><td align="left">8</td><td align="left">类似于IPv4的DS字段，用于QoS。</td></tr><tr><td align="left"><strong>流标签 (Flow Label)</strong></td><td align="left">20</td><td align="left">标识属于同一“流”的数据包，用于特定服务质量的请求。</td></tr><tr><td align="left"><strong>有效载荷长度 (Payload Length)</strong></td><td align="left">16</td><td align="left">IPv6报头之后的数据部分长度，不包括基本报头。</td></tr><tr><td align="left"><strong>下一报头 (Next Header)</strong></td><td align="left">8</td><td align="left">标识紧跟在基本报头后的扩展报头类型或上层协议。</td></tr><tr><td align="left"><strong>跳数限制 (Hop Limit)</strong></td><td align="left">8</td><td align="left">相当于IPv4的TTL。</td></tr><tr><td align="left"><strong>源地址 (Source Address)</strong></td><td align="left">128</td><td align="left">发送方的IPv6地址。</td></tr><tr><td align="left"><strong>目的地址 (Destination Address)</strong></td><td align="left">128</td><td align="left">接收方的IPv6地址。</td></tr></tbody></table><p><strong>IPv6扩展报头</strong>：IPv6将选项功能放入可串联的扩展报头中，只有需要时才添加，常见的扩展报头包括逐跳选项、路由、分片、认证、封装安全有效载荷等。</p><h1 id="虚电路与数据报"><a href="#虚电路与数据报" class="headerlink" title="虚电路与数据报"></a>虚电路与数据报</h1><h2 id="虚电路服务"><a href="#虚电路服务" class="headerlink" title="虚电路服务"></a>虚电路服务</h2><ul><li><p><strong>概述</strong>：两台计算机进行通信时首先建立网络层的连接（一条逻辑上的虚电路，VC，不是物理连接。），连接建立后就固定了虚电路对应的物理路径</p><p>比较：采用电路交换的电话通信<strong>则</strong>是建立一条真正的物理连接。</p></li><li><p><strong>特点</strong>：</p><ul><li>“虚”：指的是这条电路<strong>不是专用</strong>的。一段物理链路可以有很多条虚电路。<br>节点到其他节点之间的链路可能同时有若干条虚电路通过，亦或是建立。<strong>也不需要为每条VC预分配带宽。</strong></li><li>核心思想：可靠通信由网络自身来保证。</li></ul></li></ul><p><strong>通信过程</strong>（三个阶段）：</p><ol><li>虚电路建立<ul><li>每次建立将一个未用过的虚电路号（VCID）分配给虚电路。</li><li>分组的首部仅在连接建立时使用完整的目的地址，之后每个分组的首部只需携带虚电路编号即可。</li><li>【动作】 A发“呼叫请求”分组，B收到并同意连接，发送“呼叫应答”分组进</li></ul></li><li>数据传输<ul><li>建立虚电路后，AB可以相互传送数据分组</li></ul></li><li>虚电路释放<ul><li>结束后，A发“请求释放”分组拆除虚电路；</li><li>整个连接逐个断开。</li></ul></li></ol><p><strong>虚电路服务的特点</strong></p><table><thead><tr><th>特点</th><th>详述</th></tr></thead><tbody><tr><td>时间开销大</td><td>建立和拆除需要时间开销；<br>对于交互式应用、少量短分组场景浪费；<br>对于长时间频繁数据交换效率高。</td></tr><tr><td>路由选择的体现</td><td>路由选择体现在建立阶段。</td></tr><tr><td>可靠、对端点的流量控制<br>（保证分组有序到达）</td><td>提供可靠通信功能，保证每个分组正确、有序地到达；<br>可以对两个端点流量进行控制，通知发送方暂缓发送</td></tr><tr><td><strong>致命弱点</strong></td><td>某个节点或某条链路出现故障、彻底失效时，会破坏经过这个节点或链路的虚电路。</td></tr><tr><td>相对数据报方式开销小</td><td>分组首部不包含目的地址，而是虚电路号。</td></tr></tbody></table><h2 id="数据报服务"><a href="#数据报服务" class="headerlink" title="数据报服务"></a>数据报服务</h2><p><strong>概述</strong></p><ul><li>网络在发送分组前不需要先建立连接；</li><li>源主机的高层协议将报文拆成若干较小的数据段，并加上地址等控制信息后构成分组；</li><li>中间阶段存储分组很短一段时间，找到路由后尽快转发给每个分组。</li><li><strong>网络层不提供服务质量承诺</strong>。不提供端到端的可靠传输服务。所以路由器比较简单，造价低廉。复杂的网络功能置于因特网边缘（用户主机及其内部运输层）</li></ul><p><strong>通信过程</strong>：A向B发送分组</p><table><thead><tr><th>步骤</th><th>详述</th></tr></thead><tbody><tr><td>主机A发给交换节点</td><td>主机A先将分组逐个发往与之直接相连的交换节点，交换节点缓存分组</td></tr><tr><td>查找转发表</td><td>交换节点查找自己的转发表，转发给别的交换节点</td></tr><tr><td>继续转发直到抵达B</td><td>其他交换节点也类似地继续转发，直到B收到</td></tr></tbody></table><p><strong>数据报服务特点</strong></p><table><thead><tr><th>特点</th><th>详述</th></tr></thead><tbody><tr><td>无须建立连接</td><td>发送方随时发送，接收方随时接收</td></tr><tr><td>不保证可靠</td><td>网络只是尽最大努力交付。分组可能丢失。由于每个分组路由选择转发都是独立的，所以路径可能不同，分组也不一定按序到达</td></tr><tr><td>需完整地址</td><td>需要包括发送方和接收方的完整地址，这样才能独立传输</td></tr><tr><td>视情况丢弃</td><td>分组在交换节点处的存储转发需要排队等候，产生时延，网络拥塞时视情况丢弃部分分组</td></tr><tr><td>适应能力强</td><td>对于冗余和故障路径，相应地更新转发表，对故障适应能力强</td></tr></tbody></table><p><strong>优点</strong>：网络造价大大降低。运行方式灵活。适用多种应用场景。</p><h2 id="软件定义网络（SDN）"><a href="#软件定义网络（SDN）" class="headerlink" title="软件定义网络（SDN）"></a>软件定义网络（SDN）</h2><h3 id="SDN技术概述"><a href="#SDN技术概述" class="headerlink" title="SDN技术概述"></a>SDN技术概述</h3><h4 id="基本概念-2"><a href="#基本概念-2" class="headerlink" title="基本概念"></a>基本概念</h4><p><strong>软件定义网络（Software-Defined Networking, SDN）</strong>：一种创新的网络架构，采用集中式控制平面和分布式数据平面，实现控制与转发的彻底分离。</p><table><thead><tr><th>架构特征</th><th>传统网络</th><th>SDN网络</th></tr></thead><tbody><tr><td><strong>控制模式</strong></td><td>分布式控制</td><td>集中式控制</td></tr><tr><td><strong>平面耦合</strong></td><td>控制平面与数据平面紧耦合</td><td>控制平面与数据平面分离</td></tr><tr><td><strong>设备功能</strong></td><td>路由器具备完整控制和转发功能</td><td>交换机仅负责数据转发</td></tr><tr><td><strong>网络视图</strong></td><td>局部网络状态</td><td>全局网络状态视图</td></tr></tbody></table><h4 id="传统网络架构对比"><a href="#传统网络架构对比" class="headerlink" title="传统网络架构对比"></a>传统网络架构对比</h4><p><strong>传统路由器特征</strong>：</p><ul><li>既有转发表又有路由选择软件</li><li>既有数据平面又有控制平面</li><li>路由器之间相互交换路由信息</li></ul><p><strong>SDN架构变革</strong>：</p><ul><li>路由器不再需要路由选择软件</li><li>路由器只执行简单操作：接收分组→查找转发表→转发分组</li><li>路由信息由远程控制器统一计算和下发</li></ul><h3 id="SDN架构组件"><a href="#SDN架构组件" class="headerlink" title="SDN架构组件"></a>SDN架构组件</h3><h4 id="控制平面设计"><a href="#控制平面设计" class="headerlink" title="控制平面设计"></a>控制平面设计</h4><p><strong>远程控制器</strong>：位于网络中心位置的逻辑控制实体。</p><table><thead><tr><th>控制器功能</th><th>具体职责</th><th>技术实现</th><th>优势分析</th></tr></thead><tbody><tr><td><strong>状态感知</strong></td><td>掌握各主机和整个网络状态</td><td>拓扑发现和状态监控</td><td>提供全局网络视图</td></tr><tr><td><strong>路径计算</strong></td><td>为每个分组计算最佳路由</td><td>集中式路由算法</td><td>实现全局最优化</td></tr><tr><td><strong>策略下发</strong></td><td>通过南向接口下发转发表</td><td>OpenFlow等标准协议</td><td>统一网络控制</td></tr><tr><td><strong>协议替代</strong></td><td>取代传统分布式路由协议</td><td>集中式控制逻辑</td><td>简化网络管理</td></tr></tbody></table><h4 id="接口体系架构"><a href="#接口体系架构" class="headerlink" title="接口体系架构"></a>接口体系架构</h4><p><strong>SDN三大接口类型</strong>：</p><table><thead><tr><th>接口类型</th><th>连接对象</th><th>主要功能</th><th>典型协议</th></tr></thead><tbody><tr><td><strong>北向接口</strong></td><td>控制器与上层应用</td><td>提供丰富API，屏蔽底层细节</td><td>RESTful API</td></tr><tr><td><strong>南向接口</strong></td><td>控制器与转发设备</td><td>建立双向会话，兼容不同硬件</td><td>OpenFlow、NETCONF</td></tr><tr><td><strong>东西向接口</strong></td><td>控制器集群内部通信</td><td>增强可靠性和可扩展性</td><td>集群协调协议</td></tr></tbody></table><h3 id="SDN技术优势与挑战"><a href="#SDN技术优势与挑战" class="headerlink" title="SDN技术优势与挑战"></a>SDN技术优势与挑战</h3><h4 id="核心优势"><a href="#核心优势" class="headerlink" title="核心优势"></a>核心优势</h4><table><thead><tr><th>优势类别</th><th>具体表现</th><th>技术基础</th><th>应用价值</th></tr></thead><tbody><tr><td><strong>集中控制</strong></td><td>全局集中式控制和分布式高速转发</td><td>控制平面集中化</td><td>实现网络全局优化</td></tr><tr><td><strong>可编程性</strong></td><td>灵活可编程与性能平衡</td><td>标准化编程接口</td><td>支持快速业务创新</td></tr><tr><td><strong>成本优化</strong></td><td>网络设备制造与软件开发分离</td><td>硬件软件解耦设计</td><td>降低网络建设成本</td></tr><tr><td><strong>管理简化</strong></td><td>专用自动化工具编程配置</td><td>统一管理平台</td><td>提高运维效率</td></tr></tbody></table><h4 id="面临挑战"><a href="#面临挑战" class="headerlink" title="面临挑战"></a>面临挑战</h4><table><thead><tr><th>挑战类别</th><th>具体问题</th><th>风险分析</th><th>应对策略</th></tr></thead><tbody><tr><td><strong>安全风险</strong></td><td>集中管理受攻击影响整个网络</td><td>单点故障风险</td><td>控制器冗余和安全加固</td></tr><tr><td><strong>性能瓶颈</strong></td><td>网络规模扩大后控制器成瓶颈</td><td>处理能力限制</td><td>分布式控制器架构</td></tr><tr><td><strong>标准化</strong></td><td>不同厂商设备兼容性问题</td><td>标准不统一</td><td>推进标准化进程</td></tr><tr><td><strong>可靠性</strong></td><td>控制器故障导致网络中断</td><td>可用性要求</td><td>高可用架构设计</td></tr></tbody></table><h2 id="网络拥塞控制"><a href="#网络拥塞控制" class="headerlink" title="网络拥塞控制"></a>网络拥塞控制</h2><h3 id="拥塞控制基础概念"><a href="#拥塞控制基础概念" class="headerlink" title="拥塞控制基础概念"></a>拥塞控制基础概念</h3><h4 id="拥塞现象定义"><a href="#拥塞现象定义" class="headerlink" title="拥塞现象定义"></a>拥塞现象定义</h4><p><strong>网络拥塞（Network Congestion）</strong>：当网络中传输的数据量超过网络处理能力时，导致网络性能急剧下降的现象。</p><table><thead><tr><th>拥塞特征</th><th>具体表现</th><th>产生原因</th><th>影响后果</th></tr></thead><tbody><tr><td><strong>过量负载</strong></td><td>输入流量超过网络处理能力</td><td>多个数据流同时传输</td><td>队列溢出和丢包</td></tr><tr><td><strong>性能下降</strong></td><td>网络吞吐量和响应时间恶化</td><td>资源竞争和排队延迟</td><td>用户体验质量降低</td></tr><tr><td><strong>连锁反应</strong></td><td>局部拥塞扩散到整个网络</td><td>重传和路由振荡</td><td>网络稳定性受损</td></tr></tbody></table><h4 id="拥塞状态判断"><a href="#拥塞状态判断" class="headerlink" title="拥塞状态判断"></a>拥塞状态判断</h4><p><strong>拥塞检测指标</strong>：</p><table><thead><tr><th>拥塞程度</th><th>网络表现</th><th>吞吐量特征</th><th>处理策略</th></tr></thead><tbody><tr><td><strong>正常状态</strong></td><td>负载增加，吞吐量线性增长</td><td>吞吐量与负载成正比</td><td>维持当前传输速率</td></tr><tr><td><strong>轻度拥塞</strong></td><td>负载增加，吞吐量增长放缓</td><td>吞吐量明显小于正常值</td><td>适度降低发送速率</td></tr><tr><td><strong>严重拥塞</strong></td><td>负载增加，吞吐量反而下降</td><td>吞吐量随负载增大而减少</td><td>大幅减少发送速率</td></tr><tr><td><strong>拥塞崩溃</strong></td><td>网络几乎无法传输有效数据</td><td>吞吐量接近零</td><td>暂停发送并重新开始</td></tr></tbody></table><h3 id="拥塞控制目标与原理"><a href="#拥塞控制目标与原理" class="headerlink" title="拥塞控制目标与原理"></a>拥塞控制目标与原理</h3><h4 id="控制目标"><a href="#控制目标" class="headerlink" title="控制目标"></a>控制目标</h4><p><strong>拥塞控制的核心目标</strong>：</p><table><thead><tr><th>目标类别</th><th>具体要求</th><th>实现方式</th><th>评价指标</th></tr></thead><tbody><tr><td><strong>信息获取</strong></td><td>及时获取网络拥塞状态信息</td><td>拥塞检测和反馈机制</td><td>检测准确性和及时性</td></tr><tr><td><strong>流量调节</strong></td><td>根据拥塞信息调整发送速率</td><td>自适应速率控制算法</td><td>网络利用率和公平性</td></tr><tr><td><strong>稳定运行</strong></td><td>确保网络能承载达到的流量</td><td>负载均衡和资源管理</td><td>网络稳定性和可靠性</td></tr></tbody></table><h4 id="与流量控制的区别"><a href="#与流量控制的区别" class="headerlink" title="与流量控制的区别"></a>与流量控制的区别</h4><p><strong>拥塞控制 vs 流量控制</strong>：</p><table><thead><tr><th>对比维度</th><th>拥塞控制</th><th>流量控制</th></tr></thead><tbody><tr><td><strong>控制范围</strong></td><td>整个网络的全局控制</td><td>发送方和接收方的点对点控制</td></tr><tr><td><strong>控制目标</strong></td><td>防止网络拥塞，保护网络资源</td><td>防止接收方缓冲区溢出</td></tr><tr><td><strong>反馈信息</strong></td><td>网络中间节点的拥塞状态</td><td>接收方的缓冲区状态</td></tr><tr><td><strong>调节对象</strong></td><td>所有发送方的发送速率</td><td>特定连接的发送速率</td></tr></tbody></table><h3 id="拥塞控制方法"><a href="#拥塞控制方法" class="headerlink" title="拥塞控制方法"></a>拥塞控制方法</h3><h4 id="开环控制（静态方法）"><a href="#开环控制（静态方法）" class="headerlink" title="开环控制（静态方法）"></a>开环控制（静态方法）</h4><p><strong>开环控制特征</strong>：在网络设计阶段预先考虑拥塞因素，制定静态策略。</p><table><thead><tr><th>控制策略</th><th>实现机制</th><th>适用场景</th><th>优缺点分析</th></tr></thead><tbody><tr><td><strong>准入控制</strong></td><td>限制新连接的建立速率</td><td>连接建立阶段</td><td>简单有效但缺乏灵活性</td></tr><tr><td><strong>流量整形</strong></td><td>预先定义流量发送模式</td><td>流量源头控制</td><td>平滑流量但响应滞后</td></tr><tr><td><strong>资源预留</strong></td><td>为重要流量预留网络资源</td><td>关键业务保障</td><td>保证质量但资源浪费</td></tr><tr><td><strong>丢包策略</strong></td><td>预定义分组丢弃规则</td><td>缓冲区管理</td><td>防止溢出但可能过激</td></tr></tbody></table><p><strong>决策特点</strong>：做决定时不考虑当前网络状态，基于历史经验和统计规律。</p><h4 id="闭环控制（动态方法）"><a href="#闭环控制（动态方法）" class="headerlink" title="闭环控制（动态方法）"></a>闭环控制（动态方法）</h4><p><strong>闭环控制特征</strong>：基于实时网络状态反馈，动态调整控制策略。</p><table><thead><tr><th>控制阶段</th><th>主要活动</th><th>技术实现</th><th>反馈机制</th></tr></thead><tbody><tr><td><strong>监测检测</strong></td><td>实时监控网络状态和性能指标</td><td>拥塞检测算法</td><td>状态信息收集</td></tr><tr><td><strong>信息反馈</strong></td><td>将拥塞信息传递给控制实体</td><td>显式&#x2F;隐式反馈机制</td><td>拥塞通知传输</td></tr><tr><td><strong>策略调整</strong></td><td>根据反馈信息调整网络行为</td><td>自适应控制算法</td><td>参数动态更新</td></tr><tr><td><strong>效果评估</strong></td><td>评估控制策略的执行效果</td><td>性能监控和分析</td><td>控制效果反馈</td></tr></tbody></table><p><strong>反馈回路组成</strong>：</p><table><thead><tr><th>组件类型</th><th>功能作用</th><th>实现位置</th><th>关键技术</th></tr></thead><tbody><tr><td><strong>监测系统</strong></td><td>检测网络拥塞状态</td><td>网络节点和链路</td><td>队列长度、延迟测量</td></tr><tr><td><strong>反馈机制</strong></td><td>传递拥塞信息</td><td>控制报文或数据标记</td><td>ICMP、ECN等协议</td></tr><tr><td><strong>控制算法</strong></td><td>根据反馈调整发送行为</td><td>发送端和网络设备</td><td>速率控制、路由调整</td></tr><tr><td><strong>执行机制</strong></td><td>实施具体的控制措施</td><td>各网络层次</td><td>队列管理、调度算法</td></tr></tbody></table><h2 id="网络设备与交换技术"><a href="#网络设备与交换技术" class="headerlink" title="网络设备与交换技术"></a>网络设备与交换技术</h2><h3 id="网络互联基础原理"><a href="#网络互联基础原理" class="headerlink" title="网络互联基础原理"></a>网络互联基础原理</h3><h4 id="路由器互联要求"><a href="#路由器互联要求" class="headerlink" title="路由器互联要求"></a>路由器互联要求</h4><p><strong>协议层次兼容性原则</strong>：路由器互联的多个局域网对协议层次有特定要求。</p><table><thead><tr><th>协议层次</th><th>兼容性要求</th><th>技术原因</th><th>实际影响</th></tr></thead><tbody><tr><td><strong>物理层</strong></td><td>可以不同</td><td>路由器可适配不同物理接口</td><td>支持异构网络连接</td></tr><tr><td><strong>数据链路层</strong></td><td>可以不同</td><td>路由器处理不同帧格式</td><td>实现多种LAN互联</td></tr><tr><td><strong>网络层</strong></td><td>可以不同</td><td>路由器支持协议转换</td><td>如IPv4与IPv6互联</td></tr><tr><td><strong>传输层及以上</strong></td><td>必须相同</td><td>路由器仅工作到网络层</td><td>确保端到端通信兼容</td></tr></tbody></table><p><strong>技术原理</strong>：路由器作为第三层设备，只能影响网络层及以下协议，对传输层以上协议无法进行处理和转换。</p><p><strong>典型应用场景</strong>：IPv4和IPv6网络的互联需要专门的协议转换机制。</p><h3 id="网络设备分类与特征"><a href="#网络设备分类与特征" class="headerlink" title="网络设备分类与特征"></a>网络设备分类与特征</h3><h4 id="设备工作层次对比"><a href="#设备工作层次对比" class="headerlink" title="设备工作层次对比"></a>设备工作层次对比</h4><p><strong>网络设备分层工作原理</strong>：</p><table><thead><tr><th>设备类型</th><th>工作层次</th><th>核心功能</th><th>广播域处理</th><th>冲突域处理</th></tr></thead><tbody><tr><td><strong>集线器</strong></td><td>物理层</td><td>信号再生和广播转发</td><td>不能分隔广播域</td><td>不能分隔冲突域</td></tr><tr><td><strong>交换机</strong></td><td>数据链路层</td><td>基于MAC地址的智能转发</td><td>不能分隔广播域</td><td>能够分隔冲突域</td></tr><tr><td><strong>路由器</strong></td><td>网络层</td><td>基于IP地址的路径选择</td><td>能够分隔广播域</td><td>能够分隔冲突域</td></tr></tbody></table><h4 id="路由器技术特征"><a href="#路由器技术特征" class="headerlink" title="路由器技术特征"></a>路由器技术特征</h4><p><strong>路由器多网络互联特性</strong>：</p><table><thead><tr><th>技术特征</th><th>具体表现</th><th>技术优势</th><th>应用价值</th></tr></thead><tbody><tr><td><strong>广播控制</strong></td><td>不转发广播包，分隔广播域</td><td>抑制广播风暴</td><td>提高网络性能</td></tr><tr><td><strong>多地址配置</strong></td><td>每个接口具有独立IP地址</td><td>支持多网络连接</td><td>实现网络间路由</td></tr><tr><td><strong>硬件地址管理</strong></td><td>每个接口具有独立MAC地址</td><td>适配不同网络环境</td><td>确保数据链路层通信</td></tr><tr><td><strong>路由决策</strong></td><td>基于路由表进行转发决策</td><td>实现最优路径选择</td><td>优化网络传输效率</td></tr></tbody></table><h3 id="交换技术分类与对比"><a href="#交换技术分类与对比" class="headerlink" title="交换技术分类与对比"></a>交换技术分类与对比</h3><h4 id="交换技术特征对比"><a href="#交换技术特征对比" class="headerlink" title="交换技术特征对比"></a>交换技术特征对比</h4><p><strong>四种主要交换技术</strong>：</p><table><thead><tr><th>交换技术</th><th>技术特征</th><th>服务质量</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>电路交换</strong></td><td>建立专用物理通路</td><td>无差错控制功能</td><td>传统电话网络</td></tr><tr><td><strong>报文交换</strong></td><td>以完整报文为传输单位</td><td>存储转发，延迟较大</td><td>早期数据通信</td></tr><tr><td><strong>分组交换</strong></td><td>分为数据报和虚电路两种方式</td><td>限制分组大小</td><td>现代数据网络</td></tr><tr><td><strong>存储转发</strong></td><td>先接收完整分组再转发</td><td>确保数据完整性</td><td>所有分组交换网络</td></tr></tbody></table><h4 id="报文交换技术分析"><a href="#报文交换技术分析" class="headerlink" title="报文交换技术分析"></a>报文交换技术分析</h4><p><strong>报文交换技术特点</strong>：</p><table><thead><tr><th>技术维度</th><th>具体特征</th><th>技术影响</th><th>应用限制</th></tr></thead><tbody><tr><td><strong>传输单位</strong></td><td>报文大小不固定</td><td>需要较大存储空间</td><td>存储需求高</td></tr><tr><td><strong>处理时间</strong></td><td>因报文大小不固定而变化</td><td>处理时间不可预测</td><td>不适合实时通信</td></tr><tr><td><strong>存储要求</strong></td><td>节点需存储完整报文</td><td>对设备内存要求高</td><td>增加设备成本</td></tr><tr><td><strong>传输特性</strong></td><td>存储转发方式</td><td>传输可靠性较高</td><td>延迟相对较大</td></tr></tbody></table><h4 id="分组交换服务模式"><a href="#分组交换服务模式" class="headerlink" title="分组交换服务模式"></a>分组交换服务模式</h4><p><strong>数据报交换特征</strong>：</p><table><thead><tr><th>服务特征</th><th>技术实现</th><th>服务优势</th><th>技术挑战</th></tr></thead></table><h2 id="网络层前沿技术与发展趋势"><a href="#网络层前沿技术与发展趋势" class="headerlink" title="网络层前沿技术与发展趋势"></a>网络层前沿技术与发展趋势</h2><p>随着云计算、大数据、人工智能等技术的飞速发展，传统网络架构面临着灵活性差、管理复杂、创新困难等诸多挑战。为此，一系列以智能化、虚拟化、可编程为核心的网络层前沿技术应运而生，引领着未来网络的发展方向。</p><h3 id="软件定义网络-Software-Defined-Networking-SDN"><a href="#软件定义网络-Software-Defined-Networking-SDN" class="headerlink" title="软件定义网络 (Software-Defined Networking, SDN)"></a>软件定义网络 (Software-Defined Networking, SDN)</h3><p>SDN是近年来最重要的一次网络架构变革。其核心思想是<strong>控制与转发分离</strong>，将原本分布在各个网络设备（如路由器、交换机）上的控制平面集中到一个中央控制器上，从而实现对网络资源的灵活调度和可编程控制。</p><table><thead><tr><th align="left">SDN架构三层</th><th align="left">功能</th><th align="left">关键接口</th></tr></thead><tbody><tr><td align="left"><strong>应用层</strong></td><td align="left">运行各种网络应用和服务，如负载均衡、安全策略、网络监控等。</td><td align="left"><strong>北向接口 (NBI)</strong></td></tr><tr><td align="left"><strong>控制层</strong></td><td align="left">网络的“大脑”，通过中央控制器（SDN Controller）维护全网拓扑，计算路由，并下发转发表。</td><td align="left">-</td></tr><tr><td align="left"><strong>数据层</strong></td><td align="left">由简单的转发设备（“白盒交换机”）组成，根据控制器下发的流表（Flow Table）进行高速数据包转发。</td><td align="left"><strong>南向接口 (SBI)</strong>，如OpenFlow</td></tr></tbody></table><p><strong>SDN的优势</strong>：</p><ul><li><strong>集中控制与全局视野</strong>：控制器拥有全网拓扑信息，能够做出最优的全局决策。</li><li><strong>网络可编程性</strong>：通过开放的北向接口，开发者可以像编写软件一样定义和管理网络行为。</li><li><strong>自动化与敏捷性</strong>：快速部署新业务、自动化运维，降低了人力成本。</li><li><strong>开放与创新</strong>：打破了传统网络设备厂商的锁定，促进了网络技术的创新。</li></ul><h3 id="网络功能虚拟化-Network-Functions-Virtualization-NFV"><a href="#网络功能虚拟化-Network-Functions-Virtualization-NFV" class="headerlink" title="网络功能虚拟化 (Network Functions Virtualization, NFV)"></a>网络功能虚拟化 (Network Functions Virtualization, NFV)</h3><p>NFV旨在将传统的、基于专用硬件的网络功能（如防火墙、负载均衡器、NAT）从硬件中解耦出来，以纯软件的形式运行在通用的x86服务器上。NFV与SDN相辅相成，共同推动网络的虚拟化和软件化。</p><table><thead><tr><th align="left">NFV架构组件</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><strong>虚拟网络功能 (VNF)</strong></td><td align="left">软件化的网络功能实例，如虚拟防火墙(vFW)、虚拟负载均衡器(vLB)。</td></tr><tr><td align="left"><strong>NFV基础设施 (NFVI)</strong></td><td align="left">提供计算、存储、网络资源的通用硬件平台。</td></tr><tr><td align="left"><strong>管理与编排 (MANO)</strong></td><td align="left">负责VNF的生命周期管理、资源编排和自动化部署。</td></tr></tbody></table><p><strong>NFV的优势</strong>：</p><ul><li><strong>降低成本</strong>：用廉价的通用服务器替代昂贵的专用硬件。</li><li><strong>灵活性与弹性</strong>：按需创建、伸缩和迁移网络功能，快速响应业务变化。</li><li><strong>加速创新</strong>：缩短了新网络服务的开发和部署周期。</li></ul><h3 id="段路由-Segment-Routing-SRv6"><a href="#段路由-Segment-Routing-SRv6" class="headerlink" title="段路由 (Segment Routing, SRv6)"></a>段路由 (Segment Routing, SRv6)</h3><p>段路由是一种先进的源路由技术，它通过在数据包头中插入一个有序的“段”（Segment）列表来指导数据包的转发路径。特别是基于IPv6的段路由（SRv6），利用IPv6扩展报头的灵活性，实现了强大的网络编程能力。</p><p><strong>核心思想</strong>：将网络路径分解为一系列的“段”，每个段代表一个特定的转发指令（如“到达节点X”、“经过链路Y”）。发送方在包头中指定这些段，网络设备只需按序执行即可，无需维护复杂的每流状态。</p><p><strong>SRv6的优势</strong>：</p><ul><li><strong>简化网络</strong>：中间节点无需维护复杂的路径状态，降低了网络协议的复杂度。</li><li><strong>强大的可编程性</strong>：通过组合不同的段，可以实现精细化的流量工程和业务链（Service Chaining）。</li><li><strong>与SDN完美结合</strong>：SDN控制器可以轻松计算和下发段路径，实现对流量的精准控制。</li></ul><h3 id="意图驱动网络-Intent-Based-Networking-IBN"><a href="#意图驱动网络-Intent-Based-Networking-IBN" class="headerlink" title="意图驱动网络 (Intent-Based Networking, IBN)"></a>意图驱动网络 (Intent-Based Networking, IBN)</h3><p>IBN是网络自动化的更高阶段，它允许网络管理员用自然的业务语言（“意图”）来描述网络需求，而不是通过复杂的命令行配置。IBN系统负责将高级意图自动翻译成具体的网络策略，并完成部署、监控和保障。</p><p><strong>IBN工作流程</strong>：</p><ol><li><strong>意图转译</strong>：将管理员的业务意图（如“保证视频会议的质量”）转译为网络策略。</li><li><strong>策略部署</strong>：自动化地在全网设备上配置相应策略。</li><li><strong>持续验证</strong>：实时监控网络状态，确保网络行为与原始意图一致。</li><li><strong>智能修复</strong>：当出现偏差时，自动进行调整和修复，形成闭环控制。</li></ol><p>IBN代表了网络管理的未来方向，即从“如何做”转变为“做什么”，极大地提升了网络的自动化和智能化水平。<br>| <strong>路由选择</strong> | 每个分组独立选择路由 | 故障后可另选路径 | 可能出现丢失和失序 |<br>| <strong>可靠性保证</strong> | 依赖高层协议（如TCP） | 网络层实现简单 | 端到端可靠性复杂 |</p><p><strong>虚电路交换特征</strong>：</p><table><thead><tr><th>服务特征</th><th>技术实现</th><th>服务优势</th><th>技术挑战</th></tr></thead><tbody><tr><td><strong>连接模式</strong></td><td>面向连接，可靠服务</td><td>保证可靠有序传输</td><td>连接建立开销</td></tr><tr><td><strong>路径固定</strong></td><td>建立连接后路径固定</td><td>分组按序到达</td><td>不适合高出错率系统</td></tr><tr><td><strong>故障处理</strong></td><td>节点故障影响整条虚电路</td><td>服务质量可保证</td><td>容错能力相对较弱</td></tr></tbody></table><h3 id="存储转发机制"><a href="#存储转发机制" class="headerlink" title="存储转发机制"></a>存储转发机制</h3><h4 id="存储转发工作原理"><a href="#存储转发工作原理" class="headerlink" title="存储转发工作原理"></a>存储转发工作原理</h4><p><strong>存储转发机制定义</strong>：网络节点必须先完整接收整个分组，然后才开始转发分组的第一位。</p><table><thead><tr><th>机制特征</th><th>技术实现</th><th>技术优势</th><th>性能影响</th></tr></thead><tbody><tr><td><strong>完整接收</strong></td><td>接收完整分组后再处理</td><td>确保数据完整性</td><td>增加转发延迟</td></tr><tr><td><strong>错误检测</strong></td><td>可在转发前检测传输错误</td><td>避免错误数据传播</td><td>提高网络可靠性</td></tr><tr><td><strong>缓冲管理</strong></td><td>需要足够缓冲空间存储分组</td><td>支持不同速率链路</td><td>增加设备成本</td></tr><tr><td><strong>流量控制</strong></td><td>可实现有效的流量控制</td><td>防止网络拥塞</td><td>优化网络性能</td></tr></tbody></table><h1 id="IPv4"><a href="#IPv4" class="headerlink" title="IPv4"></a>IPv4</h1><p><strong>概述</strong>：也即网际协议(Internet Protocol,IP), 定义了数据传送的基本单元(IP分组)及其确切数据格式。IPV4地址是给因特网上的每一个主机&#x2F;路由器的每一个接口分配的一个全世界范围内的唯一32比特（IPV6为128比特）的标识符。</p><p><strong>IP数据报</strong>：IP分组也叫IP数据报。包括首部和数据部分。</p><ul><li>首部前两个字节往往以0x45开头，可用于定位IP数据报开始的位置。</li><li>补充：“4”表示版本号，0100。首部的第一个字节前4位表示IP协议的版本。首部长度以32位（四个字）为单位，标准IP首部长度为20字节，20字节&#x2F;4字节&#x3D;5 (行，一行一个字)</li><li>标识：占16bit，作为一个计数器，也是数据报的编号。每产生一个数据报就++，若长度超出MTU，则需要分片，但是分片后的几个数据报的标识都相同，以便重组。（是数据报的编号不是分片的编号）</li><li>标志：占3bit 。标志最低位MF（1表示后面还有分片，0表示最后一个分片），中间位DF&#x3D;0时才允许分片。</li><li>片偏移：占13bit。 指出较长的数据报在分片后某片在原数据报中的相对位置，以8B为偏移单位。除最后一个分片外，每个分片的长度一定是8B的整数倍。</li><li>生存时间（TTL）：8bit，数据报在网络中可通过的路由器数的最大值，也就是数据报的寿命，限制数据报的无限转发。路由器转发数据报前都要使得TTL–，减到0时丢弃。</li><li>协议：8bit，指出携带的数据使用何种协议，应当上交给哪个协议处理。6：TCP 17:UDP</li><li>首部检验和：16bit，但是只检验首部不包括数据。经过一次路由器都要重新计算一次。</li><li>源地址字段：发送方 目的地址字段：接收方 都是IP地址，都占4B</li></ul><table><thead><tr><th>字段基本单位</th><th>首部长度</th><th>总长度</th><th>片偏移</th></tr></thead><tbody><tr><td>偏移量</td><td>4B</td><td>1B</td><td>8B</td></tr></tbody></table><h2 id="IP数据报分片"><a href="#IP数据报分片" class="headerlink" title="IP数据报分片"></a>IP数据报分片</h2><p><strong>最大传送单元（MTU）</strong>：</p><ul><li>一个链路层数据帧能承载的最大数据量。链路层MTU严格限制IP数据报长度。</li><li>取决于链路层协议。 以太网MTU：1500B 许多广域网：&lt;&#x3D;576B</li><li>IP数据报总长度超出MTU时需要分装在多个较小IP数据报中，也就是分片。</li></ul><p><strong>分片重组：</strong></p><ul><li><p>目的主机使用IP首部中的标识、标志和片偏移字段完成重组。</p></li><li><p>过程：目的主机检查数据报的<code>标识号</code>确定哪些数据报属于同一个原始数据报的片。<code>标志位</code>的后两位DF和MF。</p><ul><li>只有DF&#x3D;0时能被分片。</li><li>MF告知是否是最后一个片。MF&#x3D;1说明有后续。</li><li>片偏移字段指出片应该放在原书IP数据报的哪个位置。</li></ul></li></ul><h2 id="IPv4地址"><a href="#IPv4地址" class="headerlink" title="IPv4地址"></a>IPv4地址</h2><p><strong>概述：</strong> 长度为32，唯一。格式为： {&lt;网络号&gt;，&lt;主机号&gt;}</p><ul><li>网络号：标志主机&#x2F;路由器连接到的网络。网络号在整个互联网范围内唯一。</li><li>主机号：标志主机。在网络号指明的网络范围内唯一。</li></ul><p><strong>特殊用途IP地址：</strong></p><table><thead><tr><th>地址</th><th>用途</th></tr></thead><tbody><tr><td>主机号全0</td><td>表示本网络本身。&lt;网络号，0…&gt;</td></tr><tr><td>主机号全1</td><td>表示本网络广播地址（直接广播地址） &lt;网络号，255&gt;</td></tr><tr><td>127.x.x.x</td><td>环回自检地址(Loopback Test)，用于测试网络连接性和配置，不会被路由器转发到其他网络。目的地址为环回地址的IP数据报永远不会也不可能出现在任何网络上。</td></tr><tr><td>全0：0.0.0.0</td><td>本网络上的本主机</td></tr><tr><td>全1：255.255.255.255</td><td>表示整个TCP&#x2F;IP网络的广播地址，也称受限广播地址。实际等效于本网络广播地址。</td></tr></tbody></table><p><strong>三种IP地址：</strong></p><table><thead><tr><th>网路类别</th><th>最大可用网络数</th><th>第一个可用的网络号</th><th>最后一个可用的网络号</th><th>每个网络中的最大主机数</th></tr></thead><tbody><tr><td>A</td><td>2^7-2</td><td>1</td><td>126</td><td>2^24-2</td></tr><tr><td>B</td><td>2^14</td><td>128.0</td><td>191.255</td><td>2^16-2</td></tr><tr><td>C</td><td>2^21</td><td>192.0.0</td><td>223.255.255</td><td>2^8-2</td></tr></tbody></table><p><strong>IP地址特点：</strong></p><table><thead><tr><th>IP地址特点</th><th>概述</th></tr></thead><tbody><tr><td>一种分等级地址结构</td><td>由网络号和主机号构成。IP地址管理机构只分配网络号，主机号有网络自行分配，便于管理。路由器仅根据主机的网络号来转发分组，减少路由表存储占用。</td></tr><tr><td>标志主机或链路接口</td><td>同时连接到两个不同的网络时必须同时具有两个相应IP地址，这时路由器具有两个或以上的IP地址，每个端口都有不同网络号的IP地址（因为是不同网络</td></tr><tr><td>LAN中</td><td>转发器&#x2F;桥接器（网桥等）连接的若干LAN仍是同一个网络，同一个广播域。在LAN中所有主机网络号相同（同一网络），主机号必须不同（不同个体）</td></tr><tr><td>网络平等</td><td>所有分配到网络号的网络平等</td></tr><tr><td>同一局域网</td><td>IP地址里的网络号必须相同</td></tr><tr><td>注意点</td><td>分类编址问题中，划分网络的时候，注意要同时把一群主机连接路由器也划到这群主机里。如下所示：这个网络需要254+1&#x3D;255个地址</td></tr></tbody></table><h2 id="NAT网络地址转换"><a href="#NAT网络地址转换" class="headerlink" title="NAT网络地址转换"></a>NAT网络地址转换</h2><p>**概述：**通过专用网络地址转换为公用地址，从而对外隐藏内部管理的IP地址。</p><ul><li>意义：整个专用网只需要一个全球IP地址就可和互联网</li></ul><p>**私有IP地址(可重用地址)：**用于LAN，不用于WAN</p><ul><li>不能直接用于Internet，必须通过网关利用IP地址转换为Internet中合法的全球IP地址。</li><li>并且允许私有IP地址被LAN重复使用。</li><li>互联网中所有路由器对目的地址为私有地址的数据报一律不进行转发。</li></ul><table><thead><tr><th>类别</th><th>私有IP地址网段</th></tr></thead><tbody><tr><td>1个A类网段</td><td>10.0.0.0~10.255.255.255</td></tr><tr><td>16个B类网段</td><td>172.16.0.0~172.31.255.255</td></tr><tr><td>256个C类网段</td><td>192.168.0.0~192.168.255.255</td></tr></tbody></table><p>**专用互联网：**也称本地互联网，即采用私有IP地址的互联网。</p><p><strong>使用NAT：</strong></p><ul><li>需要在专用网–&gt;互联网的路由器上安装NAT软件。</li><li>NAT路由器至少有一个有效的外部全球IP地址。可使多个私有IP映射到一个全球IP。</li><li>NAT路由器使用NAT转换表进行本地IP地址到全球IP地址的转换</li><li>NAT转换表示例： 每个 LAN 局域网 IP 地址 : 端口号 , 与 WAN 广域网 IP 地址 : 端口号 的对应关系</li><li>WAN 广域网地址 172.38.1.5 : 44444 , 对应 LAN 局域网地址 192.168.0.3 : 22222</li></ul><ul><li>网段：10.0.0.0&#x2F;8, 172.16.0.0&#x2F;12, 192.168.0.0&#x2F;16</li></ul><p><strong>NAT路由器工作原理</strong>：</p><ol><li>某家庭获得一个全球IP地址，家庭里的三台主机使用私有地址（10.0.0.0网段）。</li><li>用户主机10.0.0.1想发送数据到128.119.40.186:80 ；</li><li>NAT为IP分组生成新端口号，更改源地址为NAT的全球IP地址，更改源端口号为新端口号，并增加表项；</li><li>对方不知道分组已经变换，也不知道专用地址是多少，照常返回数据；</li><li>NAT重新转换，改回原来的端口号和原来的专用地址。</li></ol><h2 id="划分子网-（目的是减少广播域的大小，结果是增加网络数量）"><a href="#划分子网-（目的是减少广播域的大小，结果是增加网络数量）" class="headerlink" title="划分子网 （目的是减少广播域的大小，结果是增加网络数量）"></a>划分子网 （目的是减少广播域的大小，结果是增加网络数量）</h2><p>**概述：**两级IP地址的空间利用率低；给每个网络都划分一个网络后会使得路由表变得过大，降低性能。【改进】增加“子网号字段”，这就得到了三级IP地址。</p><p><strong>基本思路：</strong></p><ol><li>子网划分是内部事务，外部并不知道</li><li>从主机号借用若干位作为子网号。 地址结构变为&lt;网络号&gt;,&lt;子网号&gt;,&lt;主机号&gt;</li><li>路由器的分组转发仍然是按照目的网络号。 只是本单位路由器收到IP数据报后再次根据目的网络号和子网号找到目的子网，然后交付给目的主机。</li></ol><p><strong>子网掩码：</strong></p><ul><li><p>格式：一个与IP地址相对应的32位二进制比特串，由一串1和随后的一串0组成。1对应于IP地址中的网络后及子网号，0对应主机号。</p></li><li><p>用法：由IP地址和子网掩码进行与**（<strong><strong>AND</strong></strong>）**运算可以得出相应的子网的网络地址。</p><p>指明分类IP地址的主机号部分被借用了多少位作为子网号。</p></li><li><p>注意点</p><ul><li>路由器之间交换路由信息时必须将所在网络的子网掩码告诉对方</li><li>一台主机在设置IP地址信息的同时必须设置子网掩码。</li><li>同属于一个子网的所有主机及路由器的相应端口设置相同的子网掩码</li><li>路由器的路由表包含目的网络地址、子网掩码、下一跳地址</li></ul></li></ul><h2 id="无分类编址CIDR-无分类域间路由选择-CIDR无类别域间路由"><a href="#无分类编址CIDR-无分类域间路由选择-CIDR无类别域间路由" class="headerlink" title="无分类编址CIDR (无分类域间路由选择) CIDR无类别域间路由"></a>无分类编址CIDR (无分类域间路由选择) CIDR无类别域间路由</h2><p>**CIDR概述：**在变长子网掩码的基础上提出的一种消除传统A B C类地址及划分子网的概念。使用网络前缀的概念代替网络的概念。分配一个【块】，而不是分配一整类地址。</p><ul><li>与传统分类IP地址的最大区别：网络前缀的位数不固定，可以任意选取</li></ul><p>**记法：**IP地址&#x3D; &lt;网络前缀&gt;, &lt;主机号&gt;</p><p><strong>斜线记法(CIDR记法)</strong>：“IP地址&#x2F;网络前缀所占用的位数”</p><ul><li><p>网络前缀所占用位数对应网络号部分 &#x3D;&#x3D;子网掩码中连续1的部分</p></li><li><p>eg. 128.14.32.5&#x2F;20 掩码为20个连续的1以及随后12个连续的0,“&#x2F;”表示通过逐位“与”的方式来得到该地址的网络前缀。丫就是截取前20位。</p><p>这个IP地址可以写成10000000.00001110.00010000.00000101（写成二进制），子网掩码20为11111111.11111111.11110000.00000000（20个1），与后得到128.14.32.0（网络前缀）</p></li><li><p>可以进一步计算这个IP地址所在地址块的范围（地址块里的最小地址和最大地址）</p><table><thead><tr><th>最小地址(128.14.32.0)</th><th>最大地址(128.14.47.255)</th></tr></thead><tbody><tr><td><u>10000000.00001110.0010</u>0000.00000000</td><td><u>10000000.00001110.0010</u>1111.11111111</td></tr></tbody></table></li><li><p>注意点</p><ul><li>CIDR地址块中的地址数一定是2的整次幂。故可指派地址数一般为2^N-2 （剔除全0和全1）</li><li>地址块里的地址数越多，则网络前缀也就越短</li></ul></li></ul><h2 id="路由聚合-也称构成超网"><a href="#路由聚合-也称构成超网" class="headerlink" title="路由聚合(也称构成超网)"></a>路由聚合(也称构成超网)</h2><p><strong>概述：<strong>路由表中可以利用CIDR地址块来查找目的网络。这种</strong>地址的聚合</strong>称为路由聚合。</p><p><strong>作用</strong>：使路由表中一个项目可以表示多个 原本传统分类地址 的路由，减少路由之间的信息交换，通过网络性能。 （基于CIDR的视角来合并部分网络的路由表项）</p><p><strong>分析</strong>：不使用路由聚合，那么R1到网络1和网络2需要两条路由表项；注意到R1到两个网络的下一跳都是R2，网络1和网络2前16位相同（可以构成一个更大的地址块206.1.0.0&#x2F;16）</p><p><strong>最长前缀匹配</strong>：（也叫最佳匹配）使用CIDR时路由表各项由“网络前缀”和“下一跳地址”组成，查找路由表时可能会得到不止一个匹配结果。应当从匹配结果中<strong>选择具有最长网络前缀的路由</strong>（地址块越小，路由越具体）。</p><ul><li><p>途径：通常<strong>将无分类编制路由表存放在</strong>一种<strong>层次数据结构</strong>中（二叉线索），自上而下查找。</p></li><li><p>采用CIDR编制，可以按照前缀的长短把前缀最长的放在第一行。只有检索到匹配的就停止检索。</p></li></ul><h2 id="子网划分方法：定长的子网掩码，变长的子网掩码"><a href="#子网划分方法：定长的子网掩码，变长的子网掩码" class="headerlink" title="子网划分方法：定长的子网掩码，变长的子网掩码"></a>子网划分方法：定长的子网掩码，变长的子网掩码</h2><h3 id="定长子网掩码"><a href="#定长子网掩码" class="headerlink" title="定长子网掩码"></a>定长子网掩码</h3><p><strong>概述：</strong></p><ol><li>各子网使用相同的子网掩码。</li><li>各子网分配的IP地址数量相同（造成地址资源的浪费）</li></ol><p><strong>过程：</strong></p><ol><li>某单位拥有一个CIDR地址块208.115.21.0&#x2F;24 不难看出主机号占最后八位</li><li>划分子网。 有4个单位，则划分成4个子网。从主机号的高位借两位作为子网划分。</li><li>现在主机号还剩下6位。这样每个子网可分配的地址数为2^8-2</li></ol><h3 id="变长的网络掩码划分子网"><a href="#变长的网络掩码划分子网" class="headerlink" title="变长的网络掩码划分子网"></a>变长的网络掩码划分子网</h3><p>**概述：**每个子网可以使用不同的子网掩码。并且每个子网所分配的IP地址数量可以不同。</p><p><strong>过程：</strong></p><ol><li><p>某单位拥有一个CIDR地址块208.115.21.0&#x2F;24 不难看出主机号占最后八位。要划分给三个部门。</p></li><li><p>部门1的主机号需要6位，剩下26位作网络前缀。部门2需要5位，剩下27位作前缀。部门3的主机号需.位，剩余29位作前缀。</p></li><li><table><thead><tr><th>地址范围</th><th>划分方法</th></tr></thead><tbody><tr><td><u>208.115.21.00</u>000000 ~ <u>208.115.21.00</u>111111</td><td></td></tr><tr><td><u>208.115.21.010</u>00000 ~ <u>208.115.21.010</u>11111</td><td></td></tr><tr><td><u>208.115.21.01100</u>000 ~ <u>208.115.21.01100</u>111</td><td></td></tr><tr><td><u>208.115.21.010</u>00000 ~ <u>208.115.21.010</u>11111</td><td></td></tr></tbody></table></li><li><p>这种划分方案从大的开始划。部门1需要6位主机号，所以有2^6-2&#x3D;62个可分配地址，剩下2位用来划分子网，并且部门1为00.</p></li></ol><h2 id="网络层转发过程"><a href="#网络层转发过程" class="headerlink" title="网络层转发过程"></a>网络层转发过程</h2><p>**概述：**分组转发基于目的主机所在网络（压缩转发表大小），<strong>转发表信息 (目的网络地址，下一跳地址)</strong>，路由器根据IP地址的网络前缀来查表找到下一跳地址。</p><p><strong>两种特殊路由：</strong></p><ul><li><p>【特定主机路由】对特定目的主机的IP地址专门指明一个路由。</p><p>作用：方便管理员控制和测试网络</p></li><li><p>【默认路由】用特殊前缀0.0.0.0&#x2F;0表示默认路由。 当目的网络是其他网络(不是自身)也不在转发表中就一律选择默认路由</p><p>作用：通常用于路由器到互联网的路由（因为路由表不可能包含互联网上所有路由）</p></li></ul><p><strong>路由器分组转发算法：</strong></p><ol><li>从IP分组首部提取目的目的主机的IP地址</li><li>查找【特定主机路由】，找得到则按照这一项转发；找不到则开始按前缀长度顺序查找</li><li>对于查找中的一行，将【一行的子网掩码】与【目的地址】逐位【与】（AND），如果与结果和这一行的前缀匹配，结束查找。按下一跳转发。否则继续找下一行。</li><li>如果有一个【默认路由】，就传递给默认路由，没有，则【转发分组出错】。</li></ol><p><strong>注意：</strong></p><ul><li>因为转发表只给出下一跳地址，并非完整路径，所以传到一个路由器都要查一次它的转发表</li><li><strong>！！ 得到下一跳IP地址后，将它通过ARP转换成MAC地址然后填到MAC帧首部，再根据这个MAC地址去找到下一跳的路由器</strong></li></ul><h2 id="IP地址与硬件地址"><a href="#IP地址与硬件地址" class="headerlink" title="IP地址与硬件地址"></a>IP地址与硬件地址</h2><p><strong>各种地址</strong>：</p><table><thead><tr><th>IP地址</th><th>MAC地址（硬件地址）</th></tr></thead><tbody><tr><td>网络层及之上使用的地址，是分层式的。位于IP数据报首部。IP数据报封装成MAC帧之后，数据链路层是看不见IP地址的。</td><td>在数据链路层使用，平面式的。位于MAC帧首部。</td></tr></tbody></table><p>**网络层寻址：**网络层只使用IP地址来寻址（因为路由器的隔离，无法通过广播MAC地址来跨网络寻址）。</p><p><strong>寻址过程：</strong></p><ol><li>寻址时，每个路由器依据它的路由表选择到<strong>目标网络需要转发到的下一跳</strong></li><li>IP数据报通过多次路由转发<strong>到达目标网络后</strong>改为在目标局域网中通过数据链路层的MAC地址以广播的方式寻址</li></ol><p><strong>性质：</strong></p><ol><li>在IP层抽象的互联网上只能看到IP数据报</li><li>IP数据报首部有源IP地址，但是路由器只使用目的IP地址来转发</li><li>局域网的链路层只能看到MAC帧，MAC帧中是封装的IP数据报。MAC帧首部的源地址和目的地址会不断地改变，因为IP数据报在每次转发过程中都会被拆解重新封装（路由器根据下一跳IP地址通过ARP转换成MAC地址填进MAC帧首部）</li><li>无法使用MAC地址跨网络通信。因为每次转发都要修改MAC地址，如上所述。</li><li>IP层抽象的互联网屏蔽了下层复杂的细节，在网络层上可以使用统一抽象的IP地址来研究不同主机的通信</li></ol><h2 id="ARP-地址解析协议"><a href="#ARP-地址解析协议" class="headerlink" title="ARP  地址解析协议"></a>ARP 地址解析协议</h2><p><strong>ARP概述：</strong></p><ol><li>一种方法，旨在完成IP地址到MAC地址的映射。如果目的主机和源主机不在同一个局域网上，要通过ARP找到本局域网的某个路由器硬件地址，发分组传给它，并由这个路由器把分组转发给下一个网络。</li><li>ARP工作在网络层（看得见IP地址）；NAT工作在传输层（看得见端口）.</li></ol><p><strong>ARP表：<strong>每个主机都有的一个ARP高速缓存，存放</strong>本局域网</strong>上各主机和路由器的IP地址到MAC地址的映射表</p><p>**原理：**A向本局域网主机B发送IP数据报： （ARP请求分组：<code>广播发送</code> ARP响应分组：<code>单播发送</code>）</p><ol><li>查ARP高速缓存，如果有B的IP地址，直接得到对应硬件地址，把它写入MAC帧，并发送给B</li><li>如果没有，通过使用目的MAC地址为FF-FF-FF-FF-FF-FF的帧封装和广播ARP请求分组。所有主机都会收到ARP请求。</li><li>B收到后向A发送ARP响应分组，在分组里告诉A它(B)的IP地址和MAC地址映射关系，这样A可以写入它的ARP缓存，从而发送MAC帧</li></ol><p><strong>补充：</strong></p><ul><li>ARP用来解决同一局域网主机&#x2F;路由器的IP地址和硬件地址映射问题。不在一个局域网，则通过ARP找到某个路由器的硬件地址，发给这个路由器，让它转给下一个网络。</li><li>IP地址到硬件地址的解析自动进行，用户并不知道。</li><li>主机或路由器和本网络另一个已知IP地址的主机或路由器进行通信时，ARP自动将IP地址解析成数据链路层需要的硬件地址</li></ul><h2 id="动态主机配置协议-DHCP"><a href="#动态主机配置协议-DHCP" class="headerlink" title="动态主机配置协议 DHCP"></a>动态主机配置协议 DHCP</h2><p><strong>DHCP概述：</strong></p><ol><li>用于给主机动态地分配IP地址。</li><li>提供即插即用的联网机制，允许一台计算机加入新的网络和自动获取IP地址</li><li>应用层协议（通过客户&#x2F;服务器模式工作），基于UDP</li></ol><p><strong>工作原理：</strong></p><ol><li>使用客户&#x2F;服务器模型</li><li>需要IP地址的主机启动时向【DHCP服务器】广播发送【发现报文】，从而成为【DHCP客户】；</li><li>所有主机都能收到这个广播报文，但是只有【DHCP服务器】可以回答。</li><li>【DHCP服务器】在自己的数据库里查找这台主机的配置信息，找得到返回，找不到则从服务器的IP地址池中取一个地址分配给这台计算机。</li><li>【提供报文】DHCP服务器的回答报文。</li></ol><p><strong>过程：</strong></p><ol><li>DHCP客户广播发现报文（源地址0.0.0.0，目的地址255.255.255.255）</li><li>服务器收到这个广播报文，广播【提供报文】，这里面包括给DHCP客户的IP地址，报文源地址为DHCP服务器地址，目的地址为255.255.255.255</li><li>DHCP客户收到提供报文，如果接受这个IP地址，就需要广播“DHCP请求”给DHCP服务器。源地址0.0.0.0，目的地址255.255.255.255（同1.）</li><li>DHCP服务器广播“DHCP确认”消息，把IP地址分配给这个客户。源地址目的地址同2.</li></ol><p><strong>注意点：</strong></p><ol><li>可以有多台DHCP服务器，可能有多个应答消息，但是DHCP客户只挑选其中一个（最先到达的）</li><li>DHCP分配给客户的IP地址是【临时的】，客户只能在【租用期】内使用，租用期由服务器决定，客户也可以在报文中提出租用期要求。</li><li>交互过程采用广播方式。采用UDP。</li></ol><h2 id="ICMP-网际控制报文协议"><a href="#ICMP-网际控制报文协议" class="headerlink" title="ICMP 网际控制报文协议"></a>ICMP 网际控制报文协议</h2><p><strong>ICMP概述：</strong></p><ol><li>目的：有效转发IP数据报，提高交付成功机会。</li><li>允许主机或路由器报告差错和异常情况</li><li>虽然ICMP报文封装在IP数据报中发送，但ICMP是依然是网络层协议。</li><li>ICMP报文有两种：【ICMP差错报告报文】【ICMP询问报文】</li></ol><p><strong>ICMP差错报告报文及其五种类型</strong>：用于目标主机或到目标主机路径上的路由器。目的是向源主机报告差错和异常情况。</p><ol><li>终点不可达：路由器&#x2F;主机不能交付数据时向源主机发送</li><li>源点抑制：路由器&#x2F;主机因为【拥塞】而丢弃数据报。 源点抑制报文告诉源点应该降低数据报的发送速率。</li><li>时间超过：<ul><li>路由器收到生存时间TTL为0的数据报，除丢弃这个数据报外还需要向源点发送时间超过报文。</li><li>终点在<strong>预先规定的时间内不能</strong>收到<strong>一个数据报</strong>的<strong>全部数据报片</strong>时，就把已收到的数据报片全部丢弃，然后向源点发送时间超过报文。</li></ul></li><li>参数问题：收到的数据报首部有的字段的值不正确，则丢弃并发送参数问题报文</li><li>改变路由（重定向）：告诉主机下次应该把数据报发送给另外的路由器，可通过更好地路由</li></ol><p><strong>ICMP差错报告报文不应该发送：</strong></p><p>​	情况一：对ICMP差错报告报文不再发送ICMP差错报告报文</p><p>​	情况二：第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报文</p><p>​	情况三：对于具有多播地址的数据报都不发送ICMP差错报告报文</p><p>​	情况四：对于特殊地址的数据报也不发送</p><p><strong>ICMP询问报文的四种类型</strong>：</p><ol><li>回送请求和回答报文</li><li>时间戳请求和回答报文</li><li>地址掩码请求和回答报文</li><li>路由器询问和通告报文</li></ol><p><strong>ICMP常见应用：</strong></p><ol><li>分组网间探测PING：测试两台主机间的连通性。工作在应用层，直接使用网络层的ICMP。</li><li>Traceroute：跟踪分组经过的路由。 工作在网络层。</li></ol><h2 id="习题查漏补缺"><a href="#习题查漏补缺" class="headerlink" title="习题查漏补缺"></a>习题查漏补缺</h2><p>一、IPv4计算首部检验和</p><ol><li>先把IP数据报首部划分为许多16位字的序列，并把检验和字段置零。把所有16位字相加后，将得到的和的反码写入检验和字段。</li><li>接收方收到数据报后，将首部的所有16位字再使用反码算术运算相加一次。将得到的和取反码，即得出接收方检验和的计算结果。</li><li>若首部未发生任何变化，则此结果必为0</li></ol><p>二、多IP：如果一个主机有两个以上的IP地址，那么这些IP地址应当属于不同的网络。所以他们的网络号一定不同。</p><h1 id="IPv6（从根本上解决地址耗尽问题）"><a href="#IPv6（从根本上解决地址耗尽问题）" class="headerlink" title="IPv6（从根本上解决地址耗尽问题）"></a>IPv6（从根本上解决地址耗尽问题）</h1><h2 id="IPv6特点"><a href="#IPv6特点" class="headerlink" title="IPv6特点"></a>IPv6特点</h2><table><thead><tr><th>特点</th><th>描述</th></tr></thead><tbody><tr><td>更大地址空间</td><td>从IPv4的32位增大到128位。 地址空间是前者的2^96倍。</td></tr><tr><td>灵活首部</td><td>IPv6首部长度固定，40B。选项放在有效载荷中，选项灵活可变（IPv4选项固定，放在首部可变部分.<strong>IPv4<strong><strong>的首部长度是可变的，必须是</strong></strong>4B****的整数倍</strong>）</td></tr><tr><td>允许协议扩充</td><td>允许不断扩充功能。IPv4固定</td></tr><tr><td>支持即插即用</td><td>也即自动配置。无需使用DHCP（动态主机配置协议 ，DHCP服务器&amp;DHCP客户）</td></tr><tr><td>分片</td><td>只有源主机才能分片，是端到端的。 不允许类似IPv4传输路径中的路由分片。</td></tr><tr><td>增大了安全性</td><td>身份鉴别和保密功能是IPv6的扩展首部</td></tr><tr><td>兼容性</td><td>IPv6与IPv4不兼容，但是与所有其他互联网协议兼容(TCP UDP ICMP IGMP DNS)</td></tr><tr><td>无首部检验和</td><td>IPv6协议没有首部检验和,这意味着攻击者无法通过篡改数据包来伪造或篡改数据,这有助于提高网络的安全性。 这一措施也加快了路由器处理数据报的速度。链路层会丢弃检测出差错的帧，并且传输层也有相应的差错处理机制，所以网络层额差错检测可以精简掉。</td></tr></tbody></table><h2 id="IPv6地址类型"><a href="#IPv6地址类型" class="headerlink" title="IPv6地址类型"></a>IPv6地址类型</h2><ol><li>单播</li><li>多播</li><li>任播(新增)</li></ol><h2 id="过渡技术"><a href="#过渡技术" class="headerlink" title="过渡技术"></a>过渡技术</h2><ol><li>双协议栈</li><li>隧道技术</li></ol><h1 id="路由算法和协议"><a href="#路由算法和协议" class="headerlink" title="路由算法和协议"></a>路由算法和协议</h1><h2 id="路由算法分类"><a href="#路由算法分类" class="headerlink" title="路由算法分类"></a>路由算法分类</h2><table><thead><tr><th>类型</th><th>特点</th><th>示例</th></tr></thead><tbody><tr><td>静态</td><td>手工配置</td><td>-</td></tr><tr><td>动态</td><td>自动调整</td><td>RIP, OSPF, BGP</td></tr></tbody></table><h2 id="路由协议对比"><a href="#路由协议对比" class="headerlink" title="路由协议对比"></a>路由协议对比</h2><table><thead><tr><th>协议</th><th>类型</th><th>特点</th></tr></thead><tbody><tr><td>RIP</td><td>距离向量</td><td>跳数限制15</td></tr><tr><td>OSPF</td><td>链路状态</td><td>支持分层区域</td></tr><tr><td>BGP</td><td>路径向量</td><td>AS间路由</td></tr></tbody></table><h1 id="IP多播"><a href="#IP多播" class="headerlink" title="IP多播"></a>IP多播</h1><h2 id="多播地址"><a href="#多播地址" class="headerlink" title="多播地址"></a>多播地址</h2><ul><li>IPv4：D类地址(224.0.0.0~239.255.255.255)</li><li>IPv6：FF00::&#x2F;8</li></ul><h2 id="多播协议"><a href="#多播协议" class="headerlink" title="多播协议"></a>多播协议</h2><ol><li>IGMP：组成员管理</li><li>多播路由协议：构建多播树</li></ol><h1 id="移动IP"><a href="#移动IP" class="headerlink" title="移动IP"></a>移动IP</h1><h2 id="关键概念"><a href="#关键概念" class="headerlink" title="关键概念"></a>关键概念</h2><ul><li>家乡代理</li><li>外地代理</li><li>转交地址</li><li>三角路由问题</li></ul><h1 id="网络层设备"><a href="#网络层设备" class="headerlink" title="网络层设备"></a>网络层设备</h1><h2 id="路由器功能"><a href="#路由器功能" class="headerlink" title="路由器功能"></a>路由器功能</h2><ul><li>连接异构网络</li><li>分组转发</li><li>路由选择</li><li>分隔广播域</li></ul><h2 id="路由表vs转发表"><a href="#路由表vs转发表" class="headerlink" title="路由表vs转发表"></a>路由表vs转发表</h2><table><thead><tr><th></th><th>路由表</th><th>转发表</th></tr></thead><tbody><tr><td>用途</td><td>路由选择</td><td>分组转发</td></tr><tr><td>生成</td><td>路由算法</td><td>从路由表得出</td></tr><tr><td>实现</td><td>软件</td><td>软件&#x2F;硬件</td></tr></tbody></table><h1 id="传输层"><a href="#传输层" class="headerlink" title="传输层"></a>传输层</h1><h2 id="传输层基础概念"><a href="#传输层基础概念" class="headerlink" title="传输层基础概念"></a>传输层基础概念</h2><h3 id="传输层的作用与定位"><a href="#传输层的作用与定位" class="headerlink" title="传输层的作用与定位"></a>传输层的作用与定位</h3><p>传输层为运行在不同主机上的应用进程之间提供端到端的逻辑通信服务，是网络体系结构中承上启下的关键层次。</p><table><thead><tr><th>特征</th><th>描述</th></tr></thead><tbody><tr><td><strong>逻辑通信</strong></td><td>从传输层角度看，通信的真正端点是主机中的应用进程，而非主机本身</td></tr><tr><td><strong>协议栈分布</strong></td><td>仅存在于通信子网边缘的主机中，路由器等中间设备只使用下三层功能</td></tr><tr><td><strong>服务抽象</strong></td><td>向上层应用屏蔽底层网络核心的复杂细节，提供统一的传输服务接口</td></tr></tbody></table><h3 id="传输层核心功能"><a href="#传输层核心功能" class="headerlink" title="传输层核心功能"></a>传输层核心功能</h3><h4 id="应用进程间逻辑通信"><a href="#应用进程间逻辑通信" class="headerlink" title="应用进程间逻辑通信"></a>应用进程间逻辑通信</h4><ul><li><strong>端点识别</strong>：通过端口号标识主机内的具体应用进程</li><li><strong>进程寻址</strong>：实现不同主机上应用进程的精确定位</li><li><strong>通信抽象</strong>：为应用层提供进程到进程的直接通信视图</li></ul><h4 id="多路复用与分用机制"><a href="#多路复用与分用机制" class="headerlink" title="多路复用与分用机制"></a>多路复用与分用机制</h4><table><thead><tr><th>机制</th><th>定义</th><th>实现方式</th></tr></thead><tbody><tr><td><strong>复用（Multiplexing）</strong></td><td>发送方多个应用进程共享同一传输层协议</td><td>通过端口号区分不同应用进程的数据</td></tr><tr><td><strong>分用（Demultiplexing）</strong></td><td>接收方传输层将数据正确分发给目标进程</td><td>根据目的端口号将数据交付给相应应用</td></tr></tbody></table><h4 id="差错检测与处理"><a href="#差错检测与处理" class="headerlink" title="差错检测与处理"></a>差错检测与处理</h4><table><thead><tr><th>协议类型</th><th>差错检测范围</th><th>错误处理策略</th></tr></thead><tbody><tr><td><strong>TCP</strong></td><td>首部 + 数据部分</td><td>要求重传错误报文段</td></tr><tr><td><strong>UDP</strong></td><td>首部 + 数据部分</td><td>直接丢弃错误数据报</td></tr><tr><td><strong>IP</strong></td><td>仅检测首部</td><td>不检查数据部分完整性</td></tr></tbody></table><h4 id="连接管理服务"><a href="#连接管理服务" class="headerlink" title="连接管理服务"></a>连接管理服务</h4><p>传输层提供两种不同的服务模式：</p><table><thead><tr><th>服务类型</th><th>协议代表</th><th>通信信道特征</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>面向连接</strong></td><td>TCP</td><td>全双工可靠逻辑信道</td><td>要求数据可靠传输的应用</td></tr><tr><td><strong>无连接</strong></td><td>UDP</td><td>不可靠逻辑信道</td><td>对实时性要求高的应用</td></tr></tbody></table><h2 id="传输层协议概览"><a href="#传输层协议概览" class="headerlink" title="传输层协议概览"></a>传输层协议概览</h2><h3 id="TCP：传输控制协议（Transmission-Control-Protocol）"><a href="#TCP：传输控制协议（Transmission-Control-Protocol）" class="headerlink" title="TCP：传输控制协议（Transmission Control Protocol）"></a>TCP：传输控制协议（Transmission Control Protocol）</h3><ul><li><strong>服务特征</strong>：面向连接、可靠传输、全双工通信</li><li><strong>核心机制</strong>：确认重传、流量控制、拥塞控制、连接管理</li><li><strong>适用场景</strong>：文件传输、网页浏览、电子邮件等可靠性优先的应用</li></ul><h3 id="UDP：用户数据报协议（User-Datagram-Protocol）"><a href="#UDP：用户数据报协议（User-Datagram-Protocol）" class="headerlink" title="UDP：用户数据报协议（User Datagram Protocol）"></a>UDP：用户数据报协议（User Datagram Protocol）</h3><ul><li><strong>服务特征</strong>：无连接、不可靠传输、简单高效</li><li><strong>核心机制</strong>：基本的多路复用&#x2F;分用、可选的差错检测</li><li><strong>适用场景</strong>：实时音视频、DNS查询、简单请求-响应等效率优先的应用</li></ul><h2 id="传输层寻址机制"><a href="#传输层寻址机制" class="headerlink" title="传输层寻址机制"></a>传输层寻址机制</h2><h3 id="端口概念与作用"><a href="#端口概念与作用" class="headerlink" title="端口概念与作用"></a>端口概念与作用</h3><p>端口是传输层实现多路复用和分用的关键机制，为应用进程提供了在传输层的唯一标识符。</p><h4 id="端口的本质与功能"><a href="#端口的本质与功能" class="headerlink" title="端口的本质与功能"></a>端口的本质与功能</h4><ul><li><strong>抽象接口</strong>：端口是协议栈层间的抽象协议接口，实现应用进程与传输层实体的交互</li><li><strong>进程标识</strong>：在传输层中的作用类似于IP地址在网络层中的作用，用于标识特定的应用进程</li><li><strong>数据分发</strong>：使传输层能够将接收到的数据正确分发给目标应用进程</li></ul><h4 id="端口类型区分"><a href="#端口类型区分" class="headerlink" title="端口类型区分"></a>端口类型区分</h4><table><thead><tr><th>端口类型</th><th>定义</th><th>特点</th><th>应用场景</th></tr></thead><tbody><tr><td><strong>软件端口</strong></td><td>协议栈层间的抽象协议端口</td><td>逻辑概念，用于进程标识</td><td>传输层使用的端口类型</td></tr><tr><td><strong>硬件端口</strong></td><td>物理设备间的连接接口</td><td>物理概念，用于设备连接</td><td>路由器、交换机等设备接口</td></tr></tbody></table><h3 id="网络层次服务访问点"><a href="#网络层次服务访问点" class="headerlink" title="网络层次服务访问点"></a>网络层次服务访问点</h3><p>各层协议通过不同的服务访问点实现层间数据的正确分发：</p><table><thead><tr><th>协议层次</th><th>服务访问点</th><th>标识作用</th><th>典型值</th></tr></thead><tbody><tr><td><strong>数据链路层</strong></td><td>帧类型字段</td><td>标识上层协议类型</td><td>0x0800（IPv4）</td></tr><tr><td><strong>网络层</strong></td><td>协议字段</td><td>标识传输层协议</td><td>6（TCP）、17（UDP）</td></tr><tr><td><strong>传输层</strong></td><td>端口号字段</td><td>标识应用进程</td><td>80（HTTP）、53（DNS）</td></tr><tr><td><strong>应用层</strong></td><td>用户界面</td><td>用户交互接口</td><td>应用程序界面</td></tr></tbody></table><h3 id="端口号分配体系"><a href="#端口号分配体系" class="headerlink" title="端口号分配体系"></a>端口号分配体系</h3><h4 id="端口号基本特征"><a href="#端口号基本特征" class="headerlink" title="端口号基本特征"></a>端口号基本特征</h4><ul><li><strong>位长</strong>：16位二进制数（取值范围：0-65535）</li><li><strong>作用域</strong>：仅具有本地意义，只标识本地主机中的应用进程</li><li><strong>唯一性</strong>：在同一主机上，同一时刻每个端口号只能被一个进程使用</li></ul><h4 id="端口号分类与分配"><a href="#端口号分类与分配" class="headerlink" title="端口号分类与分配"></a>端口号分类与分配</h4><table><thead><tr><th>端口类别</th><th>数值范围</th><th>分配机构</th><th>使用特点</th><th>典型应用</th></tr></thead><tbody><tr><td><strong>熟知端口号</strong></td><td>0-1023</td><td>IANA统一分配</td><td>标准服务固定使用</td><td>系统服务、标准协议</td></tr><tr><td><strong>登记端口号</strong></td><td>1024-49151</td><td>IANA登记管理</td><td>注册后避免冲突</td><td>用户应用程序</td></tr><tr><td><strong>动态端口号</strong></td><td>49152-65535</td><td>系统动态分配</td><td>临时使用，通信结束释放</td><td>客户端临时端口</td></tr></tbody></table><h4 id="常用熟知端口号"><a href="#常用熟知端口号" class="headerlink" title="常用熟知端口号"></a>常用熟知端口号</h4><table><thead><tr><th>应用协议</th><th>端口号</th><th>传输协议</th><th>服务描述</th></tr></thead><tbody><tr><td><strong>FTP</strong></td><td>21</td><td>TCP</td><td>文件传输协议控制连接</td></tr><tr><td><strong>TELNET</strong></td><td>23</td><td>TCP</td><td>远程终端协议</td></tr><tr><td><strong>SMTP</strong></td><td>25</td><td>TCP</td><td>简单邮件传输协议</td></tr><tr><td><strong>DNS</strong></td><td>53</td><td>UDP&#x2F;TCP</td><td>域名系统</td></tr><tr><td><strong>TFTP</strong></td><td>69</td><td>UDP</td><td>简单文件传输协议</td></tr><tr><td><strong>HTTP</strong></td><td>80</td><td>TCP</td><td>超文本传输协议</td></tr><tr><td><strong>SNMP</strong></td><td>161</td><td>UDP</td><td>简单网络管理协议</td></tr></tbody></table><h4 id="动态端口分配机制"><a href="#动态端口分配机制" class="headerlink" title="动态端口分配机制"></a>动态端口分配机制</h4><ul><li><strong>分配时机</strong>：客户端进程发起连接时由操作系统自动分配</li><li><strong>生命周期</strong>：仅在通信期间有效，连接结束后立即释放</li><li><strong>重用性</strong>：端口号可在不同时间被不同进程重复使用</li><li><strong>别名</strong>：也称为临时端口号或短暂端口号</li></ul><h2 id="传输层服务模式"><a href="#传输层服务模式" class="headerlink" title="传输层服务模式"></a>传输层服务模式</h2><p>传输层提供两种截然不同的服务模式，分别对应TCP和UDP协议，满足不同应用场景的需求。</p><h3 id="面向连接服务（TCP）"><a href="#面向连接服务（TCP）" class="headerlink" title="面向连接服务（TCP）"></a>面向连接服务（TCP）</h3><h4 id="服务特征"><a href="#服务特征" class="headerlink" title="服务特征"></a>服务特征</h4><ul><li><strong>连接导向</strong>：通信前必须建立连接，通信后必须释放连接</li><li><strong>可靠传输</strong>：保证数据无差错、不丢失、不重复、按序到达</li><li><strong>全双工通信</strong>：支持双向同时数据传输</li><li><strong>点对点连接</strong>：每条TCP连接只能连接两个端点</li></ul><h4 id="可靠性保障机制"><a href="#可靠性保障机制" class="headerlink" title="可靠性保障机制"></a>可靠性保障机制</h4><table><thead><tr><th>机制类型</th><th>功能描述</th><th>实现方式</th></tr></thead><tbody><tr><td><strong>确认机制</strong></td><td>确保数据正确接收</td><td>接收方发送ACK确认</td></tr><tr><td><strong>重传机制</strong></td><td>处理数据丢失问题</td><td>超时或冗余ACK触发重传</td></tr><tr><td><strong>流量控制</strong></td><td>防止接收方缓存溢出</td><td>滑动窗口机制</td></tr><tr><td><strong>拥塞控制</strong></td><td>避免网络过载</td><td>慢开始、拥塞避免等算法</td></tr><tr><td><strong>连接管理</strong></td><td>管理连接生命周期</td><td>三次握手建立、四次挥手释放</td></tr></tbody></table><h4 id="适用场景与典型应用"><a href="#适用场景与典型应用" class="headerlink" title="适用场景与典型应用"></a>适用场景与典型应用</h4><table><thead><tr><th>应用类型</th><th>协议示例</th><th>选择TCP的原因</th></tr></thead><tbody><tr><td><strong>文件传输</strong></td><td>FTP</td><td>要求数据完整性，不能丢失</td></tr><tr><td><strong>网页浏览</strong></td><td>HTTP&#x2F;HTTPS</td><td>需要完整的页面内容</td></tr><tr><td><strong>远程登录</strong></td><td>TELNET&#x2F;SSH</td><td>命令传输必须准确无误</td></tr><tr><td><strong>电子邮件</strong></td><td>SMTP&#x2F;POP3&#x2F;IMAP</td><td>邮件内容不能有错误</td></tr></tbody></table><h3 id="无连接服务（UDP）"><a href="#无连接服务（UDP）" class="headerlink" title="无连接服务（UDP）"></a>无连接服务（UDP）</h3><h4 id="服务特征-1"><a href="#服务特征-1" class="headerlink" title="服务特征"></a>服务特征</h4><ul><li><strong>无连接</strong>：发送数据前无需建立连接</li><li><strong>不可靠传输</strong>：尽最大努力交付，不保证可靠性</li><li><strong>简单高效</strong>：协议开销小，处理速度快</li><li><strong>支持多种通信模式</strong>：一对一、一对多、多对一、多对多</li></ul><h4 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h4><table><thead><tr><th>功能</th><th>描述</th><th>与IP层的区别</th></tr></thead><tbody><tr><td><strong>多路复用&#x2F;分用</strong></td><td>通过端口号区分不同应用进程</td><td>IP层只能区分到主机级别</td></tr><tr><td><strong>差错检测</strong></td><td>可选的检验和机制</td><td>提供端到端的数据完整性检查</td></tr><tr><td><strong>数据封装</strong></td><td>添加UDP首部信息</td><td>为应用数据提供传输层封装</td></tr></tbody></table><h4 id="适用场景与典型应用-1"><a href="#适用场景与典型应用-1" class="headerlink" title="适用场景与典型应用"></a>适用场景与典型应用</h4><table><thead><tr><th>应用类型</th><th>协议示例</th><th>选择UDP的原因</th></tr></thead><tbody><tr><td><strong>域名解析</strong></td><td>DNS</td><td>查询简单，重传成本低</td></tr><tr><td><strong>简单文件传输</strong></td><td>TFTP</td><td>文件小，实现简单</td></tr><tr><td><strong>网络管理</strong></td><td>SNMP</td><td>管理信息传输要求高效</td></tr><tr><td><strong>实时应用</strong></td><td>RTP（音视频）</td><td>对延迟敏感，可容忍少量丢失</td></tr><tr><td><strong>广播&#x2F;组播</strong></td><td>DHCP、组播协议</td><td>需要一对多通信模式</td></tr></tbody></table><h3 id="服务模式选择原则"><a href="#服务模式选择原则" class="headerlink" title="服务模式选择原则"></a>服务模式选择原则</h3><table><thead><tr><th>考虑因素</th><th>选择TCP</th><th>选择UDP</th></tr></thead><tbody><tr><td><strong>可靠性要求</strong></td><td>数据必须完整准确</td><td>可容忍少量数据丢失</td></tr><tr><td><strong>实时性要求</strong></td><td>对延迟不敏感</td><td>对延迟高度敏感</td></tr><tr><td><strong>连接开销</strong></td><td>可接受连接建立开销</td><td>需要避免连接开销</td></tr><tr><td><strong>通信模式</strong></td><td>点对点通信</td><td>需要广播或组播</td></tr><tr><td><strong>应用复杂度</strong></td><td>应用层实现相对简单</td><td>应用层需要处理可靠性</td></tr></tbody></table><h2 id="应用协议与传输层映射"><a href="#应用协议与传输层映射" class="headerlink" title="应用协议与传输层映射"></a>应用协议与传输层映射</h2><h3 id="协议选择原则与实例"><a href="#协议选择原则与实例" class="headerlink" title="协议选择原则与实例"></a>协议选择原则与实例</h3><p>不同的应用协议根据其特定需求选择合适的传输层协议，形成了典型的应用-传输层协议组合。</p><h4 id="基于UDP的应用协议"><a href="#基于UDP的应用协议" class="headerlink" title="基于UDP的应用协议"></a>基于UDP的应用协议</h4><table><thead><tr><th>应用协议</th><th>全称</th><th>端口号</th><th>选择UDP的原因</th><th>应用特点</th></tr></thead><tbody><tr><td><strong>DNS</strong></td><td>域名系统</td><td>53</td><td>查询响应简单，对延迟敏感</td><td>短请求-响应模式</td></tr><tr><td><strong>TFTP</strong></td><td>简单文件传输协议</td><td>69</td><td>实现简单，文件较小</td><td>无需复杂的连接管理</td></tr><tr><td><strong>RIP</strong></td><td>路由信息协议</td><td>520</td><td>路由更新频繁，开销要小</td><td>周期性广播路由信息</td></tr><tr><td><strong>DHCP</strong></td><td>动态主机配置协议</td><td>67&#x2F;68</td><td>需要广播功能</td><td>自动IP地址分配</td></tr><tr><td><strong>SNMP</strong></td><td>简单网络管理协议</td><td>161</td><td>管理信息传输要求高效</td><td>网络设备监控管理</td></tr><tr><td><strong>IGMP</strong></td><td>网际组管理协议</td><td>-</td><td>组播管理，无需可靠性</td><td>IP组播成员管理</td></tr></tbody></table><h4 id="基于TCP的应用协议"><a href="#基于TCP的应用协议" class="headerlink" title="基于TCP的应用协议"></a>基于TCP的应用协议</h4><table><thead><tr><th>应用协议</th><th>全称</th><th>端口号</th><th>选择TCP的原因</th><th>应用特点</th></tr></thead><tbody><tr><td><strong>SMTP</strong></td><td>简单邮件传输协议</td><td>25</td><td>邮件传输必须可靠</td><td>邮件不能丢失或损坏</td></tr><tr><td><strong>TELNET</strong></td><td>远程终端协议</td><td>23</td><td>命令传输需要准确性</td><td>交互式远程登录</td></tr><tr><td><strong>HTTP</strong></td><td>超文本传输协议</td><td>80</td><td>网页内容必须完整</td><td>万维网内容传输</td></tr><tr><td><strong>FTP</strong></td><td>文件传输协议</td><td>20&#x2F;21</td><td>文件传输要求完整性</td><td>大文件可靠传输</td></tr><tr><td><strong>SSH</strong></td><td>安全外壳协议</td><td>22</td><td>安全连接需要可靠性</td><td>加密远程访问</td></tr><tr><td><strong>HTTPS</strong></td><td>安全超文本传输协议</td><td>443</td><td>安全传输需要完整性</td><td>加密网页传输</td></tr></tbody></table><h3 id="传输层协议特性对比"><a href="#传输层协议特性对比" class="headerlink" title="传输层协议特性对比"></a>传输层协议特性对比</h3><h4 id="数据传输视角"><a href="#数据传输视角" class="headerlink" title="数据传输视角"></a>数据传输视角</h4><table><thead><tr><th>特性维度</th><th>UDP数据报</th><th>TCP报文段</th><th>IP数据报</th></tr></thead><tbody><tr><td><strong>传输范围</strong></td><td>端到端逻辑信道</td><td>端到端逻辑信道</td><td>网络层逐跳转发</td></tr><tr><td><strong>路由器可见性</strong></td><td>不可见（封装在IP中）</td><td>不可见（封装在IP中）</td><td>可见（路由转发依据）</td></tr><tr><td><strong>状态维护</strong></td><td>无状态</td><td>有状态（连接信息）</td><td>无状态</td></tr><tr><td><strong>处理复杂度</strong></td><td>简单</td><td>复杂</td><td>中等</td></tr></tbody></table><h4 id="服务层次对比"><a href="#服务层次对比" class="headerlink" title="服务层次对比"></a>服务层次对比</h4><table><thead><tr><th>服务层次</th><th>虚电路（网络层）</th><th>TCP连接（传输层）</th></tr></thead><tbody><tr><td><strong>状态保存位置</strong></td><td>网络中间节点</td><td>仅在端系统</td></tr><tr><td><strong>对网络层影响</strong></td><td>限制为面向连接</td><td>不影响网络层服务模式</td></tr><tr><td><strong>实现复杂度</strong></td><td>网络设备复杂</td><td>端系统复杂</td></tr><tr><td><strong>扩展性</strong></td><td>受网络规模限制</td><td>仅受端系统能力限制</td></tr></tbody></table><h3 id="协议栈层次关系"><a href="#协议栈层次关系" class="headerlink" title="协议栈层次关系"></a>协议栈层次关系</h3><h4 id="封装与解封装过程"><a href="#封装与解封装过程" class="headerlink" title="封装与解封装过程"></a>封装与解封装过程</h4><ol><li><strong>应用层</strong>：生成应用数据</li><li><strong>传输层</strong>：添加TCP&#x2F;UDP首部，形成报文段&#x2F;数据报</li><li><strong>网络层</strong>：添加IP首部，形成IP数据报</li><li><strong>数据链路层</strong>：添加帧首部和尾部</li><li><strong>物理层</strong>：转换为物理信号传输</li></ol><h4 id="层次独立性原则"><a href="#层次独立性原则" class="headerlink" title="层次独立性原则"></a>层次独立性原则</h4><ul><li><strong>传输层独立性</strong>：TCP&#x2F;UDP的选择不影响网络层的服务模式</li><li><strong>网络层透明性</strong>：传输层协议对中间路由器透明</li><li><strong>应用层灵活性</strong>：应用可根据需求选择合适的传输层协议</li></ul><h2 id="TCP与UDP协议对比分析"><a href="#TCP与UDP协议对比分析" class="headerlink" title="TCP与UDP协议对比分析"></a>TCP与UDP协议对比分析</h2><h3 id="协议栈层次服务特征"><a href="#协议栈层次服务特征" class="headerlink" title="协议栈层次服务特征"></a>协议栈层次服务特征</h3><h4 id="传输层服务提供模式"><a href="#传输层服务提供模式" class="headerlink" title="传输层服务提供模式"></a>传输层服务提供模式</h4><table><thead><tr><th>协议栈层次</th><th>UDP服务模式</th><th>TCP服务模式</th><th>底层依赖</th></tr></thead><tbody><tr><td><strong>应用层</strong></td><td>应用数据直接传递</td><td>应用数据直接传递</td><td>传输层服务</td></tr><tr><td><strong>传输层</strong></td><td>无连接不可靠服务</td><td>面向连接可靠服务</td><td>网络层服务</td></tr><tr><td><strong>网络层</strong></td><td>无连接不可靠服务</td><td>无连接不可靠服务</td><td>数据链路层服务</td></tr><tr><td><strong>数据链路层</strong></td><td>帧传输服务</td><td>帧传输服务</td><td>物理层服务</td></tr><tr><td><strong>物理层</strong></td><td>比特流传输</td><td>比特流传输</td><td>物理介质</td></tr></tbody></table><h4 id="服务质量对比"><a href="#服务质量对比" class="headerlink" title="服务质量对比"></a>服务质量对比</h4><table><thead><tr><th>服务特性</th><th>UDP</th><th>TCP</th><th>说明</th></tr></thead><tbody><tr><td><strong>连接管理</strong></td><td>无连接</td><td>面向连接</td><td>TCP需要三次握手建立连接</td></tr><tr><td><strong>可靠性保证</strong></td><td>不可靠</td><td>可靠</td><td>TCP提供确认、重传机制</td></tr><tr><td><strong>数据顺序</strong></td><td>不保证</td><td>保证</td><td>TCP确保数据按序到达</td></tr><tr><td><strong>流量控制</strong></td><td>无</td><td>有</td><td>TCP防止接收方缓存溢出</td></tr><tr><td><strong>拥塞控制</strong></td><td>无</td><td>有</td><td>TCP避免网络过载</td></tr><tr><td><strong>错误检测</strong></td><td>可选</td><td>必须</td><td>都提供检验和机制</td></tr></tbody></table><h3 id="适用场景分析"><a href="#适用场景分析" class="headerlink" title="适用场景分析"></a>适用场景分析</h3><h4 id="UDP适用场景"><a href="#UDP适用场景" class="headerlink" title="UDP适用场景"></a>UDP适用场景</h4><ul><li><strong>实时应用</strong>：IP电话、视频会议、在线游戏</li><li><strong>简单查询</strong>：DNS查询、SNMP网络管理</li><li><strong>广播&#x2F;组播</strong>：DHCP、路由协议更新</li><li><strong>小数据传输</strong>：TFTP简单文件传输</li></ul><h4 id="TCP适用场景"><a href="#TCP适用场景" class="headerlink" title="TCP适用场景"></a>TCP适用场景</h4><ul><li><strong>可靠传输</strong>：文件传输（FTP）、网页浏览（HTTP）</li><li><strong>交互应用</strong>：远程登录（TELNET&#x2F;SSH）、电子邮件（SMTP）</li><li><strong>大数据传输</strong>：数据库同步、软件下载</li><li><strong>安全通信</strong>：HTTPS、加密数据传输</li></ul><h3 id="协议首部结构对比"><a href="#协议首部结构对比" class="headerlink" title="协议首部结构对比"></a>协议首部结构对比</h3><h4 id="UDP首部格式"><a href="#UDP首部格式" class="headerlink" title="UDP首部格式"></a>UDP首部格式</h4><p>UDP首部设计简洁，仅包含必要的传输信息，体现了其简单高效的特点。</p><table><thead><tr><th>字段名称</th><th>位长（bit）</th><th>字节数</th><th>功能描述</th></tr></thead><tbody><tr><td><strong>源端口</strong></td><td>16</td><td>2</td><td>发送方应用进程端口号</td></tr><tr><td><strong>目的端口</strong></td><td>16</td><td>2</td><td>接收方应用进程端口号</td></tr><tr><td><strong>长度</strong></td><td>16</td><td>2</td><td>UDP首部+数据的总长度</td></tr><tr><td><strong>检验和</strong></td><td>16</td><td>2</td><td>错误检测（可选）</td></tr></tbody></table><p><strong>UDP首部特点</strong>：</p><ul><li><strong>固定长度</strong>：8字节，结构简单</li><li><strong>最小开销</strong>：仅提供基本的多路复用和错误检测</li><li><strong>处理高效</strong>：字段少，解析速度快</li></ul><h4 id="TCP首部格式"><a href="#TCP首部格式" class="headerlink" title="TCP首部格式"></a>TCP首部格式</h4><p>TCP首部包含丰富的控制信息，支持可靠传输的各种机制。</p><h5 id="固定首部字段（20字节）"><a href="#固定首部字段（20字节）" class="headerlink" title="固定首部字段（20字节）"></a>固定首部字段（20字节）</h5><table><thead><tr><th>字段名称</th><th>位长（bit）</th><th>字节数</th><th>功能描述</th></tr></thead><tbody><tr><td><strong>源端口</strong></td><td>16</td><td>2</td><td>发送方应用进程端口号</td></tr><tr><td><strong>目的端口</strong></td><td>16</td><td>2</td><td>接收方应用进程端口号</td></tr><tr><td><strong>序列号</strong></td><td>32</td><td>4</td><td>数据字节流中首字节的序号</td></tr><tr><td><strong>确认号</strong></td><td>32</td><td>4</td><td>期望接收的下一个字节序号</td></tr><tr><td><strong>数据偏移</strong></td><td>4</td><td>0.5</td><td>TCP首部长度（以4字节为单位）</td></tr><tr><td><strong>保留</strong></td><td>6</td><td>0.75</td><td>保留字段，必须为0</td></tr><tr><td><strong>标志位</strong></td><td>6</td><td>0.75</td><td>控制位（URG、ACK、PSH、RST、SYN、FIN）</td></tr><tr><td><strong>窗口大小</strong></td><td>16</td><td>2</td><td>接收窗口大小（流量控制）</td></tr><tr><td><strong>检验和</strong></td><td>16</td><td>2</td><td>错误检测（必须）</td></tr><tr><td><strong>紧急指针</strong></td><td>16</td><td>2</td><td>紧急数据指针</td></tr></tbody></table><h5 id="可变选项字段（0-40字节）"><a href="#可变选项字段（0-40字节）" class="headerlink" title="可变选项字段（0-40字节）"></a>可变选项字段（0-40字节）</h5><table><thead><tr><th>选项类型</th><th>长度</th><th>功能</th></tr></thead><tbody><tr><td><strong>最大报文段长度（MSS）</strong></td><td>4字节</td><td>协商最大数据段大小</td></tr><tr><td><strong>窗口扩大</strong></td><td>3字节</td><td>扩展窗口大小范围</td></tr><tr><td><strong>时间戳</strong></td><td>10字节</td><td>RTT测量和序列号回绕处理</td></tr><tr><td><strong>选择确认（SACK）</strong></td><td>可变</td><td>选择性确认机制</td></tr></tbody></table><p><strong>TCP首部特点</strong>：</p><ul><li><strong>可变长度</strong>：20-60字节，功能丰富</li><li><strong>控制复杂</strong>：支持连接管理、流量控制、拥塞控制</li><li><strong>扩展性强</strong>：选项字段支持协议功能扩展</li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><table><thead><tr><th align="left">特性</th><th align="left">UDP (User Datagram Protocol)</th><th align="left">TCP (Transmission Control Protocol)</th></tr></thead><tbody><tr><td align="left">连接</td><td align="left">无连接</td><td align="left">面向连接</td></tr><tr><td align="left">端点通信</td><td align="left">支持“一对一”、“一对多”、“多对一”和“多对多”交互通信</td><td align="left">每一条 TCP 连接只能有两个端点 EP，只能是一对一通信</td></tr><tr><td align="left">数据流类型</td><td align="left">面向应用报文</td><td align="left">面向字节流</td></tr><tr><td align="left">可靠性</td><td align="left">尽最大努力交付，即不可靠；不使用流量控制和拥塞控制</td><td align="left">可靠传输，使用流量控制和拥塞控制</td></tr><tr><td align="left">首部开销</td><td align="left">首部开销小，仅 8 字节</td><td align="left">首部开销最小 20 字节，最大 60 字节</td></tr></tbody></table><h2 id="习题查漏补缺-1"><a href="#习题查漏补缺-1" class="headerlink" title="习题查漏补缺"></a>习题查漏补缺</h2><ol><li><strong>通信子网、传输层、资源子网</strong><ul><li><strong>通信子网:</strong> 包括物理层、数据链路层和网络层，主要负责数据通信。</li><li><strong>传输层:</strong> 主要任务是向高层用户屏蔽下面通信子网的细节 (如网络拓扑、路由协议等)。</li><li><strong>资源子网:</strong> OSI 参考模型的上三层。</li></ul></li><li>传输层面向连接服务的特性: 保证可靠和顺序交付。</li><li>一个 TCP 报文的首部长度是 20B, 一个 IP 数据报的首部长度也是 20B, 再加上 60B 的数据, 一个 IP 数据报的总长度为 100B, 从而数据占 60%。</li><li>若用户应用程序使用 UDP 进行数据传输, 则必须在传输层的上层即应用层提供可靠性方面的全部工作。</li></ol><p>##UDP 协议</p><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>UDP 仅在 IP 层的数据包服务之上增加了两个最基本的功能，复用和分用，以及差错检测。</p><h3 id="UDP协议特征分析"><a href="#UDP协议特征分析" class="headerlink" title="UDP协议特征分析"></a>UDP协议特征分析</h3><p>UDP（User Datagram Protocol，用户数据报协议）是传输层的无连接协议，以其简单高效的特点在特定应用场景中发挥重要作用。</p><h4 id="核心设计特点"><a href="#核心设计特点" class="headerlink" title="核心设计特点"></a>核心设计特点</h4><table><thead><tr><th>特征维度</th><th>UDP特点</th><th>技术优势</th><th>应用影响</th></tr></thead><tbody><tr><td><strong>连接管理</strong></td><td>无连接服务</td><td>无需三次握手建立连接</td><td>降低通信延迟和系统开销</td></tr><tr><td><strong>状态维护</strong></td><td>无状态协议</td><td>不维护连接状态信息</td><td>服务器可支持更多并发客户端</td></tr><tr><td><strong>首部开销</strong></td><td>8字节固定首部</td><td>相比TCP节省75%首部空间</td><td>提高网络传输效率</td></tr><tr><td><strong>流量控制</strong></td><td>无流量控制</td><td>发送速率不受接收方限制</td><td>适合实时性要求高的应用</td></tr><tr><td><strong>拥塞控制</strong></td><td>无拥塞控制</td><td>不响应网络拥塞状况</td><td>保持恒定发送速率</td></tr><tr><td><strong>通信模式</strong></td><td>多种通信模式</td><td>支持1对1、1对多、多对1、多对多</td><td>灵活的网络拓扑支持</td></tr><tr><td><strong>数据处理</strong></td><td>面向报文</td><td>保持应用层报文边界</td><td>应用层需合理控制报文大小</td></tr></tbody></table><h4 id="协议工作机制"><a href="#协议工作机制" class="headerlink" title="协议工作机制"></a>协议工作机制</h4><p><strong>1. 无连接传输模式</strong></p><ul><li><strong>即发即送</strong>：数据传输前无需建立连接</li><li><strong>独立处理</strong>：每个数据报独立路由和处理</li><li><strong>状态无关</strong>：发送方和接收方不维护连接状态</li></ul><p><strong>2. 面向报文的数据处理</strong></p><ul><li><strong>边界保持</strong>：保留应用层报文的完整性</li><li><strong>原样传递</strong>：不对报文进行分割或合并</li><li><strong>大小控制</strong>：应用程序需选择合适的报文大小</li></ul><p><strong>3. 最小化协议开销</strong></p><ul><li><strong>简化首部</strong>：仅包含必要的传输信息</li><li><strong>快速处理</strong>：协议栈处理开销最小</li><li><strong>高效传输</strong>：适合对延迟敏感的应用</li></ul><h3 id="UDP首部结构详解"><a href="#UDP首部结构详解" class="headerlink" title="UDP首部结构详解"></a>UDP首部结构详解</h3><h4 id="首部字段组成"><a href="#首部字段组成" class="headerlink" title="首部字段组成"></a>首部字段组成</h4><table><thead><tr><th>字段名称</th><th>位长（bit）</th><th>字节数</th><th>字段范围</th><th>功能描述</th></tr></thead><tbody><tr><td><strong>源端口</strong></td><td>16</td><td>2</td><td>0-65535</td><td>发送方应用进程端口号，回复时使用</td></tr><tr><td><strong>目的端口</strong></td><td>16</td><td>2</td><td>0-65535</td><td>接收方应用进程端口号，必须字段</td></tr><tr><td><strong>长度</strong></td><td>16</td><td>2</td><td>8-65535</td><td>UDP首部+数据总长度（最小8字节）</td></tr><tr><td><strong>检验和</strong></td><td>16</td><td>2</td><td>0-65535</td><td>差错检测，IPv4可选，IPv6必须</td></tr></tbody></table><h4 id="字段功能说明"><a href="#字段功能说明" class="headerlink" title="字段功能说明"></a>字段功能说明</h4><p><strong>源端口字段</strong>：</p><ul><li><strong>双向通信</strong>：用于接收方回复数据</li><li><strong>可选性</strong>：单向通信时可设为0</li><li><strong>多路复用</strong>：标识发送方应用进程</li></ul><p><strong>目的端口字段</strong>：</p><ul><li><strong>必要性</strong>：数据包正确投递的关键</li><li><strong>服务标识</strong>：指定目标应用服务</li><li><strong>解复用依据</strong>：传输层分发数据的基础</li><li><strong>错误处理</strong>：端口不存在时，接收方丢弃报文并通过ICMP发送”端口不可达”错误</li></ul><p><strong>长度字段</strong>：</p><ul><li><strong>范围限制</strong>：8字节（仅首部）到65535字节</li><li><strong>完整性</strong>：包含首部和数据部分总长度</li><li><strong>验证作用</strong>：接收方验证数据包完整性</li></ul><p><strong>检验和字段</strong>：</p><ul><li><strong>差错检测</strong>：检验UDP数据报传输完整性</li><li><strong>处理策略</strong>：发现错误直接丢弃数据报</li><li><strong>版本差异</strong>：IPv4中可选（不用时设为0），IPv6中强制使用</li></ul><h3 id="UDP检验和机制"><a href="#UDP检验和机制" class="headerlink" title="UDP检验和机制"></a>UDP检验和机制</h3><p>UDP检验和提供端到端的差错检测，虽然简单但能有效发现传输错误。</p><h4 id="检验和计算流程"><a href="#检验和计算流程" class="headerlink" title="检验和计算流程"></a>检验和计算流程</h4><p><strong>发送方处理过程</strong>：</p><ol><li><strong>构造伪首部</strong>：添加IP层信息用于检验</li><li><strong>数据分组</strong>：将伪首部+UDP首部+数据按16位分组</li><li><strong>求和计算</strong>：所有16位字相加，进位回卷</li><li><strong>取反操作</strong>：对和值按位求反得到检验和</li><li><strong>填入首部</strong>：将检验和写入UDP首部对应字段</li></ol><p><strong>接收方验证过程</strong>：</p><ol><li><strong>重构检验</strong>：按相同方式构造伪首部和分组</li><li><strong>全部求和</strong>：包括接收到的检验和一起计算</li><li><strong>结果判断</strong>：<ul><li>结果为0：传输正确</li><li>结果非0：存在错误，丢弃数据包</li></ul></li></ol><h4 id="伪首部结构"><a href="#伪首部结构" class="headerlink" title="伪首部结构"></a>伪首部结构</h4><table><thead><tr><th>字段名称</th><th>位长（bit）</th><th>字节数</th><th>内容来源</th><th>作用</th></tr></thead><tbody><tr><td><strong>源IP地址</strong></td><td>32</td><td>4</td><td>IP首部</td><td>验证数据包来源</td></tr><tr><td><strong>目的IP地址</strong></td><td>32</td><td>4</td><td>IP首部</td><td>验证数据包目标</td></tr><tr><td><strong>保留字段</strong></td><td>8</td><td>1</td><td>全0</td><td>字节对齐</td></tr><tr><td><strong>协议字段</strong></td><td>8</td><td>1</td><td>17（UDP）</td><td>标识上层协议</td></tr><tr><td><strong>UDP长度</strong></td><td>16</td><td>2</td><td>UDP首部</td><td>数据包长度信息</td></tr></tbody></table><p><strong>伪首部特点</strong>：</p><ul><li><strong>虚拟结构</strong>：仅用于检验和计算，不实际传输</li><li><strong>跨层信息</strong>：结合网络层和传输层信息</li><li><strong>完整性保证</strong>：确保数据包在正确的源和目的间传输</li></ul><h4 id="检验和策略差异"><a href="#检验和策略差异" class="headerlink" title="检验和策略差异"></a>检验和策略差异</h4><table><thead><tr><th>协议版本</th><th>检验和要求</th><th>处理方式</th><th>设计考虑</th></tr></thead><tbody><tr><td><strong>IPv4环境</strong></td><td>可选机制</td><td>不使用时设为0</td><td>兼容性考虑</td></tr><tr><td><strong>IPv6环境</strong></td><td>强制要求</td><td>必须计算和验证</td><td>可靠性提升</td></tr></tbody></table><p><strong>与IP检验和的区别</strong>：</p><ul><li><strong>覆盖范围</strong>：UDP检验整个数据包，IP仅检验首部</li><li><strong>检测能力</strong>：UDP能发现数据部分的传输错误</li><li><strong>处理机制</strong>：UDP发现错误直接丢弃，不进行纠错</li></ul><h2 id="TCP协议详解"><a href="#TCP协议详解" class="headerlink" title="TCP协议详解"></a>TCP协议详解</h2><h3 id="TCP协议概述"><a href="#TCP协议概述" class="headerlink" title="TCP协议概述"></a>TCP协议概述</h3><p>TCP（Transmission Control Protocol，传输控制协议）是传输层的面向连接协议，在不可靠的IP网络层之上提供可靠的端到端数据传输服务。TCP通过复杂的控制机制解决了网络通信中的可靠性、有序性、流量控制和拥塞控制等关键问题。</p><h4 id="协议设计目标"><a href="#协议设计目标" class="headerlink" title="协议设计目标"></a>协议设计目标</h4><table><thead><tr><th>设计目标</th><th>实现机制</th><th>技术手段</th></tr></thead><tbody><tr><td><strong>可靠传输</strong></td><td>确认重传机制</td><td>序列号、确认号、超时重传</td></tr><tr><td><strong>有序交付</strong></td><td>序列号排序</td><td>32位序列号、接收缓冲区重排</td></tr><tr><td><strong>流量控制</strong></td><td>滑动窗口</td><td>接收窗口通告、流量调节</td></tr><tr><td><strong>拥塞控制</strong></td><td>拥塞窗口</td><td>慢启动、拥塞避免、快重传</td></tr><tr><td><strong>连接管理</strong></td><td>状态机制</td><td>三次握手、四次挥手</td></tr></tbody></table><h3 id="TCP核心特征分析"><a href="#TCP核心特征分析" class="headerlink" title="TCP核心特征分析"></a>TCP核心特征分析</h3><h4 id="面向连接的服务模式"><a href="#面向连接的服务模式" class="headerlink" title="面向连接的服务模式"></a>面向连接的服务模式</h4><p><strong>连接生命周期管理</strong>：</p><ul><li><strong>建立阶段</strong>：三次握手协商连接参数</li><li><strong>数据传输</strong>：可靠的双向数据交换</li><li><strong>释放阶段</strong>：四次挥手优雅关闭连接</li></ul><p><strong>连接状态维护</strong>：</p><ul><li><strong>发送状态</strong>：发送缓冲区、发送窗口、重传定时器</li><li><strong>接收状态</strong>：接收缓冲区、接收窗口、确认机制</li><li><strong>控制状态</strong>：拥塞窗口、RTT估计、连接状态</li></ul><h4 id="可靠传输保障机制"><a href="#可靠传输保障机制" class="headerlink" title="可靠传输保障机制"></a>可靠传输保障机制</h4><table><thead><tr><th>可靠性问题</th><th>TCP解决方案</th><th>技术实现</th></tr></thead><tbody><tr><td><strong>数据丢失</strong></td><td>超时重传</td><td>自适应重传定时器</td></tr><tr><td><strong>数据重复</strong></td><td>序列号去重</td><td>32位序列号空间</td></tr><tr><td><strong>数据乱序</strong></td><td>缓冲重排</td><td>接收缓冲区排序</td></tr><tr><td><strong>数据损坏</strong></td><td>检验和验证</td><td>强制性检验和机制</td></tr></tbody></table><h4 id="通信模式特点"><a href="#通信模式特点" class="headerlink" title="通信模式特点"></a>通信模式特点</h4><p><strong>点对点通信</strong>：</p><ul><li><strong>连接唯一性</strong>：每个TCP连接连接两个特定端点</li><li><strong>资源独占</strong>：每个连接维护独立的状态信息</li><li><strong>不支持广播</strong>：无法实现一对多通信模式</li></ul><p><strong>全双工数据传输</strong>：</p><ul><li><strong>双向独立</strong>：两个方向的数据流独立控制</li><li><strong>缓冲机制</strong>：发送和接收缓冲区分离</li><li><strong>异步操作</strong>：发送和接收可同时进行</li></ul><h4 id="面向字节流的数据处理"><a href="#面向字节流的数据处理" class="headerlink" title="面向字节流的数据处理"></a>面向字节流的数据处理</h4><p><strong>字节流特性</strong>：</p><ul><li><strong>无边界性</strong>：不保持应用层消息边界</li><li><strong>连续性</strong>：将数据视为连续的字节序列</li><li><strong>灵活分段</strong>：根据网络条件动态调整段大小</li></ul><p><strong>数据处理机制</strong>：</p><table><thead><tr><th>处理层面</th><th>发送方行为</th><th>接收方行为</th></tr></thead><tbody><tr><td><strong>应用层</strong></td><td>提交不定长数据块</td><td>接收重组后的字节流</td></tr><tr><td><strong>TCP层</strong></td><td>按MSS分段传输</td><td>缓冲重组字节流</td></tr><tr><td><strong>网络层</strong></td><td>独立IP数据包</td><td>独立接收处理</td></tr></tbody></table><p><strong>缓冲区管理机制</strong>：</p><table><thead><tr><th>缓冲区类型</th><th>功能作用</th><th>存储内容</th><th>管理策略</th></tr></thead><tbody><tr><td><strong>发送缓冲区</strong></td><td>暂存待发送数据</td><td>应用数据、已发送未确认数据</td><td>滑动窗口控制</td></tr><tr><td><strong>接收缓冲区</strong></td><td>重组接收数据</td><td>按序数据、乱序数据</td><td>顺序交付应用</td></tr></tbody></table><p><strong>字节流处理示例</strong>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">发送方应用: [1000字节] [500字节] [1500字节]</span><br><span class="line">     ↓</span><br><span class="line">TCP分段:   [1000] [500] [1460] [40]</span><br><span class="line">     ↓</span><br><span class="line">网络传输:   独立的IP数据包</span><br><span class="line">     ↓</span><br><span class="line">TCP重组:   连续的3000字节流</span><br><span class="line">     ↓</span><br><span class="line">接收方应用: [2000字节] [1000字节] (应用层自定义边界)</span><br></pre></td></tr></table></figure><h4 id="TCP与UDP协议对比"><a href="#TCP与UDP协议对比" class="headerlink" title="TCP与UDP协议对比"></a>TCP与UDP协议对比</h4><table><thead><tr><th>特征维度</th><th>TCP</th><th>UDP</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>连接性</strong></td><td>面向连接</td><td>无连接</td><td>TCP适合可靠传输，UDP适合实时应用</td></tr><tr><td><strong>可靠性</strong></td><td>可靠传输</td><td>尽力而为</td><td>TCP保证数据完整，UDP允许数据丢失</td></tr><tr><td><strong>开销</strong></td><td>高开销</td><td>低开销</td><td>TCP功能丰富，UDP简单高效</td></tr><tr><td><strong>报文长度</strong></td><td>动态调整</td><td>应用决定</td><td>TCP优化网络利用，UDP保持边界</td></tr></tbody></table><h3 id="TCP报文段结构"><a href="#TCP报文段结构" class="headerlink" title="TCP报文段结构"></a>TCP报文段结构</h3><p>TCP报文段是TCP协议的基本传输单元，既承载用户数据，又实现连接控制功能。</p><h4 id="TCP首部详细结构"><a href="#TCP首部详细结构" class="headerlink" title="TCP首部详细结构"></a>TCP首部详细结构</h4><h5 id="固定首部字段（20字节）-1"><a href="#固定首部字段（20字节）-1" class="headerlink" title="固定首部字段（20字节）"></a>固定首部字段（20字节）</h5><table><thead><tr><th>字段名称</th><th>位长</th><th>字节偏移</th><th>功能描述</th><th>重要性</th></tr></thead><tbody><tr><td><strong>源端口</strong></td><td>16位</td><td>0-1</td><td>发送方应用进程标识</td><td>多路复用基础</td></tr><tr><td><strong>目的端口</strong></td><td>16位</td><td>2-3</td><td>接收方应用进程标识</td><td>服务定位关键</td></tr><tr><td><strong>序列号</strong></td><td>32位</td><td>4-7</td><td>数据字节流位置标识</td><td>有序传输核心</td></tr><tr><td><strong>确认号</strong></td><td>32位</td><td>8-11</td><td>期望接收的下一字节号</td><td>可靠传输基础</td></tr><tr><td><strong>首部长度</strong></td><td>4位</td><td>12</td><td>TCP首部长度（4字节单位）</td><td>首部解析依据</td></tr><tr><td><strong>保留字段</strong></td><td>6位</td><td>12</td><td>未来扩展预留</td><td>协议兼容性</td></tr><tr><td><strong>控制标志</strong></td><td>6位</td><td>13</td><td>连接状态控制</td><td>状态机驱动</td></tr><tr><td><strong>窗口大小</strong></td><td>16位</td><td>14-15</td><td>接收窗口通告</td><td>流量控制机制</td></tr><tr><td><strong>检验和</strong></td><td>16位</td><td>16-17</td><td>数据完整性验证</td><td>错误检测</td></tr><tr><td><strong>紧急指针</strong></td><td>16位</td><td>18-19</td><td>紧急数据边界</td><td>优先数据处理</td></tr></tbody></table><h5 id="控制标志位详解"><a href="#控制标志位详解" class="headerlink" title="控制标志位详解"></a>控制标志位详解</h5><table><thead><tr><th>标志位</th><th>全称</th><th>功能作用</th><th>使用场景</th><th>组合使用</th></tr></thead><tbody><tr><td><strong>URG</strong></td><td>Urgent</td><td>紧急指针有效</td><td>紧急数据传输</td><td>与紧急指针配合</td></tr><tr><td><strong>ACK</strong></td><td>Acknowledgment</td><td>确认号有效</td><td>数据确认</td><td>除SYN外几乎总是置1</td></tr><tr><td><strong>PSH</strong></td><td>Push</td><td>立即推送数据</td><td>交互式应用</td><td>提高响应性</td></tr><tr><td><strong>RST</strong></td><td>Reset</td><td>重置连接</td><td>异常处理</td><td>强制关闭连接</td></tr><tr><td><strong>SYN</strong></td><td>Synchronize</td><td>同步序列号</td><td>连接建立</td><td>三次握手使用</td></tr><tr><td><strong>FIN</strong></td><td>Finish</td><td>结束数据传输</td><td>连接释放</td><td>四次挥手使用</td></tr></tbody></table><p><strong>常见标志位组合</strong>：</p><ul><li><strong>SYN&#x3D;1, ACK&#x3D;0</strong>：连接请求</li><li><strong>SYN&#x3D;1, ACK&#x3D;1</strong>：连接确认</li><li><strong>FIN&#x3D;1, ACK&#x3D;1</strong>：连接终止</li><li><strong>RST&#x3D;1</strong>：连接重置</li><li><strong>PSH&#x3D;1, ACK&#x3D;1</strong>：数据推送</li></ul><h5 id="关键字段功能分析"><a href="#关键字段功能分析" class="headerlink" title="关键字段功能分析"></a>关键字段功能分析</h5><p><strong>序列号机制</strong>：</p><ul><li><strong>初始值</strong>：连接建立时随机选择</li><li><strong>递增规则</strong>：按发送字节数递增</li><li><strong>回绕处理</strong>：32位空间循环使用</li><li><strong>同步作用</strong>：确保数据有序传输</li></ul><p><strong>确认号机制</strong>：</p><ul><li><strong>累积确认</strong>：确认连续接收的最大序号+1</li><li><strong>有效条件</strong>：ACK标志位为1时有效</li><li><strong>确认策略</strong>：可延迟确认提高效率</li><li><strong>重复确认</strong>：触发快速重传机制</li></ul><p><strong>窗口字段</strong>：</p><ul><li><strong>流量控制</strong>：通告接收方缓冲区可用空间</li><li><strong>动态调整</strong>：根据处理能力实时更新</li><li><strong>零窗口</strong>：暂停发送，启动持续定时器</li><li><strong>窗口扩大</strong>：通过选项字段扩展范围</li></ul><p><strong>检验和计算</strong>：</p><ul><li><strong>覆盖范围</strong>：TCP首部+数据+伪首部</li><li><strong>强制性</strong>：TCP检验和必须计算</li><li><strong>伪首部</strong>：包含IP地址信息</li><li><strong>错误处理</strong>：检验失败直接丢弃</li></ul><p><strong>紧急数据处理</strong>：</p><ul><li><strong>优先传输</strong>：紧急数据插队发送</li><li><strong>带外数据</strong>：不占用正常数据流序号</li><li><strong>应用通知</strong>：接收方立即通知应用层</li><li><strong>指针含义</strong>：指向紧急数据末尾位置</li></ul><h5 id="可变选项字段（0-40字节）-1"><a href="#可变选项字段（0-40字节）-1" class="headerlink" title="可变选项字段（0-40字节）"></a>可变选项字段（0-40字节）</h5><table><thead><tr><th>选项类型</th><th>选项长度</th><th>功能描述</th><th>使用时机</th></tr></thead><tbody><tr><td><strong>MSS</strong></td><td>4字节</td><td>最大报文段长度</td><td>连接建立时协商</td></tr><tr><td><strong>窗口扩大因子</strong></td><td>3字节</td><td>扩展窗口大小范围</td><td>高带宽网络</td></tr><tr><td><strong>时间戳</strong></td><td>10字节</td><td>RTT测量和PAWS</td><td>高速网络</td></tr><tr><td><strong>SACK允许</strong></td><td>2字节</td><td>启用选择确认</td><td>连接建立时</td></tr><tr><td><strong>SACK</strong></td><td>可变</td><td>选择确认块</td><td>数据传输时</td></tr></tbody></table><p><strong>选项字段特点</strong>：</p><ul><li><strong>可选性</strong>：根据需要添加</li><li><strong>对齐要求</strong>：总长度4字节对齐</li><li><strong>填充处理</strong>：不足部分用0填充</li><li><strong>向后兼容</strong>：不识别的选项被忽略</li></ul><h3 id="TCP检验和机制"><a href="#TCP检验和机制" class="headerlink" title="TCP检验和机制"></a>TCP检验和机制</h3><p>TCP检验和是强制性的端到端错误检测机制，确保数据在传输过程中的完整性。</p><h4 id="检验和计算原理"><a href="#检验和计算原理" class="headerlink" title="检验和计算原理"></a>检验和计算原理</h4><p><strong>算法特点</strong>：</p><ul><li><strong>强制性</strong>：TCP检验和必须计算，不可选</li><li><strong>全覆盖</strong>：包含首部、数据和伪首部</li><li><strong>简单高效</strong>：16位字求和算法</li><li><strong>错误检测</strong>：能检测大部分传输错误</li></ul><h4 id="检验和计算流程-1"><a href="#检验和计算流程-1" class="headerlink" title="检验和计算流程"></a>检验和计算流程</h4><h5 id="发送方处理步骤"><a href="#发送方处理步骤" class="headerlink" title="发送方处理步骤"></a>发送方处理步骤</h5><table><thead><tr><th>步骤</th><th>操作内容</th><th>技术细节</th><th>注意事项</th></tr></thead><tbody><tr><td><strong>1</strong></td><td>构造伪首部</td><td>添加IP层信息</td><td>包含源&#x2F;目的IP地址</td></tr><tr><td><strong>2</strong></td><td>数据准备</td><td>检验和字段置0</td><td>为计算做准备</td></tr><tr><td><strong>3</strong></td><td>16位分组</td><td>按16位字划分</td><td>奇数字节需填充0</td></tr><tr><td><strong>4</strong></td><td>求和计算</td><td>所有16位字相加</td><td>进位回卷处理</td></tr><tr><td><strong>5</strong></td><td>取反操作</td><td>对和值按位求反</td><td>得到最终检验和</td></tr><tr><td><strong>6</strong></td><td>填入首部</td><td>写入检验和字段</td><td>完成报文段构造</td></tr></tbody></table><p><strong>计算示例</strong>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">伪首部 + TCP首部 + 数据 → 16位字序列</span><br><span class="line">0x4500 + 0x0028 + 0x1234 + ... → 求和</span><br><span class="line">进位回卷：(sum &amp; 0xFFFF) + (sum &gt;&gt; 16)</span><br><span class="line">按位取反：~sum &amp; 0xFFFF</span><br></pre></td></tr></table></figure><h5 id="接收方验证步骤"><a href="#接收方验证步骤" class="headerlink" title="接收方验证步骤"></a>接收方验证步骤</h5><table><thead><tr><th>步骤</th><th>操作内容</th><th>验证逻辑</th><th>处理结果</th></tr></thead><tbody><tr><td><strong>1</strong></td><td>重构检验</td><td>按相同方式构造</td><td>包含接收到的检验和</td></tr><tr><td><strong>2</strong></td><td>全部求和</td><td>所有16位字相加</td><td>包括原检验和字段</td></tr><tr><td><strong>3</strong></td><td>结果判断</td><td>检查最终结果</td><td>0表示正确，非0表示错误</td></tr><tr><td><strong>4</strong></td><td>错误处理</td><td>丢弃错误报文段</td><td>不通知发送方</td></tr></tbody></table><h4 id="伪首部结构详解"><a href="#伪首部结构详解" class="headerlink" title="伪首部结构详解"></a>伪首部结构详解</h4><table><thead><tr><th>字段名称</th><th>位长</th><th>字节数</th><th>数据来源</th><th>作用说明</th></tr></thead><tbody><tr><td><strong>源IP地址</strong></td><td>32位</td><td>4</td><td>IP首部</td><td>验证数据包来源正确性</td></tr><tr><td><strong>目的IP地址</strong></td><td>32位</td><td>4</td><td>IP首部</td><td>验证数据包目标正确性</td></tr><tr><td><strong>保留字段</strong></td><td>8位</td><td>1</td><td>全0</td><td>字节对齐和协议兼容</td></tr><tr><td><strong>协议字段</strong></td><td>8位</td><td>1</td><td>6(TCP)</td><td>标识传输层协议类型</td></tr><tr><td><strong>TCP长度</strong></td><td>16位</td><td>2</td><td>计算得出</td><td>TCP首部+数据总长度</td></tr></tbody></table><p><strong>伪首部作用</strong>：</p><ul><li><strong>跨层验证</strong>：结合网络层信息进行验证</li><li><strong>路由保护</strong>：防止数据包被错误路由</li><li><strong>协议识别</strong>：确保数据包被正确的协议处理</li><li><strong>长度校验</strong>：验证数据包长度信息正确性</li></ul><h4 id="检验和特性分析"><a href="#检验和特性分析" class="headerlink" title="检验和特性分析"></a>检验和特性分析</h4><p><strong>检测能力</strong>：</p><ul><li><strong>单比特错误</strong>：100%检测</li><li><strong>双比特错误</strong>：高概率检测</li><li><strong>突发错误</strong>：部分检测能力</li><li><strong>随机错误</strong>：统计检测能力</li></ul><p><strong>性能考虑</strong>：</p><ul><li><strong>计算开销</strong>：相对较小</li><li><strong>硬件支持</strong>：可硬件加速</li><li><strong>实时性</strong>：不影响传输延迟</li><li><strong>可靠性</strong>：提供基本错误检测</li></ul><p><strong>与其他协议对比</strong>：</p><table><thead><tr><th>协议</th><th>检验和要求</th><th>覆盖范围</th><th>错误处理</th></tr></thead><tbody><tr><td><strong>TCP</strong></td><td>强制计算</td><td>首部+数据+伪首部</td><td>丢弃错误报文</td></tr><tr><td><strong>UDP</strong></td><td>IPv4可选，IPv6强制</td><td>首部+数据+伪首部</td><td>丢弃错误报文</td></tr><tr><td><strong>IP</strong></td><td>仅首部</td><td>仅IP首部</td><td>丢弃错误数据包</td></tr></tbody></table><h3 id="TCP-运输连接"><a href="#TCP-运输连接" class="headerlink" title="TCP 运输连接"></a>TCP 运输连接</h3><p>分为三个阶段:</p><ol><li>通过 “三报文握手” 来建立 TCP 连接。</li><li>基于已建立的 TCP 连接进行可靠的数据传输。</li><li>在数据传输结束后还要通过 “四报文挥手” 来释放 TCP 连接。</li></ol><h4 id="“三报文握手”-建立-TCP-连接"><a href="#“三报文握手”-建立-TCP-连接" class="headerlink" title="“三报文握手” 建立 TCP 连接"></a>“三报文握手” 建立 TCP 连接</h4><p><strong>目的:</strong> 在于解决以下三个主要问题:</p><ul><li>使 TCP 双方能够确知对方的存在。</li><li>使 TCP 双方能够协商一些参数 (最大报文段长度、最大窗口大小、时间戳选项等)。</li><li>使 TCP 双方能够对运输实体资源进行分配和初始化，运输实体资源包括缓存大小、各状态变量、连接表中的项目等。</li></ul><ol><li>每条 TCP 连接有两个端点，此端点即套接字。每条 TCP 连接唯一地被通信的两个端点 (套接字) 确定。</li><li>同一个 IP 地址可以有多个不同的 TCP 连接，而同一个端口号也可以出现在多个不同的 TCP 连接中。</li><li>TCP 连接的建立采用客户&#x2F;服务器模式，主动发起连接建立的应用进程称为客户，而被动等待连接建立的应用进程称为服务器。</li></ol><p><strong>过程:</strong><br>(此处原文有三张图片，逐步展示了 TCP 建立连接的 “三报文握手” 过程，包括 SYN 包、SYN-ACK 包、ACK 包的发送和状态转换。)</p><ul><li><strong>序号 seq 字段被设置了一个初始值 x，作为 TCP 客户进程所选择的初始序号。</strong></li><li><strong>请同学们注意:</strong><ul><li>TCP 规定同步标志位 SYN 被设置为 1 的报文段 (例如 TCP 连接请求报文段和 TCP 连接请求确认报文段) 不能携带数据，但要消耗掉一个序号。</li><li>按上述规定，TCP 连接请求报文段不能携带数据 (即没有数据载荷)，但是会消耗掉序号 x。</li><li>因此，TCP 客户进程下一次发送的 TCP 报文段的数据载荷的第一个字节的序号为 x+1。</li></ul></li><li><strong>补充:</strong> 上述过程发送的第三个普通的 TCP 报文段是否多余?(使用三报文握手而不是两报文握手建立 TCP 连接的原因)<ul><li><strong>“三报文握手”建立 TCP 连接 ————使用“三报文握手”而不是“两报文握手”建立 TCP 连接的原因</strong><br>(此处原文有一张图片，展示了使用两报文握手可能导致已失效的连接请求报文段被接受，从而造成资源浪费的场景。)</li><li>采用 “三报文握手” 而不是 “两报文握手” 来建立 TCP 连接，是为了防止已失效的 TCP 连接请求报文段突然又传送到了 TCP 服务器进程，因而导致错误。</li></ul></li></ul><h4 id="“四报文挥手”-释放-TCP-连接"><a href="#“四报文挥手”-释放-TCP-连接" class="headerlink" title="“四报文挥手” 释放 TCP 连接"></a>“四报文挥手” 释放 TCP 连接</h4><p><strong>第一步:</strong> 客户机发送连接释放报文段，并停止发送数据，主动关闭 TCP 连接。该报文段终止位 FIN 设置为 1，序号 seq&#x3D;u (等于前面已传送过的数据的最后一个字节的序号加 1)。<br>(此处原文有一张图片，展示了 TCP 释放连接的第一步，客户机发送 FIN 包，进入 FIN-WAIT-1 状态。)</p><ul><li>TCP 连接释放报文段首部中的终止标志位 FIN 和确认标志位 ACK 的值都被设置为 1。</li><li>表明这是一个 TCP 连接释放报文段，同时也对之前收到的 TCP 报文段进行确认。</li></ul><p><strong>第二步:</strong> 服务器收到连接释放报文段后发出确认。<br>(此处原文有一张图片，展示了 TCP 释放连接的第二步，服务器收到 FIN 包后发送 ACK 包，进入 CLOSE-WAIT 状态。)</p><ul><li>TCP 规定终止标志位 FIN 等于 1 的 TCP 报文段即使不携带数据，也要消耗掉一个序号。</li><li>从 TCP 客户进程到 TCP 服务器进程这个方向的连接就释放了。</li><li><strong>此时的 TCP 连接属于半关闭状态。</strong><ul><li>TCP 客户进程已经没有数据要发送了。但 TCP 服务器进程如果还有数据要发送，TCP 客户进程仍要接收，也就是从 TCP 服务器进程到 TCP 客户进程这个方向的连接并未关闭。</li><li>半关闭状态可能会持续一段时间。</li></ul></li></ul><p><strong>第三步:</strong> 若服务器已经没有要向客户机发送的数据，就通知 TCP 释放连接。<br>(此处原文有一张图片，展示了 TCP 释放连接的第三步，服务器发送 FIN 包，进入 LAST-ACK 状态。)</p><ul><li>TCP 连接释放报文段首部中的终止标志位 FIN 和确认标志位 ACK 的值都被设置为 1。</li><li>表明这是一个 TCP 连接释放报文段，同时也对之前收到的 TCP 报文段进行确认。</li></ul><p><strong>第四步:</strong><br>(此处原文有一张图片，展示了 TCP 释放连接的第四步，客户机发送 ACK 包，进入 TIME-WAIT 状态，服务器进入 CLOSED 状态。)</p><ul><li><strong>TIME-WAIT (时间等待) 状态</strong><ul><li>MSL 是最长报文段寿命 (Maximum Segment Lifetime) 的英文缩写词，[RFC793] 建议为 2 分钟。也就是说，TCP 客户进程进入时间等待 (TIME-WAIT) 状态后，还要经过 4 分钟才能进入关闭 (CLOSED) 状态。</li></ul></li><li><strong>补充:</strong> 为何要经过 2MSL 后才进入关闭状态?<ul><li>处于时间等待 (TIME-WAIT) 状态后要经过 2MSL 时长，可以确保 TCP 服务器进程能够收到最后一个 TCP 确认报文段而进入关闭 (CLOSED) 状态。</li><li>另外，TCP 客户进程在发送完最后一个 TCP 确认报文段后，再经过 2MSL 时长，就可以使本次连接持续期内所产生的所有报文段都从网络中消失。这样就可以使下一个新的 TCP 连接中不会出现旧连接中的报文段。</li></ul></li></ul><p><strong>总结:</strong></p><table><thead><tr><th align="left">阶段</th><th align="left">建立连接</th><th align="left">释放连接</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">SYN&#x3D;1 seq&#x3D;x</td><td align="left">FIN&#x3D;1 seq&#x3D;u</td></tr><tr><td align="left">2</td><td align="left">SYN&#x3D;1 ACK&#x3D;1 seq&#x3D;y ack&#x3D;x+1</td><td align="left">ACK&#x3D;1 seq&#x3D;v ack&#x3D;u+1</td></tr><tr><td align="left">3</td><td align="left">ACK&#x3D;1 seq&#x3D;x+1 ack&#x3D;y+1</td><td align="left">FIN&#x3D;1 ACK&#x3D;1 seq&#x3D;w ack&#x3D;u+1</td></tr><tr><td align="left">4</td><td align="left"></td><td align="left">ACK&#x3D;1 seq&#x3D;u+1 ack&#x3D;w+1</td></tr></tbody></table><h3 id="TCP-可靠传输"><a href="#TCP-可靠传输" class="headerlink" title="TCP 可靠传输"></a>TCP 可靠传输</h3><h4 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h4><p>TCP 在不可靠的 IP 层之上建立一种可靠数据传输服务，该服务保证接收方从缓存区读出的字节流与发送方发出的字节流完全一样。TCP 使用了检验、序号、确认和重传等机制来达到这一目的。</p><h4 id="序号"><a href="#序号" class="headerlink" title="序号"></a>序号</h4><p>TCP 将数据视为一个无结构但有序的字节流，序号建立在传送的字节流之上，而不建立在报文段之上。下图中第二个报文段的序号是 3。<br>(此处原文有一张图片，展示了 TCP 报文段中字节流的序号划分。)</p><h4 id="确认"><a href="#确认" class="headerlink" title="确认"></a>确认</h4><p>确认号是期望收到对方的下一个报文段的数据的第一个字节的序号。<br>TCP 默认使用 <strong>【累积确认】</strong>, 即 TCP 只确认数据流中至第一个丢失字节为止的字节。</p><h4 id="重传"><a href="#重传" class="headerlink" title="重传"></a>重传</h4><p>超时和冗余 ACK 会导致 TCP 对报文段进行重传。</p><h5 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h5><p>TCP 每发送一个报文段就对这个报文段设置一个超时计时器。计时器设置的重传时间到但还未收到确认时，就要重传这一报文段。<br>TCP 采用一种自适应算法来计算超时计时器的重传时间。一个报文段发出的时间以及收到相应确认的时间的间隔称为报文段的往返时间 RTT。TCP 维护 RTT 的一个加权平均往返时间 RTTS，<strong>【超时重传时间】</strong> 应该略大于 RTTS。</p><h5 id="冗余-ACK-冗余确认"><a href="#冗余-ACK-冗余确认" class="headerlink" title="冗余 ACK (冗余确认)"></a>冗余 ACK (冗余确认)</h5><p>冗余 ACK 就是再次确认某个报文段的 ACK。<br>TCP 规定每当比期望序号大的失序报文段到达时，就发送一个冗余 ACK，指明下一个期待字节的序号。<br>例如 3,4,5 号报文段到达时不是自己所期望的 2 号报文段，那就发送 3 个对 1 号报文段的 ACK。</p><h3 id="TCP-流量控制"><a href="#TCP-流量控制" class="headerlink" title="TCP 流量控制"></a>TCP 流量控制</h3><h4 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h4><p>TCP 为应用程序提供了流量控制机制，以解决因发送方发送数据太快而导致接收方来不及接收，造成接收方的接收缓存溢出的问题。</p><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ul><li><strong>基本方法:</strong> 接收方根据自己的接收能力 (接收缓存的可用空间大小) 控制发送方的发送速率。</li><li><strong>采用滑动窗口机制。</strong> TCP 要求发送方维持一个接收窗口 rwnd，接收方根据当前接受缓存的大小动态地调整接收窗口的大小，这个值被放在接收方 TCP 报文段首部中的窗口字段，以通知发送方。发送方的发送窗口不能超过接收方给出的接收窗口值，以限制发送方向网络注入报文的速率。</li><li><strong>TCP 为每个连接设有一个【持续计时器】</strong>，只要发送方收到对方的零窗口通知就启动持续计时器。如果计时器超时，就发送一个零窗口探测报文段，对方就在确认这个探测报文段时给出现在的窗口值。如果窗口仍然为 0，则发送方收到确认报文段后就重新设置持续计时器。<br>(此处原文有一张图片，展示了 TCP 流量控制方法，包括零窗口探测报文段的发送和确认过程。)<ul><li>实际上 TCP 规定: 即使接收窗口值为 0，也必须接受零窗口探测报文段、确认报文段以及携带有紧急数据的报文段。</li><li>回答是肯定的。因为零窗口探测报文段也有重传计时器，当重传计时器超时后，零窗口探测报文段会被重传。</li></ul></li></ul><h4 id="流量控制与数据链路层流量控制比较"><a href="#流量控制与数据链路层流量控制比较" class="headerlink" title="流量控制与数据链路层流量控制比较"></a>流量控制与数据链路层流量控制比较</h4><table><thead><tr><th align="left">特性</th><th align="left">传输层</th><th align="left">数据链路层</th></tr></thead><tbody><tr><td align="left">控制范围</td><td align="left">端到端 (两个进程之间流量控制)</td><td align="left">两个中间的相邻结点之间的流量控制</td></tr><tr><td align="left">窗口大小</td><td align="left">窗口大小可动态变化</td><td align="left">窗口大小不能动态变化</td></tr></tbody></table><h3 id="TCP-拥塞控制"><a href="#TCP-拥塞控制" class="headerlink" title="TCP 拥塞控制"></a>TCP 拥塞控制</h3><h4 id="拥塞控制和流量控制"><a href="#拥塞控制和流量控制" class="headerlink" title="拥塞控制和流量控制"></a>拥塞控制和流量控制</h4><ul><li><strong>拥塞控制:</strong> 指防止过多的数据注入网络，保证网络中的路由器或链路不致过载。</li><li><strong>拥塞出现时，端点并不了解拥塞发生的细节，但是对于通信的端点来说，拥塞往往表现为通信时延的增加。</strong></li><li><strong>TCP 的四种拥塞算法:</strong> 慢开始、拥塞避免、快重传和快恢复。</li></ul><h4 id="闭环拥塞控制算法分类"><a href="#闭环拥塞控制算法分类" class="headerlink" title="闭环拥塞控制算法分类"></a>闭环拥塞控制算法分类</h4><p>根据拥塞信息的反馈形式，可将闭环拥塞控制算法分为：</p><ul><li><strong>显式反馈算法:</strong> 从拥塞节点 (即路由器) 向源点提供关于网络中拥塞状态的显式反馈信息。</li><li><strong>隐式反馈算法:</strong> 源点自身通过对网络行为的观察 (例如超时重传或往返时间 RTT) 来推断网络是否发生拥塞。TCP 采用的就是隐式反馈算法。<br>(此处原文有一张图片，展示隐式反馈和显式反馈算法的区别。)<ul><li>拥塞控制并不仅仅是运输层要考虑的问题。显式反馈算法就必须涉及网络层。虽然一些网络体系结构 (如 ATM 网络) 主要在网络层实现拥塞控制，但因特网主要利用隐式反馈在运输层实现拥塞控制。</li></ul></li></ul><h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><ul><li><strong>流量控制:</strong> 通常指点对点的通信量控制，要做的是抑制发送端发送数据的速率，以便接收端来得及接收。</li><li><strong>拥塞控制:</strong> 让网络能够承受现有的网络负荷，是一个全局性的过程，涉及所有的主机、所有的路由器，以及与降低网络传输性能有关的所有因素。</li></ul><h4 id="拥塞窗口-cwnd"><a href="#拥塞窗口-cwnd" class="headerlink" title="拥塞窗口 (cwnd)"></a>拥塞窗口 (cwnd)</h4><p>TCP 除了上文的接收窗口，还要求发送方维持一个拥塞窗口，其大小取决于网络的拥塞程度，动态变化。<br>发送方控制拥塞窗口的原则: 只要网络出现拥塞，拥塞窗口就减小一些。<br>发送窗口的上限值取接收窗口 rwnd 和拥塞窗口 cwnd 中较小的一个。</p><ul><li>发送窗口上限值 &#x3D; min{rwnd, cwnd}</li></ul><h4 id="慢开始和拥塞避免-拥塞避免并不能完全避免拥塞，只是使得网络不容易出现拥塞"><a href="#慢开始和拥塞避免-拥塞避免并不能完全避免拥塞，只是使得网络不容易出现拥塞" class="headerlink" title="慢开始和拥塞避免 (拥塞避免并不能完全避免拥塞，只是使得网络不容易出现拥塞)"></a>慢开始和拥塞避免 (拥塞避免并不能完全避免拥塞，只是使得网络不容易出现拥塞)</h4><h5 id="慢开始算法"><a href="#慢开始算法" class="headerlink" title="慢开始算法"></a>慢开始算法</h5><ul><li><strong>具体方法:</strong> 先发送少量数据探测一下，若没有发生拥塞则适当增大拥塞窗口。(从小到大逐渐增大拥塞窗口 (发送窗口))</li><li><strong>慢开始门限 (ssthresh):</strong> 每经过一个传输轮次 (RTT)，cwnd 就会加倍。cwnd 随轮次指数增长。</li><li>慢开始一直把 cwnd 增大到一个规定的 ssthresh，然后改用拥塞避免算法。</li></ul><h5 id="拥塞避免算法"><a href="#拥塞避免算法" class="headerlink" title="拥塞避免算法"></a>拥塞避免算法</h5><ul><li><strong>具体方法:</strong> 每经过一个往返时延 RTT 就把发送方拥塞窗口 cwnd 加 1，而不是翻倍。</li><li><strong>过程:</strong><ul><li>cwnd &lt; ssthresh, 使用慢开始。</li><li>cwnd &gt; ssthresh, 改用拥塞避免算法。</li><li>cwnd &#x3D; ssthresh, 通常使用拥塞避免算法，也可以使用慢开始。</li></ul></li></ul><h4 id="网络拥塞处理"><a href="#网络拥塞处理" class="headerlink" title="网络拥塞处理"></a>网络拥塞处理</h4><p>无论在何阶段，只要发送方判断网络出现拥塞，就首先把慢开始门限 ssthresh 设置为出现拥塞时发送方 cwnd 值的一般 (不能小于 2)，然后把 cwnd 重新设置为 1，继而执行慢开始算法。<br><strong>注意:</strong> 慢开始阶段，如果 2<em>cwnd &gt; ssthresh，则下一个 RTT 后 cwnd 等于 ssthresh，而非 2</em>cwnd。</p><h4 id="快重传和快恢复"><a href="#快重传和快恢复" class="headerlink" title="快重传和快恢复"></a>快重传和快恢复</h4><h5 id="快重传概述"><a href="#快重传概述" class="headerlink" title="快重传概述"></a>快重传概述</h5><p>个别报文段在网络中丢失，但是此时网络其实并未发生拥塞，但发送方收不到确认就会误认为网络发生了拥塞，从而启动慢开始算法降低传输效率。</p><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>使发送方尽早尽快地进行重传，不等计时器超时再重传。接收方即使受到了失序的报文段也要立即发出对已收到的报文段的重复确认。发送方一旦连续收到 3 个冗余 ACK (重复确认)，就立即重传相应的报文段。</p><h5 id="快恢复原理"><a href="#快恢复原理" class="headerlink" title="快恢复原理"></a>快恢复原理</h5><p>当发送方收到 3 个冗余 ACK (重复确认) 时，执行 “乘法减小”，把慢开始门限 ssthresh 调整为当前 cwnd 的一半。发送方此时认为网络很可能没有发生拥塞。并把 cwnd 值夜调整为当前 cwnd 的一半，此时 cwnd 等于 ssthresh，然后开始执行拥塞避免算法。<br>(此处原文有一张图片，展示了 TCP 拥塞控制的慢开始、拥塞避免、快重传和快恢复四种算法的结合图。)</p><h4 id="TCP-拥塞控制机制中四种算法的同时应用"><a href="#TCP-拥塞控制机制中四种算法的同时应用" class="headerlink" title="TCP 拥塞控制机制中四种算法的同时应用"></a>TCP 拥塞控制机制中四种算法的同时应用</h4><p>TCP 连接建立和网络出现超时时，采用慢开始和拥塞避免算法 (ssthresh&#x3D;cwnd&#x2F;2, cwnd&#x3D;1)。<br>发送方收到 3 个冗余 ACK 时，采用快重传和快恢复算法 (ssthresh&#x3D;cwnd&#x2F;2, cwnd&#x3D;ssthresh)。</p><h3 id="习题查漏补缺-2"><a href="#习题查漏补缺-2" class="headerlink" title="习题查漏补缺"></a>习题查漏补缺</h3><ol><li>在 TCP 首部中没有目标主机 IP 地址。</li><li>TCP 报文段和 UDP 报文段都包含源端口、目的端口、检验号。因为 UDP 提供不可靠的传输服务，所以不需要对报文进行编号，不会有序列号字段。相比之下，TCP 需要有序列号字段。</li><li>TCP 的滑动窗口协议中规定重传分组的数量最多可以是滑动窗口的大小。</li><li>假设 TCP 客户与 TCP 服务器的通信已结束，端到端的往返时间为 RTT。t 时刻 TCP 客户请求断开连接，则从 t 时刻起 TCP 服务器释放该连接的最短时间是 <strong>1.5 个 RTT</strong>。<ul><li><strong>1.5 个 RTT</strong>。t 时刻 TCP 客户请求断开连接，发出连接释放 FIN 报文段。当 TCP 服务器收到 TCP 客户发来的 FIN 报文段后不能再发送数据，因此同时发出确认 ACK 报文段和连接释放 FIN 报文段，即直接跳过 CLOSED-WAIT 状态。TCP 客户收到 FIN 报文段后必须发出确认，TCP 服务器收到确认后就进入 CLOSED 状态，共经历 1.5 个 RTT。</li></ul></li><li>TCP 采用对 <strong>【报文段】</strong> 的确认机制。</li><li>TCP 中滑动窗口的值设置得太大，对主机的影响是 <strong>【由于传送的数据过多而使路由器变得拥挤，主机可能丢失分组】</strong>。</li></ol></div><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://polarwanderer.cn/2025/06/22/0218/" data-id="cmju9ysag001z5uzbftv0dgsr" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABwklEQVR42u3aQY7DIBAEQP//094HRNg9gyHOqjhZiQWVHFoww3HE4xyMz29H74/mPFYMXFzcae55OarLXyPy+Yez4eLibuReB83nO/lPGi18Pf/wc1xc3Fdye5GXbIlwcXH/Bzf/JAlBXFzct3GTeMop8/H3wFkNFxd3gptXKdc9L6nv4uLitrhncfSi6rqkUlgdFxd3CzcPlGp7tRqIybq4uLjf5eYFi2r7JC/HFJqsuLi4j3J7y1RjLm+13vwRuLi4G7l5rFRLJ3kBNApTXFzc7dweMd+45AWRoQQXF3cLNyltzGxcEkrzrIaLi7udW70slV+Y6G19boIMFxd3AbdX2qheusqzKGrP4OLiLuP2mihVerV0Ujir4eLiLuCumKi6iWle0cDFxV3MnQmv/P28ZXJTdsHFxd3I7ZU+55/zwxUuLu4buNVWRx5tM21aXFzc1dyzOOYPP3kBBRcX91vc6nWr6gJ5qD18RQwXF3eam4dOXtpI/pteyxYXF3cnNw+a/MLWwrMaLi7uy7gzx6fqEQsXF/cXudXWbB5nw/lxcXE3cnvFzWozdf5AhYuLu4dbjZJk4aQgku9bcHFxN3L/APf1uWiSHLjCAAAAAElFTkSuQmCC">Share</a><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/408/" rel="tag">408</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%80%83%E7%A0%94/" rel="tag">计算机考研</a></li></ul></div><div class="post-nav"><a class="pre" href="/2025/12/08/1813/">当AI遇见调酒师，一场数字时代的温暖邂逅</a><a class="next" href="/2025/03/25/1556/">数据结构</a></div><div class="nofancybox" id="waline"></div><link rel="stylesheet" type="text/css" href="https://unpkg.com/@waline/client@v3/dist/waline.css"><script type="module">import{init}from"https://unpkg.com/@waline/client@v3/dist/waline.js";init({el:"#waline",comment:!0,serverURL:"comments.polarwanderer.cn",pageSize:"8",wordLimit:"120",requiredMeta:requiredMeta,emoji:["//unpkg.com/@waline/emojis@1.2.0/weibo","//unpkg.com/@waline/emojis@1.2.0/qq","//unpkg.com/@waline/emojis@1.2.0/tw-emoji"]})</script><script>let metaInfo=["nick","mail","link"],requiredMeta="nick,mail".split(",").filter(i=>metaInfo.indexOf(i)>-1)</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0" readonly></div></div><div class="search-modal" id="search-modal"><div class="search-modal-content"><div class="search-modal-header"><input class="search-modal-input" id="modal-search-input" placeholder="输入关键词搜索..." type="text" name="q"></div><div class="search-modal-body"><div id="modal-search-result"></div></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o">Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o">Tags</i></div><div class="tagcloud"><a href="/tags/408/" style="font-size:15px">408</a> <a href="/tags/AI%E5%BA%94%E7%94%A8/" style="font-size:15px">AI应用</a> <a href="/tags/React/" style="font-size:15px">React</a> <a href="/tags/TypeScript/" style="font-size:15px">TypeScript</a> <a href="/tags/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" style="font-size:15px">个人博客</a> <a href="/tags/%E4%BA%BA%E7%89%A9/" style="font-size:15px">人物</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/" style="font-size:15px">前端开发</a> <a href="/tags/%E5%8E%86%E5%8F%B2/" style="font-size:15px">历史</a> <a href="/tags/%E5%93%B2%E5%AD%A6/" style="font-size:15px">哲学</a> <a href="/tags/%E5%9B%9E%E5%BF%86/" style="font-size:15px">回忆</a> <a href="/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" style="font-size:15px">年终总结</a> <a href="/tags/%E6%80%9D%E8%80%83/" style="font-size:15px">思考</a> <a href="/tags/%E6%84%9F%E6%82%9F/" style="font-size:15px">感悟</a> <a href="/tags/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/" style="font-size:15px">数学建模</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size:15px">数据结构</a> <a href="/tags/%E6%97%A5%E8%AE%B0/" style="font-size:15px">日记</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size:15px">机器学习</a> <a href="/tags/%E6%A2%A6%E5%A2%83/" style="font-size:15px">梦境</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size:15px">生活</a> <a href="/tags/%E7%A4%BE%E4%BC%9A%E7%8E%B0%E8%B1%A1/" style="font-size:15px">社会现象</a> <a href="/tags/%E7%AB%9E%E8%B5%9B/" style="font-size:15px">竞赛</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size:15px">笔记</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size:15px">计算机网络</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%80%83%E7%A0%94/" style="font-size:15px">计算机考研</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size:15px">记录</a> <a href="/tags/%E9%9A%8F%E6%83%B3/" style="font-size:15px">随想</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size:15px">随笔</a> <a href="/tags/%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D/" style="font-size:15px">项目介绍</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o">Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/12/31/2359/">再见2025</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/12/17/1529/">遗憾总是贯穿人生</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/12/08/1813/">当AI遇见调酒师，一场数字时代的温暖邂逅</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/06/22/0218/">计算机网络</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/25/1556/">数据结构</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/07/29/0021/">浪迹天涯</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/07/13/2215/">随想</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/07/08/2317/">寻书</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/06/25/2338/">半年志</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/02/07/2150/">2024年美赛</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o">Recent Comments</i></div><div id="widget-waline-list"></div><script type="text/javascript" id="recent-comment" serverurl="comments.polarwanderer.cn" count="5" src="/js/recent-comments.js?v=1.0.0" async></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022-2026 <a href="/." rel="nofollow">Polarwanderer.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path;searchFunc(path,"local-search-input","local-search-result")</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="/js/sticky-header.js?v=1.0.0"></script><script type="text/javascript" src="/js/toc-generator.js?v=1.0.0"></script><script type="text/javascript" src="/js/snowfall.js?v=1.0.0"></script><script type="text/javascript" src="/js/text-reader.js?v=1.0.0"></script><script type="text/javascript" src="/js/floating-buttons.js?v=1.0.0"></script><script type="text/javascript" src="/js/random-post.js?v=1.0.0"></script><script type="text/javascript" src="/js/thoughts-typewriter.js?v=1.0.0"></script><script type="text/javascript" src="/js/subtitle-typewriter.js?v=1.0.0"></script></div></body></html>