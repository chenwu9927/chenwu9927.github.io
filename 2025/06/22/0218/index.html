<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>[计算机网络]第五章-传输层 | BlankChen</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">[计算机网络]第五章-传输层</h1><a id="logo" href="/.">BlankChen</a><p class="description">相逢的人会再相逢。</p></div><div id="nav-menu"><a href="/."><i class="fa fa-home">Home</i></a><a class="current" href="/notes/"><i class="fa fa-sticky-note-o"> Notes</i></a><a href="/esoterica/"><i class="fa fa-eye"> Esoterica</i></a><a href="/thoughts/"><i class="fa fa-lightbulb-o"> Thoughts</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">[计算机网络]第五章-传输层</h1><div class="post-meta">2025-06-22<span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 12.2k</span><span class="post-meta-item-text"> Words</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 43</span><span class="post-meta-item-text"> Minutes</span></span></span></div><a class="disqus-comment-count" href="/2025/06/22/0218/#waline"><span class="waline-comment-count" id="/2025/06/22/0218/"></span><span> Comment</span></a><div class="post-content"><h1 id="5-1-传输层服务概述"><a href="#5-1-传输层服务概述" class="headerlink" title="5.1 传输层服务概述"></a>5.1 传输层服务概述</h1><h2 id="传输层基础概念"><a href="#传输层基础概念" class="headerlink" title="传输层基础概念"></a>传输层基础概念</h2><h3 id="传输层的作用与定位"><a href="#传输层的作用与定位" class="headerlink" title="传输层的作用与定位"></a>传输层的作用与定位</h3><p>传输层为运行在不同主机上的应用进程之间提供端到端的逻辑通信服务，是网络体系结构中承上启下的关键层次。</p><table><thead><tr><th>特征</th><th>描述</th></tr></thead><tbody><tr><td><strong>逻辑通信</strong></td><td>从传输层角度看，通信的真正端点是主机中的应用进程，而非主机本身</td></tr><tr><td><strong>协议栈分布</strong></td><td>仅存在于通信子网边缘的主机中，路由器等中间设备只使用下三层功能</td></tr><tr><td><strong>服务抽象</strong></td><td>向上层应用屏蔽底层网络核心的复杂细节，提供统一的传输服务接口</td></tr></tbody></table><h3 id="传输层核心功能"><a href="#传输层核心功能" class="headerlink" title="传输层核心功能"></a>传输层核心功能</h3><h4 id="1-应用进程间逻辑通信"><a href="#1-应用进程间逻辑通信" class="headerlink" title="1. 应用进程间逻辑通信"></a>1. 应用进程间逻辑通信</h4><ul><li><strong>端点识别</strong>：通过端口号标识主机内的具体应用进程</li><li><strong>进程寻址</strong>：实现不同主机上应用进程的精确定位</li><li><strong>通信抽象</strong>：为应用层提供进程到进程的直接通信视图</li></ul><h4 id="2-多路复用与分用机制"><a href="#2-多路复用与分用机制" class="headerlink" title="2. 多路复用与分用机制"></a>2. 多路复用与分用机制</h4><table><thead><tr><th>机制</th><th>定义</th><th>实现方式</th></tr></thead><tbody><tr><td><strong>复用（Multiplexing）</strong></td><td>发送方多个应用进程共享同一传输层协议</td><td>通过端口号区分不同应用进程的数据</td></tr><tr><td><strong>分用（Demultiplexing）</strong></td><td>接收方传输层将数据正确分发给目标进程</td><td>根据目的端口号将数据交付给相应应用</td></tr></tbody></table><h4 id="3-差错检测与处理"><a href="#3-差错检测与处理" class="headerlink" title="3. 差错检测与处理"></a>3. 差错检测与处理</h4><table><thead><tr><th>协议类型</th><th>差错检测范围</th><th>错误处理策略</th></tr></thead><tbody><tr><td><strong>TCP</strong></td><td>首部 + 数据部分</td><td>要求重传错误报文段</td></tr><tr><td><strong>UDP</strong></td><td>首部 + 数据部分</td><td>直接丢弃错误数据报</td></tr><tr><td><strong>IP</strong></td><td>仅检测首部</td><td>不检查数据部分完整性</td></tr></tbody></table><h4 id="4-连接管理服务"><a href="#4-连接管理服务" class="headerlink" title="4. 连接管理服务"></a>4. 连接管理服务</h4><p>传输层提供两种不同的服务模式：</p><table><thead><tr><th>服务类型</th><th>协议代表</th><th>通信信道特征</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>面向连接</strong></td><td>TCP</td><td>全双工可靠逻辑信道</td><td>要求数据可靠传输的应用</td></tr><tr><td><strong>无连接</strong></td><td>UDP</td><td>不可靠逻辑信道</td><td>对实时性要求高的应用</td></tr></tbody></table><h2 id="传输层协议概览"><a href="#传输层协议概览" class="headerlink" title="传输层协议概览"></a>传输层协议概览</h2><h3 id="TCP：传输控制协议（Transmission-Control-Protocol）"><a href="#TCP：传输控制协议（Transmission-Control-Protocol）" class="headerlink" title="TCP：传输控制协议（Transmission Control Protocol）"></a>TCP：传输控制协议（Transmission Control Protocol）</h3><ul><li><strong>服务特征</strong>：面向连接、可靠传输、全双工通信</li><li><strong>核心机制</strong>：确认重传、流量控制、拥塞控制、连接管理</li><li><strong>适用场景</strong>：文件传输、网页浏览、电子邮件等可靠性优先的应用</li></ul><h3 id="UDP：用户数据报协议（User-Datagram-Protocol）"><a href="#UDP：用户数据报协议（User-Datagram-Protocol）" class="headerlink" title="UDP：用户数据报协议（User Datagram Protocol）"></a>UDP：用户数据报协议（User Datagram Protocol）</h3><ul><li><strong>服务特征</strong>：无连接、不可靠传输、简单高效</li><li><strong>核心机制</strong>：基本的多路复用&#x2F;分用、可选的差错检测</li><li><strong>适用场景</strong>：实时音视频、DNS查询、简单请求-响应等效率优先的应用</li></ul><h2 id="传输层寻址机制"><a href="#传输层寻址机制" class="headerlink" title="传输层寻址机制"></a>传输层寻址机制</h2><h3 id="端口概念与作用"><a href="#端口概念与作用" class="headerlink" title="端口概念与作用"></a>端口概念与作用</h3><p>端口是传输层实现多路复用和分用的关键机制，为应用进程提供了在传输层的唯一标识符。</p><h4 id="端口的本质与功能"><a href="#端口的本质与功能" class="headerlink" title="端口的本质与功能"></a>端口的本质与功能</h4><ul><li><strong>抽象接口</strong>：端口是协议栈层间的抽象协议接口，实现应用进程与传输层实体的交互</li><li><strong>进程标识</strong>：在传输层中的作用类似于IP地址在网络层中的作用，用于标识特定的应用进程</li><li><strong>数据分发</strong>：使传输层能够将接收到的数据正确分发给目标应用进程</li></ul><h4 id="端口类型区分"><a href="#端口类型区分" class="headerlink" title="端口类型区分"></a>端口类型区分</h4><table><thead><tr><th>端口类型</th><th>定义</th><th>特点</th><th>应用场景</th></tr></thead><tbody><tr><td><strong>软件端口</strong></td><td>协议栈层间的抽象协议端口</td><td>逻辑概念，用于进程标识</td><td>传输层使用的端口类型</td></tr><tr><td><strong>硬件端口</strong></td><td>物理设备间的连接接口</td><td>物理概念，用于设备连接</td><td>路由器、交换机等设备接口</td></tr></tbody></table><h3 id="网络层次服务访问点"><a href="#网络层次服务访问点" class="headerlink" title="网络层次服务访问点"></a>网络层次服务访问点</h3><p>各层协议通过不同的服务访问点实现层间数据的正确分发：</p><table><thead><tr><th>协议层次</th><th>服务访问点</th><th>标识作用</th><th>典型值</th></tr></thead><tbody><tr><td><strong>数据链路层</strong></td><td>帧类型字段</td><td>标识上层协议类型</td><td>0x0800（IPv4）</td></tr><tr><td><strong>网络层</strong></td><td>协议字段</td><td>标识传输层协议</td><td>6（TCP）、17（UDP）</td></tr><tr><td><strong>传输层</strong></td><td>端口号字段</td><td>标识应用进程</td><td>80（HTTP）、53（DNS）</td></tr><tr><td><strong>应用层</strong></td><td>用户界面</td><td>用户交互接口</td><td>应用程序界面</td></tr></tbody></table><h3 id="端口号分配体系"><a href="#端口号分配体系" class="headerlink" title="端口号分配体系"></a>端口号分配体系</h3><h4 id="端口号基本特征"><a href="#端口号基本特征" class="headerlink" title="端口号基本特征"></a>端口号基本特征</h4><ul><li><strong>位长</strong>：16位二进制数（取值范围：0-65535）</li><li><strong>作用域</strong>：仅具有本地意义，只标识本地主机中的应用进程</li><li><strong>唯一性</strong>：在同一主机上，同一时刻每个端口号只能被一个进程使用</li></ul><h4 id="端口号分类与分配"><a href="#端口号分类与分配" class="headerlink" title="端口号分类与分配"></a>端口号分类与分配</h4><table><thead><tr><th>端口类别</th><th>数值范围</th><th>分配机构</th><th>使用特点</th><th>典型应用</th></tr></thead><tbody><tr><td><strong>熟知端口号</strong></td><td>0-1023</td><td>IANA统一分配</td><td>标准服务固定使用</td><td>系统服务、标准协议</td></tr><tr><td><strong>登记端口号</strong></td><td>1024-49151</td><td>IANA登记管理</td><td>注册后避免冲突</td><td>用户应用程序</td></tr><tr><td><strong>动态端口号</strong></td><td>49152-65535</td><td>系统动态分配</td><td>临时使用，通信结束释放</td><td>客户端临时端口</td></tr></tbody></table><h4 id="常用熟知端口号"><a href="#常用熟知端口号" class="headerlink" title="常用熟知端口号"></a>常用熟知端口号</h4><table><thead><tr><th>应用协议</th><th>端口号</th><th>传输协议</th><th>服务描述</th></tr></thead><tbody><tr><td><strong>FTP</strong></td><td>21</td><td>TCP</td><td>文件传输协议控制连接</td></tr><tr><td><strong>TELNET</strong></td><td>23</td><td>TCP</td><td>远程终端协议</td></tr><tr><td><strong>SMTP</strong></td><td>25</td><td>TCP</td><td>简单邮件传输协议</td></tr><tr><td><strong>DNS</strong></td><td>53</td><td>UDP&#x2F;TCP</td><td>域名系统</td></tr><tr><td><strong>TFTP</strong></td><td>69</td><td>UDP</td><td>简单文件传输协议</td></tr><tr><td><strong>HTTP</strong></td><td>80</td><td>TCP</td><td>超文本传输协议</td></tr><tr><td><strong>SNMP</strong></td><td>161</td><td>UDP</td><td>简单网络管理协议</td></tr></tbody></table><h4 id="动态端口分配机制"><a href="#动态端口分配机制" class="headerlink" title="动态端口分配机制"></a>动态端口分配机制</h4><ul><li><strong>分配时机</strong>：客户端进程发起连接时由操作系统自动分配</li><li><strong>生命周期</strong>：仅在通信期间有效，连接结束后立即释放</li><li><strong>重用性</strong>：端口号可在不同时间被不同进程重复使用</li><li><strong>别名</strong>：也称为临时端口号或短暂端口号</li></ul><h2 id="传输层服务模式"><a href="#传输层服务模式" class="headerlink" title="传输层服务模式"></a>传输层服务模式</h2><p>传输层提供两种截然不同的服务模式，分别对应TCP和UDP协议，满足不同应用场景的需求。</p><h3 id="面向连接服务（TCP）"><a href="#面向连接服务（TCP）" class="headerlink" title="面向连接服务（TCP）"></a>面向连接服务（TCP）</h3><h4 id="服务特征"><a href="#服务特征" class="headerlink" title="服务特征"></a>服务特征</h4><ul><li><strong>连接导向</strong>：通信前必须建立连接，通信后必须释放连接</li><li><strong>可靠传输</strong>：保证数据无差错、不丢失、不重复、按序到达</li><li><strong>全双工通信</strong>：支持双向同时数据传输</li><li><strong>点对点连接</strong>：每条TCP连接只能连接两个端点</li></ul><h4 id="可靠性保障机制"><a href="#可靠性保障机制" class="headerlink" title="可靠性保障机制"></a>可靠性保障机制</h4><table><thead><tr><th>机制类型</th><th>功能描述</th><th>实现方式</th></tr></thead><tbody><tr><td><strong>确认机制</strong></td><td>确保数据正确接收</td><td>接收方发送ACK确认</td></tr><tr><td><strong>重传机制</strong></td><td>处理数据丢失问题</td><td>超时或冗余ACK触发重传</td></tr><tr><td><strong>流量控制</strong></td><td>防止接收方缓存溢出</td><td>滑动窗口机制</td></tr><tr><td><strong>拥塞控制</strong></td><td>避免网络过载</td><td>慢开始、拥塞避免等算法</td></tr><tr><td><strong>连接管理</strong></td><td>管理连接生命周期</td><td>三次握手建立、四次挥手释放</td></tr></tbody></table><h4 id="适用场景与典型应用"><a href="#适用场景与典型应用" class="headerlink" title="适用场景与典型应用"></a>适用场景与典型应用</h4><table><thead><tr><th>应用类型</th><th>协议示例</th><th>选择TCP的原因</th></tr></thead><tbody><tr><td><strong>文件传输</strong></td><td>FTP</td><td>要求数据完整性，不能丢失</td></tr><tr><td><strong>网页浏览</strong></td><td>HTTP&#x2F;HTTPS</td><td>需要完整的页面内容</td></tr><tr><td><strong>远程登录</strong></td><td>TELNET&#x2F;SSH</td><td>命令传输必须准确无误</td></tr><tr><td><strong>电子邮件</strong></td><td>SMTP&#x2F;POP3&#x2F;IMAP</td><td>邮件内容不能有错误</td></tr></tbody></table><h3 id="无连接服务（UDP）"><a href="#无连接服务（UDP）" class="headerlink" title="无连接服务（UDP）"></a>无连接服务（UDP）</h3><h4 id="服务特征-1"><a href="#服务特征-1" class="headerlink" title="服务特征"></a>服务特征</h4><ul><li><strong>无连接</strong>：发送数据前无需建立连接</li><li><strong>不可靠传输</strong>：尽最大努力交付，不保证可靠性</li><li><strong>简单高效</strong>：协议开销小，处理速度快</li><li><strong>支持多种通信模式</strong>：一对一、一对多、多对一、多对多</li></ul><h4 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h4><table><thead><tr><th>功能</th><th>描述</th><th>与IP层的区别</th></tr></thead><tbody><tr><td><strong>多路复用&#x2F;分用</strong></td><td>通过端口号区分不同应用进程</td><td>IP层只能区分到主机级别</td></tr><tr><td><strong>差错检测</strong></td><td>可选的检验和机制</td><td>提供端到端的数据完整性检查</td></tr><tr><td><strong>数据封装</strong></td><td>添加UDP首部信息</td><td>为应用数据提供传输层封装</td></tr></tbody></table><h4 id="适用场景与典型应用-1"><a href="#适用场景与典型应用-1" class="headerlink" title="适用场景与典型应用"></a>适用场景与典型应用</h4><table><thead><tr><th>应用类型</th><th>协议示例</th><th>选择UDP的原因</th></tr></thead><tbody><tr><td><strong>域名解析</strong></td><td>DNS</td><td>查询简单，重传成本低</td></tr><tr><td><strong>简单文件传输</strong></td><td>TFTP</td><td>文件小，实现简单</td></tr><tr><td><strong>网络管理</strong></td><td>SNMP</td><td>管理信息传输要求高效</td></tr><tr><td><strong>实时应用</strong></td><td>RTP（音视频）</td><td>对延迟敏感，可容忍少量丢失</td></tr><tr><td><strong>广播&#x2F;组播</strong></td><td>DHCP、组播协议</td><td>需要一对多通信模式</td></tr></tbody></table><h3 id="服务模式选择原则"><a href="#服务模式选择原则" class="headerlink" title="服务模式选择原则"></a>服务模式选择原则</h3><table><thead><tr><th>考虑因素</th><th>选择TCP</th><th>选择UDP</th></tr></thead><tbody><tr><td><strong>可靠性要求</strong></td><td>数据必须完整准确</td><td>可容忍少量数据丢失</td></tr><tr><td><strong>实时性要求</strong></td><td>对延迟不敏感</td><td>对延迟高度敏感</td></tr><tr><td><strong>连接开销</strong></td><td>可接受连接建立开销</td><td>需要避免连接开销</td></tr><tr><td><strong>通信模式</strong></td><td>点对点通信</td><td>需要广播或组播</td></tr><tr><td><strong>应用复杂度</strong></td><td>应用层实现相对简单</td><td>应用层需要处理可靠性</td></tr></tbody></table><h2 id="应用协议与传输层映射"><a href="#应用协议与传输层映射" class="headerlink" title="应用协议与传输层映射"></a>应用协议与传输层映射</h2><h3 id="协议选择原则与实例"><a href="#协议选择原则与实例" class="headerlink" title="协议选择原则与实例"></a>协议选择原则与实例</h3><p>不同的应用协议根据其特定需求选择合适的传输层协议，形成了典型的应用-传输层协议组合。</p><h4 id="基于UDP的应用协议"><a href="#基于UDP的应用协议" class="headerlink" title="基于UDP的应用协议"></a>基于UDP的应用协议</h4><table><thead><tr><th>应用协议</th><th>全称</th><th>端口号</th><th>选择UDP的原因</th><th>应用特点</th></tr></thead><tbody><tr><td><strong>DNS</strong></td><td>域名系统</td><td>53</td><td>查询响应简单，对延迟敏感</td><td>短请求-响应模式</td></tr><tr><td><strong>TFTP</strong></td><td>简单文件传输协议</td><td>69</td><td>实现简单，文件较小</td><td>无需复杂的连接管理</td></tr><tr><td><strong>RIP</strong></td><td>路由信息协议</td><td>520</td><td>路由更新频繁，开销要小</td><td>周期性广播路由信息</td></tr><tr><td><strong>DHCP</strong></td><td>动态主机配置协议</td><td>67&#x2F;68</td><td>需要广播功能</td><td>自动IP地址分配</td></tr><tr><td><strong>SNMP</strong></td><td>简单网络管理协议</td><td>161</td><td>管理信息传输要求高效</td><td>网络设备监控管理</td></tr><tr><td><strong>IGMP</strong></td><td>网际组管理协议</td><td>-</td><td>组播管理，无需可靠性</td><td>IP组播成员管理</td></tr></tbody></table><h4 id="基于TCP的应用协议"><a href="#基于TCP的应用协议" class="headerlink" title="基于TCP的应用协议"></a>基于TCP的应用协议</h4><table><thead><tr><th>应用协议</th><th>全称</th><th>端口号</th><th>选择TCP的原因</th><th>应用特点</th></tr></thead><tbody><tr><td><strong>SMTP</strong></td><td>简单邮件传输协议</td><td>25</td><td>邮件传输必须可靠</td><td>邮件不能丢失或损坏</td></tr><tr><td><strong>TELNET</strong></td><td>远程终端协议</td><td>23</td><td>命令传输需要准确性</td><td>交互式远程登录</td></tr><tr><td><strong>HTTP</strong></td><td>超文本传输协议</td><td>80</td><td>网页内容必须完整</td><td>万维网内容传输</td></tr><tr><td><strong>FTP</strong></td><td>文件传输协议</td><td>20&#x2F;21</td><td>文件传输要求完整性</td><td>大文件可靠传输</td></tr><tr><td><strong>SSH</strong></td><td>安全外壳协议</td><td>22</td><td>安全连接需要可靠性</td><td>加密远程访问</td></tr><tr><td><strong>HTTPS</strong></td><td>安全超文本传输协议</td><td>443</td><td>安全传输需要完整性</td><td>加密网页传输</td></tr></tbody></table><h3 id="传输层协议特性对比"><a href="#传输层协议特性对比" class="headerlink" title="传输层协议特性对比"></a>传输层协议特性对比</h3><h4 id="数据传输视角"><a href="#数据传输视角" class="headerlink" title="数据传输视角"></a>数据传输视角</h4><table><thead><tr><th>特性维度</th><th>UDP数据报</th><th>TCP报文段</th><th>IP数据报</th></tr></thead><tbody><tr><td><strong>传输范围</strong></td><td>端到端逻辑信道</td><td>端到端逻辑信道</td><td>网络层逐跳转发</td></tr><tr><td><strong>路由器可见性</strong></td><td>不可见（封装在IP中）</td><td>不可见（封装在IP中）</td><td>可见（路由转发依据）</td></tr><tr><td><strong>状态维护</strong></td><td>无状态</td><td>有状态（连接信息）</td><td>无状态</td></tr><tr><td><strong>处理复杂度</strong></td><td>简单</td><td>复杂</td><td>中等</td></tr></tbody></table><h4 id="服务层次对比"><a href="#服务层次对比" class="headerlink" title="服务层次对比"></a>服务层次对比</h4><table><thead><tr><th>服务层次</th><th>虚电路（网络层）</th><th>TCP连接（传输层）</th></tr></thead><tbody><tr><td><strong>状态保存位置</strong></td><td>网络中间节点</td><td>仅在端系统</td></tr><tr><td><strong>对网络层影响</strong></td><td>限制为面向连接</td><td>不影响网络层服务模式</td></tr><tr><td><strong>实现复杂度</strong></td><td>网络设备复杂</td><td>端系统复杂</td></tr><tr><td><strong>扩展性</strong></td><td>受网络规模限制</td><td>仅受端系统能力限制</td></tr></tbody></table><h3 id="协议栈层次关系"><a href="#协议栈层次关系" class="headerlink" title="协议栈层次关系"></a>协议栈层次关系</h3><h4 id="封装与解封装过程"><a href="#封装与解封装过程" class="headerlink" title="封装与解封装过程"></a>封装与解封装过程</h4><ol><li><strong>应用层</strong>：生成应用数据</li><li><strong>传输层</strong>：添加TCP&#x2F;UDP首部，形成报文段&#x2F;数据报</li><li><strong>网络层</strong>：添加IP首部，形成IP数据报</li><li><strong>数据链路层</strong>：添加帧首部和尾部</li><li><strong>物理层</strong>：转换为物理信号传输</li></ol><h4 id="层次独立性原则"><a href="#层次独立性原则" class="headerlink" title="层次独立性原则"></a>层次独立性原则</h4><ul><li><strong>传输层独立性</strong>：TCP&#x2F;UDP的选择不影响网络层的服务模式</li><li><strong>网络层透明性</strong>：传输层协议对中间路由器透明</li><li><strong>应用层灵活性</strong>：应用可根据需求选择合适的传输层协议</li></ul><h2 id="TCP与UDP协议对比分析"><a href="#TCP与UDP协议对比分析" class="headerlink" title="TCP与UDP协议对比分析"></a>TCP与UDP协议对比分析</h2><h3 id="协议栈层次服务特征"><a href="#协议栈层次服务特征" class="headerlink" title="协议栈层次服务特征"></a>协议栈层次服务特征</h3><h4 id="传输层服务提供模式"><a href="#传输层服务提供模式" class="headerlink" title="传输层服务提供模式"></a>传输层服务提供模式</h4><table><thead><tr><th>协议栈层次</th><th>UDP服务模式</th><th>TCP服务模式</th><th>底层依赖</th></tr></thead><tbody><tr><td><strong>应用层</strong></td><td>应用数据直接传递</td><td>应用数据直接传递</td><td>传输层服务</td></tr><tr><td><strong>传输层</strong></td><td>无连接不可靠服务</td><td>面向连接可靠服务</td><td>网络层服务</td></tr><tr><td><strong>网络层</strong></td><td>无连接不可靠服务</td><td>无连接不可靠服务</td><td>数据链路层服务</td></tr><tr><td><strong>数据链路层</strong></td><td>帧传输服务</td><td>帧传输服务</td><td>物理层服务</td></tr><tr><td><strong>物理层</strong></td><td>比特流传输</td><td>比特流传输</td><td>物理介质</td></tr></tbody></table><h4 id="服务质量对比"><a href="#服务质量对比" class="headerlink" title="服务质量对比"></a>服务质量对比</h4><table><thead><tr><th>服务特性</th><th>UDP</th><th>TCP</th><th>说明</th></tr></thead><tbody><tr><td><strong>连接管理</strong></td><td>无连接</td><td>面向连接</td><td>TCP需要三次握手建立连接</td></tr><tr><td><strong>可靠性保证</strong></td><td>不可靠</td><td>可靠</td><td>TCP提供确认、重传机制</td></tr><tr><td><strong>数据顺序</strong></td><td>不保证</td><td>保证</td><td>TCP确保数据按序到达</td></tr><tr><td><strong>流量控制</strong></td><td>无</td><td>有</td><td>TCP防止接收方缓存溢出</td></tr><tr><td><strong>拥塞控制</strong></td><td>无</td><td>有</td><td>TCP避免网络过载</td></tr><tr><td><strong>错误检测</strong></td><td>可选</td><td>必须</td><td>都提供检验和机制</td></tr></tbody></table><h3 id="适用场景分析"><a href="#适用场景分析" class="headerlink" title="适用场景分析"></a>适用场景分析</h3><h4 id="UDP适用场景"><a href="#UDP适用场景" class="headerlink" title="UDP适用场景"></a>UDP适用场景</h4><ul><li><strong>实时应用</strong>：IP电话、视频会议、在线游戏</li><li><strong>简单查询</strong>：DNS查询、SNMP网络管理</li><li><strong>广播&#x2F;组播</strong>：DHCP、路由协议更新</li><li><strong>小数据传输</strong>：TFTP简单文件传输</li></ul><h4 id="TCP适用场景"><a href="#TCP适用场景" class="headerlink" title="TCP适用场景"></a>TCP适用场景</h4><ul><li><strong>可靠传输</strong>：文件传输（FTP）、网页浏览（HTTP）</li><li><strong>交互应用</strong>：远程登录（TELNET&#x2F;SSH）、电子邮件（SMTP）</li><li><strong>大数据传输</strong>：数据库同步、软件下载</li><li><strong>安全通信</strong>：HTTPS、加密数据传输</li></ul><h3 id="协议首部结构对比"><a href="#协议首部结构对比" class="headerlink" title="协议首部结构对比"></a>协议首部结构对比</h3><h4 id="UDP首部格式"><a href="#UDP首部格式" class="headerlink" title="UDP首部格式"></a>UDP首部格式</h4><p>UDP首部设计简洁，仅包含必要的传输信息，体现了其简单高效的特点。</p><table><thead><tr><th>字段名称</th><th>位长（bit）</th><th>字节数</th><th>功能描述</th></tr></thead><tbody><tr><td><strong>源端口</strong></td><td>16</td><td>2</td><td>发送方应用进程端口号</td></tr><tr><td><strong>目的端口</strong></td><td>16</td><td>2</td><td>接收方应用进程端口号</td></tr><tr><td><strong>长度</strong></td><td>16</td><td>2</td><td>UDP首部+数据的总长度</td></tr><tr><td><strong>检验和</strong></td><td>16</td><td>2</td><td>错误检测（可选）</td></tr></tbody></table><p><strong>UDP首部特点</strong>：</p><ul><li><strong>固定长度</strong>：8字节，结构简单</li><li><strong>最小开销</strong>：仅提供基本的多路复用和错误检测</li><li><strong>处理高效</strong>：字段少，解析速度快</li></ul><h4 id="TCP首部格式"><a href="#TCP首部格式" class="headerlink" title="TCP首部格式"></a>TCP首部格式</h4><p>TCP首部包含丰富的控制信息，支持可靠传输的各种机制。</p><h5 id="固定首部字段（20字节）"><a href="#固定首部字段（20字节）" class="headerlink" title="固定首部字段（20字节）"></a>固定首部字段（20字节）</h5><table><thead><tr><th>字段名称</th><th>位长（bit）</th><th>字节数</th><th>功能描述</th></tr></thead><tbody><tr><td><strong>源端口</strong></td><td>16</td><td>2</td><td>发送方应用进程端口号</td></tr><tr><td><strong>目的端口</strong></td><td>16</td><td>2</td><td>接收方应用进程端口号</td></tr><tr><td><strong>序列号</strong></td><td>32</td><td>4</td><td>数据字节流中首字节的序号</td></tr><tr><td><strong>确认号</strong></td><td>32</td><td>4</td><td>期望接收的下一个字节序号</td></tr><tr><td><strong>数据偏移</strong></td><td>4</td><td>0.5</td><td>TCP首部长度（以4字节为单位）</td></tr><tr><td><strong>保留</strong></td><td>6</td><td>0.75</td><td>保留字段，必须为0</td></tr><tr><td><strong>标志位</strong></td><td>6</td><td>0.75</td><td>控制位（URG、ACK、PSH、RST、SYN、FIN）</td></tr><tr><td><strong>窗口大小</strong></td><td>16</td><td>2</td><td>接收窗口大小（流量控制）</td></tr><tr><td><strong>检验和</strong></td><td>16</td><td>2</td><td>错误检测（必须）</td></tr><tr><td><strong>紧急指针</strong></td><td>16</td><td>2</td><td>紧急数据指针</td></tr></tbody></table><h5 id="可变选项字段（0-40字节）"><a href="#可变选项字段（0-40字节）" class="headerlink" title="可变选项字段（0-40字节）"></a>可变选项字段（0-40字节）</h5><table><thead><tr><th>选项类型</th><th>长度</th><th>功能</th></tr></thead><tbody><tr><td><strong>最大报文段长度（MSS）</strong></td><td>4字节</td><td>协商最大数据段大小</td></tr><tr><td><strong>窗口扩大</strong></td><td>3字节</td><td>扩展窗口大小范围</td></tr><tr><td><strong>时间戳</strong></td><td>10字节</td><td>RTT测量和序列号回绕处理</td></tr><tr><td><strong>选择确认（SACK）</strong></td><td>可变</td><td>选择性确认机制</td></tr></tbody></table><p><strong>TCP首部特点</strong>：</p><ul><li><strong>可变长度</strong>：20-60字节，功能丰富</li><li><strong>控制复杂</strong>：支持连接管理、流量控制、拥塞控制</li><li><strong>扩展性强</strong>：选项字段支持协议功能扩展</li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><table><thead><tr><th align="left">特性</th><th align="left">UDP (User Datagram Protocol)</th><th align="left">TCP (Transmission Control Protocol)</th></tr></thead><tbody><tr><td align="left">连接</td><td align="left">无连接</td><td align="left">面向连接</td></tr><tr><td align="left">端点通信</td><td align="left">支持“一对一”、“一对多”、“多对一”和“多对多”交互通信</td><td align="left">每一条 TCP 连接只能有两个端点 EP，只能是一对一通信</td></tr><tr><td align="left">数据流类型</td><td align="left">面向应用报文</td><td align="left">面向字节流</td></tr><tr><td align="left">可靠性</td><td align="left">尽最大努力交付，即不可靠；不使用流量控制和拥塞控制</td><td align="left">可靠传输，使用流量控制和拥塞控制</td></tr><tr><td align="left">首部开销</td><td align="left">首部开销小，仅 8 字节</td><td align="left">首部开销最小 20 字节，最大 60 字节</td></tr></tbody></table><h2 id="习题查漏补缺"><a href="#习题查漏补缺" class="headerlink" title="习题查漏补缺"></a>习题查漏补缺</h2><ol><li><strong>通信子网、传输层、资源子网</strong><ul><li><strong>通信子网:</strong> 包括物理层、数据链路层和网络层，主要负责数据通信。</li><li><strong>传输层:</strong> 主要任务是向高层用户屏蔽下面通信子网的细节 (如网络拓扑、路由协议等)。</li><li><strong>资源子网:</strong> OSI 参考模型的上三层。</li></ul></li><li>传输层面向连接服务的特性: 保证可靠和顺序交付。</li><li>一个 TCP 报文的首部长度是 20B, 一个 IP 数据报的首部长度也是 20B, 再加上 60B 的数据, 一个 IP 数据报的总长度为 100B, 从而数据占 60%。</li><li>若用户应用程序使用 UDP 进行数据传输, 则必须在传输层的上层即应用层提供可靠性方面的全部工作。</li></ol><h2 id="5-2-UDP-协议"><a href="#5-2-UDP-协议" class="headerlink" title="5.2 UDP 协议"></a>5.2 UDP 协议</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>UDP 仅在 IP 层的数据包服务之上增加了两个最基本的功能，复用和分用，以及差错检测。</p><h3 id="UDP协议特征分析"><a href="#UDP协议特征分析" class="headerlink" title="UDP协议特征分析"></a>UDP协议特征分析</h3><p>UDP（User Datagram Protocol，用户数据报协议）是传输层的无连接协议，以其简单高效的特点在特定应用场景中发挥重要作用。</p><h4 id="核心设计特点"><a href="#核心设计特点" class="headerlink" title="核心设计特点"></a>核心设计特点</h4><table><thead><tr><th>特征维度</th><th>UDP特点</th><th>技术优势</th><th>应用影响</th></tr></thead><tbody><tr><td><strong>连接管理</strong></td><td>无连接服务</td><td>无需三次握手建立连接</td><td>降低通信延迟和系统开销</td></tr><tr><td><strong>状态维护</strong></td><td>无状态协议</td><td>不维护连接状态信息</td><td>服务器可支持更多并发客户端</td></tr><tr><td><strong>首部开销</strong></td><td>8字节固定首部</td><td>相比TCP节省75%首部空间</td><td>提高网络传输效率</td></tr><tr><td><strong>流量控制</strong></td><td>无流量控制</td><td>发送速率不受接收方限制</td><td>适合实时性要求高的应用</td></tr><tr><td><strong>拥塞控制</strong></td><td>无拥塞控制</td><td>不响应网络拥塞状况</td><td>保持恒定发送速率</td></tr><tr><td><strong>通信模式</strong></td><td>多种通信模式</td><td>支持1对1、1对多、多对1、多对多</td><td>灵活的网络拓扑支持</td></tr><tr><td><strong>数据处理</strong></td><td>面向报文</td><td>保持应用层报文边界</td><td>应用层需合理控制报文大小</td></tr></tbody></table><h4 id="协议工作机制"><a href="#协议工作机制" class="headerlink" title="协议工作机制"></a>协议工作机制</h4><p><strong>1. 无连接传输模式</strong></p><ul><li><strong>即发即送</strong>：数据传输前无需建立连接</li><li><strong>独立处理</strong>：每个数据报独立路由和处理</li><li><strong>状态无关</strong>：发送方和接收方不维护连接状态</li></ul><p><strong>2. 面向报文的数据处理</strong></p><ul><li><strong>边界保持</strong>：保留应用层报文的完整性</li><li><strong>原样传递</strong>：不对报文进行分割或合并</li><li><strong>大小控制</strong>：应用程序需选择合适的报文大小</li></ul><p><strong>3. 最小化协议开销</strong></p><ul><li><strong>简化首部</strong>：仅包含必要的传输信息</li><li><strong>快速处理</strong>：协议栈处理开销最小</li><li><strong>高效传输</strong>：适合对延迟敏感的应用</li></ul><h3 id="UDP首部结构详解"><a href="#UDP首部结构详解" class="headerlink" title="UDP首部结构详解"></a>UDP首部结构详解</h3><h4 id="首部字段组成"><a href="#首部字段组成" class="headerlink" title="首部字段组成"></a>首部字段组成</h4><table><thead><tr><th>字段名称</th><th>位长（bit）</th><th>字节数</th><th>字段范围</th><th>功能描述</th></tr></thead><tbody><tr><td><strong>源端口</strong></td><td>16</td><td>2</td><td>0-65535</td><td>发送方应用进程端口号，回复时使用</td></tr><tr><td><strong>目的端口</strong></td><td>16</td><td>2</td><td>0-65535</td><td>接收方应用进程端口号，必须字段</td></tr><tr><td><strong>长度</strong></td><td>16</td><td>2</td><td>8-65535</td><td>UDP首部+数据总长度（最小8字节）</td></tr><tr><td><strong>检验和</strong></td><td>16</td><td>2</td><td>0-65535</td><td>差错检测，IPv4可选，IPv6必须</td></tr></tbody></table><h4 id="字段功能说明"><a href="#字段功能说明" class="headerlink" title="字段功能说明"></a>字段功能说明</h4><p><strong>源端口字段</strong>：</p><ul><li><strong>双向通信</strong>：用于接收方回复数据</li><li><strong>可选性</strong>：单向通信时可设为0</li><li><strong>多路复用</strong>：标识发送方应用进程</li></ul><p><strong>目的端口字段</strong>：</p><ul><li><strong>必要性</strong>：数据包正确投递的关键</li><li><strong>服务标识</strong>：指定目标应用服务</li><li><strong>解复用依据</strong>：传输层分发数据的基础</li><li><strong>错误处理</strong>：端口不存在时，接收方丢弃报文并通过ICMP发送”端口不可达”错误</li></ul><p><strong>长度字段</strong>：</p><ul><li><strong>范围限制</strong>：8字节（仅首部）到65535字节</li><li><strong>完整性</strong>：包含首部和数据部分总长度</li><li><strong>验证作用</strong>：接收方验证数据包完整性</li></ul><p><strong>检验和字段</strong>：</p><ul><li><strong>差错检测</strong>：检验UDP数据报传输完整性</li><li><strong>处理策略</strong>：发现错误直接丢弃数据报</li><li><strong>版本差异</strong>：IPv4中可选（不用时设为0），IPv6中强制使用</li></ul><h3 id="UDP检验和机制"><a href="#UDP检验和机制" class="headerlink" title="UDP检验和机制"></a>UDP检验和机制</h3><p>UDP检验和提供端到端的差错检测，虽然简单但能有效发现传输错误。</p><h4 id="检验和计算流程"><a href="#检验和计算流程" class="headerlink" title="检验和计算流程"></a>检验和计算流程</h4><p><strong>发送方处理过程</strong>：</p><ol><li><strong>构造伪首部</strong>：添加IP层信息用于检验</li><li><strong>数据分组</strong>：将伪首部+UDP首部+数据按16位分组</li><li><strong>求和计算</strong>：所有16位字相加，进位回卷</li><li><strong>取反操作</strong>：对和值按位求反得到检验和</li><li><strong>填入首部</strong>：将检验和写入UDP首部对应字段</li></ol><p><strong>接收方验证过程</strong>：</p><ol><li><strong>重构检验</strong>：按相同方式构造伪首部和分组</li><li><strong>全部求和</strong>：包括接收到的检验和一起计算</li><li><strong>结果判断</strong>：<ul><li>结果为0：传输正确</li><li>结果非0：存在错误，丢弃数据包</li></ul></li></ol><h4 id="伪首部结构"><a href="#伪首部结构" class="headerlink" title="伪首部结构"></a>伪首部结构</h4><table><thead><tr><th>字段名称</th><th>位长（bit）</th><th>字节数</th><th>内容来源</th><th>作用</th></tr></thead><tbody><tr><td><strong>源IP地址</strong></td><td>32</td><td>4</td><td>IP首部</td><td>验证数据包来源</td></tr><tr><td><strong>目的IP地址</strong></td><td>32</td><td>4</td><td>IP首部</td><td>验证数据包目标</td></tr><tr><td><strong>保留字段</strong></td><td>8</td><td>1</td><td>全0</td><td>字节对齐</td></tr><tr><td><strong>协议字段</strong></td><td>8</td><td>1</td><td>17（UDP）</td><td>标识上层协议</td></tr><tr><td><strong>UDP长度</strong></td><td>16</td><td>2</td><td>UDP首部</td><td>数据包长度信息</td></tr></tbody></table><p><strong>伪首部特点</strong>：</p><ul><li><strong>虚拟结构</strong>：仅用于检验和计算，不实际传输</li><li><strong>跨层信息</strong>：结合网络层和传输层信息</li><li><strong>完整性保证</strong>：确保数据包在正确的源和目的间传输</li></ul><h4 id="检验和策略差异"><a href="#检验和策略差异" class="headerlink" title="检验和策略差异"></a>检验和策略差异</h4><table><thead><tr><th>协议版本</th><th>检验和要求</th><th>处理方式</th><th>设计考虑</th></tr></thead><tbody><tr><td><strong>IPv4环境</strong></td><td>可选机制</td><td>不使用时设为0</td><td>兼容性考虑</td></tr><tr><td><strong>IPv6环境</strong></td><td>强制要求</td><td>必须计算和验证</td><td>可靠性提升</td></tr></tbody></table><p><strong>与IP检验和的区别</strong>：</p><ul><li><strong>覆盖范围</strong>：UDP检验整个数据包，IP仅检验首部</li><li><strong>检测能力</strong>：UDP能发现数据部分的传输错误</li><li><strong>处理机制</strong>：UDP发现错误直接丢弃，不进行纠错</li></ul><h2 id="TCP协议详解"><a href="#TCP协议详解" class="headerlink" title="TCP协议详解"></a>TCP协议详解</h2><h3 id="TCP协议概述"><a href="#TCP协议概述" class="headerlink" title="TCP协议概述"></a>TCP协议概述</h3><p>TCP（Transmission Control Protocol，传输控制协议）是传输层的面向连接协议，在不可靠的IP网络层之上提供可靠的端到端数据传输服务。TCP通过复杂的控制机制解决了网络通信中的可靠性、有序性、流量控制和拥塞控制等关键问题。</p><h4 id="协议设计目标"><a href="#协议设计目标" class="headerlink" title="协议设计目标"></a>协议设计目标</h4><table><thead><tr><th>设计目标</th><th>实现机制</th><th>技术手段</th></tr></thead><tbody><tr><td><strong>可靠传输</strong></td><td>确认重传机制</td><td>序列号、确认号、超时重传</td></tr><tr><td><strong>有序交付</strong></td><td>序列号排序</td><td>32位序列号、接收缓冲区重排</td></tr><tr><td><strong>流量控制</strong></td><td>滑动窗口</td><td>接收窗口通告、流量调节</td></tr><tr><td><strong>拥塞控制</strong></td><td>拥塞窗口</td><td>慢启动、拥塞避免、快重传</td></tr><tr><td><strong>连接管理</strong></td><td>状态机制</td><td>三次握手、四次挥手</td></tr></tbody></table><h3 id="TCP核心特征分析"><a href="#TCP核心特征分析" class="headerlink" title="TCP核心特征分析"></a>TCP核心特征分析</h3><h4 id="面向连接的服务模式"><a href="#面向连接的服务模式" class="headerlink" title="面向连接的服务模式"></a>面向连接的服务模式</h4><p><strong>连接生命周期管理</strong>：</p><ul><li><strong>建立阶段</strong>：三次握手协商连接参数</li><li><strong>数据传输</strong>：可靠的双向数据交换</li><li><strong>释放阶段</strong>：四次挥手优雅关闭连接</li></ul><p><strong>连接状态维护</strong>：</p><ul><li><strong>发送状态</strong>：发送缓冲区、发送窗口、重传定时器</li><li><strong>接收状态</strong>：接收缓冲区、接收窗口、确认机制</li><li><strong>控制状态</strong>：拥塞窗口、RTT估计、连接状态</li></ul><h4 id="可靠传输保障机制"><a href="#可靠传输保障机制" class="headerlink" title="可靠传输保障机制"></a>可靠传输保障机制</h4><table><thead><tr><th>可靠性问题</th><th>TCP解决方案</th><th>技术实现</th></tr></thead><tbody><tr><td><strong>数据丢失</strong></td><td>超时重传</td><td>自适应重传定时器</td></tr><tr><td><strong>数据重复</strong></td><td>序列号去重</td><td>32位序列号空间</td></tr><tr><td><strong>数据乱序</strong></td><td>缓冲重排</td><td>接收缓冲区排序</td></tr><tr><td><strong>数据损坏</strong></td><td>检验和验证</td><td>强制性检验和机制</td></tr></tbody></table><h4 id="通信模式特点"><a href="#通信模式特点" class="headerlink" title="通信模式特点"></a>通信模式特点</h4><p><strong>点对点通信</strong>：</p><ul><li><strong>连接唯一性</strong>：每个TCP连接连接两个特定端点</li><li><strong>资源独占</strong>：每个连接维护独立的状态信息</li><li><strong>不支持广播</strong>：无法实现一对多通信模式</li></ul><p><strong>全双工数据传输</strong>：</p><ul><li><strong>双向独立</strong>：两个方向的数据流独立控制</li><li><strong>缓冲机制</strong>：发送和接收缓冲区分离</li><li><strong>异步操作</strong>：发送和接收可同时进行</li></ul><h4 id="面向字节流的数据处理"><a href="#面向字节流的数据处理" class="headerlink" title="面向字节流的数据处理"></a>面向字节流的数据处理</h4><p><strong>字节流特性</strong>：</p><ul><li><strong>无边界性</strong>：不保持应用层消息边界</li><li><strong>连续性</strong>：将数据视为连续的字节序列</li><li><strong>灵活分段</strong>：根据网络条件动态调整段大小</li></ul><p><strong>数据处理机制</strong>：</p><table><thead><tr><th>处理层面</th><th>发送方行为</th><th>接收方行为</th></tr></thead><tbody><tr><td><strong>应用层</strong></td><td>提交不定长数据块</td><td>接收重组后的字节流</td></tr><tr><td><strong>TCP层</strong></td><td>按MSS分段传输</td><td>缓冲重组字节流</td></tr><tr><td><strong>网络层</strong></td><td>独立IP数据包</td><td>独立接收处理</td></tr></tbody></table><p><strong>缓冲区管理机制</strong>：</p><table><thead><tr><th>缓冲区类型</th><th>功能作用</th><th>存储内容</th><th>管理策略</th></tr></thead><tbody><tr><td><strong>发送缓冲区</strong></td><td>暂存待发送数据</td><td>应用数据、已发送未确认数据</td><td>滑动窗口控制</td></tr><tr><td><strong>接收缓冲区</strong></td><td>重组接收数据</td><td>按序数据、乱序数据</td><td>顺序交付应用</td></tr></tbody></table><p><strong>字节流处理示例</strong>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">发送方应用: [1000字节] [500字节] [1500字节]</span><br><span class="line">     ↓</span><br><span class="line">TCP分段:   [1000] [500] [1460] [40]</span><br><span class="line">     ↓</span><br><span class="line">网络传输:   独立的IP数据包</span><br><span class="line">     ↓</span><br><span class="line">TCP重组:   连续的3000字节流</span><br><span class="line">     ↓</span><br><span class="line">接收方应用: [2000字节] [1000字节] (应用层自定义边界)</span><br></pre></td></tr></table></figure><h4 id="TCP与UDP协议对比"><a href="#TCP与UDP协议对比" class="headerlink" title="TCP与UDP协议对比"></a>TCP与UDP协议对比</h4><table><thead><tr><th>特征维度</th><th>TCP</th><th>UDP</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>连接性</strong></td><td>面向连接</td><td>无连接</td><td>TCP适合可靠传输，UDP适合实时应用</td></tr><tr><td><strong>可靠性</strong></td><td>可靠传输</td><td>尽力而为</td><td>TCP保证数据完整，UDP允许数据丢失</td></tr><tr><td><strong>开销</strong></td><td>高开销</td><td>低开销</td><td>TCP功能丰富，UDP简单高效</td></tr><tr><td><strong>报文长度</strong></td><td>动态调整</td><td>应用决定</td><td>TCP优化网络利用，UDP保持边界</td></tr></tbody></table><h3 id="TCP报文段结构"><a href="#TCP报文段结构" class="headerlink" title="TCP报文段结构"></a>TCP报文段结构</h3><p>TCP报文段是TCP协议的基本传输单元，既承载用户数据，又实现连接控制功能。</p><h4 id="TCP首部详细结构"><a href="#TCP首部详细结构" class="headerlink" title="TCP首部详细结构"></a>TCP首部详细结构</h4><h5 id="固定首部字段（20字节）-1"><a href="#固定首部字段（20字节）-1" class="headerlink" title="固定首部字段（20字节）"></a>固定首部字段（20字节）</h5><table><thead><tr><th>字段名称</th><th>位长</th><th>字节偏移</th><th>功能描述</th><th>重要性</th></tr></thead><tbody><tr><td><strong>源端口</strong></td><td>16位</td><td>0-1</td><td>发送方应用进程标识</td><td>多路复用基础</td></tr><tr><td><strong>目的端口</strong></td><td>16位</td><td>2-3</td><td>接收方应用进程标识</td><td>服务定位关键</td></tr><tr><td><strong>序列号</strong></td><td>32位</td><td>4-7</td><td>数据字节流位置标识</td><td>有序传输核心</td></tr><tr><td><strong>确认号</strong></td><td>32位</td><td>8-11</td><td>期望接收的下一字节号</td><td>可靠传输基础</td></tr><tr><td><strong>首部长度</strong></td><td>4位</td><td>12</td><td>TCP首部长度（4字节单位）</td><td>首部解析依据</td></tr><tr><td><strong>保留字段</strong></td><td>6位</td><td>12</td><td>未来扩展预留</td><td>协议兼容性</td></tr><tr><td><strong>控制标志</strong></td><td>6位</td><td>13</td><td>连接状态控制</td><td>状态机驱动</td></tr><tr><td><strong>窗口大小</strong></td><td>16位</td><td>14-15</td><td>接收窗口通告</td><td>流量控制机制</td></tr><tr><td><strong>检验和</strong></td><td>16位</td><td>16-17</td><td>数据完整性验证</td><td>错误检测</td></tr><tr><td><strong>紧急指针</strong></td><td>16位</td><td>18-19</td><td>紧急数据边界</td><td>优先数据处理</td></tr></tbody></table><h5 id="控制标志位详解"><a href="#控制标志位详解" class="headerlink" title="控制标志位详解"></a>控制标志位详解</h5><table><thead><tr><th>标志位</th><th>全称</th><th>功能作用</th><th>使用场景</th><th>组合使用</th></tr></thead><tbody><tr><td><strong>URG</strong></td><td>Urgent</td><td>紧急指针有效</td><td>紧急数据传输</td><td>与紧急指针配合</td></tr><tr><td><strong>ACK</strong></td><td>Acknowledgment</td><td>确认号有效</td><td>数据确认</td><td>除SYN外几乎总是置1</td></tr><tr><td><strong>PSH</strong></td><td>Push</td><td>立即推送数据</td><td>交互式应用</td><td>提高响应性</td></tr><tr><td><strong>RST</strong></td><td>Reset</td><td>重置连接</td><td>异常处理</td><td>强制关闭连接</td></tr><tr><td><strong>SYN</strong></td><td>Synchronize</td><td>同步序列号</td><td>连接建立</td><td>三次握手使用</td></tr><tr><td><strong>FIN</strong></td><td>Finish</td><td>结束数据传输</td><td>连接释放</td><td>四次挥手使用</td></tr></tbody></table><p><strong>常见标志位组合</strong>：</p><ul><li><strong>SYN&#x3D;1, ACK&#x3D;0</strong>：连接请求</li><li><strong>SYN&#x3D;1, ACK&#x3D;1</strong>：连接确认</li><li><strong>FIN&#x3D;1, ACK&#x3D;1</strong>：连接终止</li><li><strong>RST&#x3D;1</strong>：连接重置</li><li><strong>PSH&#x3D;1, ACK&#x3D;1</strong>：数据推送</li></ul><h5 id="关键字段功能分析"><a href="#关键字段功能分析" class="headerlink" title="关键字段功能分析"></a>关键字段功能分析</h5><p><strong>序列号机制</strong>：</p><ul><li><strong>初始值</strong>：连接建立时随机选择</li><li><strong>递增规则</strong>：按发送字节数递增</li><li><strong>回绕处理</strong>：32位空间循环使用</li><li><strong>同步作用</strong>：确保数据有序传输</li></ul><p><strong>确认号机制</strong>：</p><ul><li><strong>累积确认</strong>：确认连续接收的最大序号+1</li><li><strong>有效条件</strong>：ACK标志位为1时有效</li><li><strong>确认策略</strong>：可延迟确认提高效率</li><li><strong>重复确认</strong>：触发快速重传机制</li></ul><p><strong>窗口字段</strong>：</p><ul><li><strong>流量控制</strong>：通告接收方缓冲区可用空间</li><li><strong>动态调整</strong>：根据处理能力实时更新</li><li><strong>零窗口</strong>：暂停发送，启动持续定时器</li><li><strong>窗口扩大</strong>：通过选项字段扩展范围</li></ul><p><strong>检验和计算</strong>：</p><ul><li><strong>覆盖范围</strong>：TCP首部+数据+伪首部</li><li><strong>强制性</strong>：TCP检验和必须计算</li><li><strong>伪首部</strong>：包含IP地址信息</li><li><strong>错误处理</strong>：检验失败直接丢弃</li></ul><p><strong>紧急数据处理</strong>：</p><ul><li><strong>优先传输</strong>：紧急数据插队发送</li><li><strong>带外数据</strong>：不占用正常数据流序号</li><li><strong>应用通知</strong>：接收方立即通知应用层</li><li><strong>指针含义</strong>：指向紧急数据末尾位置</li></ul><h5 id="可变选项字段（0-40字节）-1"><a href="#可变选项字段（0-40字节）-1" class="headerlink" title="可变选项字段（0-40字节）"></a>可变选项字段（0-40字节）</h5><table><thead><tr><th>选项类型</th><th>选项长度</th><th>功能描述</th><th>使用时机</th></tr></thead><tbody><tr><td><strong>MSS</strong></td><td>4字节</td><td>最大报文段长度</td><td>连接建立时协商</td></tr><tr><td><strong>窗口扩大因子</strong></td><td>3字节</td><td>扩展窗口大小范围</td><td>高带宽网络</td></tr><tr><td><strong>时间戳</strong></td><td>10字节</td><td>RTT测量和PAWS</td><td>高速网络</td></tr><tr><td><strong>SACK允许</strong></td><td>2字节</td><td>启用选择确认</td><td>连接建立时</td></tr><tr><td><strong>SACK</strong></td><td>可变</td><td>选择确认块</td><td>数据传输时</td></tr></tbody></table><p><strong>选项字段特点</strong>：</p><ul><li><strong>可选性</strong>：根据需要添加</li><li><strong>对齐要求</strong>：总长度4字节对齐</li><li><strong>填充处理</strong>：不足部分用0填充</li><li><strong>向后兼容</strong>：不识别的选项被忽略</li></ul><h3 id="TCP检验和机制"><a href="#TCP检验和机制" class="headerlink" title="TCP检验和机制"></a>TCP检验和机制</h3><p>TCP检验和是强制性的端到端错误检测机制，确保数据在传输过程中的完整性。</p><h4 id="检验和计算原理"><a href="#检验和计算原理" class="headerlink" title="检验和计算原理"></a>检验和计算原理</h4><p><strong>算法特点</strong>：</p><ul><li><strong>强制性</strong>：TCP检验和必须计算，不可选</li><li><strong>全覆盖</strong>：包含首部、数据和伪首部</li><li><strong>简单高效</strong>：16位字求和算法</li><li><strong>错误检测</strong>：能检测大部分传输错误</li></ul><h4 id="检验和计算流程-1"><a href="#检验和计算流程-1" class="headerlink" title="检验和计算流程"></a>检验和计算流程</h4><h5 id="发送方处理步骤"><a href="#发送方处理步骤" class="headerlink" title="发送方处理步骤"></a>发送方处理步骤</h5><table><thead><tr><th>步骤</th><th>操作内容</th><th>技术细节</th><th>注意事项</th></tr></thead><tbody><tr><td><strong>1</strong></td><td>构造伪首部</td><td>添加IP层信息</td><td>包含源&#x2F;目的IP地址</td></tr><tr><td><strong>2</strong></td><td>数据准备</td><td>检验和字段置0</td><td>为计算做准备</td></tr><tr><td><strong>3</strong></td><td>16位分组</td><td>按16位字划分</td><td>奇数字节需填充0</td></tr><tr><td><strong>4</strong></td><td>求和计算</td><td>所有16位字相加</td><td>进位回卷处理</td></tr><tr><td><strong>5</strong></td><td>取反操作</td><td>对和值按位求反</td><td>得到最终检验和</td></tr><tr><td><strong>6</strong></td><td>填入首部</td><td>写入检验和字段</td><td>完成报文段构造</td></tr></tbody></table><p><strong>计算示例</strong>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">伪首部 + TCP首部 + 数据 → 16位字序列</span><br><span class="line">0x4500 + 0x0028 + 0x1234 + ... → 求和</span><br><span class="line">进位回卷：(sum &amp; 0xFFFF) + (sum &gt;&gt; 16)</span><br><span class="line">按位取反：~sum &amp; 0xFFFF</span><br></pre></td></tr></table></figure><h5 id="接收方验证步骤"><a href="#接收方验证步骤" class="headerlink" title="接收方验证步骤"></a>接收方验证步骤</h5><table><thead><tr><th>步骤</th><th>操作内容</th><th>验证逻辑</th><th>处理结果</th></tr></thead><tbody><tr><td><strong>1</strong></td><td>重构检验</td><td>按相同方式构造</td><td>包含接收到的检验和</td></tr><tr><td><strong>2</strong></td><td>全部求和</td><td>所有16位字相加</td><td>包括原检验和字段</td></tr><tr><td><strong>3</strong></td><td>结果判断</td><td>检查最终结果</td><td>0表示正确，非0表示错误</td></tr><tr><td><strong>4</strong></td><td>错误处理</td><td>丢弃错误报文段</td><td>不通知发送方</td></tr></tbody></table><h4 id="伪首部结构详解"><a href="#伪首部结构详解" class="headerlink" title="伪首部结构详解"></a>伪首部结构详解</h4><table><thead><tr><th>字段名称</th><th>位长</th><th>字节数</th><th>数据来源</th><th>作用说明</th></tr></thead><tbody><tr><td><strong>源IP地址</strong></td><td>32位</td><td>4</td><td>IP首部</td><td>验证数据包来源正确性</td></tr><tr><td><strong>目的IP地址</strong></td><td>32位</td><td>4</td><td>IP首部</td><td>验证数据包目标正确性</td></tr><tr><td><strong>保留字段</strong></td><td>8位</td><td>1</td><td>全0</td><td>字节对齐和协议兼容</td></tr><tr><td><strong>协议字段</strong></td><td>8位</td><td>1</td><td>6(TCP)</td><td>标识传输层协议类型</td></tr><tr><td><strong>TCP长度</strong></td><td>16位</td><td>2</td><td>计算得出</td><td>TCP首部+数据总长度</td></tr></tbody></table><p><strong>伪首部作用</strong>：</p><ul><li><strong>跨层验证</strong>：结合网络层信息进行验证</li><li><strong>路由保护</strong>：防止数据包被错误路由</li><li><strong>协议识别</strong>：确保数据包被正确的协议处理</li><li><strong>长度校验</strong>：验证数据包长度信息正确性</li></ul><h4 id="检验和特性分析"><a href="#检验和特性分析" class="headerlink" title="检验和特性分析"></a>检验和特性分析</h4><p><strong>检测能力</strong>：</p><ul><li><strong>单比特错误</strong>：100%检测</li><li><strong>双比特错误</strong>：高概率检测</li><li><strong>突发错误</strong>：部分检测能力</li><li><strong>随机错误</strong>：统计检测能力</li></ul><p><strong>性能考虑</strong>：</p><ul><li><strong>计算开销</strong>：相对较小</li><li><strong>硬件支持</strong>：可硬件加速</li><li><strong>实时性</strong>：不影响传输延迟</li><li><strong>可靠性</strong>：提供基本错误检测</li></ul><p><strong>与其他协议对比</strong>：</p><table><thead><tr><th>协议</th><th>检验和要求</th><th>覆盖范围</th><th>错误处理</th></tr></thead><tbody><tr><td><strong>TCP</strong></td><td>强制计算</td><td>首部+数据+伪首部</td><td>丢弃错误报文</td></tr><tr><td><strong>UDP</strong></td><td>IPv4可选，IPv6强制</td><td>首部+数据+伪首部</td><td>丢弃错误报文</td></tr><tr><td><strong>IP</strong></td><td>仅首部</td><td>仅IP首部</td><td>丢弃错误数据包</td></tr></tbody></table><h3 id="TCP-运输连接"><a href="#TCP-运输连接" class="headerlink" title="TCP 运输连接"></a>TCP 运输连接</h3><p>分为三个阶段:</p><ol><li>通过 “三报文握手” 来建立 TCP 连接。</li><li>基于已建立的 TCP 连接进行可靠的数据传输。</li><li>在数据传输结束后还要通过 “四报文挥手” 来释放 TCP 连接。</li></ol><h4 id="“三报文握手”-建立-TCP-连接"><a href="#“三报文握手”-建立-TCP-连接" class="headerlink" title="“三报文握手” 建立 TCP 连接"></a>“三报文握手” 建立 TCP 连接</h4><p><strong>目的:</strong> 在于解决以下三个主要问题:</p><ul><li>使 TCP 双方能够确知对方的存在。</li><li>使 TCP 双方能够协商一些参数 (最大报文段长度、最大窗口大小、时间戳选项等)。</li><li>使 TCP 双方能够对运输实体资源进行分配和初始化，运输实体资源包括缓存大小、各状态变量、连接表中的项目等。</li></ul><ol><li>每条 TCP 连接有两个端点，此端点即套接字。每条 TCP 连接唯一地被通信的两个端点 (套接字) 确定。</li><li>同一个 IP 地址可以有多个不同的 TCP 连接，而同一个端口号也可以出现在多个不同的 TCP 连接中。</li><li>TCP 连接的建立采用客户&#x2F;服务器模式，主动发起连接建立的应用进程称为客户，而被动等待连接建立的应用进程称为服务器。</li></ol><p><strong>过程:</strong><br>(此处原文有三张图片，逐步展示了 TCP 建立连接的 “三报文握手” 过程，包括 SYN 包、SYN-ACK 包、ACK 包的发送和状态转换。)</p><ul><li><strong>序号 seq 字段被设置了一个初始值 x，作为 TCP 客户进程所选择的初始序号。</strong></li><li><strong>请同学们注意:</strong><ul><li>TCP 规定同步标志位 SYN 被设置为 1 的报文段 (例如 TCP 连接请求报文段和 TCP 连接请求确认报文段) 不能携带数据，但要消耗掉一个序号。</li><li>按上述规定，TCP 连接请求报文段不能携带数据 (即没有数据载荷)，但是会消耗掉序号 x。</li><li>因此，TCP 客户进程下一次发送的 TCP 报文段的数据载荷的第一个字节的序号为 x+1。</li></ul></li><li><strong>补充:</strong> 上述过程发送的第三个普通的 TCP 报文段是否多余?(使用三报文握手而不是两报文握手建立 TCP 连接的原因)<ul><li><strong>“三报文握手”建立 TCP 连接 ————使用“三报文握手”而不是“两报文握手”建立 TCP 连接的原因</strong><br>(此处原文有一张图片，展示了使用两报文握手可能导致已失效的连接请求报文段被接受，从而造成资源浪费的场景。)</li><li>采用 “三报文握手” 而不是 “两报文握手” 来建立 TCP 连接，是为了防止已失效的 TCP 连接请求报文段突然又传送到了 TCP 服务器进程，因而导致错误。</li></ul></li></ul><h4 id="“四报文挥手”-释放-TCP-连接"><a href="#“四报文挥手”-释放-TCP-连接" class="headerlink" title="“四报文挥手” 释放 TCP 连接"></a>“四报文挥手” 释放 TCP 连接</h4><p><strong>第一步:</strong> 客户机发送连接释放报文段，并停止发送数据，主动关闭 TCP 连接。该报文段终止位 FIN 设置为 1，序号 seq&#x3D;u (等于前面已传送过的数据的最后一个字节的序号加 1)。<br>(此处原文有一张图片，展示了 TCP 释放连接的第一步，客户机发送 FIN 包，进入 FIN-WAIT-1 状态。)</p><ul><li>TCP 连接释放报文段首部中的终止标志位 FIN 和确认标志位 ACK 的值都被设置为 1。</li><li>表明这是一个 TCP 连接释放报文段，同时也对之前收到的 TCP 报文段进行确认。</li></ul><p><strong>第二步:</strong> 服务器收到连接释放报文段后发出确认。<br>(此处原文有一张图片，展示了 TCP 释放连接的第二步，服务器收到 FIN 包后发送 ACK 包，进入 CLOSE-WAIT 状态。)</p><ul><li>TCP 规定终止标志位 FIN 等于 1 的 TCP 报文段即使不携带数据，也要消耗掉一个序号。</li><li>从 TCP 客户进程到 TCP 服务器进程这个方向的连接就释放了。</li><li><strong>此时的 TCP 连接属于半关闭状态。</strong><ul><li>TCP 客户进程已经没有数据要发送了。但 TCP 服务器进程如果还有数据要发送，TCP 客户进程仍要接收，也就是从 TCP 服务器进程到 TCP 客户进程这个方向的连接并未关闭。</li><li>半关闭状态可能会持续一段时间。</li></ul></li></ul><p><strong>第三步:</strong> 若服务器已经没有要向客户机发送的数据，就通知 TCP 释放连接。<br>(此处原文有一张图片，展示了 TCP 释放连接的第三步，服务器发送 FIN 包，进入 LAST-ACK 状态。)</p><ul><li>TCP 连接释放报文段首部中的终止标志位 FIN 和确认标志位 ACK 的值都被设置为 1。</li><li>表明这是一个 TCP 连接释放报文段，同时也对之前收到的 TCP 报文段进行确认。</li></ul><p><strong>第四步:</strong><br>(此处原文有一张图片，展示了 TCP 释放连接的第四步，客户机发送 ACK 包，进入 TIME-WAIT 状态，服务器进入 CLOSED 状态。)</p><ul><li><strong>TIME-WAIT (时间等待) 状态</strong><ul><li>MSL 是最长报文段寿命 (Maximum Segment Lifetime) 的英文缩写词，[RFC793] 建议为 2 分钟。也就是说，TCP 客户进程进入时间等待 (TIME-WAIT) 状态后，还要经过 4 分钟才能进入关闭 (CLOSED) 状态。</li></ul></li><li><strong>补充:</strong> 为何要经过 2MSL 后才进入关闭状态?<ul><li>处于时间等待 (TIME-WAIT) 状态后要经过 2MSL 时长，可以确保 TCP 服务器进程能够收到最后一个 TCP 确认报文段而进入关闭 (CLOSED) 状态。</li><li>另外，TCP 客户进程在发送完最后一个 TCP 确认报文段后，再经过 2MSL 时长，就可以使本次连接持续期内所产生的所有报文段都从网络中消失。这样就可以使下一个新的 TCP 连接中不会出现旧连接中的报文段。</li></ul></li></ul><p><strong>总结:</strong></p><table><thead><tr><th align="left">阶段</th><th align="left">建立连接</th><th align="left">释放连接</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">SYN&#x3D;1 seq&#x3D;x</td><td align="left">FIN&#x3D;1 seq&#x3D;u</td></tr><tr><td align="left">2</td><td align="left">SYN&#x3D;1 ACK&#x3D;1 seq&#x3D;y ack&#x3D;x+1</td><td align="left">ACK&#x3D;1 seq&#x3D;v ack&#x3D;u+1</td></tr><tr><td align="left">3</td><td align="left">ACK&#x3D;1 seq&#x3D;x+1 ack&#x3D;y+1</td><td align="left">FIN&#x3D;1 ACK&#x3D;1 seq&#x3D;w ack&#x3D;u+1</td></tr><tr><td align="left">4</td><td align="left"></td><td align="left">ACK&#x3D;1 seq&#x3D;u+1 ack&#x3D;w+1</td></tr></tbody></table><h3 id="TCP-可靠传输"><a href="#TCP-可靠传输" class="headerlink" title="TCP 可靠传输"></a>TCP 可靠传输</h3><h4 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h4><p>TCP 在不可靠的 IP 层之上建立一种可靠数据传输服务，该服务保证接收方从缓存区读出的字节流与发送方发出的字节流完全一样。TCP 使用了检验、序号、确认和重传等机制来达到这一目的。</p><h4 id="序号"><a href="#序号" class="headerlink" title="序号"></a>序号</h4><p>TCP 将数据视为一个无结构但有序的字节流，序号建立在传送的字节流之上，而不建立在报文段之上。下图中第二个报文段的序号是 3。<br>(此处原文有一张图片，展示了 TCP 报文段中字节流的序号划分。)</p><h4 id="确认"><a href="#确认" class="headerlink" title="确认"></a>确认</h4><p>确认号是期望收到对方的下一个报文段的数据的第一个字节的序号。<br>TCP 默认使用 <strong>【累积确认】</strong>, 即 TCP 只确认数据流中至第一个丢失字节为止的字节。</p><h4 id="重传"><a href="#重传" class="headerlink" title="重传"></a>重传</h4><p>超时和冗余 ACK 会导致 TCP 对报文段进行重传。</p><h5 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h5><p>TCP 每发送一个报文段就对这个报文段设置一个超时计时器。计时器设置的重传时间到但还未收到确认时，就要重传这一报文段。<br>TCP 采用一种自适应算法来计算超时计时器的重传时间。一个报文段发出的时间以及收到相应确认的时间的间隔称为报文段的往返时间 RTT。TCP 维护 RTT 的一个加权平均往返时间 RTTS，<strong>【超时重传时间】</strong> 应该略大于 RTTS。</p><h5 id="冗余-ACK-冗余确认"><a href="#冗余-ACK-冗余确认" class="headerlink" title="冗余 ACK (冗余确认)"></a>冗余 ACK (冗余确认)</h5><p>冗余 ACK 就是再次确认某个报文段的 ACK。<br>TCP 规定每当比期望序号大的失序报文段到达时，就发送一个冗余 ACK，指明下一个期待字节的序号。<br>例如 3,4,5 号报文段到达时不是自己所期望的 2 号报文段，那就发送 3 个对 1 号报文段的 ACK。</p><h3 id="TCP-流量控制"><a href="#TCP-流量控制" class="headerlink" title="TCP 流量控制"></a>TCP 流量控制</h3><h4 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h4><p>TCP 为应用程序提供了流量控制机制，以解决因发送方发送数据太快而导致接收方来不及接收，造成接收方的接收缓存溢出的问题。</p><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ul><li><strong>基本方法:</strong> 接收方根据自己的接收能力 (接收缓存的可用空间大小) 控制发送方的发送速率。</li><li><strong>采用滑动窗口机制。</strong> TCP 要求发送方维持一个接收窗口 rwnd，接收方根据当前接受缓存的大小动态地调整接收窗口的大小，这个值被放在接收方 TCP 报文段首部中的窗口字段，以通知发送方。发送方的发送窗口不能超过接收方给出的接收窗口值，以限制发送方向网络注入报文的速率。</li><li><strong>TCP 为每个连接设有一个【持续计时器】</strong>，只要发送方收到对方的零窗口通知就启动持续计时器。如果计时器超时，就发送一个零窗口探测报文段，对方就在确认这个探测报文段时给出现在的窗口值。如果窗口仍然为 0，则发送方收到确认报文段后就重新设置持续计时器。<br>(此处原文有一张图片，展示了 TCP 流量控制方法，包括零窗口探测报文段的发送和确认过程。)<ul><li>实际上 TCP 规定: 即使接收窗口值为 0，也必须接受零窗口探测报文段、确认报文段以及携带有紧急数据的报文段。</li><li>回答是肯定的。因为零窗口探测报文段也有重传计时器，当重传计时器超时后，零窗口探测报文段会被重传。</li></ul></li></ul><h4 id="流量控制与数据链路层流量控制比较"><a href="#流量控制与数据链路层流量控制比较" class="headerlink" title="流量控制与数据链路层流量控制比较"></a>流量控制与数据链路层流量控制比较</h4><table><thead><tr><th align="left">特性</th><th align="left">传输层</th><th align="left">数据链路层</th></tr></thead><tbody><tr><td align="left">控制范围</td><td align="left">端到端 (两个进程之间流量控制)</td><td align="left">两个中间的相邻结点之间的流量控制</td></tr><tr><td align="left">窗口大小</td><td align="left">窗口大小可动态变化</td><td align="left">窗口大小不能动态变化</td></tr></tbody></table><h3 id="TCP-拥塞控制"><a href="#TCP-拥塞控制" class="headerlink" title="TCP 拥塞控制"></a>TCP 拥塞控制</h3><h4 id="拥塞控制和流量控制"><a href="#拥塞控制和流量控制" class="headerlink" title="拥塞控制和流量控制"></a>拥塞控制和流量控制</h4><ul><li><strong>拥塞控制:</strong> 指防止过多的数据注入网络，保证网络中的路由器或链路不致过载。</li><li><strong>拥塞出现时，端点并不了解拥塞发生的细节，但是对于通信的端点来说，拥塞往往表现为通信时延的增加。</strong></li><li><strong>TCP 的四种拥塞算法:</strong> 慢开始、拥塞避免、快重传和快恢复。</li></ul><h4 id="闭环拥塞控制算法分类"><a href="#闭环拥塞控制算法分类" class="headerlink" title="闭环拥塞控制算法分类"></a>闭环拥塞控制算法分类</h4><p>根据拥塞信息的反馈形式，可将闭环拥塞控制算法分为：</p><ul><li><strong>显式反馈算法:</strong> 从拥塞节点 (即路由器) 向源点提供关于网络中拥塞状态的显式反馈信息。</li><li><strong>隐式反馈算法:</strong> 源点自身通过对网络行为的观察 (例如超时重传或往返时间 RTT) 来推断网络是否发生拥塞。TCP 采用的就是隐式反馈算法。<br>(此处原文有一张图片，展示隐式反馈和显式反馈算法的区别。)<ul><li>拥塞控制并不仅仅是运输层要考虑的问题。显式反馈算法就必须涉及网络层。虽然一些网络体系结构 (如 ATM 网络) 主要在网络层实现拥塞控制，但因特网主要利用隐式反馈在运输层实现拥塞控制。</li></ul></li></ul><h4 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h4><ul><li><strong>流量控制:</strong> 通常指点对点的通信量控制，要做的是抑制发送端发送数据的速率，以便接收端来得及接收。</li><li><strong>拥塞控制:</strong> 让网络能够承受现有的网络负荷，是一个全局性的过程，涉及所有的主机、所有的路由器，以及与降低网络传输性能有关的所有因素。</li></ul><h4 id="拥塞窗口-cwnd"><a href="#拥塞窗口-cwnd" class="headerlink" title="拥塞窗口 (cwnd)"></a>拥塞窗口 (cwnd)</h4><p>TCP 除了上文的接收窗口，还要求发送方维持一个拥塞窗口，其大小取决于网络的拥塞程度，动态变化。<br>发送方控制拥塞窗口的原则: 只要网络出现拥塞，拥塞窗口就减小一些。<br>发送窗口的上限值取接收窗口 rwnd 和拥塞窗口 cwnd 中较小的一个。</p><ul><li>发送窗口上限值 &#x3D; min{rwnd, cwnd}</li></ul><h4 id="慢开始和拥塞避免-拥塞避免并不能完全避免拥塞，只是使得网络不容易出现拥塞"><a href="#慢开始和拥塞避免-拥塞避免并不能完全避免拥塞，只是使得网络不容易出现拥塞" class="headerlink" title="慢开始和拥塞避免 (拥塞避免并不能完全避免拥塞，只是使得网络不容易出现拥塞)"></a>慢开始和拥塞避免 (拥塞避免并不能完全避免拥塞，只是使得网络不容易出现拥塞)</h4><h5 id="慢开始算法"><a href="#慢开始算法" class="headerlink" title="慢开始算法"></a>慢开始算法</h5><ul><li><strong>具体方法:</strong> 先发送少量数据探测一下，若没有发生拥塞则适当增大拥塞窗口。(从小到大逐渐增大拥塞窗口 (发送窗口))</li><li><strong>慢开始门限 (ssthresh):</strong> 每经过一个传输轮次 (RTT)，cwnd 就会加倍。cwnd 随轮次指数增长。</li><li>慢开始一直把 cwnd 增大到一个规定的 ssthresh，然后改用拥塞避免算法。</li></ul><h5 id="拥塞避免算法"><a href="#拥塞避免算法" class="headerlink" title="拥塞避免算法"></a>拥塞避免算法</h5><ul><li><strong>具体方法:</strong> 每经过一个往返时延 RTT 就把发送方拥塞窗口 cwnd 加 1，而不是翻倍。</li><li><strong>过程:</strong><ul><li>cwnd &lt; ssthresh, 使用慢开始。</li><li>cwnd &gt; ssthresh, 改用拥塞避免算法。</li><li>cwnd &#x3D; ssthresh, 通常使用拥塞避免算法，也可以使用慢开始。</li></ul></li></ul><h4 id="网络拥塞处理"><a href="#网络拥塞处理" class="headerlink" title="网络拥塞处理"></a>网络拥塞处理</h4><p>无论在何阶段，只要发送方判断网络出现拥塞，就首先把慢开始门限 ssthresh 设置为出现拥塞时发送方 cwnd 值的一般 (不能小于 2)，然后把 cwnd 重新设置为 1，继而执行慢开始算法。<br><strong>注意:</strong> 慢开始阶段，如果 2<em>cwnd &gt; ssthresh，则下一个 RTT 后 cwnd 等于 ssthresh，而非 2</em>cwnd。</p><h4 id="快重传和快恢复"><a href="#快重传和快恢复" class="headerlink" title="快重传和快恢复"></a>快重传和快恢复</h4><h5 id="快重传概述"><a href="#快重传概述" class="headerlink" title="快重传概述"></a>快重传概述</h5><p>个别报文段在网络中丢失，但是此时网络其实并未发生拥塞，但发送方收不到确认就会误认为网络发生了拥塞，从而启动慢开始算法降低传输效率。</p><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>使发送方尽早尽快地进行重传，不等计时器超时再重传。接收方即使受到了失序的报文段也要立即发出对已收到的报文段的重复确认。发送方一旦连续收到 3 个冗余 ACK (重复确认)，就立即重传相应的报文段。</p><h5 id="快恢复原理"><a href="#快恢复原理" class="headerlink" title="快恢复原理"></a>快恢复原理</h5><p>当发送方收到 3 个冗余 ACK (重复确认) 时，执行 “乘法减小”，把慢开始门限 ssthresh 调整为当前 cwnd 的一半。发送方此时认为网络很可能没有发生拥塞。并把 cwnd 值夜调整为当前 cwnd 的一半，此时 cwnd 等于 ssthresh，然后开始执行拥塞避免算法。<br>(此处原文有一张图片，展示了 TCP 拥塞控制的慢开始、拥塞避免、快重传和快恢复四种算法的结合图。)</p><h4 id="TCP-拥塞控制机制中四种算法的同时应用"><a href="#TCP-拥塞控制机制中四种算法的同时应用" class="headerlink" title="TCP 拥塞控制机制中四种算法的同时应用"></a>TCP 拥塞控制机制中四种算法的同时应用</h4><p>TCP 连接建立和网络出现超时时，采用慢开始和拥塞避免算法 (ssthresh&#x3D;cwnd&#x2F;2, cwnd&#x3D;1)。<br>发送方收到 3 个冗余 ACK 时，采用快重传和快恢复算法 (ssthresh&#x3D;cwnd&#x2F;2, cwnd&#x3D;ssthresh)。</p><h3 id="习题查漏补缺-1"><a href="#习题查漏补缺-1" class="headerlink" title="习题查漏补缺"></a>习题查漏补缺</h3><ol><li>在 TCP 首部中没有目标主机 IP 地址。</li><li>TCP 报文段和 UDP 报文段都包含源端口、目的端口、检验号。因为 UDP 提供不可靠的传输服务，所以不需要对报文进行编号，不会有序列号字段。相比之下，TCP 需要有序列号字段。</li><li>TCP 的滑动窗口协议中规定重传分组的数量最多可以是滑动窗口的大小。</li><li>假设 TCP 客户与 TCP 服务器的通信已结束，端到端的往返时间为 RTT。t 时刻 TCP 客户请求断开连接，则从 t 时刻起 TCP 服务器释放该连接的最短时间是 <strong>1.5 个 RTT</strong>。<ul><li><strong>1.5 个 RTT</strong>。t 时刻 TCP 客户请求断开连接，发出连接释放 FIN 报文段。当 TCP 服务器收到 TCP 客户发来的 FIN 报文段后不能再发送数据，因此同时发出确认 ACK 报文段和连接释放 FIN 报文段，即直接跳过 CLOSED-WAIT 状态。TCP 客户收到 FIN 报文段后必须发出确认，TCP 服务器收到确认后就进入 CLOSED 状态，共经历 1.5 个 RTT。</li></ul></li><li>TCP 采用对 <strong>【报文段】</strong> 的确认机制。</li><li>TCP 中滑动窗口的值设置得太大，对主机的影响是 <strong>【由于传送的数据过多而使路由器变得拥挤，主机可能丢失分组】</strong>。</li></ol></div><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://polarwanderer.cn/2025/06/22/0218/" data-id="cmfksiqz200246fzba25921rt" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABwklEQVR42u3aQY7DIBAEQP//094HRNg9gyHOqjhZiQWVHFoww3HE4xyMz29H74/mPFYMXFzcae55OarLXyPy+Yez4eLibuReB83nO/lPGi18Pf/wc1xc3Fdye5GXbIlwcXH/Bzf/JAlBXFzct3GTeMop8/H3wFkNFxd3gptXKdc9L6nv4uLitrhncfSi6rqkUlgdFxd3CzcPlGp7tRqIybq4uLjf5eYFi2r7JC/HFJqsuLi4j3J7y1RjLm+13vwRuLi4G7l5rFRLJ3kBNApTXFzc7dweMd+45AWRoQQXF3cLNyltzGxcEkrzrIaLi7udW70slV+Y6G19boIMFxd3AbdX2qheusqzKGrP4OLiLuP2mihVerV0Ujir4eLiLuCumKi6iWle0cDFxV3MnQmv/P28ZXJTdsHFxd3I7ZU+55/zwxUuLu4buNVWRx5tM21aXFzc1dyzOOYPP3kBBRcX91vc6nWr6gJ5qD18RQwXF3eam4dOXtpI/pteyxYXF3cnNw+a/MLWwrMaLi7uy7gzx6fqEQsXF/cXudXWbB5nw/lxcXE3cnvFzWozdf5AhYuLu4dbjZJk4aQgku9bcHFxN3L/APf1uWiSHLjCAAAAAElFTkSuQmCC">Share</a><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/408/" rel="tag">408</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag">笔记</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" rel="tag">计算机网络</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%80%83%E7%A0%94/" rel="tag">计算机考研</a></li></ul></div><div class="post-nav"><a class="next" href="/2025/03/25/1558/">【数据结构】第二章-线性表</a></div><div class="nofancybox" id="waline"></div><link rel="stylesheet" type="text/css" href="https://unpkg.com/@waline/client@v3/dist/waline.css"><script type="module">import{init}from"https://unpkg.com/@waline/client@v3/dist/waline.js";init({el:"#waline",comment:!0,serverURL:"comments.polarwanderer.cn",pageSize:"8",wordLimit:"120",requiredMeta:requiredMeta,emoji:["//unpkg.com/@waline/emojis@1.2.0/weibo","//unpkg.com/@waline/emojis@1.2.0/qq","//unpkg.com/@waline/emojis@1.2.0/tw-emoji"]})</script><script>let metaInfo=["nick","mail","link"],requiredMeta="nick,mail".split(",").filter(i=>metaInfo.indexOf(i)>-1)</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0" readonly></div></div><div class="search-modal" id="search-modal"><div class="search-modal-content"><div class="search-modal-header"><input class="search-modal-input" id="modal-search-input" placeholder="输入关键词搜索..." type="text" name="q"></div><div class="search-modal-body"><div id="modal-search-result"></div></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o">Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o">Tags</i></div><div class="tagcloud"><a href="/tags/408/" style="font-size:15px">408</a> <a href="/tags/%E4%BA%BA%E7%89%A9/" style="font-size:15px">人物</a> <a href="/tags/%E5%8E%86%E5%8F%B2/" style="font-size:15px">历史</a> <a href="/tags/%E5%93%B2%E5%AD%A6/" style="font-size:15px">哲学</a> <a href="/tags/%E5%9B%9E%E5%BF%86/" style="font-size:15px">回忆</a> <a href="/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" style="font-size:15px">年终总结</a> <a href="/tags/%E6%80%9D%E8%80%83/" style="font-size:15px">思考</a> <a href="/tags/%E6%84%9F%E6%82%9F/" style="font-size:15px">感悟</a> <a href="/tags/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/" style="font-size:15px">数学建模</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size:15px">数据结构</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size:15px">机器学习</a> <a href="/tags/%E6%A2%A6%E5%A2%83/" style="font-size:15px">梦境</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size:15px">生活</a> <a href="/tags/%E7%A4%BE%E4%BC%9A%E7%8E%B0%E8%B1%A1/" style="font-size:15px">社会现象</a> <a href="/tags/%E7%AB%9E%E8%B5%9B/" style="font-size:15px">竞赛</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size:15px">笔记</a> <a href="/tags/%E7%BA%BF%E6%80%A7%E8%A1%A8/" style="font-size:15px">线性表</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%B1%82/" style="font-size:15px">网络层</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size:15px">计算机网络</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%80%83%E7%A0%94/" style="font-size:15px">计算机考研</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size:15px">记录</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size:15px">随笔</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o">Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/06/22/0218/">[计算机网络]第五章-传输层</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/25/1558/">【数据结构】第二章-线性表</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/25/1556/">【数据结构】第一章-基本概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/24/2121/">【计算机网络】第四章-网络层</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/07/29/0021/">浪迹天涯</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/07/08/2317/">寻书</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/06/25/2338/">半年志</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/02/07/2150/">2024年美赛</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/12/31/2342/">抓住2023的小尾巴</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/11/12/1620/">11月12日</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o">Recent Comments</i></div><div id="widget-waline-list"></div><script type="text/javascript" id="recent-comment" serverurl="comments.polarwanderer.cn" count="5" src="/js/recent-comments.js?v=1.0.0" async></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2022-2025 <a href="/." rel="nofollow">BlankChen.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path;searchFunc(path,"local-search-input","local-search-result")</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="/js/sticky-header.js?v=1.0.0"></script><script type="text/javascript" src="/js/toc-generator.js?v=1.0.0"></script><script type="text/javascript" src="/js/snowfall.js?v=1.0.0"></script><script type="text/javascript" src="/js/text-reader.js?v=1.0.0"></script><script type="text/javascript" src="/js/floating-buttons.js?v=1.0.0"></script><script type="text/javascript" src="/js/random-post.js?v=1.0.0"></script><script type="text/javascript" src="/js/thoughts-typewriter.js?v=1.0.0"></script><script type="text/javascript" src="/js/subtitle-typewriter.js?v=1.0.0"></script></div></body></html>