<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>【数据结构】第二章-线性表</title>
      <link href="/2025/03/25/1558/"/>
      <url>/2025/03/25/1558/</url>
      
        <content type="html"><![CDATA[<h1 id="【数据结构】第二章-线性表"><a href="#【数据结构】第二章-线性表" class="headerlink" title="【数据结构】第二章-线性表"></a>【数据结构】第二章-线性表</h1><h2 id="线性表的定义"><a href="#线性表的定义" class="headerlink" title="线性表的定义"></a>线性表的定义</h2><p>线性表是具有相同数据类型的n（n≥0）个数据元素的有限序列，其中n为表长，当n&#x3D;0时线性表是一个空表。</p><h2 id="线性表的基本操作"><a href="#线性表的基本操作" class="headerlink" title="线性表的基本操作"></a>线性表的基本操作</h2><ol><li><strong>InitList(&amp;L)</strong>: 初始化表。构造一个空的线性表L，分配内存空间。</li><li><strong>DestroyList(&amp;L)</strong>: 销毁操作。销毁线性表，并释放线性表L所占用的内存空间。</li><li><strong>ListInsert(&amp;L,i,e)</strong>: 插入操作。在表L中的第i个位置上插入指定元素e。</li><li><strong>ListDelete(&amp;L,i,&amp;e)</strong>: 删除操作。删除表L中第i个位置的元素，并用e返回删除元素的值。</li><li><strong>LocateElem(L,e)</strong>: 按值查找操作。在表L中查找具有给定关键字值的元素。</li><li><strong>GetElem(L,i)</strong>: 按位查找操作。获取表L中第i个位置的元素的值。</li></ol><h2 id="线性表的特点"><a href="#线性表的特点" class="headerlink" title="线性表的特点"></a>线性表的特点</h2><ol><li>表中元素的个数有限</li><li>表中元素具有逻辑上的顺序性，在序列中各元素排列有其先后次序</li><li>表中元素都是数据元素，每个元素都是单个元素</li><li>表中元素的数据类型都相同，这意味着每个元素占有相同大小的存储空间</li><li>表中元素具有抽象性，即仅讨论元素间的逻辑关系，而不考虑元素究竟表示什么内容</li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 408 </tag>
            
            <tag> 线性表 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【数据结构】第一章-基本概念</title>
      <link href="/2025/03/25/1556/"/>
      <url>/2025/03/25/1556/</url>
      
        <content type="html"><![CDATA[<h1 id="数据结构基础概念"><a href="#数据结构基础概念" class="headerlink" title="数据结构基础概念"></a>数据结构基础概念</h1><h2 id="一、基本概念"><a href="#一、基本概念" class="headerlink" title="一、基本概念"></a>一、基本概念</h2><ol><li><p>**数据：**信息的载体。数据是计算机程序加工的原料。</p></li><li><p>**数据元素：**数据的基本单位，通常作为一个整体进行考虑。一个数据元素可以由若干数据项组成。如学生记录。</p></li><li><p>**数据项：**构成数据元素的最小单位。如学号，姓名。</p></li><li><p>**数据对象：**具有相同性质的数据元素的集合，是数据的一个子集。</p></li><li><p>**数据类型：**数据类型是一个值的集合和定义在此集合上的一组操作的总称。</p><ul><li>原子类型：其值不可再分的数据类型</li><li>结构类型：其值可以再分解为若干成分的数据类型</li><li>抽象数据类型：一个数学模型及定义在该数学模型上的一组操作，它通常是对数据的某种抽象，定义了数据的取值范围及其结构形式，以及对数据操作的集合。</li></ul></li><li><p>**数据结构：**是相互之间存在一种或多种特定关系的数据元素的集合。数据元素相互之间的关系称为【结构】。数据结构包括三方面【三要素】的内容：【逻辑结构】、【存储结构】和【数据的运算】</p></li><li><p><strong>数据结构的研究内容</strong></p><ul><li>数据如何组织</li><li>数据如何存储</li><li>数据如何运算</li></ul></li><li><p>**逻辑结构和存储结构：**一个算法的设计取决于所选定的【逻辑结构】，而算法的实现依赖于所采用的的【存储结构】。</p><ul><li><p>**逻辑结构：**指数据元素之间的逻辑关系，即从逻辑关系上描述数据。**与数据的存储无关。**分为【线性结构】（典型的如【线性表】）和【非线性结构】。</p><table><thead><tr><th>类型</th><th>关系特征</th><th>典型结构</th></tr></thead><tbody><tr><td>集合</td><td>无特定关系</td><td>-</td></tr><tr><td><strong>线性结构</strong></td><td>一对一</td><td>线性表&#x2F;栈&#x2F;队列&#x2F;串</td></tr><tr><td>树形结构</td><td>一对多</td><td>树&#x2F;二叉树</td></tr><tr><td>图状结构</td><td>多对多</td><td>图</td></tr></tbody></table></li><li><p>**存储结构：**指数据结构在计算机中的表示（映像），也称【物理结构】。它包括【数据元素的表示】和【关系的表示】。存储结构依赖于计算机语言。</p><table><thead><tr><th>类型</th><th>特点</th><th>优缺点</th></tr></thead><tbody><tr><td>顺序存储</td><td>逻辑相邻 → 物理相邻</td><td>✅ 随机存取<br>❌ 外部碎片多</td></tr><tr><td>链式存储</td><td>指针表示逻辑关系</td><td>✅ 空间利用率高<br>❌ 只能顺序存取</td></tr><tr><td>索引存储</td><td>建立索引表（关键字+地址）</td><td>✅ 检索快<br>❌ 额外空间+修改耗时</td></tr><tr><td>散列存储</td><td>哈希函数计算存储地址</td><td>✅ 增删查快<br>❌ 哈希冲突需处理</td></tr></tbody></table></li></ul></li></ol><h2 id="二、算法和算法评价"><a href="#二、算法和算法评价" class="headerlink" title="二、算法和算法评价"></a>二、算法和算法评价</h2><ol><li><strong>算法定义</strong></li></ol><table><thead><tr><th>术语</th><th>说明</th><th>示例&#x2F;补充说明</th></tr></thead><tbody><tr><td><strong>算法</strong></td><td>对特定问题求解步骤的一种描述，是指令的有限序列</td><td>如排序算法、搜索算法等</td></tr><tr><td><strong>指令序列</strong></td><td>由基本操作组成的有限步骤</td><td>包含输入、处理、输出三个阶段</td></tr></tbody></table><ol start="2"><li><strong>算法的五大特征</strong></li></ol><table><thead><tr><th>特征</th><th>描述</th><th>重要性说明</th></tr></thead><tbody><tr><td><strong>有穷性</strong></td><td>必须在有穷步后结束，每一步可在有穷时间内完成</td><td>避免无限循环</td></tr><tr><td><strong>确定性</strong></td><td>每条指令有确切含义，相同输入必得相同输出</td><td>保证结果可靠性</td></tr><tr><td><strong>可行性</strong></td><td>操作可通过基本运算有限次实现</td><td>确保可执行性</td></tr><tr><td><strong>输入</strong></td><td>有零个或多个特定集合的输入</td><td>零输入如随机数生成</td></tr><tr><td><strong>输出</strong></td><td>有一个或多个确定的输出</td><td>无输出则无意义</td></tr></tbody></table><ol start="3"><li><strong>优质算法的特征</strong></li></ol><table><thead><tr><th>特征</th><th>说明</th><th>评估标准</th></tr></thead><tbody><tr><td><strong>正确性</strong></td><td>能准确解决问题</td><td>通过测试用例验证</td></tr><tr><td><strong>可读性</strong></td><td>代码清晰易理解</td><td>命名规范、注释完整</td></tr><tr><td><strong>健壮性</strong></td><td>能处理非法输入</td><td>边界条件处理</td></tr><tr><td><strong>时间效率</strong></td><td>执行速度快</td><td>时间复杂度低</td></tr><tr><td><strong>空间效率</strong></td><td>内存占用少</td><td>空间复杂度低</td></tr></tbody></table><ol start="4"><li><strong>效率度量指标</strong></li></ol><ul><li>时间复杂度分析</li></ul><table><thead><tr><th>概念</th><th>定义</th><th>典型示例</th></tr></thead><tbody><tr><td><strong>频度</strong></td><td>语句被重复执行的次数</td><td>循环体内的操作</td></tr><tr><td><strong>T(n)</strong></td><td>基本运算执行次数函数</td><td>如3n²+2n+1</td></tr><tr><td><strong>O(n)</strong></td><td>渐进时间复杂度</td><td>忽略低阶项和常数</td></tr><tr><td><strong>O(1)</strong></td><td>常数时间复杂度</td><td>哈希查找</td></tr><tr><td><strong>O(logn)</strong></td><td>对数复杂度</td><td>二分查找</td></tr><tr><td><strong>O(n)</strong></td><td>线性复杂度</td><td>顺序查找</td></tr><tr><td><strong>O(nlogn)</strong></td><td>线性对数复杂度</td><td>快速排序</td></tr><tr><td><strong>O(n²)</strong></td><td>平方复杂度</td><td>冒泡排序</td></tr></tbody></table><ul><li>空间复杂度分析</li></ul><table><thead><tr><th>类型</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><strong>固定空间</strong></td><td>输入输出以外的固定需求</td><td>简单变量</td></tr><tr><td><strong>可变空间</strong></td><td>动态分配的空间</td><td>递归栈</td></tr><tr><td><strong>O(1)</strong></td><td>原地算法</td><td>冒泡排序</td></tr><tr><td><strong>O(n)</strong></td><td>线性空间</td><td>归并排序</td></tr></tbody></table><ol start="5"><li><strong>递归算法分析</strong></li></ol><table><thead><tr><th>方法</th><th>说明</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>递推公式法</strong></td><td>T(n)&#x3D;aT(n&#x2F;b)+f(n)</td><td>分治算法</td></tr><tr><td><strong>递归树法</strong></td><td>可视化递归过程</td><td>多层递归</td></tr><tr><td><strong>主定理法</strong></td><td>快速求解特定递推式</td><td>标准分治</td></tr></tbody></table><ol start="6"><li><strong>常见算法对比</strong></li></ol><table><thead><tr><th>算法</th><th>时间复杂度</th><th>空间复杂度</th><th>特点</th></tr></thead><tbody><tr><td>冒泡排序</td><td>O(n²)</td><td>O(1)</td><td>简单但效率低</td></tr><tr><td>快速排序</td><td>O(nlogn)</td><td>O(logn)</td><td>平均性能最好</td></tr><tr><td>归并排序</td><td>O(nlogn)</td><td>O(n)</td><td>稳定但需额外空间</td></tr><tr><td>二分查找</td><td>O(logn)</td><td>O(1)</td><td>前提是有序表</td></tr></tbody></table><ol start="7"><li><strong>优化策略</strong></li></ol><table><thead><tr><th>策略</th><th>实现方式</th><th>效果</th></tr></thead><tbody><tr><td>空间换时间</td><td>使用哈希表</td><td>O(n)→O(1)</td></tr><tr><td>分治法</td><td>将问题分解</td><td>O(n²)→O(nlogn)</td></tr><tr><td>动态规划</td><td>存储中间结果</td><td>指数→多项式</td></tr><tr><td>剪枝策略</td><td>减少不必要的计算</td><td>提升实际效率</td></tr></tbody></table><h2 id="三、第一章习题总结"><a href="#三、第一章习题总结" class="headerlink" title="三、第一章习题总结"></a>三、第一章习题总结</h2><ol><li><strong>数据类型分类</strong></li></ol><table><thead><tr><th>类型</th><th>定义</th><th>特点</th><th>示例</th></tr></thead><tbody><tr><td><strong>单型数据类型</strong></td><td>数据元素类型固定</td><td>单一数据类型</td><td>整型、实型、字符串</td></tr><tr><td><strong>多型数据类型</strong></td><td>可包含多种数据类型</td><td>元素类型灵活</td><td>栈、队列、树、图</td></tr></tbody></table><blockquote><p><strong>注</strong>：多型数据结构中元素可以是单型数据，也可以是其他结构数据</p></blockquote><ol start="2"><li><strong>数据结构与数据类型</strong></li></ol><table><thead><tr><th>概念</th><th>形式化定义</th><th>组成要素</th><th>区别</th></tr></thead><tbody><tr><td><strong>数据结构</strong></td><td>(D, R)</td><td>D: 数据对象<br>R: 数据关系</td><td>关注数据组织方式</td></tr><tr><td><strong>数据类型</strong></td><td>(D, R, P)</td><td>增加P: 基本操作集</td><td>包含操作定义</td></tr></tbody></table><ol start="3"><li><strong>数据结构基本概念</strong></li></ol><table><thead><tr><th>概念</th><th>定义</th><th>说明</th><th>常见误区</th></tr></thead><tbody><tr><td><strong>数据项</strong></td><td>数据的最小单位</td><td>不可分割的基本单元</td><td>如学生记录中的”学号”</td></tr><tr><td><strong>逻辑结构</strong></td><td>数据元素间的抽象关系</td><td>与内容形式无关</td><td>独立于物理存储</td></tr><tr><td><strong>物理结构</strong></td><td>计算机中的存储方式</td><td>包含：<br>• 数据元素<br>• 元素间关系</td><td>如顺序&#x2F;链式存储</td></tr></tbody></table><ol start="4"><li><strong>存储结构对比</strong></li></ol><table><thead><tr><th>类型</th><th>关系表示方式</th><th>特点</th><th>示例</th></tr></thead><tbody><tr><td><strong>顺序存储</strong></td><td>物理位置相邻</td><td>无需额外存储关系</td><td>数组</td></tr><tr><td><strong>链式存储</strong></td><td>显式指针链接</td><td>动态分配内存</td><td>链表</td></tr></tbody></table><ol start="5"><li><strong>算法特性</strong></li></ol><table><thead><tr><th>特性</th><th>说明</th><th>重要性</th></tr></thead><tbody><tr><td><strong>语言无关性</strong></td><td>独立于具体语言和计算机</td><td>算法优劣的本质属性</td></tr><tr><td><strong>效率规律</strong></td><td>语言级别↑ → 执行效率↓</td><td>高级语言vs机器码</td></tr></tbody></table><ol start="6"><li><strong>时间复杂度分析</strong></li></ol><table><thead><tr><th>概念</th><th>定义</th><th>关键点</th><th>经典案例</th></tr></thead><tbody><tr><td><strong>时间复杂度</strong></td><td>最坏情况下执行时间的上界</td><td>取决于：<br>• 问题规模(n)<br>• 数据初态</td><td>汉诺塔O(2ⁿ)</td></tr><tr><td><strong>基本操作</strong></td><td>最深层循环内的操作</td><td>统计执行次数</td><td>循环体内的核心操作</td></tr></tbody></table><ol start="7"><li><strong>常见误区澄清</strong></li></ol><table><thead><tr><th>错误观点</th><th>正解</th><th>反例</th></tr></thead><tbody><tr><td>“所有数据结构都有插入、删除、查找”</td><td>基本操作取决于结构特性</td><td>二维数组无插入删除功能</td></tr><tr><td>“存储结构需要额外存储元素关系”</td><td>顺序存储通过物理位置隐含关系</td><td>数组不需要指针表示相邻关系</td></tr></tbody></table><ol start="8"><li><strong>设计原则</strong></li></ol><table><thead><tr><th>原则</th><th>内涵</th><th>实践意义</th></tr></thead><tbody><tr><td><strong>抽象封装</strong></td><td>定义与实现分离</td><td>数据结构变化不影响应用</td></tr><tr><td><strong>操作独立性</strong></td><td>应用与存储结构解耦</td><td>便于底层优化调整</td></tr></tbody></table><ol start="9"><li><strong>抽象数据类型(ADT)</strong></li></ol><table><thead><tr><th>特征</th><th>说明</th><th>设计要点</th></tr></thead><tbody><tr><td><strong>逻辑特性优先</strong></td><td>仅关注数学特性</td><td>定义规范接口</td></tr><tr><td><strong>实现无关性</strong></td><td>不限定内部表示</td><td>允许性能优化</td></tr><tr><td><strong>稳定性</strong></td><td>接口不变则外部无感知</td><td>契约式编程</td></tr></tbody></table><p><strong>补充说明</strong></p><ol><li><p><strong>汉诺塔复杂度证明</strong>：</p><ul><li>递推式：T(n) &#x3D; 2T(n-1) + 1</li><li>解方程得O(2ⁿ)</li></ul></li><li><p><strong>操作设计准则</strong>：</p><ul><li>基本操作应完备且正交</li><li>避免暴露内部实现细节</li></ul></li><li><p><strong>物理结构本质</strong>：</p><ul><li>必须完整存储：<ul><li>数据元素本身</li><li>元素间逻辑关系的物理表示</li></ul></li></ul></li><li><p>【习题】数据结构被形式定义为（D，S), 其中D是<code>(   )</code>的有限集合，S是D上的<code>(   )</code>有限的集合。 </p><p>A、算法</p><p>B、数据元素</p><p>C、数据操作</p><p>D、逻辑结构</p><p>E、操作</p><p>F、映像</p><p>G、存储</p><p>H、关系</p></li></ol><blockquote><p>正确答案：<em><strong>BH</strong></em></p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> 408 </tag>
            
            <tag> 计算机考研 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【计算机网络】第四章-网络层(上)</title>
      <link href="/2025/03/24/2121/"/>
      <url>/2025/03/24/2121/</url>
      
        <content type="html"><![CDATA[<h1 id="4-1-网络层的功能"><a href="#4-1-网络层的功能" class="headerlink" title="4.1 网络层的功能"></a>4.1 网络层的功能</h1><h2 id="网络层的功能"><a href="#网络层的功能" class="headerlink" title="网络层的功能"></a>网络层的功能</h2><ul><li><strong>主要任务</strong>：将分组从源主机经过多个网络和多段链路传输到目的主机<ul><li>分组转发：路由器根据转发表将分组从合适的端口转发出去（数据平面），转发的依据是IP地址（网络层通过IP地址来标识主机）</li><li>路由选择：根据路由协议构造路由表，经常&#x2F;定期与相邻路由器交换信息，更新维护路由表（转发平面）</li></ul></li><li>网络抽象划分：可以将网络抽象划分为数据平面（转发平面）和控制平面。</li></ul><h2 id="TCP-IP体系的网络层"><a href="#TCP-IP体系的网络层" class="headerlink" title="TCP&#x2F;IP体系的网络层"></a>TCP&#x2F;IP体系的网络层</h2><ol><li>提供无连接的数据报服务，由用户主机来保证通信的可靠性。</li><li>只向上提供简单灵活的、无连接的、尽最大努力交付的数据报服务</li><li>所传送分组可能出错、丢失、重复、失序或超时。</li></ol><h2 id="异构网络互连（网络层的任务之一）"><a href="#异构网络互连（网络层的任务之一）" class="headerlink" title="异构网络互连（网络层的任务之一）"></a>异构网络互连（网络层的任务之一）</h2><ul><li><p><strong>网络互连</strong>：将两个以上的计算机网络，通过一定的方法，用一些中继系统相互连接起来，以构成更大的网络系统。<strong>通常是指用路由器进行网络连接路由选择。</strong></p></li><li><p><strong>异构网络</strong>：数据链路层和物理层均不同。</p><p>【异构性】指（在物理层和数据链路层中定义的）传输介质、数据编码方式、链路控制协议及不同的数据单元格式和转发机制。</p></li><li><p><strong>中继系统</strong></p><ul><li>物理层中继系统：转发器，集线器</li><li>数据链路层中继系统：网桥和交换机</li><li>网络层中继系统：路由器</li><li>网络层以上的中继系统：网关</li></ul></li></ul><h2 id="虚拟互联网络"><a href="#虚拟互联网络" class="headerlink" title="虚拟互联网络"></a>虚拟互联网络</h2><ol><li>也就是逻辑互联网络。</li><li>互联起来的各种物理网络的异构性本来是客观存在的，但是通过IP协议就可使这些性能各异的网络在网络层上看起来像是一个统一的网络。</li><li>使用IP协议的虚拟互联网络简称为IP网络<ul><li>优点：IP网上主机进行通信时，就好像在单个网络上通信一样。看不见具体异构细节。</li></ul></li></ol><h2 id="路由与转发"><a href="#路由与转发" class="headerlink" title="路由与转发"></a>路由与转发</h2><table><thead><tr><th>概念</th><th>说明</th></tr></thead><tbody><tr><td>分组转发</td><td>路由器根据转发表将分组从合适的端口转发出去</td></tr><tr><td>路由选择</td><td>根据路由协议构造路由表，经常&#x2F;定期与相邻路由器交换信息，更新维护路由表</td></tr><tr><td>路由表</td><td>根据路由选择算法得出</td></tr><tr><td>转发表</td><td>从路由表得出</td></tr></tbody></table><p>路由表的表项包括：</p><ul><li>目的地址：表示IP包的目的地址或目的网络；</li><li>网络掩码：与目的地址一起标识目的主机或者路由器所在的网段的地址</li><li>pre：标示路由加入IP路由表的优先级（因为到达一个目的地有多条路由）</li><li>cost：路由开销，同上，但是给出的是开销</li><li>interface：输出接口，指明IP包将从路由器哪个接口转发</li><li>nexthop：下一跳IP地址，说明IP包所经过的下一个路由器</li></ul><p>请注意：</p><ul><li>路由器只保留到达目的地址的下一个路由器的地址，不保留整个传输路径的信息。采用目的网络，则只需包含目的网络和到达该目的网络路径上的下一个路由器的IP地址即可。</li><li>每个路由器根据路由表来选择IP分组的下一跳地址。主机仅知道到达本地网络的路径，要去往其他网络，那么需要把IP分组交给路由器。路由器和源主机都不知道IP分组要经过的完整路径。</li></ul><h2 id="网络层向其上层提供的两种服务"><a href="#网络层向其上层提供的两种服务" class="headerlink" title="网络层向其上层提供的两种服务"></a>网络层向其上层提供的两种服务</h2><ol><li>面向连接的虚电路服务</li><li>无连接的数据报服务</li></ol><table><thead><tr><th></th><th>数据报服务</th><th>虚电路服务</th></tr></thead><tbody><tr><td>连接的建立</td><td>不需要</td><td>必须有</td></tr><tr><td>目的地址</td><td>每个分组都有完整的目的地址</td><td>仅在建立连接阶段使用,之后每个分组使用长度较短的虚电路号</td></tr><tr><td>路由选择</td><td>每个分组独立地进行路由选择和转发</td><td>属于同一条虚电路的分组按照同一路由转发</td></tr><tr><td>分组顺序</td><td>不保证分组的有序到达</td><td>保证分组的有序到达</td></tr><tr><td>可靠性</td><td>不保证可靠通信，可靠性由用户主机来保证</td><td>可靠性由网络保证</td></tr><tr><td>对网络故障的适应性</td><td>出故障的结点丢失分组,其他分组路径选择发生变化时可以正常传输</td><td>所有经过故障结点的虚电路均不能正常工作</td></tr><tr><td>差错处理和流量控制</td><td>由用户主机进行流量控制，不保证数据报的可靠性</td><td>可由分组交换网负责，也可由用户主机负责</td></tr></tbody></table><h1 id="虚电路与数据报"><a href="#虚电路与数据报" class="headerlink" title="虚电路与数据报"></a>虚电路与数据报</h1><h2 id="虚电路服务"><a href="#虚电路服务" class="headerlink" title="虚电路服务"></a>虚电路服务</h2><ul><li><p><strong>概述</strong>：两台计算机进行通信时首先建立网络层的连接（一条逻辑上的虚电路，VC，不是物理连接。），连接建立后就固定了虚电路对应的物理路径</p><p>比较：采用电路交换的电话通信<strong>则</strong>是建立一条真正的物理连接。</p></li><li><p><strong>特点</strong>：</p><ul><li>“虚”：指的是这条电路<strong>不是专用</strong>的。一段物理链路可以有很多条虚电路。<br> 节点到其他节点之间的链路可能同时有若干条虚电路通过，亦或是建立。<strong>也不需要为每条VC预分配带宽。</strong></li><li>核心思想：可靠通信由网络自身来保证。</li></ul></li></ul><p><strong>通信过程</strong>（三个阶段）：</p><ol><li>虚电路建立<ul><li>每次建立将一个未用过的虚电路号（VCID）分配给虚电路。</li><li>分组的首部仅在连接建立时使用完整的目的地址，之后每个分组的首部只需携带虚电路编号即可。</li><li>【动作】 A发“呼叫请求”分组，B收到并同意连接，发送“呼叫应答”分组进</li></ul></li><li>数据传输<ul><li>建立虚电路后，AB可以相互传送数据分组</li></ul></li><li>虚电路释放<ul><li>结束后，A发“请求释放”分组拆除虚电路；</li><li>整个连接逐个断开。</li></ul></li></ol><p><strong>虚电路服务的特点</strong></p><table><thead><tr><th>特点</th><th>详述</th></tr></thead><tbody><tr><td>时间开销大</td><td>建立和拆除需要时间开销；<br />对于交互式应用、少量短分组场景浪费；<br />对于长时间频繁数据交换效率高。</td></tr><tr><td>路由选择的体现</td><td>路由选择体现在建立阶段。</td></tr><tr><td>可靠、对端点的流量控制<br />（保证分组有序到达）</td><td>提供可靠通信功能，保证每个分组正确、有序地到达；<br />可以对两个端点流量进行控制，通知发送方暂缓发送</td></tr><tr><td><strong>致命弱点</strong></td><td>某个节点或某条链路出现故障、彻底失效时，会破坏经过这个节点或链路的虚电路。</td></tr><tr><td>相对数据报方式开销小</td><td>分组首部不包含目的地址，而是虚电路号。</td></tr></tbody></table><h2 id="数据报服务"><a href="#数据报服务" class="headerlink" title="数据报服务"></a>数据报服务</h2><p><strong>概述</strong></p><ul><li>网络在发送分组前不需要先建立连接；</li><li>源主机的高层协议将报文拆成若干较小的数据段，并加上地址等控制信息后构成分组；</li><li>中间阶段存储分组很短一段时间，找到路由后尽快转发给每个分组。</li><li><strong>网络层不提供服务质量承诺</strong>。不提供端到端的可靠传输服务。所以路由器比较简单，造价低廉。复杂的网络功能置于因特网边缘（用户主机及其内部运输层）</li></ul><p><strong>通信过程</strong>：A向B发送分组</p><table><thead><tr><th>步骤</th><th>详述</th></tr></thead><tbody><tr><td>主机A发给交换节点</td><td>主机A先将分组逐个发往与之直接相连的交换节点，交换节点缓存分组</td></tr><tr><td>查找转发表</td><td>交换节点查找自己的转发表，转发给别的交换节点</td></tr><tr><td>继续转发直到抵达B</td><td>其他交换节点也类似地继续转发，直到B收到</td></tr></tbody></table><p><strong>数据报服务特点</strong></p><table><thead><tr><th>特点</th><th>详述</th></tr></thead><tbody><tr><td>无须建立连接</td><td>发送方随时发送，接收方随时接收</td></tr><tr><td>不保证可靠</td><td>网络只是尽最大努力交付。分组可能丢失。由于每个分组路由选择转发都是独立的，所以路径可能不同，分组也不一定按序到达</td></tr><tr><td>需完整地址</td><td>需要包括发送方和接收方的完整地址，这样才能独立传输</td></tr><tr><td>视情况丢弃</td><td>分组在交换节点处的存储转发需要排队等候，产生时延，网络拥塞时视情况丢弃部分分组</td></tr><tr><td>适应能力强</td><td>对于冗余和故障路径，相应地更新转发表，对故障适应能力强</td></tr></tbody></table><p><strong>优点</strong>：网络造价大大降低。运行方式灵活。适用多种应用场景。</p><h1 id="SDN（软件定义网络）"><a href="#SDN（软件定义网络）" class="headerlink" title="SDN（软件定义网络）"></a>SDN（软件定义网络）</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>一种创新网络架构。采用<strong>集中式的控制平面</strong>和<strong>分布式的数据平面</strong>。两平面<strong>彼此分离</strong>。</p><h2 id="控制平面"><a href="#控制平面" class="headerlink" title="控制平面"></a>控制平面</h2><p>SDN利用<strong>控制—数据接口</strong>对数据平面上的路由器进行集中式控制，方便软件控制网络。</p><h2 id="传统网络中的路由器"><a href="#传统网络中的路由器" class="headerlink" title="传统网络中的路由器"></a>传统网络中的路由器</h2><ul><li><p>既有转发表又有路由选择软件；</p></li><li><p>既有数据平面又有控制平面。</p></li></ul><h2 id="SDN结构"><a href="#SDN结构" class="headerlink" title="SDN结构"></a>SDN结构</h2><p>不再需要路由选择软件（路由器之间不再相互交换路由信息）；</p><p>路由器只是做简单工作：收到分组、查找转发表、转发分组。那么如何得知路由信息？</p><p>网络控制平面有一个逻辑上的<strong>远程控制器(不在SDN交换机中，而位于网络中心位置)</strong>：</p><ul><li>掌握各主机和整个网络状态，并为每个分组计算出最佳路由；</li><li>通过Openflow协议（这是南向接口协议）把转发表下发给路由器。它取代了路由协议。</li></ul><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul><li><strong>可编程性</strong>：为开发者提供强大编程接口。北向接口、南向接口、东西向接口<ul><li>北向接口：SDN对上层应用开发者提供北向接口（有丰富的API，不必关心底层硬件细节）；</li><li>南向接口：SDN控制器和转发设备建立双向会话的接口。通过南向接口SDN控制器可兼容不同硬件设备</li><li>东西向接口：SDN控制器集群内部控制器之间的通信接口。用于增强整个控制平面的可靠性和可拓展性。</li></ul></li><li><strong>优点</strong>：<ol><li>全局集中式控制和分布式高速转发</li><li>灵活可编程与性能平衡：由专有的自动化工具以编程方式配置</li><li>降低成本：网络设备的制造与功能软件的开发相分离</li></ol></li><li><strong>缺点</strong>：<ol><li>安全风险：集中管理受攻击崩溃会影响整个网络</li><li>规模瓶颈：网络规模扩大后，控制器将成为网络性能的瓶颈</li></ol></li></ul><h1 id="拥塞控制"><a href="#拥塞控制" class="headerlink" title="拥塞控制"></a>拥塞控制</h1><p><strong>拥塞</strong>：过量分组引起网络性能下降</p><p><strong>判断拥塞状态</strong>：</p><ul><li>随着网络负载增加，网络吞吐量明显小于正常吞吐量 -&gt; 轻度拥塞</li><li>网络吞吐量随着网络负载增大反而下降 -&gt; 可能已进入拥塞</li></ul><p><strong>拥塞控制目标</strong>：</p><ul><li>获取发生拥塞的信息，利用信息进行控制；确保网络能够承载所达到的流量</li><li>【比较】流量控制指发送方和接收方之间的点对点通信量控制，抑制发送方的发送速率。</li></ul><p><strong>拥塞控制方法</strong>：</p><ul><li>开环控制：（静态方法）设计时就事先考虑到发生拥塞的因素：确定何时可接受新流量、何时可丢弃分组。(做决定时不考虑当前网络状态)</li><li>闭环控制：（动态方法，反馈回路）采用监测系统来监视，检测到拥塞后把拥塞信息发送给合适地方，来调整网络运行。</li></ul><h1 id="4-1总结补充"><a href="#4-1总结补充" class="headerlink" title="4.1总结补充"></a>4.1总结补充</h1><p>一、<strong>路由器</strong>互联的多个局域网的结构中要求每个局域网（物理层、数据链路层、网络层协议可以不同，但是网络层之上的协议必须相同）原因：路由器是第三层设备，他只能影响所在的网络层及以下，再往上并不能影响到。</p><ul><li>关于网络层协议不同而实现互联的eg：IPV4和IPV6网络</li></ul><p>二、路由器和交换机</p><table><thead><tr><th>路由器</th><th>工作在网络层，不转发广播包，能够分隔广播域，抑制广播风暴；  路由器互连多个网络，不仅有多个IP地址，还有多个硬件地址</th></tr></thead><tbody><tr><td>交换机</td><td>工作在数据链路层，能够分隔冲突域，不能分隔广播域</td></tr><tr><td>集线器</td><td>工作在物理层，不能分隔广播域也不能分隔冲突域</td></tr></tbody></table><p>三、电路交换、报文交换、数据报交换、虚电路交换</p><table><thead><tr><th>电路交换</th><th>无差错控制功能。</th></tr></thead><tbody><tr><td>报文交换</td><td>交换的数据单元是报文，报文大小不固定（需要较大存储空间），因为大小不固定所以处理时间也不固定，不能用于实时通信环境。</td></tr><tr><td>分组交换</td><td>分为下面两种方式：数据报交换和虚电路交换。 分组交换限制分组大小，超过限制时需分隔。</td></tr><tr><td>数据报交换</td><td>无连接，不可靠；每个分组都是独立选择路由；可能丢失、失序。故障后可以另选路径。  要保证可靠性和有序性需要高层协议（TCP）的支持。</td></tr><tr><td>虚电路交换</td><td>面向连接，可靠；保证可靠有序。 建立连接后，分组走的路径就是固定的。     不适合出错率高的系统，因为很容易出现结点故障。</td></tr></tbody></table><p>四、存储转发机制：<strong>先接收完整个分组</strong>才开始转发分组的第一位</p><h1 id="4-2-IPv4"><a href="#4-2-IPv4" class="headerlink" title="4.2 IPv4"></a>4.2 IPv4</h1><p><strong>概述</strong>：也即网际协议(Internet Protocol,IP), 定义了数据传送的基本单元(IP分组)及其确切数据格式。IPV4地址是给因特网上的每一个主机&#x2F;路由器的每一个接口分配的一个全世界范围内的唯一32比特（IPV6为128比特）的标识符。</p><p><strong>IP数据报</strong>：IP分组也叫IP数据报。包括首部和数据部分。</p><ul><li>首部前两个字节往往以0x45开头，可用于定位IP数据报开始的位置。</li><li>补充：“4”表示版本号，0100。首部的第一个字节前4位表示IP协议的版本。首部长度以32位（四个字）为单位，标准IP首部长度为20字节，20字节&#x2F;4字节&#x3D;5 (行，一行一个字)</li><li>标识：占16bit，作为一个计数器，也是数据报的编号。每产生一个数据报就++，若长度超出MTU，则需要分片，但是分片后的几个数据报的标识都相同，以便重组。（是数据报的编号不是分片的编号）</li><li>标志：占3bit 。标志最低位MF（1表示后面还有分片，0表示最后一个分片），中间位DF&#x3D;0时才允许分片。</li><li>片偏移：占13bit。 指出较长的数据报在分片后某片在原数据报中的相对位置，以8B为偏移单位。除最后一个分片外，每个分片的长度一定是8B的整数倍。</li><li>生存时间（TTL）：8bit，数据报在网络中可通过的路由器数的最大值，也就是数据报的寿命，限制数据报的无限转发。路由器转发数据报前都要使得TTL–，减到0时丢弃。</li><li>协议：8bit，指出携带的数据使用何种协议，应当上交给哪个协议处理。6：TCP     17:UDP</li><li>首部检验和：16bit，但是只检验首部不包括数据。经过一次路由器都要重新计算一次。</li><li>源地址字段：发送方  目的地址字段：接收方  都是IP地址，都占4B</li></ul><table><thead><tr><th>字段基本单位</th><th>首部长度</th><th>总长度</th><th>片偏移</th></tr></thead><tbody><tr><td>偏移量</td><td>4B</td><td>1B</td><td>8B</td></tr></tbody></table><h2 id="IP数据报分片"><a href="#IP数据报分片" class="headerlink" title="IP数据报分片"></a>IP数据报分片</h2><p><strong>最大传送单元（MTU）</strong>：</p><ul><li>一个链路层数据帧能承载的最大数据量。链路层MTU严格限制IP数据报长度。</li><li>取决于链路层协议。 以太网MTU：1500B      许多广域网：&lt;&#x3D;576B</li><li>IP数据报总长度超出MTU时需要分装在多个较小IP数据报中，也就是分片。</li></ul><p><strong>分片重组：</strong></p><ul><li><p>目的主机使用IP首部中的标识、标志和片偏移字段完成重组。</p></li><li><p>过程：目的主机检查数据报的<code>标识号</code>确定哪些数据报属于同一个原始数据报的片。<code>标志位</code>的后两位DF和MF。 </p><ul><li>只有DF&#x3D;0时能被分片。</li><li>MF告知是否是最后一个片。MF&#x3D;1说明有后续。</li><li>片偏移字段指出片应该放在原书IP数据报的哪个位置。</li></ul></li></ul><h2 id="IPv4地址"><a href="#IPv4地址" class="headerlink" title="IPv4地址"></a>IPv4地址</h2><p><strong>概述：</strong>  长度为32，唯一。格式为： {&lt;网络号&gt;，&lt;主机号&gt;}     </p><ul><li>网络号：标志主机&#x2F;路由器连接到的网络。网络号在整个互联网范围内唯一。   </li><li>主机号：标志主机。在网络号指明的网络范围内唯一。</li></ul><p><strong>特殊用途IP地址：</strong></p><table><thead><tr><th>地址</th><th>用途</th></tr></thead><tbody><tr><td>主机号全0</td><td>表示本网络本身。&lt;网络号，0…&gt;</td></tr><tr><td>主机号全1</td><td>表示本网络广播地址（直接广播地址） &lt;网络号，255&gt;</td></tr><tr><td>127.x.x.x</td><td>环回自检地址(Loopback Test)，用于测试网络连接性和配置，不会被路由器转发到其他网络。目的地址为环回地址的IP数据报永远不会也不可能出现在任何网络上。</td></tr><tr><td>全0：0.0.0.0</td><td>本网络上的本主机</td></tr><tr><td>全1：255.255.255.255</td><td>表示整个TCP&#x2F;IP网络的广播地址，也称受限广播地址。实际等效于本网络广播地址。</td></tr></tbody></table><p><strong>三种IP地址：</strong></p><table><thead><tr><th>网路类别</th><th>最大可用网络数</th><th>第一个可用的网络号</th><th>最后一个可用的网络号</th><th>每个网络中的最大主机数</th></tr></thead><tbody><tr><td>A</td><td>2^7-2</td><td>1</td><td>126</td><td>2^24-2</td></tr><tr><td>B</td><td>2^14</td><td>128.0</td><td>191.255</td><td>2^16-2</td></tr><tr><td>C</td><td>2^21</td><td>192.0.0</td><td>223.255.255</td><td>2^8-2</td></tr></tbody></table><p><strong>IP地址特点：</strong></p><table><thead><tr><th>IP地址特点</th><th>概述</th></tr></thead><tbody><tr><td>一种分等级地址结构</td><td>由网络号和主机号构成。IP地址管理机构只分配网络号，主机号有网络自行分配，便于管理。路由器仅根据主机的网络号来转发分组，减少路由表存储占用。</td></tr><tr><td>标志主机或链路接口</td><td>同时连接到两个不同的网络时必须同时具有两个相应IP地址，这时路由器具有两个或以上的IP地址，每个端口都有不同网络号的IP地址（因为是不同网络</td></tr><tr><td>LAN中</td><td>转发器&#x2F;桥接器（网桥等）连接的若干LAN仍是同一个网络，同一个广播域。在LAN中所有主机网络号相同（同一网络），主机号必须不同（不同个体）</td></tr><tr><td>网络平等</td><td>所有分配到网络号的网络平等</td></tr><tr><td>同一局域网</td><td>IP地址里的网络号必须相同</td></tr><tr><td>注意点</td><td>分类编址问题中，划分网络的时候，注意要同时把一群主机连接路由器也划到这群主机里。如下所示：这个网络需要254+1&#x3D;255个地址</td></tr></tbody></table><h2 id="NAT网络地址转换"><a href="#NAT网络地址转换" class="headerlink" title="NAT网络地址转换"></a>NAT网络地址转换</h2><p>**概述：**通过专用网络地址转换为公用地址，从而对外隐藏内部管理的IP地址。</p><ul><li>意义：整个专用网只需要一个全球IP地址就可和互联网</li></ul><p>**私有IP地址(可重用地址)：**用于LAN，不用于WAN</p><ul><li>不能直接用于Internet，必须通过网关利用IP地址转换为Internet中合法的全球IP地址。</li><li>并且允许私有IP地址被LAN重复使用。</li><li>互联网中所有路由器对目的地址为私有地址的数据报一律不进行转发。</li></ul><table><thead><tr><th>类别</th><th>私有IP地址网段</th></tr></thead><tbody><tr><td>1个A类网段</td><td>10.0.0.0~10.255.255.255</td></tr><tr><td>16个B类网段</td><td>172.16.0.0~172.31.255.255</td></tr><tr><td>256个C类网段</td><td>192.168.0.0~192.168.255.255</td></tr></tbody></table><p>**专用互联网：**也称本地互联网，即采用私有IP地址的互联网。</p><p><strong>使用NAT：</strong></p><ul><li>需要在专用网–&gt;互联网的路由器上安装NAT软件。</li><li>NAT路由器至少有一个有效的外部全球IP地址。可使多个私有IP映射到一个全球IP。</li><li>NAT路由器使用NAT转换表进行本地IP地址到全球IP地址的转换</li><li>NAT转换表示例： 每个 LAN 局域网 IP 地址 : 端口号 , 与 WAN 广域网 IP 地址 : 端口号 的对应关系 </li><li>WAN 广域网地址 172.38.1.5 : 44444 , 对应 LAN 局域网地址 192.168.0.3 : 22222</li></ul><ul><li>网段：10.0.0.0&#x2F;8, 172.16.0.0&#x2F;12, 192.168.0.0&#x2F;16</li></ul><p><strong>NAT路由器工作原理</strong>：</p><ol><li>某家庭获得一个全球IP地址，家庭里的三台主机使用私有地址（10.0.0.0网段）。</li><li>用户主机10.0.0.1想发送数据到128.119.40.186:80 ；</li><li>NAT为IP分组生成新端口号，更改源地址为NAT的全球IP地址，更改源端口号为新端口号，并增加表项；</li><li>对方不知道分组已经变换，也不知道专用地址是多少，照常返回数据；</li><li>NAT重新转换，改回原来的端口号和原来的专用地址。</li></ol><h2 id="划分子网-（目的是减少广播域的大小，结果是增加网络数量）"><a href="#划分子网-（目的是减少广播域的大小，结果是增加网络数量）" class="headerlink" title="划分子网 （目的是减少广播域的大小，结果是增加网络数量）"></a>划分子网 （目的是减少广播域的大小，结果是增加网络数量）</h2><p>**概述：**两级IP地址的空间利用率低；给每个网络都划分一个网络后会使得路由表变得过大，降低性能。【改进】增加“子网号字段”，这就得到了三级IP地址。</p><p><strong>基本思路：</strong></p><ol><li>子网划分是内部事务，外部并不知道</li><li>从主机号借用若干位作为子网号。 地址结构变为&lt;网络号&gt;,&lt;子网号&gt;,&lt;主机号&gt;</li><li>路由器的分组转发仍然是按照目的网络号。 只是本单位路由器收到IP数据报后再次根据目的网络号和子网号找到目的子网，然后交付给目的主机。</li></ol><p><strong>子网掩码：</strong></p><ul><li><p>格式：一个与IP地址相对应的32位二进制比特串，由一串1和随后的一串0组成。1对应于IP地址中的网络后及子网号，0对应主机号。</p></li><li><p>用法：由IP地址和子网掩码进行与**（<strong><strong>AND</strong></strong>）**运算可以得出相应的子网的网络地址。</p><p>指明分类IP地址的主机号部分被借用了多少位作为子网号。</p></li><li><p>注意点</p><ul><li>路由器之间交换路由信息时必须将所在网络的子网掩码告诉对方</li><li>一台主机在设置IP地址信息的同时必须设置子网掩码。</li><li>同属于一个子网的所有主机及路由器的相应端口设置相同的子网掩码</li><li>路由器的路由表包含目的网络地址、子网掩码、下一跳地址</li></ul></li></ul><h2 id="无分类编址CIDR-无分类域间路由选择-CIDR无类别域间路由"><a href="#无分类编址CIDR-无分类域间路由选择-CIDR无类别域间路由" class="headerlink" title="无分类编址CIDR (无分类域间路由选择) CIDR无类别域间路由"></a>无分类编址CIDR (无分类域间路由选择) CIDR无类别域间路由</h2><p>**CIDR概述：**在变长子网掩码的基础上提出的一种消除传统A B C类地址及划分子网的概念。使用网络前缀的概念代替网络的概念。分配一个【块】，而不是分配一整类地址。</p><ul><li>与传统分类IP地址的最大区别：网络前缀的位数不固定，可以任意选取</li></ul><p>**记法：**IP地址&#x3D; &lt;网络前缀&gt;, &lt;主机号&gt;</p><p><strong>斜线记法(CIDR记法)</strong>：“IP地址&#x2F;网络前缀所占用的位数”</p><ul><li><p>网络前缀所占用位数对应网络号部分 &#x3D;&#x3D;子网掩码中连续1的部分</p></li><li><p>eg. 128.14.32.5&#x2F;20     掩码为20个连续的1以及随后12个连续的0,“&#x2F;”表示通过逐位“与”的方式来得到该地址的网络前缀。丫就是截取前20位。</p><p>这个IP地址可以写成10000000.00001110.00010000.00000101（写成二进制），子网掩码20为11111111.11111111.11110000.00000000（20个1），与后得到128.14.32.0（网络前缀）</p></li><li><p>可以进一步计算这个IP地址所在地址块的范围（地址块里的最小地址和最大地址）</p><table><thead><tr><th>最小地址(128.14.32.0)</th><th>最大地址(128.14.47.255)</th></tr></thead><tbody><tr><td><u>10000000.00001110.0010</u>0000.00000000</td><td><u>10000000.00001110.0010</u>1111.11111111</td></tr></tbody></table></li><li><p>注意点</p><ul><li>CIDR地址块中的地址数一定是2的整次幂。故可指派地址数一般为2^N-2 （剔除全0和全1）</li><li>地址块里的地址数越多，则网络前缀也就越短</li></ul></li></ul><h2 id="路由聚合-也称构成超网"><a href="#路由聚合-也称构成超网" class="headerlink" title="路由聚合(也称构成超网)"></a>路由聚合(也称构成超网)</h2><p><strong>概述：<strong>路由表中可以利用CIDR地址块来查找目的网络。这种</strong>地址的聚合</strong>称为路由聚合。</p><p><strong>作用</strong>：使路由表中一个项目可以表示多个 原本传统分类地址 的路由，减少路由之间的信息交换，通过网络性能。 （基于CIDR的视角来合并部分网络的路由表项）</p><p><strong>分析</strong>：不使用路由聚合，那么R1到网络1和网络2需要两条路由表项；注意到R1到两个网络的下一跳都是R2，网络1和网络2前16位相同（可以构成一个更大的地址块206.1.0.0&#x2F;16）</p><p><strong>最长前缀匹配</strong>：（也叫最佳匹配）使用CIDR时路由表各项由“网络前缀”和“下一跳地址”组成，查找路由表时可能会得到不止一个匹配结果。应当从匹配结果中<strong>选择具有最长网络前缀的路由</strong>（地址块越小，路由越具体）。</p><ul><li><p>途径：通常<strong>将无分类编制路由表存放在</strong>一种<strong>层次数据结构</strong>中（二叉线索），自上而下查找。</p></li><li><p>采用CIDR编制，可以按照前缀的长短把前缀最长的放在第一行。只有检索到匹配的就停止检索。</p></li></ul><h2 id="子网划分方法：定长的子网掩码，变长的子网掩码"><a href="#子网划分方法：定长的子网掩码，变长的子网掩码" class="headerlink" title="子网划分方法：定长的子网掩码，变长的子网掩码"></a>子网划分方法：定长的子网掩码，变长的子网掩码</h2><h3 id="定长子网掩码"><a href="#定长子网掩码" class="headerlink" title="定长子网掩码"></a>定长子网掩码</h3><p><strong>概述：</strong></p><ol><li>各子网使用相同的子网掩码。 </li><li>各子网分配的IP地址数量相同（造成地址资源的浪费）</li></ol><p><strong>过程：</strong></p><ol><li>某单位拥有一个CIDR地址块208.115.21.0&#x2F;24  不难看出主机号占最后八位</li><li>划分子网。 有4个单位，则划分成4个子网。从主机号的高位借两位作为子网划分。</li><li>现在主机号还剩下6位。这样每个子网可分配的地址数为2^8-2</li></ol><h3 id="变长的网络掩码划分子网"><a href="#变长的网络掩码划分子网" class="headerlink" title="变长的网络掩码划分子网"></a>变长的网络掩码划分子网</h3><p>**概述：**每个子网可以使用不同的子网掩码。并且每个子网所分配的IP地址数量可以不同。</p><p><strong>过程：</strong></p><ol><li><p>某单位拥有一个CIDR地址块208.115.21.0&#x2F;24  不难看出主机号占最后八位。要划分给三个部门。</p></li><li><p>部门1的主机号需要6位，剩下26位作网络前缀。部门2需要5位，剩下27位作前缀。部门3的主机号需.位，剩余29位作前缀。</p></li><li><table><thead><tr><th>地址范围</th><th>划分方法</th></tr></thead><tbody><tr><td><u>208.115.21.00</u>000000 ~ <u>208.115.21.00</u>111111</td><td></td></tr><tr><td><u>208.115.21.010</u>00000 ~ <u>208.115.21.010</u>11111</td><td></td></tr><tr><td><u>208.115.21.01100</u>000 ~ <u>208.115.21.01100</u>111</td><td></td></tr><tr><td><u>208.115.21.010</u>00000 ~ <u>208.115.21.010</u>11111</td><td></td></tr></tbody></table></li><li><p>这种划分方案从大的开始划。部门1需要6位主机号，所以有2^6-2&#x3D;62个可分配地址，剩下2位用来划分子网，并且部门1为00.</p></li></ol><h2 id="网络层转发过程"><a href="#网络层转发过程" class="headerlink" title="网络层转发过程"></a>网络层转发过程</h2><p>**概述：**分组转发基于目的主机所在网络（压缩转发表大小），<strong>转发表信息 (目的网络地址，下一跳地址)</strong>，路由器根据IP地址的网络前缀来查表找到下一跳地址。</p><p><strong>两种特殊路由：</strong></p><ul><li><p>【特定主机路由】对特定目的主机的IP地址专门指明一个路由。</p><p>作用：方便管理员控制和测试网络</p></li><li><p>【默认路由】用特殊前缀0.0.0.0&#x2F;0表示默认路由。 当目的网络是其他网络(不是自身)也不在转发表中就一律选择默认路由</p><p>作用：通常用于路由器到互联网的路由（因为路由表不可能包含互联网上所有路由）</p></li></ul><p><strong>路由器分组转发算法：</strong></p><ol><li>从IP分组首部提取目的目的主机的IP地址</li><li>查找【特定主机路由】，找得到则按照这一项转发；找不到则开始按前缀长度顺序查找</li><li>对于查找中的一行，将【一行的子网掩码】与【目的地址】逐位【与】（AND），如果与结果和这一行的前缀匹配，结束查找。按下一跳转发。否则继续找下一行。</li><li>如果有一个【默认路由】，就传递给默认路由，没有，则【转发分组出错】。</li></ol><p><strong>注意：</strong></p><ul><li>因为转发表只给出下一跳地址，并非完整路径，所以传到一个路由器都要查一次它的转发表</li><li><strong>！！ 得到下一跳IP地址后，将它通过ARP转换成MAC地址然后填到MAC帧首部，再根据这个MAC地址去找到下一跳的路由器</strong></li></ul><h2 id="IP地址与硬件地址"><a href="#IP地址与硬件地址" class="headerlink" title="IP地址与硬件地址"></a>IP地址与硬件地址</h2><p><strong>各种地址</strong>：</p><table><thead><tr><th>IP地址</th><th>MAC地址（硬件地址）</th></tr></thead><tbody><tr><td>网络层及之上使用的地址，是分层式的。位于IP数据报首部。IP数据报封装成MAC帧之后，数据链路层是看不见IP地址的。</td><td>在数据链路层使用，平面式的。位于MAC帧首部。</td></tr></tbody></table><p>**网络层寻址：**网络层只使用IP地址来寻址（因为路由器的隔离，无法通过广播MAC地址来跨网络寻址）。</p><p><strong>寻址过程：</strong></p><ol><li>寻址时，每个路由器依据它的路由表选择到<strong>目标网络需要转发到的下一跳</strong></li><li>IP数据报通过多次路由转发<strong>到达目标网络后</strong>改为在目标局域网中通过数据链路层的MAC地址以广播的方式寻址</li></ol><p><strong>性质：</strong></p><ol><li>在IP层抽象的互联网上只能看到IP数据报</li><li>IP数据报首部有源IP地址，但是路由器只使用目的IP地址来转发</li><li>局域网的链路层只能看到MAC帧，MAC帧中是封装的IP数据报。MAC帧首部的源地址和目的地址会不断地改变，因为IP数据报在每次转发过程中都会被拆解重新封装（路由器根据下一跳IP地址通过ARP转换成MAC地址填进MAC帧首部）</li><li>无法使用MAC地址跨网络通信。因为每次转发都要修改MAC地址，如上所述。</li><li>IP层抽象的互联网屏蔽了下层复杂的细节，在网络层上可以使用统一抽象的IP地址来研究不同主机的通信</li></ol><h2 id="ARP-地址解析协议"><a href="#ARP-地址解析协议" class="headerlink" title="ARP  地址解析协议"></a>ARP  地址解析协议</h2><p><strong>ARP概述：</strong></p><ol><li>一种方法，旨在完成IP地址到MAC地址的映射。如果目的主机和源主机不在同一个局域网上，要通过ARP找到本局域网的某个路由器硬件地址，发分组传给它，并由这个路由器把分组转发给下一个网络。</li><li>ARP工作在网络层（看得见IP地址）；NAT工作在传输层（看得见端口）.</li></ol><p><strong>ARP表：<strong>每个主机都有的一个ARP高速缓存，存放</strong>本局域网</strong>上各主机和路由器的IP地址到MAC地址的映射表</p><p>**原理：**A向本局域网主机B发送IP数据报：  （ARP请求分组：<code>广播发送</code>  ARP响应分组：<code>单播发送</code>）</p><ol><li>查ARP高速缓存，如果有B的IP地址，直接得到对应硬件地址，把它写入MAC帧，并发送给B</li><li>如果没有，通过使用目的MAC地址为FF-FF-FF-FF-FF-FF的帧封装和广播ARP请求分组。所有主机都会收到ARP请求。</li><li>B收到后向A发送ARP响应分组，在分组里告诉A它(B)的IP地址和MAC地址映射关系，这样A可以写入它的ARP缓存，从而发送MAC帧</li></ol><p><strong>补充：</strong></p><ul><li>ARP用来解决同一局域网主机&#x2F;路由器的IP地址和硬件地址映射问题。不在一个局域网，则通过ARP找到某个路由器的硬件地址，发给这个路由器，让它转给下一个网络。</li><li>IP地址到硬件地址的解析自动进行，用户并不知道。</li><li>主机或路由器和本网络另一个已知IP地址的主机或路由器进行通信时，ARP自动将IP地址解析成数据链路层需要的硬件地址</li></ul><h2 id="动态主机配置协议-DHCP"><a href="#动态主机配置协议-DHCP" class="headerlink" title="动态主机配置协议 DHCP"></a>动态主机配置协议 DHCP</h2><p><strong>DHCP概述：</strong></p><ol><li>用于给主机动态地分配IP地址。</li><li>提供即插即用的联网机制，允许一台计算机加入新的网络和自动获取IP地址</li><li>应用层协议（通过客户&#x2F;服务器模式工作），基于UDP</li></ol><p><strong>工作原理：</strong></p><ol><li>使用客户&#x2F;服务器模型</li><li>需要IP地址的主机启动时向【DHCP服务器】广播发送【发现报文】，从而成为【DHCP客户】；</li><li>所有主机都能收到这个广播报文，但是只有【DHCP服务器】可以回答。</li><li>【DHCP服务器】在自己的数据库里查找这台主机的配置信息，找得到返回，找不到则从服务器的IP地址池中取一个地址分配给这台计算机。</li><li>【提供报文】DHCP服务器的回答报文。</li></ol><p><strong>过程：</strong></p><ol><li>DHCP客户广播发现报文（源地址0.0.0.0，目的地址255.255.255.255）</li><li>服务器收到这个广播报文，广播【提供报文】，这里面包括给DHCP客户的IP地址，报文源地址为DHCP服务器地址，目的地址为255.255.255.255</li><li>DHCP客户收到提供报文，如果接受这个IP地址，就需要广播“DHCP请求”给DHCP服务器。源地址0.0.0.0，目的地址255.255.255.255（同1.）</li><li>DHCP服务器广播“DHCP确认”消息，把IP地址分配给这个客户。源地址目的地址同2.</li></ol><p><strong>注意点：</strong></p><ol><li>可以有多台DHCP服务器，可能有多个应答消息，但是DHCP客户只挑选其中一个（最先到达的）</li><li>DHCP分配给客户的IP地址是【临时的】，客户只能在【租用期】内使用，租用期由服务器决定，客户也可以在报文中提出租用期要求。</li><li>交互过程采用广播方式。采用UDP。</li></ol><h2 id="ICMP-网际控制报文协议"><a href="#ICMP-网际控制报文协议" class="headerlink" title="ICMP 网际控制报文协议"></a>ICMP 网际控制报文协议</h2><p><strong>ICMP概述：</strong></p><ol><li>目的：有效转发IP数据报，提高交付成功机会。 </li><li>允许主机或路由器报告差错和异常情况</li><li>虽然ICMP报文封装在IP数据报中发送，但ICMP是依然是网络层协议。</li><li>ICMP报文有两种：【ICMP差错报告报文】【ICMP询问报文】</li></ol><p><strong>ICMP差错报告报文及其五种类型</strong>：用于目标主机或到目标主机路径上的路由器。目的是向源主机报告差错和异常情况。</p><ol><li>终点不可达：路由器&#x2F;主机不能交付数据时向源主机发送</li><li>源点抑制：路由器&#x2F;主机因为【拥塞】而丢弃数据报。 源点抑制报文告诉源点应该降低数据报的发送速率。</li><li>时间超过：<ul><li>路由器收到生存时间TTL为0的数据报，除丢弃这个数据报外还需要向源点发送时间超过报文。</li><li>终点在<strong>预先规定的时间内不能</strong>收到<strong>一个数据报</strong>的<strong>全部数据报片</strong>时，就把已收到的数据报片全部丢弃，然后向源点发送时间超过报文。</li></ul></li><li>参数问题：收到的数据报首部有的字段的值不正确，则丢弃并发送参数问题报文</li><li>改变路由（重定向）：告诉主机下次应该把数据报发送给另外的路由器，可通过更好地路由</li></ol><p><strong>ICMP差错报告报文不应该发送：</strong></p><p>​情况一：对ICMP差错报告报文不再发送ICMP差错报告报文</p><p>​情况二：第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报文</p><p>​情况三：对于具有多播地址的数据报都不发送ICMP差错报告报文</p><p>​情况四：对于特殊地址的数据报也不发送</p><p><strong>ICMP询问报文的四种类型</strong>：</p><ol><li>回送请求和回答报文</li><li>时间戳请求和回答报文</li><li>地址掩码请求和回答报文</li><li>路由器询问和通告报文</li></ol><p><strong>ICMP常见应用：</strong></p><ol><li>分组网间探测PING：测试两台主机间的连通性。工作在应用层，直接使用网络层的ICMP。</li><li>Traceroute：跟踪分组经过的路由。 工作在网络层。</li></ol><h2 id="4-2-习题查漏补缺"><a href="#4-2-习题查漏补缺" class="headerlink" title="4.2  习题查漏补缺"></a>4.2  习题查漏补缺</h2><p>一、IPv4计算首部检验和</p><ol><li>先把IP数据报首部划分为许多16位字的序列，并把检验和字段置零。把所有16位字相加后，将得到的和的反码写入检验和字段。</li><li>接收方收到数据报后，将首部的所有16位字再使用反码算术运算相加一次。将得到的和取反码，即得出接收方检验和的计算结果。</li><li>若首部未发生任何变化，则此结果必为0</li></ol><p>二、多IP：如果一个主机有两个以上的IP地址，那么这些IP地址应当属于不同的网络。所以他们的网络号一定不同。</p><h1 id="4-3-IPv6（从根本上解决地址耗尽问题）"><a href="#4-3-IPv6（从根本上解决地址耗尽问题）" class="headerlink" title="4.3 IPv6（从根本上解决地址耗尽问题）"></a>4.3 IPv6（从根本上解决地址耗尽问题）</h1><h2 id="IPv6特点"><a href="#IPv6特点" class="headerlink" title="IPv6特点"></a>IPv6特点</h2><table><thead><tr><th>特点</th><th>描述</th></tr></thead><tbody><tr><td>更大地址空间</td><td>从IPv4的32位增大到128位。 地址空间是前者的2^96倍。</td></tr><tr><td>灵活首部</td><td>IPv6首部长度固定，40B。选项放在有效载荷中，选项灵活可变（IPv4选项固定，放在首部可变部分.<strong>IPv4<strong><strong>的首部长度是可变的，必须是</strong></strong>4B****的整数倍</strong>）</td></tr><tr><td>允许协议扩充</td><td>允许不断扩充功能。IPv4固定</td></tr><tr><td>支持即插即用</td><td>也即自动配置。无需使用DHCP（动态主机配置协议 ，DHCP服务器&amp;DHCP客户）</td></tr><tr><td>分片</td><td>只有源主机才能分片，是端到端的。 不允许类似IPv4传输路径中的路由分片。</td></tr><tr><td>增大了安全性</td><td>身份鉴别和保密功能是IPv6的扩展首部</td></tr><tr><td>兼容性</td><td>IPv6与IPv4不兼容，但是与所有其他互联网协议兼容(TCP UDP ICMP IGMP DNS)</td></tr><tr><td>无首部检验和</td><td>IPv6协议没有首部检验和,这意味着攻击者无法通过篡改数据包来伪造或篡改数据,这有助于提高网络的安全性。     这一措施也加快了路由器处理数据报的速度。链路层会丢弃检测出差错的帧，并且传输层也有相应的差错处理机制，所以网络层额差错检测可以精简掉。</td></tr></tbody></table><h2 id="IPv6地址类型"><a href="#IPv6地址类型" class="headerlink" title="IPv6地址类型"></a>IPv6地址类型</h2><ol><li>单播</li><li>多播</li><li>任播(新增)</li></ol><h2 id="过渡技术"><a href="#过渡技术" class="headerlink" title="过渡技术"></a>过渡技术</h2><ol><li>双协议栈</li><li>隧道技术</li></ol><h1 id="4-4-路由算法和协议"><a href="#4-4-路由算法和协议" class="headerlink" title="4.4 路由算法和协议"></a>4.4 路由算法和协议</h1><h2 id="路由算法分类"><a href="#路由算法分类" class="headerlink" title="路由算法分类"></a>路由算法分类</h2><table><thead><tr><th>类型</th><th>特点</th><th>示例</th></tr></thead><tbody><tr><td>静态</td><td>手工配置</td><td>-</td></tr><tr><td>动态</td><td>自动调整</td><td>RIP, OSPF, BGP</td></tr></tbody></table><h2 id="路由协议对比"><a href="#路由协议对比" class="headerlink" title="路由协议对比"></a>路由协议对比</h2><table><thead><tr><th>协议</th><th>类型</th><th>特点</th></tr></thead><tbody><tr><td>RIP</td><td>距离向量</td><td>跳数限制15</td></tr><tr><td>OSPF</td><td>链路状态</td><td>支持分层区域</td></tr><tr><td>BGP</td><td>路径向量</td><td>AS间路由</td></tr></tbody></table><h1 id="4-5-IP多播"><a href="#4-5-IP多播" class="headerlink" title="4.5 IP多播"></a>4.5 IP多播</h1><h2 id="多播地址"><a href="#多播地址" class="headerlink" title="多播地址"></a>多播地址</h2><ul><li>IPv4：D类地址(224.0.0.0~239.255.255.255)</li><li>IPv6：FF00::&#x2F;8</li></ul><h2 id="多播协议"><a href="#多播协议" class="headerlink" title="多播协议"></a>多播协议</h2><ol><li>IGMP：组成员管理</li><li>多播路由协议：构建多播树</li></ol><h1 id="4-6-移动IP"><a href="#4-6-移动IP" class="headerlink" title="4.6 移动IP"></a>4.6 移动IP</h1><h2 id="关键概念"><a href="#关键概念" class="headerlink" title="关键概念"></a>关键概念</h2><ul><li>家乡代理</li><li>外地代理</li><li>转交地址</li><li>三角路由问题</li></ul><h1 id="4-7-网络层设备"><a href="#4-7-网络层设备" class="headerlink" title="4.7 网络层设备"></a>4.7 网络层设备</h1><h2 id="路由器功能"><a href="#路由器功能" class="headerlink" title="路由器功能"></a>路由器功能</h2><ul><li>连接异构网络</li><li>分组转发</li><li>路由选择</li><li>分隔广播域</li></ul><h2 id="路由表vs转发表"><a href="#路由表vs转发表" class="headerlink" title="路由表vs转发表"></a>路由表vs转发表</h2><table><thead><tr><th></th><th>路由表</th><th>转发表</th></tr></thead><tbody><tr><td>用途</td><td>路由选择</td><td>分组转发</td></tr><tr><td>生成</td><td>路由算法</td><td>从路由表得出</td></tr><tr><td>实现</td><td>软件</td><td>软件&#x2F;硬件</td></tr></tbody></table>]]></content>
      
      
      
        <tags>
            
            <tag> 408 </tag>
            
            <tag> 计算机网络 </tag>
            
            <tag> 网络层 </tag>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>开坑|计算机考研408专业课笔记</title>
      <link href="/2025/03/24/1954/"/>
      <url>/2025/03/24/1954/</url>
      
        <content type="html"><![CDATA[<p>2025年春天，我一站上岸了某华五计算机专硕。欣喜之余，我将准备初试期间所做的笔记都贴在这里，供诸位后来的登山者们参考学习。</p><p>预计更新顺序：</p><ul><li><input disabled="" type="checkbox"> 计算机网络<code>(3.24~3.31)</code></li><li><input disabled="" type="checkbox"> 计算机组成原理<code>(4.1~4.5)</code></li><li><input disabled="" type="checkbox"> 数据结构<code>(4.6~4.10)</code></li><li><input disabled="" type="checkbox"> 操作系统<code>(4.11~4.15)</code></li></ul><p>现在开始吧！</p>]]></content>
      
      
      
        <tags>
            
            <tag> 408 </tag>
            
            <tag> 计算机考研 </tag>
            
            <tag> 学习笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浪迹天涯</title>
      <link href="/2024/07/29/0021/"/>
      <url>/2024/07/29/0021/</url>
      
        <content type="html"><![CDATA[<p>这一个月来的实习真是令人心力憔悴，渐而使我愈发地有了逃离感。每天面对着堆积如山的实习工作和学习任务，我仿佛被压在巨石下的蚂蚁，挣扎着寻找一丝透气的空间。</p><p>不得不承认中█████研究院确实是一个大佬云集的地方，这里齐聚着各式各样人才，只是茶余饭后片刻的随想便已是我无法企及的高度。只可惜，每个人都是忙忙碌碌的，却又充满了希望，唯独我。</p><p>我总是一遍又一遍的思考着自己究竟想要什么——我并不是一个逆来顺受、安于现状的人，我仿佛就不是industrial engineering专业的人，更不是一个称手的研究助理：这不是理想中的生活，我只想跳出当下的圈子。</p><p>实习+学习的双重任务压得我喘不过气。我开始怀疑自己的选择，开始质疑自己的能力，甚至开始害怕面对未来。是否真的有勇气面对失败，就此，<strong>浪迹天涯</strong>，无人理解。</p><blockquote><p>寂寞与孤独，是亘古不变的主题。</p></blockquote><p>我只是一个微不足道的存在，一个在这个世界上挣扎求生的普通人。才刚踏上心灵的摆渡之旅，希望小小浪花不至将我吹翻，也不至触及礁石、湮入大海。</p><p>倘若我真的就这样开始了流浪，我将不再被那些无形的枷锁束缚。我将放下那些曾经让我窒息的期望和责任，去追寻那些真正让我心动的事物。我会走过繁华的城市，也会穿越寂静的乡村；我会在星空下许下愿望，也会在暴风雨中寻找庇护。</p><p>但也许，我将一直孤独地行走，直到世界的尽头。那时，我或许会明白，真正的自由不是逃避，而是在面对生活的重压时，依然能够保持内心的平静和坚定。</p><p>我会写下我的所见所闻；我会，</p><blockquote><p>浪迹天涯。</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 随笔 </tag>
            
            <tag> 感悟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>寻书</title>
      <link href="/2024/07/08/2317/"/>
      <url>/2024/07/08/2317/</url>
      
        <content type="html"><![CDATA[<p>我记得我小时候</p><p>我姐当时在██读高中她的房间很多闲书   就是消遣时间用的</p><p>我当时翻看就着迷了  文字虽然写的平淡无聊  文笔也很一般  就地摊小说水平  但是对于一个小学生来说</p><p>那里面的见闻让人心旷神怡</p><p>一拨人坐着竹筏游山玩水  然后桥头还点着灯火</p><p>那个时候光污染应该还没那么严重</p><p>其实这段事情我可能不会再想起来了，因为就是太久了</p><p>直到我看到这么一段词</p><blockquote><p>照野弥弥浅浪，横空隐隐层霄。<br>障泥未解玉骢骄，我欲醉眠芳草。<br>可惜一溪风月，莫教踏碎琼瑶。<br>解鞍欹枕绿杨桥，杜宇一声春晓。——《西江月·顷在黄州》</p></blockquote><p>它的序也写得特别好</p><blockquote><p>“及觉已晓，乱山攒拥，流水锵然，疑非尘世也。”</p></blockquote><p>我觉得这简直就是闲书中写的那个桂林</p><blockquote><p>乱山攒拥，流水锵然</p></blockquote><p>还有就是之前看词的时候，有一段写的是</p><blockquote><p>“帐底吹笙香吐麝，更无一点尘随马”</p></blockquote><p>这是刚刚下过雨，然后空气很湿润<br>马车跑过去没有一点灰尘</p><p><em>回复【当时下完雨还很凉快】  差不多就这种感觉</em></p><p>现在华北这边太██热了</p><p>那本小说里面写的就是  几个人就这样漂流远去</p><p>我原本觉得看这种书很俗的</p><p>但是里面那些内容，直到现在也是引人入胜的，就每个看过的人也会想去</p><p>不知道现在那边是不是两岸全是那种光污染</p><p>那本小说很久以前得了，估计也是一零年左右写的</p><p>现在去应该难找到同一种感觉</p><p>其实，我更希望自然人文景点还是能保持最初的样子</p><p>现在的茶峒也不是以前那个茶峒了</p><p>我记得他们那个时候还是傍晚，两岸还有那种灯火，竹筏开出去，离岸边远了，四处慢慢暗下来，直到伸手不见五指</p><p>然后他们就互相问对方怕不怕</p><p>……</p><p>甲辰年辛未月于北京</p>]]></content>
      
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 随笔 </tag>
            
            <tag> 回忆 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>半年志</title>
      <link href="/2024/06/25/2338/"/>
      <url>/2024/06/25/2338/</url>
      
        <content type="html"><![CDATA[<p>时间过得真快啊！还来不及为春节题文，一眨眼已是年中了。</p><blockquote><p><em>这一学期所学的课程，…</em></p></blockquote><p> 能够掌握专业知识和技能，必然是极好的。只是，在我愈发的深入了解██这个专业后，我逐渐产生了逃离感，愈发地向自己发问：这真的是我想要的生活吗？又或许从高考填志愿就已经注定了。我在大二的时候有过转专业的想法，但最终还是为了一年的沉没成本想着暂且读下去。这份遗憾自高考录取起，雪藏了三年，兜兜转转又回到了原点。直至癸卯年腊月的某一个下午，初见██的那怦然心动的一刻，我心里大抵也有了想法——████。但囿于21级各大改革的阵痛，这一个学期的复习并不顺利。毕竟要学许许多多新的东西。眼下繁多的课程及学校布置的任务，以及突然延长的强制生产实习，留给我复习的时间已经不多了。</p><p> 最后，回顾整个学期。2024年悄然过半，又到了写半年志的时候。真正地提起了笔，静待思绪涌现，沉默良久后又作罢。依旧是兵荒马乱的半年，曾几何时，我耗费了太多的时间在一些或有意义或无意义的事情上。悟已往之不谏，知来者之可追。既然选择了这条路，就应当坚定走下去，何必欸奈路途艰难。希望馀下的这半年岁月里我们都能成长成为更好的人，“縱浪大化裡，不喜亦不懼”。</p><p>甲辰年庚午月于北京</p>]]></content>
      
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 随笔 </tag>
            
            <tag> 感悟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2024年美赛</title>
      <link href="/2024/02/07/2150/"/>
      <url>/2024/02/07/2150/</url>
      
        <content type="html"><![CDATA[<p><strong>2024年5月更新</strong></p><p>最后是<strong>Honorable Winner</strong>.</p><hr><p><strong>以下是原文：</strong></p><blockquote><p>回家后就没怎么学，四天时间三个人随便做了做，本来已经打算开摆了，编程建模写论文都粘点。  好歹是场比赛，这几日一直为之心力憔悴，开个贴记录一下。下面是论文部分内容。</p></blockquote><h2 id="Too-close-to-call-The-Impact-of-Momentum-Changes"><a href="#Too-close-to-call-The-Impact-of-Momentum-Changes" class="headerlink" title="Too close to call? The Impact of Momentum Changes"></a>Too close to call? The Impact of Momentum Changes</h2><h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>In an intense tennis match, even a world-renowned and experienced veteran may fail to grasp the momentary reversal of the situation and lose miserably. Thus, capturing the factors affecting match points and situation changes, and verifying the potential momentum effects that may exist in a match are of great significance in improving the athletes’ ability to cope with the match as well as formulating the next sentence of the match strategy. Starting from this phenomenon, this paper constructs a series of models to model players’ performance as well as momentum, and to verify the impact that different factors may have on the situation.</p><p>Before the modeling begins, through the analysis and preprocessing of the tennis match data in the annex Wimbledon-featured matches, we consider the relevant factors and normalize them, so as to facilitate the subsequent processing and quantification of the data.</p><p>For problem 1, as the opening question of this modeling exercise, we need to find the factors related to ”performance”, build a corresponding model, and visualize the performance of the athletes and the process of the game. We use several classification models for testing, select the best one, and then use accuracy, recall, precision and other indicators to conduct in-depth testing and evaluation of the model, and finally visualize the performance of athletes.</p><p>For problem 2, this paper mainly quantifies the index of ”momentum”, transforms the model from a theoretical existence of material into a part that can be practically solved, so as to compare it with the results of the game obtained in the previous question, and judge whether the index of ”momentum” is random or not. We compare it with the results of the previous question to determine whether the indicator ”momentum” is random or not. For this model, we firstly use the entropy weight method to determine the weight of each variable that may affect the momentum, and then use the Spearman correlation analysis to determine the degree of influence of the ”momentum” on the game, in addition, we carry out the S-W test and the K-S test on the index, and then we determine whether the swing and the success of the game are random or not.</p><p>In addition, the S-W test and the K-S test were performed on the indicators, and in summary, it was determined whether the swing and success in the game were randomized, which further proved that there was a certain influence of ”momentum” by proving that the selected variables did not satisfy the randomness distribution. In this problem, the result of correlation analysis is 0.334, which can show that there is a weak correlation between ”momentum” and the result of the game, which has a certain influence on the result, not random as the coach said.</p><p>For question three, the focus is to establish a model to predict the fluctuation of the game, this paper is based on the previous two questions, through the logistic regression to obtain the conversion point of the performance function, so as to determine the key moment of the situation change, and use the KNN method and the BP neural network to support the evidence. Finally, the data of multi-set matches are used to inversely verify the effectiveness of the model. For the determination of the most relevant factors, a combination of metrics derived from the first two questions is used and a heat analysis graph of the correlation is given. Recommendations are finally given based on those metrics, aiming to provide insight into the player’s momentum changes in different match situations and support for future matches.</p><p><strong>Keywords: Machine Learning, Momentum, Correlation Analysis, Entropy Weighting Method, Logistic Regression</strong></p><h3 id="Model-Overview"><a href="#Model-Overview" class="headerlink" title="Model Overview"></a>Model Overview</h3><p>Specifically, our work is organized in the following order:</p><p>First, we preprocessed the dataset and selected&#x2F;constructed 14 variables for modeling. We selected the XGboost classification model with the best predictive performance from several methods for modeling, and the trained model can predict whether a player will perform well or poorly at a given moment based on the given 14 variables.</p><p>Then, we consider the possible impact of momentum on the game trend, select the key six variables to construct the momentum function, and combine with the entropy weighting method to get the variable weights by calculating the impact of the selected indicators on the game scores; in addition, the indicators are subjected to the S-W test and the K-S test, and synthesized to determine whether the swings and successes in the game are random or not.</p><p>Third, we set out on the basis of the first two steps , through the logistic regression method to obtain the key thresholds of the performance function, modeling the performance of the players to get the specific moments of the situation shift, combined with the amount of change in the momentum of the players to determine the dominant side.</p><p>Finally, we analyze, validate and evaluate the constructed model.</p><p><img src="/2024/02/07/2150/ourwork.jpg" alt="Our Work"></p><h3 id="Task-1"><a href="#Task-1" class="headerlink" title="Task 1"></a>Task 1</h3><p><img src="/2024/02/07/2150/modelcmp.png"></p><p>![ROC Curve](ROC Curve.jpg)</p><p><img src="/2024/02/07/2150/pef.png"></p><p><img src="/2024/02/07/2150/1.jpg"></p><p><img src="/2024/02/07/2150/2.jpg"></p><h3 id="Task-2"><a href="#Task-2" class="headerlink" title="Task 2"></a>Task 2</h3><p>复制到md里不太方便，直接贴图片</p><p><img src="/2024/02/07/2150/121.png"></p><p><img src="/2024/02/07/2150/122.png"></p><p><img src="/2024/02/07/2150/123.png"></p><p><img src="/2024/02/07/2150/124.png"></p><h3 id="Task-3"><a href="#Task-3" class="headerlink" title="Task 3"></a>Task 3</h3><p><img src="/2024/02/07/2150/131.png"></p><p><img src="/2024/02/07/2150/132.png"></p><h3 id="meme"><a href="#meme" class="headerlink" title="meme"></a>meme</h3><blockquote><p>To: Darren Cahill and other great tennis coaches</p><p>From the team: 2430080</p><p>Date: February 6, 2024</p><p>Subject: Analysis of article and strategies for further research</p><p>In today’s tennis world, in addition to improving the technical and physical conditioning of the players, it is also very important to optimize the players’ game conditioning so that they can win at the right time with a bang or rationalize their own physical strength. In this article, we aim to quantify the factor of ”momentum” and identify its important role in the game, so as to formulate appropriate strategies for your reference and use in your work.</p><p>By sifting through some of the Wimbledon Grand Slam match data, such as scores, serves, points, errors, etc., our team has developed a process and metrics that can be used to analyze and predict a player’s form over time, which will help you determine which metrics have the greatest impact on a player’s ”momentum” and form. We will walk you through the specifics of how to do this analysis and provide you with further specific recommendations.</p><p>Our methodology :</p><p>We used a machine learning model, with a focus on the xgboost model to process the data.</p><ul><li>using the xgboost model in the ROC curve to draw, ROC curve refers to receiver operating characteristic curve, is to reflect the sensitivity and specificity of the continuous variables of the composite index. The curve is drawn with sensitivity as the vertical coordinate and specificity as the horizontal coordinate, and the larger the area under the curve, the higher the diagnostic accuracy. On the ROC curve, the point closest to the upper left of the coordinate graph is the critical value where both sensitivity and specificity are high.</li><li>Standardize and normalize the needed indicators, and represent the serve, score, error, and net in a normalized way, so as to facilitate the comparison and processing. Then using the model of logistic regression, we predicted our model, and came up with some fluctuations in the game at the point of time with the current emergence of the world, and give the prediction.</li></ul><p>Findings and Recommendations of the Study :</p><ul><li>in the process of the game, if the opponent has a continuous score, a period of time more winning points, more points in front of the net and other indicators with a strong correlation with the ”momentum”, should be timely proposed pause, slow down the opponent’s offensive rhythm.</li><li>in the game, should be based on the characteristics of different opponents to take different tactics. When facing the opponent with strong explosive power and fierce offense, you can properly avoid his front, save energy, and start to make efforts to beat the opponent when his ”momentum” appears to be declining. If you are facing an opponent with low momentum in the opening round, you can score consecutive points to keep his momentum low and beat him quickly.</li></ul><p>Our long-term recommendations are as follows:</p><ul><li>In normal training, the quality of serve and the scoring rate should be further improved. According to the model, the serve has a greater impact on the player’s ”momentum” and scoring, so it should be practiced more often.</li><li>should be carried out on the player pressure training and psychological counseling and<br>other measures, to avoid the ”momentum” brought about by the decline of the economic level of a substantial decline. At the same time, we should analyze the time period for the player to enter the state, and extend or change it appropriately.</li></ul><p>We thank you for your time and consideration, and hope that you will adopt our suggestions so that more players can realize their talents and become stronger. </p><p>Sincerely</p><p>Team 2430080</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 数学建模 </tag>
            
            <tag> 机器学习 </tag>
            
            <tag> 竞赛 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>抓住2023的小尾巴</title>
      <link href="/2023/12/31/2342/"/>
      <url>/2023/12/31/2342/</url>
      
        <content type="html"><![CDATA[<p>一眨眼2023居然马上就要结束了。我在慌乱之中拿起了笔，总想写些什么，沉默良久后又作罢。</p><p>一个荒诞的考期，一个兵荒马乱的周末。曾几何时，我耗费了太多的时间在一些或有意义或无意义的事情上。来到这里两年有余，却依旧难以洗去当初的锐气。我想做许许多多的事，见识许许多多的人，只可惜2023将要过去，我只能存有遗憾地等待又一年了。</p><p>惊险、多梦、神奇，是我在这一年末留存的最后念头。期待新的一年里我们都能成长成为更好的人，縱浪大化裡，不喜亦不懼。</p><p>谨以此文，纪念我的2023.</p>]]></content>
      
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 随笔 </tag>
            
            <tag> 年终总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>最后一堂课</title>
      <link href="/2023/12/10/2113/"/>
      <url>/2023/12/10/2113/</url>
      
        <content type="html"><![CDATA[<blockquote><p>工程数学导论，张老师很喜欢Gilbert strang。 他说我们可以不去上他的课，能去ocw mit看Gilbert strang的课更好。</p><p>Gilbert Strang有着独特的魅力，不光是张老师，世人都很崇拜他。 然后同样是最后一堂课，老师采取了同样的结课方式来向他致敬。BTW, Gilbert在前段时间退休了。</p><p>不过，这个教室还是太旧了，我觉得其实可以换一个教室的，拍照效果会更好一些 （</p></blockquote><p><img src="/2023/12/10/2113/classmit.jpg" alt="mit"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 随笔 </tag>
            
            <tag> 大学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>11月12日</title>
      <link href="/2023/11/12/1620/"/>
      <url>/2023/11/12/1620/</url>
      
        <content type="html"><![CDATA[<p>天气不错！</p><p><em><strong>Lazy sunny day</strong></em> ~ ~</p><p><img src="/2023/11/12/1620/dairy_11%E6%9C%8812%E6%97%A5.jpg" alt="窗外风景。PS:在图书馆六楼东中文阅览室，窗边有一排小圆桌。倘若天气晴朗，坐在桌边，只一转头、轻松便能望到很远很远的地方。冬日的阳关柔和，即便没有百叶窗的遮拦，也不会感到刺眼。这大概是能让我在慵懒的周末从床上爬起来的最大动力了吧:) "></p>]]></content>
      
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 随笔 </tag>
            
            <tag> 记录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Data Analysis-Week9~week13</title>
      <link href="/2023/05/15/2239/"/>
      <url>/2023/05/15/2239/</url>
      
        <content type="html"><![CDATA[<h1 id="Week-9"><a href="#Week-9" class="headerlink" title="Week 9"></a>Week 9</h1><blockquote><p>在数据分析中，常常需要迭代的内容数据量过大，无法一次性加载。例如，在图像相关的深度学习任务中，由于数据总量过大，一次性加载全部数据耗时过长、内存占用过大，因此一般会采用批量加载数据的方法。现提供文件FaceImages.zip(<a href="http://vis-www.cs.umass.edu/fddb/originalPics.tar.gz%EF%BC%8C%E5%85%B6%E4%B8%AD%E5%8C%85%E5%90%AB5000%E4%BD%99%E5%BC%A0%E4%BA%BA%E8%84%B8%E5%9B%BE%E7%89%87%E3%80%82%E8%A6%81%E6%B1%82%E8%AE%BE%E8%AE%A1FaceDataset%E7%B1%BB%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%A0%E8%BD%BD%E3%80%82%E5%85%B7%E4%BD%93%E8%A6%81%E6%B1%82%EF%BC%9A">http://vis-www.cs.umass.edu/fddb/originalPics.tar.gz，其中包含5000余张人脸图片。要求设计FaceDataset类，实现图片数据的加载。具体要求：</a></p><ol><li>该类至少有一个数据属性_path，来接收图片目录的路径，且该属性在实例化时通过参数来初始化。</li><li>该类有一个生成器方法image_generator，能够生成一张图片数据的ndarray形式并返回（利用PIL库实现）。</li><li>实现__iter__方法，使得该类支持迭代器相关的操作。</li><li>实现__next__方法，根据类内的图片路径列表，迭代地加载并以ndarray形式返回图片数据。</li><li>对上述生成器和迭代器相关的方法进行测试。</li><li>（附加）实现__len__方法，返回数据集中图片的数量。</li><li>（附加）实现__getitem__方法，使得该类的实例fd支持fd[i]的形式来获取第i+1个图片的ndarray。</li><li>（附加）该类有一个生成器方法image_representation_generator方法，可以利有预训练模型Vgg或Restnet来生成图片的向量表示。</li><li>（附加）尝试用预训练模型生成的向量来计算图片相似性（如两个向量之间的夹角等）。</li></ol></blockquote><h4 id="库"><a href="#库" class="headerlink" title="库"></a>库</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> keras_vggface.vggface <span class="keyword">import</span> VGGFace</span><br><span class="line"><span class="keyword">from</span> keras_vggface.utils <span class="keyword">import</span> preprocess_input</span><br><span class="line"><span class="keyword">import</span> tensorflow.python.keras.engine</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> sys</span><br></pre></td></tr></table></figure><h4 id="FaceDataset-类"><a href="#FaceDataset-类" class="headerlink" title="FaceDataset 类"></a><code>FaceDataset</code> 类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FaceDataset</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,path</span>):</span><br><span class="line">        <span class="variable language_">self</span>._path=path</span><br><span class="line">        <span class="variable language_">self</span>._file_list=[file <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(<span class="variable language_">self</span>._path)]</span><br><span class="line">        <span class="variable language_">self</span>._start=<span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>._length=<span class="built_in">len</span>(<span class="variable language_">self</span>._file_list)</span><br><span class="line">        <span class="variable language_">self</span>._idx=<span class="variable language_">self</span>._start</span><br><span class="line">        <span class="variable language_">self</span>._model=VGGFace(model=<span class="string">&#x27;vgg16&#x27;</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._idx &gt;= <span class="variable language_">self</span>._length:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            imgg_array=<span class="variable language_">self</span>.__getitem__(<span class="variable language_">self</span>._idx)</span><br><span class="line">            <span class="variable language_">self</span>._idx+=<span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> imgg_array</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>._file_list)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, idx</span>):</span><br><span class="line">        imgg=Image.<span class="built_in">open</span>(os.path.join(<span class="variable language_">self</span>._path,<span class="variable language_">self</span>._file_list[idx]))</span><br><span class="line">        imgg_data=imgg.getdata()</span><br><span class="line">        <span class="keyword">return</span> np.reshape(imgg_data,(imgg.height,imgg.width,<span class="built_in">len</span>(imgg.getbands())))</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_generator</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable language_">self</span>._file_list:</span><br><span class="line">            imgg=Image.<span class="built_in">open</span>(os.path.join(<span class="variable language_">self</span>._path,file))</span><br><span class="line">            imgg_data=imgg.getdata()</span><br><span class="line">            <span class="keyword">yield</span> np.reshape(imgg_data,(imgg.height,imgg.width,<span class="built_in">len</span>(imgg.getbands())))</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_representation_generator</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> file_path <span class="keyword">in</span> <span class="variable language_">self</span>._file_list:</span><br><span class="line">            imgg=Image.<span class="built_in">open</span>(os.path.join(<span class="variable language_">self</span>._path,file_path))</span><br><span class="line">            imgg_array=np.reshape(imgg.getdata(),(imgg.height,imgg.width,<span class="built_in">len</span>(imgg.getbands())))</span><br><span class="line">            pre_processed_imgg=preprocess_input(imgg_array)</span><br><span class="line">            pre_presented_imgg=<span class="variable language_">self</span>._model.predict(pre_processed_imgg)</span><br><span class="line">            <span class="keyword">yield</span> pre_presented_imgg</span><br></pre></td></tr></table></figure><h4 id="测试-next"><a href="#测试-next" class="headerlink" title="测试  __next__"></a>测试  <code>__next__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(): lib_path=<span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/originalPics/2002/07/20/big&#x27;</span></span><br><span class="line">    dataset=FaceDataset(lib_path)</span><br><span class="line">    <span class="keyword">for</span> image_array <span class="keyword">in</span> dataset:</span><br><span class="line">        <span class="built_in">print</span>(image_array.shape)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="测试-image-generator"><a href="#测试-image-generator" class="headerlink" title="测试  image_generator"></a>测试  <code>image_generator</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():        lib_path=<span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/originalPics/2002/07/20/big&#x27;</span></span><br><span class="line">    dataset=FaceDataset(lib_path)</span><br><span class="line">    <span class="keyword">for</span> image_array <span class="keyword">in</span> dataset.image_generator():</span><br><span class="line">        <span class="built_in">print</span>(image_array.shape)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="测试-len-和-getitem"><a href="#测试-len-和-getitem" class="headerlink" title="测试__len__ 和__getitem__"></a>测试<code>__len__</code> 和<code>__getitem__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">lib_path=<span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/originalPics/2002/07/20/big&#x27;</span></span><br><span class="line">    dataset=FaceDataset(lib_path)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(dataset))</span><br><span class="line">    <span class="built_in">print</span>(dataset[<span class="number">0</span>].shape)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="用预训练模型生成的向量来计算图片相似性"><a href="#用预训练模型生成的向量来计算图片相似性" class="headerlink" title="用预训练模型生成的向量来计算图片相似性"></a>用预训练模型生成的向量来计算图片相似性</h4><h6 id="增加库"><a href="#增加库" class="headerlink" title="增加库"></a>增加库</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics.pairwise <span class="keyword">import</span> cosine_similarity </span><br></pre></td></tr></table></figure><h6 id="修改FaceDataset中的部分方法"><a href="#修改FaceDataset中的部分方法" class="headerlink" title="修改FaceDataset中的部分方法"></a>修改<code>FaceDataset</code>中的部分方法</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FaceDataset</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_generator</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable language_">self</span>._file_list:</span><br><span class="line">            imgg=Image.<span class="built_in">open</span>(os.path.join(<span class="variable language_">self</span>._path,file))</span><br><span class="line">            imgg_data=imgg.getdata()</span><br><span class="line">            <span class="keyword">yield</span> np.reshape(imgg_data,(imgg.height,imgg.width,<span class="built_in">len</span>(imgg.getbands())))</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_representation_generator</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> file_path <span class="keyword">in</span> <span class="variable language_">self</span>._file_list:</span><br><span class="line">            img_path = os.path.join(<span class="variable language_">self</span>._path, file_path)</span><br><span class="line">            imgg_array = cv2.imread(img_path)</span><br><span class="line">            imgg_array = cv2.cvtColor(imgg_array, cv2.COLOR_BGR2RGB)</span><br><span class="line">            imgg_array = cv2.resize(imgg_array, (<span class="number">224</span>, <span class="number">224</span>))</span><br><span class="line">            imgg_array = np.expand_dims(imgg_array, axis=<span class="number">0</span>)</span><br><span class="line">            pre_processed_imgg = preprocess_input(imgg_array.astype(<span class="string">&#x27;float32&#x27;</span>))</span><br><span class="line">            pre_presented_imgg = <span class="variable language_">self</span>._model.predict(pre_processed_imgg)</span><br><span class="line">            <span class="keyword">yield</span> pre_presented_imgg</span><br></pre></td></tr></table></figure><h6 id="测试函数"><a href="#测试函数" class="headerlink" title="测试函数"></a>测试函数</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    lib_path = <span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/originalPics/2002/07/20/big&#x27;</span></span><br><span class="line">    dataset = FaceDataset(lib_path)</span><br><span class="line">    vector=[]</span><br><span class="line">    model=VGGFace(model=<span class="string">&#x27;vgg16&#x27;</span>,include_top=<span class="literal">False</span>,input_shape=(<span class="number">224</span>,<span class="number">224</span>,<span class="number">3</span>),pooling=<span class="string">&#x27;avg&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> ele <span class="keyword">in</span> dataset.image_representation_generator():</span><br><span class="line">        vector.append(ele)</span><br><span class="line">    <span class="keyword">for</span> ele <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(vector)):</span><br><span class="line">        <span class="keyword">for</span> tlt <span class="keyword">in</span> <span class="built_in">range</span>(ele,<span class="built_in">len</span>(vector)):</span><br><span class="line">            sim=cosine_similarity(vector[ele],vector[tlt])[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;image <span class="subst">&#123;ele+<span class="number">1</span>&#125;</span> &amp; image <span class="subst">&#123;tlt+<span class="number">1</span>&#125;</span> similarity:<span class="subst">&#123;sim:<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h1 id="Week-11"><a href="#Week-11" class="headerlink" title="Week 11"></a>Week 11</h1><blockquote><p>当需要计算多段音频统的音高等特征时，串行计算往往需要耗费较长的时间。本周作业要求利用librosa库以及Python多进程实现对多个音频的并行特征计算：</p><ol><li>主进程读取声音数据目录，得到所有声音文件的列表；</li><li>直接使用Process类构建子进程，利用libraso提供的支持来计算音高和声强，并保存计算结果到文件（一个声音一个文件 ）。</li><li>通过继承Process类来构建子进程，同样利用libraso提供的支持来计算音高和声强，并保存计算结果到文件（一个声音一个文件 ）。</li><li>在主进程中启动利用2，3中构建的子进程，并分发（如通过队列）参数（声音文件名）。</li></ol><p>5（附加）. 观察在一定数目的声音文件处理时（建议文件多一些），子进程数目变化与处理总时长的关系。</p><p>6（附加）. 如果修改2，3中的要求，不再为每个声音保存一个文件，而是将所有声音的结果保存到一个文件中，应该如何处理？比如，计算子进程会将结果写入一个队列，而一个新的Writer子进程将负责从队列里读取内容并写入一个特定的汇总文件。<br>参考资料</p><p><a href="https://librosa.org/doc/latest/generated/librosa.yin.html#librosa.yin">https://librosa.org/doc/latest/generated/librosa.yin.html#librosa.yin</a><br><a href="https://librosa.org/doc/latest/generated/librosa.amplitude_to_db.html#librosa.amplitude_to_db">https://librosa.org/doc/latest/generated/librosa.amplitude_to_db.html#librosa.amplitude_to_db</a></p></blockquote><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><h3 id="库-1"><a href="#库-1" class="headerlink" title="库"></a>库</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing <span class="keyword">as</span> mp</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> librosa</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure><h3 id="基本代码"><a href="#基本代码" class="headerlink" title="基本代码"></a>基本代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main_process</span>(<span class="params">path</span>):</span><br><span class="line">    wav_doc_list = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.wav&#x27;</span>):</span><br><span class="line">            wav_doc_list.append(os.path.join(path, file))</span><br><span class="line">    <span class="keyword">return</span> wav_doc_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_process</span>(<span class="params">queue</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> queue.empty():</span><br><span class="line">        path = queue.get()</span><br><span class="line">        write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">            pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">            data = <span class="string">&#x27;pitches: &#x27;</span> + <span class="built_in">str</span>(pitches) + <span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27; magnitudes: &#x27;</span> + <span class="built_in">str</span>(magnitudes) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            f.write(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubProcess</span>(multiprocessing.Process):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, queue</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.queue = queue</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> <span class="variable language_">self</span>.queue.empty():</span><br><span class="line">            path = <span class="variable language_">self</span>.queue.get()</span><br><span class="line">            write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">                pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">                data = <span class="string">f&#x27;pitches: <span class="subst">&#123;<span class="built_in">str</span>(pitches)&#125;</span>\n magnitudes: <span class="subst">&#123;<span class="built_in">str</span>(magnitudes)&#125;</span>\n&#x27;</span></span><br><span class="line">                f.write(data)</span><br></pre></td></tr></table></figure><hr><h2 id="直接使用Process类构建子进程"><a href="#直接使用Process类构建子进程" class="headerlink" title="直接使用Process类构建子进程"></a>直接使用Process类构建子进程</h2><blockquote><ol start="2"><li><p>直接使用Process类构建子进程，利用libraso提供的支持来计算音高和声强，并保存计算结果到文件（一个声音一个文件 ）。</p></li><li><p>在主进程中启动利用2，3中构建的子进程，并分发（如通过队列）参数（声音文件名）。</p></li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main_process</span>(<span class="params">path</span>):</span><br><span class="line">    mp3_doc_list = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.wav&#x27;</span>):</span><br><span class="line">            mp3_doc_list.append(os.path.join(path, file))</span><br><span class="line">    <span class="keyword">return</span> mp3_doc_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_process</span>(<span class="params">queue</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> queue.empty():</span><br><span class="line">        path = queue.get()</span><br><span class="line">        write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">            pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">            data = <span class="string">&#x27;pitches: &#x27;</span> + <span class="built_in">str</span>(pitches) + <span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27; magnitudes: &#x27;</span> + <span class="built_in">str</span>(magnitudes) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            f.write(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/wav_list&#x27;</span></span><br><span class="line">    doc_list = main_process(path=path)</span><br><span class="line">    queue = multiprocessing.Queue()</span><br><span class="line">    processes = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> doc_list:</span><br><span class="line">        queue.put(file)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(doc_list)):</span><br><span class="line">        pro_ = multiprocessing.Process(target=sub_process, args=(queue,))</span><br><span class="line">        pro_.start()</span><br><span class="line">        processes.append(pro_)</span><br><span class="line">    <span class="keyword">for</span> ele <span class="keyword">in</span> processes:</span><br><span class="line">        ele.join()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;已完成。&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="通过继承Process类来构建子进程"><a href="#通过继承Process类来构建子进程" class="headerlink" title="通过继承Process类来构建子进程"></a>通过继承Process类来构建子进程</h2><blockquote><ol start="3"><li><p>通过继承Process类来构建子进程，同样利用libraso提供的支持来计算音高和声强，并保存计算结果到文件（一个声音一个文件 ）。</p></li><li><p>在主进程中启动利用2，3中构建的子进程，并分发（如通过队列）参数（声音文件名）。</p></li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main_process</span>(<span class="params">path</span>):</span><br><span class="line">    wav_doc_list = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.wav&#x27;</span>):</span><br><span class="line">            wav_doc_list.append(os.path.join(path, file))</span><br><span class="line">    <span class="keyword">return</span> wav_doc_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubProcess</span>(multiprocessing.Process):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, queue</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.queue = queue</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> <span class="variable language_">self</span>.queue.empty():</span><br><span class="line">            path = <span class="variable language_">self</span>.queue.get()</span><br><span class="line">            write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">                pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">                data = <span class="string">f&#x27;pitches: <span class="subst">&#123;<span class="built_in">str</span>(pitches)&#125;</span>\n magnitudes: <span class="subst">&#123;<span class="built_in">str</span>(magnitudes)&#125;</span>\n&#x27;</span></span><br><span class="line">                f.write(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/wav_list&#x27;</span></span><br><span class="line">    doc_list = main_process(path=path)</span><br><span class="line">    queue = multiprocessing.Queue()</span><br><span class="line">    processes = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> doc_list:</span><br><span class="line">        queue.put(file)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(doc_list)):</span><br><span class="line">        pro_ = SubProcess(queue=queue)</span><br><span class="line">        pro_.start()</span><br><span class="line">        processes.append(pro_)</span><br><span class="line">    <span class="keyword">for</span> ele <span class="keyword">in</span> processes:</span><br><span class="line">        ele.join()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;已完成。&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="探究子进程数目与运行时长的关系"><a href="#探究子进程数目与运行时长的关系" class="headerlink" title="探究子进程数目与运行时长的关系"></a>探究子进程数目与运行时长的关系</h2><blockquote><p>5（附加）. 观察在一定数目的声音文件处理时（建议文件多一些），子进程数目变化与处理总时长的关系。</p></blockquote><p>* <em>为了方便后续测试起见，以下代码中略去了最后一步文件写入的步骤。</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main_process</span>(<span class="params">path</span>):</span><br><span class="line">    wav_doc_list = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.wav&#x27;</span>):</span><br><span class="line">            wav_doc_list.append(os.path.join(path, file))</span><br><span class="line">    <span class="keyword">return</span> wav_doc_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_process</span>(<span class="params">path</span>):</span><br><span class="line">    write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">        pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">        data = <span class="string">f&#x27;pitches: <span class="subst">&#123;<span class="built_in">str</span>(pitches)&#125;</span>\n magnitudes: <span class="subst">&#123;<span class="built_in">str</span>(magnitudes)&#125;</span>\n&#x27;</span></span><br><span class="line">        <span class="comment"># f.write(data)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/wav_list&#x27;</span></span><br><span class="line">    doc_list = main_process(path=path)</span><br><span class="line">    start=time.time()</span><br><span class="line">    pool = mp.Pool(processes=<span class="number">1</span>)</span><br><span class="line">    result = pool.<span class="built_in">map</span>(sub_process, doc_list)</span><br><span class="line">    end=time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;已完成, 耗时:<span class="subst">&#123;end-start&#125;</span>s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><p>当<code>processes==1</code>时，耗时<code>9.906246900558472s</code>。</p><p>当<code>processes==3</code>时，耗时<code>4.453998327255249s</code>。</p><p>当<code>processes==5</code>时，耗时<code>4.425124406814575s</code>。</p><p>当<code>processes==7</code>时，耗时<code>4.3829286098480225s</code>。</p><p>当<code>processes==8</code>时，耗时<code>4.366180181503296s</code>。</p><p>当<code>processes==9</code>时，耗时<code>4.445085048675537s</code>。</p><p>当<code>processes==12</code>时，耗时<code>4.432607412338257s</code>。</p><p>可以初步猜测随着进程数的增加，程序耗时向下降后上升。当进程数为8时，耗时达到最小。</p><h3 id="完整测试"><a href="#完整测试" class="headerlink" title="完整测试"></a>完整测试</h3><h4 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main_process</span>(<span class="params">path</span>):</span><br><span class="line">    wav_doc_list = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.wav&#x27;</span>):</span><br><span class="line">            wav_doc_list.append(os.path.join(path, file))</span><br><span class="line">    <span class="keyword">return</span> wav_doc_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_process</span>(<span class="params">path</span>):</span><br><span class="line">    write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">        pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">        data = <span class="string">f&#x27;pitches: <span class="subst">&#123;<span class="built_in">str</span>(pitches)&#125;</span>\n magnitudes: <span class="subst">&#123;<span class="built_in">str</span>(magnitudes)&#125;</span>\n&#x27;</span></span><br><span class="line">        <span class="comment"># f.write(data)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/wav_list&#x27;</span></span><br><span class="line">    doc_list = main_process(path=path)</span><br><span class="line">    x_list=[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>)]</span><br><span class="line">    y_list=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> x_list:</span><br><span class="line">        start=time.time()</span><br><span class="line">        pool = mp.Pool(processes=i)</span><br><span class="line">        result = pool.<span class="built_in">map</span>(sub_process, doc_list)</span><br><span class="line">        end=time.time()</span><br><span class="line">        y_list.append(end-start)</span><br><span class="line">    plt.title(<span class="string">&quot;Points and Fitting Curve&quot;</span>)</span><br><span class="line">    plt.xlabel(<span class="string">&quot;process num/(int)&quot;</span>)</span><br><span class="line">    plt.ylabel(<span class="string">&quot;time cost/(s)&quot;</span>)</span><br><span class="line">    plt.grid(<span class="literal">True</span>)</span><br><span class="line">    plt.xlim(<span class="built_in">min</span>(x_list) - <span class="number">1</span>, <span class="built_in">max</span>(x_list) + <span class="number">1</span>)</span><br><span class="line">    plt.ylim(<span class="built_in">min</span>(y_list) - <span class="number">1</span>, <span class="built_in">max</span>(y_list) + <span class="number">1</span>)</span><br><span class="line">    plt.plot(x_list, y_list, <span class="string">&quot;ro&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x_list)):</span><br><span class="line">        plt.annotate(<span class="string">&quot;(&#123;:.1f&#125;, &#123;:.1f&#125;)&quot;</span>.<span class="built_in">format</span>(x_list[i], y_list[i]), xy=(x_list[i], y_list[i]), xytext=(-<span class="number">15</span>, <span class="number">15</span>),</span><br><span class="line">                     textcoords=<span class="string">&quot;Process num via time cost&quot;</span>, ha=<span class="string">&quot;center&quot;</span>, va=<span class="string">&quot;top&quot;</span>)</span><br><span class="line">    coefficients = np.polyfit(np.array(x_list), np.array(y_list), <span class="number">3</span>)</span><br><span class="line">    p = np.poly1d(coefficients)</span><br><span class="line">    x_range = np.linspace(<span class="built_in">min</span>(x_list) - <span class="number">1</span>, <span class="built_in">max</span>(x_list) + <span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    y_range = p(x_range)</span><br><span class="line">    plt.plot(x_range, y_range, <span class="string">&quot;b-&quot;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>可见，随着进程数的增加，程序耗时向下降后上升。当进程数为8时，耗时达到最小。</p><h1 id="Week-12"><a href="#Week-12" class="headerlink" title="Week 12"></a>Week 12</h1><blockquote><p>利用Python的多线程实现音频文件的采集，并计算语速。</p><ol><li>通过类继承，实现一个线程类，参考voa.py中的示例，从<a href="https://www.51voa.com/VOA_Standard_3.html">https://www.51voa.com/VOA_Standard_3.html</a> (其中 “3”可被替换为其他数字，对应翻页操作)中获取新的链接地址列表。</li><li>通过类继承，实现一个线程类，参考voa.py中的示例，从1中获取的链接（如<a href="https://www.51voa.com/VOA_Standard_English/u-s-supports-diversity-of-energy-sources-in-europe-79541.html%EF%BC%89%E8%8E%B7%E5%8F%96mp3%E6%96%87%E4%BB%B6%E9%93%BE%E6%8E%A5%E3%80%82">https://www.51voa.com/VOA_Standard_English/u-s-supports-diversity-of-energy-sources-in-europe-79541.html）获取mp3文件链接。</a></li><li>通过类继承，实现一个线程类，参考voa.py中的示例，利用2中的mp3文件链接（如<a href="https://files.51voa.cn/201806/fighting-tb-in-uzbekistan.mp3%EF%BC%89%EF%BC%8C%E5%B0%86%E6%96%87%E4%BB%B6%E4%BF%9D%E5%AD%98%E5%88%B0%E6%9C%AC%E5%9C%B0%E3%80%82">https://files.51voa.cn/201806/fighting-tb-in-uzbekistan.mp3），将文件保存到本地。</a></li><li>通过类继承，实现一个线程类，参考sr.py中的示例，对存储的音频文件计算语速。</li><li>设计一种同步策略（比如用线程池，或锁，或队列等），实现1，2，3，4中几种不同功能线程的配合，实现多线程的mp3文件下载功能，并进行语速的计算和输出。</li><li>(附加)考虑到Python的多进程更适合计算密集型的任务，可否在4中不使用线程，而使用多进程来计算存储文件的语速？即主进程的多线程负责音频文件的下载与存储，另几个子进程则负责语速计算。比较一下与5中线程设计的速度差异。</li><li>（附加）音频采集如果时间过长，可能会因为外部因素（网络等）出现意外的中断，可否设计一种“断点”的记录机制，使得即使采集过程被打断，也能够从上次的断点继续开始，避免重复采集。</li></ol></blockquote><h2 id="库-2"><a href="#库-2" class="headerlink" title="库"></a>库</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> wave</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> librosa</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br></pre></td></tr></table></figure><h2 id="主体"><a href="#主体" class="headerlink" title="主体"></a>主体</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VoaThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,start_page,end_page,link_list</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.start_page=start_page</span><br><span class="line">        <span class="variable language_">self</span>.end_page=end_page</span><br><span class="line">        <span class="variable language_">self</span>.link_list=link_list</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.start_page,<span class="variable language_">self</span>.end_page):</span><br><span class="line">            url = <span class="string">f&#x27;https://www.51voa.com/VOA_Standard_<span class="subst">&#123;i&#125;</span>.html&#x27;</span></span><br><span class="line">            response=requests.get(url)</span><br><span class="line">            html=etree.HTML(response.text)</span><br><span class="line">            links=[]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">                links = links+html.xpath(<span class="string">&#x27;//*[@id=&quot;righter&quot;]/div[3]/ul/li[%s]/a/@href&#x27;</span>%<span class="built_in">str</span>(j))</span><br><span class="line">            <span class="keyword">for</span> ele <span class="keyword">in</span> links:</span><br><span class="line">                <span class="variable language_">self</span>.link_list.append(ele)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GetMP3Thread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,link_list</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.link_list=link_list</span><br><span class="line">        <span class="variable language_">self</span>.mlist=[]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> tqdm(<span class="variable language_">self</span>.link_list[:<span class="number">5</span>]):</span><br><span class="line">            url=<span class="string">&#x27;https://www.51voa.com&#x27;</span>+link</span><br><span class="line">            response=requests.get(url,headers=<span class="variable language_">self</span>.headers)</span><br><span class="line">            <span class="variable language_">self</span>.mlist = <span class="variable language_">self</span>.mlist+<span class="built_in">list</span>(<span class="built_in">set</span>(re.findall(<span class="string">r&#x27;https://.+?\.mp3&#x27;</span>, response.text)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DownloadMP3Thread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, mlist, directory=<span class="string">&#x27;.&#x27;</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.mlist = mlist</span><br><span class="line">        <span class="variable language_">self</span>.directory = directory</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> murl <span class="keyword">in</span> tqdm(<span class="variable language_">self</span>.mlist):</span><br><span class="line">            mp3_stream = requests.get(murl, headers=<span class="variable language_">self</span>.headers).content</span><br><span class="line">            fname = murl[murl.rfind(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>:]</span><br><span class="line">            path = os.path.join(<span class="variable language_">self</span>.directory, fname)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(mp3_stream)</span><br><span class="line">                </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpeechRateThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, filename</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.filename = filename</span><br><span class="line">        <span class="variable language_">self</span>.words_per_second = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        y, sr = librosa.load(<span class="variable language_">self</span>.filename, sr=<span class="literal">None</span>)</span><br><span class="line">        onsets = librosa.onset.onset_detect(y=y, sr=sr, units=<span class="string">&quot;time&quot;</span>, hop_length=<span class="number">128</span>, backtrack=<span class="literal">False</span>)</span><br><span class="line">        number_of_words = <span class="built_in">len</span>(onsets)</span><br><span class="line">        duration = <span class="built_in">len</span>(y) / sr</span><br><span class="line">        <span class="variable language_">self</span>.words_per_second = number_of_words / duration</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_words_per_second</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.words_per_second</span><br></pre></td></tr></table></figure><h2 id="获取链接并下载MP3文件"><a href="#获取链接并下载MP3文件" class="headerlink" title="获取链接并下载MP3文件"></a>获取链接并下载MP3文件</h2><h4 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h4><blockquote><ol><li>通过类继承，实现一个线程类，参考voa.py中的示例，从<a href="https://www.51voa.com/VOA_Standard_3.html">https://www.51voa.com/VOA_Standard_3.html</a> (其中 “3”可被替换为其他数字，对应翻页操作)中获取新的链接地址列表。</li><li>通过类继承，实现一个线程类，参考voa.py中的示例，从1中获取的链接（如<a href="https://www.51voa.com/VOA_Standard_English/u-s-supports-diversity-of-energy-sources-in-europe-79541.html%EF%BC%89%E8%8E%B7%E5%8F%96mp3%E6%96%87%E4%BB%B6%E9%93%BE%E6%8E%A5%E3%80%82">https://www.51voa.com/VOA_Standard_English/u-s-supports-diversity-of-energy-sources-in-europe-79541.html）获取mp3文件链接。</a></li><li>通过类继承，实现一个线程类，参考voa.py中的示例，利用2中的mp3文件链接（如<a href="https://files.51voa.cn/201806/fighting-tb-in-uzbekistan.mp3%EF%BC%89%EF%BC%8C%E5%B0%86%E6%96%87%E4%BB%B6%E4%BF%9D%E5%AD%98%E5%88%B0%E6%9C%AC%E5%9C%B0%E3%80%82">https://files.51voa.cn/201806/fighting-tb-in-uzbekistan.mp3），将文件保存到本地。</a></li></ol></blockquote><h4 id="测试代码："><a href="#测试代码：" class="headerlink" title="测试代码："></a>测试代码：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    link_list = []</span><br><span class="line">    voa_thread = VoaThread(<span class="number">1</span>, <span class="number">6</span>, link_list)</span><br><span class="line">    voa_thread.start()</span><br><span class="line">    voa_thread.join()</span><br><span class="line"></span><br><span class="line">    get_mp3_thread = GetMP3Thread(link_list)</span><br><span class="line">    get_mp3_thread.start()</span><br><span class="line">    get_mp3_thread.join()</span><br><span class="line"></span><br><span class="line">    download_mp3_thread = DownloadMP3Thread(get_mp3_thread.mlist,<span class="string">&#x27;C:/Users/Administrator/Desktop/save_path&#x27;</span>)</span><br><span class="line">    download_mp3_thread.start()</span><br><span class="line">    download_mp3_thread.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="测试结果："><a href="#测试结果：" class="headerlink" title="测试结果："></a>测试结果：</h4><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="计算对应音频文件的语速"><a href="#计算对应音频文件的语速" class="headerlink" title="计算对应音频文件的语速"></a>计算对应音频文件的语速</h2><h4 id="问题：-1"><a href="#问题：-1" class="headerlink" title="问题："></a>问题：</h4><blockquote><ol start="4"><li>通过类继承，实现一个线程类，参考sr.py中的示例，对存储的音频文件计算语速。</li></ol></blockquote><h4 id="测试代码：-1"><a href="#测试代码：-1" class="headerlink" title="测试代码："></a>测试代码：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">        link_list = []</span><br><span class="line">        voa_thread = VoaThread(<span class="number">1</span>, <span class="number">6</span>, link_list)</span><br><span class="line">        voa_thread.start()</span><br><span class="line">        voa_thread.join()</span><br><span class="line"></span><br><span class="line">        get_mp3_thread = GetMP3Thread(link_list)</span><br><span class="line">        get_mp3_thread.start()</span><br><span class="line">        get_mp3_thread.join()</span><br><span class="line"></span><br><span class="line">        download_mp3_thread = DownloadMP3Thread(get_mp3_thread.mlist)</span><br><span class="line">        download_mp3_thread.start()</span><br><span class="line">        download_mp3_thread.join()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> mp3_file <span class="keyword">in</span> get_mp3_thread.mlist:</span><br><span class="line">            speechrate_thread = SpeechRateThread(mp3_file)</span><br><span class="line">            speechrate_thread.start()</span><br><span class="line">            speechrate_thread.join()</span><br><span class="line"></span><br><span class="line">            words_per_second = speechrate_thread.get_words_per_second()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;os.path.basename(mp3_file)&#125;</span>: <span class="subst">&#123;words_per_second&#125;</span> words-per-second&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h4><h1 id="-1"><a href="#-1" class="headerlink" title=""></a></h1><h2 id="同步策略"><a href="#同步策略" class="headerlink" title="同步策略"></a>同步策略</h2><h4 id="主体改动："><a href="#主体改动：" class="headerlink" title="主体改动："></a>主体改动：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VoaThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,start_page,end_page,link_queue</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.start_page=start_page</span><br><span class="line">        <span class="variable language_">self</span>.end_page=end_page</span><br><span class="line">        <span class="variable language_">self</span>.link_queue=link_queue</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.start_page,<span class="variable language_">self</span>.end_page):</span><br><span class="line">            url = <span class="string">f&#x27;https://www.51voa.com/VOA_Standard_<span class="subst">&#123;i&#125;</span>.html&#x27;</span></span><br><span class="line">            response=requests.get(url)</span><br><span class="line">            html=etree.HTML(response.text)</span><br><span class="line">            links=[]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">                links = links+html.xpath(<span class="string">&#x27;//*[@id=&quot;righter&quot;]/div[3]/ul/li[%s]/a/@href&#x27;</span>%<span class="built_in">str</span>(j))</span><br><span class="line">            <span class="keyword">for</span> ele <span class="keyword">in</span> links:</span><br><span class="line">                <span class="variable language_">self</span>.link_queue.put(ele)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GetMP3Thread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,link_queue, mlist_queue</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.link_queue=link_queue</span><br><span class="line">        <span class="variable language_">self</span>.mlist_queue=mlist_queue</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> <span class="variable language_">self</span>.link_queue.empty():</span><br><span class="line">            link = <span class="variable language_">self</span>.link_queue.get()</span><br><span class="line">            url=<span class="string">&#x27;https://www.51voa.com&#x27;</span>+link</span><br><span class="line">            response=requests.get(url,headers=<span class="variable language_">self</span>.headers)</span><br><span class="line">            mlist = <span class="built_in">list</span>(<span class="built_in">set</span>(re.findall(<span class="string">r&#x27;https://.+?\.mp3&#x27;</span>, response.text)))</span><br><span class="line">            <span class="keyword">for</span> murl <span class="keyword">in</span> mlist:</span><br><span class="line">                <span class="variable language_">self</span>.mlist_queue.put(murl)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DownloadMP3Thread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, mlist_queue, directory=<span class="string">&#x27;.&#x27;</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.mlist_queue = mlist_queue</span><br><span class="line">        <span class="variable language_">self</span>.directory = directory</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> <span class="variable language_">self</span>.mlist_queue.empty():</span><br><span class="line">            murl = <span class="variable language_">self</span>.mlist_queue.get()</span><br><span class="line">            mp3_stream = requests.get(murl, headers=<span class="variable language_">self</span>.headers).content</span><br><span class="line">            fname = murl[murl.rfind(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>:]</span><br><span class="line">            path = os.path.join(<span class="variable language_">self</span>.directory, fname)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(mp3_stream)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpeechRateThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, filename, words_per_second_queue</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.filename = filename</span><br><span class="line">        <span class="variable language_">self</span>.words_per_second_queue = words_per_second_queue</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        y, sr = librosa.load(<span class="variable language_">self</span>.filename, sr=<span class="literal">None</span>)</span><br><span class="line">        onsets = librosa.onset.onset_detect(y=y, sr=sr, units=<span class="string">&quot;time&quot;</span>, hop_length=<span class="number">128</span>, backtrack=<span class="literal">False</span>)</span><br><span class="line">        number_of_words = <span class="built_in">len</span>(onsets)</span><br><span class="line">        duration = <span class="built_in">len</span>(y) / sr</span><br><span class="line">        words_per_second = number_of_words / duration</span><br><span class="line">        <span class="variable language_">self</span>.words_per_second_queue.put(words_per_second)</span><br></pre></td></tr></table></figure><h4 id="测试代码：-2"><a href="#测试代码：-2" class="headerlink" title="测试代码："></a>测试代码：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    link_queue = queue.Queue()</span><br><span class="line">    mlist_queue = queue.Queue()</span><br><span class="line">    words_per_second_queue = queue.Queue()</span><br><span class="line">    voa_thread = VoaThread(<span class="number">1</span>, <span class="number">6</span>, link_queue)</span><br><span class="line">    voa_thread.start()</span><br><span class="line">    voa_thread.join()</span><br><span class="line">    get_mp3_thread = GetMP3Thread(link_queue, mlist_queue)</span><br><span class="line">    get_mp3_thread.start()</span><br><span class="line">    download_mp3_threads = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        download_mp3_thread = DownloadMP3Thread(mlist_queue)</span><br><span class="line">        download_mp3_thread.start()</span><br><span class="line">        download_mp3_threads.append(download_mp3_thread)</span><br><span class="line">    get_mp3_thread.join()</span><br><span class="line">    speechrate_threads = []</span><br><span class="line">    <span class="keyword">for</span> mp3_file <span class="keyword">in</span> get_mp3_thread.mlist:</span><br><span class="line">        speechrate_thread = SpeechRateThread(mp3_file, words_per_second_queue)</span><br><span class="line">        speechrate_thread.start()</span><br><span class="line">        speechrate_threads.append(speechrate_thread)</span><br><span class="line">    <span class="keyword">for</span> speechrate_thread <span class="keyword">in</span> speechrate_threads:</span><br><span class="line">        speechrate_thread.join()</span><br><span class="line">    <span class="keyword">for</span> i, mp3_file <span class="keyword">in</span> <span class="built_in">enumerate</span>(get_mp3_thread.mlist):</span><br><span class="line">        words_per_second = words_per_second_queue.get()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>. <span class="subst">&#123;os.path.basename(mp3_file)&#125;</span>: <span class="subst">&#123;words_per_second:<span class="number">.2</span>f&#125;</span> words-per-second&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> download_mp3_thread <span class="keyword">in</span> download_mp3_threads:</span><br><span class="line">        download_mp3_thread.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h1 id="Week-13"><a href="#Week-13" class="headerlink" title="Week 13"></a>Week 13</h1><h2 id="作业描述"><a href="#作业描述" class="headerlink" title="作业描述"></a>作业描述</h2><blockquote><p>协程有时被称为“微线程”，因为二者有类似的使用场景。和线程相比，协程占用资源更少、切换迅速，且实现简单（如协程是协作式调用，一般不用考虑资源的抢占，所以大部分情况下不需要通过同步原语来避免冲突）。通常协程被用在高并发的IO场景中。本周要求利用协程，实现一个协程爬虫类 VoaCrawler ，对第十二周作业的数据采集部分进行重新实现，即用协程实现Mp3音频文件的爬取（可以使用 gevent , aiohttop等第三方库），用 aiofiles 实现音频文件的存储。如果有余力，也可以继续改进 Bilibili_Crawler.py中的例子，使用 aiofiles 等进行文件存储，并测试大规模视频同时获取是否可行。</p></blockquote><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> aiofiles</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VoaCrawler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, start_page, end_page</span>):</span><br><span class="line">        <span class="variable language_">self</span>.start_page = start_page</span><br><span class="line">        <span class="variable language_">self</span>.end_page = end_page</span><br><span class="line">        <span class="variable language_">self</span>.link_list = []</span><br><span class="line">        <span class="variable language_">self</span>.mlist = []</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_links</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.start_page, <span class="variable language_">self</span>.end_page):</span><br><span class="line">            url = <span class="string">f&#x27;https://www.51voa.com/VOA_Standard_<span class="subst">&#123;i&#125;</span>.html&#x27;</span></span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">                <span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">                    html = etree.HTML(<span class="keyword">await</span> response.text())</span><br><span class="line">                    links = []</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">50</span>):</span><br><span class="line">                        links = links + html.xpath(<span class="string">&#x27;//*[@id=&quot;righter&quot;]/div[3]/ul/li[%s]/a/@href&#x27;</span> % <span class="built_in">str</span>(j))</span><br><span class="line">                    <span class="keyword">for</span> ele <span class="keyword">in</span> links:</span><br><span class="line">                        <span class="variable language_">self</span>.link_list.append(ele)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_mp3</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> tqdm(<span class="variable language_">self</span>.link_list[:<span class="number">5</span>]):</span><br><span class="line">                url = <span class="string">&#x27;https://www.51voa.com&#x27;</span> + link</span><br><span class="line">                <span class="keyword">async</span> <span class="keyword">with</span> session.get(url, headers=<span class="variable language_">self</span>.headers) <span class="keyword">as</span> response:</span><br><span class="line">                    <span class="variable language_">self</span>.mlist = <span class="variable language_">self</span>.mlist + <span class="built_in">list</span>(<span class="built_in">set</span>(re.findall(<span class="string">r&#x27;https://.+?\.mp3&#x27;</span>, <span class="keyword">await</span> response.text())))</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">download_mp3</span>(<span class="params">self, directory=<span class="string">&#x27;.&#x27;</span></span>):</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">            <span class="keyword">for</span> murl <span class="keyword">in</span> tqdm(<span class="variable language_">self</span>.mlist):</span><br><span class="line">                mp3_stream = <span class="keyword">await</span> session.get(murl, headers=<span class="variable language_">self</span>.headers)</span><br><span class="line">                fname = murl[murl.rfind(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>:]</span><br><span class="line">                path = os.path.join(directory, fname)</span><br><span class="line">                <span class="keyword">async</span> <span class="keyword">with</span> aiofiles.<span class="built_in">open</span>(path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="keyword">await</span> f.write(<span class="keyword">await</span> mp3_stream.read())</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">self</span>.get_links()</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">self</span>.get_mp3()</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">self</span>.download_mp3()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    crawler = VoaCrawler(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    asyncio.run(crawler.run())</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="运行结果-1"><a href="#运行结果-1" class="headerlink" title="运行结果"></a>运行结果</h2><h1 id="-2"><a href="#-2" class="headerlink" title=""></a></h1>]]></content>
      
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
            <tag> 数据分析 </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>远山的回响|“新村民”现象背后的哲学皈思</title>
      <link href="/2022/12/10/1720/"/>
      <url>/2022/12/10/1720/</url>
      
        <content type="html"><![CDATA[<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在这个高度智能化、信息化的时代，城市的生活节奏正随着时代的发展越来越快。越来越多的年轻人或因不忍各方面的压力、或因渴望宁静与自然已久，选择“裸辞”。也有年轻人，在自己无限青春美好的年华走向农村，建设农村——他们成为了推动乡村振兴的重要力量。央视推出的系列报道——《远山的回响》讲述的正是他们的故事。“新村民”正在成为中国农村的一种活跃的新生力量，也正在成为流传于都市职场人心中的向往。是什么，让他们勇敢地迈出了这一步伐？</p><h2 id="01心系着另一片土地的人"><a href="#01心系着另一片土地的人" class="headerlink" title="01心系着另一片土地的人"></a>01心系着另一片土地的人</h2><blockquote><p>生活不止眼前的苟且，还有诗和远方。</p></blockquote><p>2011年，张扬在初识上海西郊的岑卜村时便爱上了那里。岑卜村沿河而建，一面临水。夏夜有飞扬的萤火，清晨有甜糯的青菜。“微雨过，小荷翻，榴花开欲燃。”“潭中鱼可百许头，皆若空游无所依。”湖水之下，能看见荡漾的水草的肌理。污染性企业早已迁出，这里处处彰显生态文明建设的成果。最初，张扬和妻子只是周末住在这里享受自然的宁静。活在身体的此时此刻，他们后来选择彻底辞职，来村里创业，并长住下去。</p><p>女儿在村里长大，她在那里有着无数的动物朋友与大自然老师。村里还住着其他“新村民”：有科学家，有画家，有农学家，也有运动员。各式各样的人彼此间往来友好，常常相约做饭，烹饪他们亲手栽培出的食材。</p><blockquote><p>每一个人的心中都住着一个陶渊明。</p></blockquote><p>李久太出身于农村。他因成绩优异，哈工大建筑专业毕业后直博清华大学。12年学涯他看遍了建筑的“美”，但在他的视线落回农村之时，他才明白了那些“美”究竟差在哪里。他抛弃了名利，在山东威海的大水泊镇度过了五年时光。</p><p>李久太投身于农村改造当中。他与镇政府签订了合同，卖掉了北京的房子，在三岐山上的一处破旧的厂房打造了风格别样的“设计谷”。李久太担任起了清华大学乡村振兴工作站文登基站的站长，用自己创意盘活了那些闲置废弃的农房，将它们打造成为富有传统韵味的特色民居。他流转了村里的荒地，每年为村合作社创造十多万的租金。</p><p>李久太善用人和资源改造大水泊镇，在互联网上一炮走红，吸引来了16名博士、教授级专家、200多名城市精英在此定居，成为“新村民”。这个原本狭隘肮脏、名不经传的地方实现了华丽转身。</p><p>走出大山，跳出农门，曾经是多少代人的热切期望。现代社会的愈演愈烈的“内卷”式竞争。暗无天日的职场和望不到头绩效考核勾起了他们的乡愁。当下，回归乡村正在成为一种新时尚。对于一部分人来说，逃离城市成为“新村民”，是为了规避城市对自己内心的侵蚀。而对于另一部分人来说，成为新村民，是为了实现自己新的人生追求。他们对乡村有着独特的情怀，对于“自然”“和谐”有着自己深刻的理解。他们认同乡村，愿意用自己的知识和技能去推动乡村。</p><p>倘若能放下都市的最后执念，人们便有了来去自由的权利，便有了掌握命运的权利。乡村便成为他们生命的舞台，亦或是归宿。“新村民”便就此产生了。</p><h2 id="02老庄哲学的相关内涵"><a href="#02老庄哲学的相关内涵" class="headerlink" title="02老庄哲学的相关内涵"></a>02老庄哲学的相关内涵</h2><p>老子主张“返璞归真”。在老子看来“婴儿之未孩”是最为淳朴无邪、无拘无束的时期，淳朴无欲，清静无为，处于一种与宇宙浑然一体的自然状态。</p><p>老子选择了归隐，以避免樊尘的纷扰。深思熟虑之后，他选择了从洛邑向西出走，避开东边的家乡、南边令他失落的楚国及北边的漫漫凛冬。西边有昆仑山、函谷关，有两条大河的源头，有壮阔、险要的地势，都为他所向往。他在优哉游哉的青牛上悠然自得，享受着自然的奥秘与退隐后的轻快，任思想在世间徜徉，任青牛一路上走走停停。牛在前面走，老子在后面欹着，正反之间达到平衡和统一，他们共同奔赴自然，真正达到了“返璞归真”的生命之道。</p><p>“大道泛兮，其可左右。万物恃之而生而不辞，功成不名有，衣养万物而不为主。常无欲，可名于小。”此处“无欲”即“自然”，“无欲”作为“自然”是“道”的本性。《老子》指出了人的欲望的三个表现：其一，作为肉体存在二具有的感官欲望；其二，心灵上的恣情纵欲；其三，行为上的追名逐利。</p><p>“无色令人目盲，五音令人耳聋，五味令人口爽。”这些伤害源于人对感官欲望的本能追逐中。“驰骋畋猎，令人心发狂。”心灵上的恣情纵欲使人陷入迷狂而背弃道德。而对于“名”“利”的追求，又会使得人们陷入争斗之中。因而“欲”存在着多种危害，在老子的哲学思想看来，应“以不欲为欲”。</p><p>“无知”，即不用“智”或不认知。“无知”避免了人们用智慧去看待、批判、谋划和取舍，避免陷入心物二元对待的格局中，导致自然之“道”的消解。《老子》第二章描绘了人因用“智”带来的自我蒙蔽以及拯救之道。用“智”的直接后果是落入知识论的相对视野之中。</p><p>“无心”，就是“无知”“无欲”所达到的境界，使心灵回归原初。</p><p>“无欲”“无知”“无心”能够拨开种种非本真性的生存欲望，使得一个人得以进入“无为”“自然”的生存状态之中。老子认为，“大道至简”，生活应当以此参照进行，才能无为而无不为，不为繁杂所烦恼和困扰。自然界是人类生命源泉，人只要维持生命活动，必须顺乎自然，适应自然变化规律，才能真正乐在其中。老子追求“天地合一”的自然境界。尊重自然、顺应自然是养生、养心、养神的根本原则。老子顺乎自然，怡淡寡欲，静养柔气的养生思想成为了道家养生的指导思想，甚至深远地影响了传统医学的发展。</p><p>庄子的人生目标是重视生命，轻视名利。他强调人应修炼自己的内在人格，追求自由境界，这与当时浮躁的社会风气格格不入。《逍遥游》表现了庄子对自然浪漫生活的向往的追求。“至人无己，神人无功，圣人无名。”自由和尊严的价值观深深根植于人性之中。</p><p>“庄子真正追求的是逍遥之乐，这是一种精神的自我满足，指一种非常识、非世俗的怡悦之乐，是超脱现实我之有限性达到精神之无限的境界。”</p><p>庄子的人生观、君子观，是当时社会中生活思索和价值追求的体现。春秋战国兵荒马乱的社会背景之下，庄子作为一个没落的贵族、漆园小吏，无力抵御或是改变自身所处的滚滚历史洪流。 [<a href="#_edn1">i]</a>走在人世间，穿越熙熙攘攘的集市、生灵涂炭的战场，许多人为命运所束缚，那个时代，人们失去了“自我”斗争的力量和话语权。</p><p>庄子通过提升自己身的精神修养，改变了自己的存在状态，使自己达到人与世界的精神和谐。 他从高度的精神自由与道的默契出发，把对人的外在观察和思考转向对人的内在探索和守护，洁身自好，达到逍遥自在、个性自由的人生选择。在自我实践、修养提升中达到“自然”“无为”。</p><h2 id="03现象解构"><a href="#03现象解构" class="headerlink" title="03现象解构"></a>03现象解构</h2><h3 id="重拾“自然”的喜悦"><a href="#重拾“自然”的喜悦" class="headerlink" title="重拾“自然”的喜悦"></a>重拾“自然”的喜悦</h3><p>从每周周末的短暂留居，到干脆辞职来到村里长住并创业，张扬和妻子能够迈出这一步，做出了巨大的努力——自我认知的重定位和追求的转变，需要为诗和远方放弃自己的所有执念和部分钱财。对于来到岑卜村受感染并定居下来的其他科学家、运动员、画家等人，又何尝不是呢？</p><p>岑卜村“新村民”们的生活智慧，在于始终如一回归自然、保持本真、坚守单一，这与老子哲学思想是相通的。岑卜村的“新村民”们选择了归去，而不是远远地眺望而不及，他们终于回到他们念念不忘的农村生活当中，重新拥抱自然。</p><p>“阡陌交通，鸡犬相闻。”山川秀美，鸟语花香。白天在芳草和繁花中迷失归路，夜里萤火在湖面上飞舞。脚下有大地，头顶有星河。这是“新村民”们所直接接触的“自然”。事实上，真正的“自然”，早已超出物理意义上的“大自然”范畴。</p><p>人们不再为城市的嘈杂、晋升的欲望而烦恼。为城市生活奔波过，才知道闲暇的可贵。在岑卜村，摆脱了市井欲望的束缚，他们有机会真正接触和认识自己:从“无欲”到“无知”再到“无心”。仿佛人与人之间彻底抛弃了“猜疑”与“误解”。“大道至简”，昭示着精神内耗的终止，一切归于平淡。他们彼此问候，彼此帮助。倘若你碰巧经过一个村民的园子，他一定会摘几把新熟成的菜品，邀请你前来品鉴。在夜幕渐渐落下，灯火渐渐亮起之时，他们在昏暗的灯光下拼其餐桌，摆上各自的劳作成果，沐浴在“烟火气”中，其乐融融。</p><p>他们也如同老子一般倒骑青牛归去。</p><p>清静无为，大道至简，人生美妙。经历了精气神的洗礼，人们终于能享受重拾“自然”的喜悦了。“自然”的滋养之下，他们更为友善和理性，愈发团结。</p><h3 id="“广阔天地，大有作为”"><a href="#“广阔天地，大有作为”" class="headerlink" title="“广阔天地，大有作为”"></a>“广阔天地，大有作为”</h3><p>12年来，看遍了建筑的“美”，才恍然发现，真正的美在山村。初家村满足了李久太对农村和大海的所有向往，让他在那里心甘情愿地渡过了五年时光。李久太在改造初家村的几年历程当中吃尽了苦楚，艰辛的条件、人情往来的不快和委屈并没有使他停滞不前，甚至没能真正打入他的心扉。但他早以超脱于此。初家村是他发挥天马行空的想象力的舞台，在这里，他能尽情地追求自由和浪漫，打造一个非同凡想的农村。</p><p>  庄子在当时并没有能力去改变。那个时代的特性，决定了他所能做的只是皈依与自己内心的一片净土，从修养和实践的提升中达到“自然”“无为”。但是李久太不同。李久太很幸运的生活在这样一个美好的时代。这里没有战争的纷扰，没有剥削、压迫的社会制度。“振兴乡村”在这个时代并不是一句口号，而是一场全国上下齐心协力的、真真正正的“斗争”。一个李久太的力量虽小，他的精力也十分有限，但如果是千千万万的李久太呢？振兴乡村的潮流已然势不可当。越来越多年轻人抛却了城市优渥的生活条件，甚至如李久太一样，不惜卖掉自己在北京的房子，变现资金来支撑自己艰苦创业。</p><p>  “至人无己，神人无功，圣人无名。”李久太追求的，是一个理想中的新农村，一片萦绕着村民欢声笑语的乐土。名声与赞誉，与李久太梦想中的“农村”而言，仿佛只是附赠品。他极大地改善了村民的居住环境，增加了居民的收入，吸引来一众精英来此定居，接下他的“接力棒”。</p><p> 远山给了他回响，可他依然是那个村中穿梭往来的李久太。</p><p>成为“新村民”，是个人追求。“久在樊笼里，复得返自然。”归去，是个人选择，亦是对自己的重新认识。对于张扬以及一众“新村民”而言，这里是他们内心深处的一方净土。他们不需要再为城市高昂的消费和沉浮的职涯忧虑。</p><p>选择了隐逸的“新村民”，或许会为那些城里的奋斗一族感到不齿。但双方之间并没有什么值得互相看不起的。“新村民”只是一种生活方式。或许对于他们而言，享受到“归去”、重拾“自然”的喜悦，已经是最大的满足了吧。</p><p>“新村民”是推动乡村振兴的重要力量。过去，城市从农村剥夺了太多劳动力和知识分子，留在农村的主要是老人和妇女儿童，亦或患有疾病或残疾的非劳动力。依靠他们来振兴乡村，显然是不太现实的。起初，岑卜村中居住的几乎都是老年人，他们平淡地过着生活，仿佛与世隔绝。以张扬为代表的一批“新村民”的入驻，才使得岑卜村迸发出强大生命力。他们当中，不乏高学历者和社会精英。他们将知识和技术带入农村，同时也是城市发展之后对乡村的反哺。李久太更是靠奋斗，让初家村焕然一新吸引“新村民”入驻、再奋斗，实现永续发展。</p><p>  央视《远山的回响》系列报道，就讲述了一系列诸如此类至纯至美的故事。他们对于乡村振兴，是有着重大意义的。</p><h2 id="04“总而言之”"><a href="#04“总而言之”" class="headerlink" title="04“总而言之”"></a>04“总而言之”</h2><p>道家清净简朴的生活方式，是众多“新村民”们的追求。人们按照自然节律调适、生活，自由自在，其乐融融，超然洒脱。烦躁不安的社会下，我们能够从中汲取力量，淡薄名利，超越社会的种种制约，从容面对自然法则，甚至是死亡。</p><p>但这样的思想，不可否认其存在消极的一面。庄子的选择，是逆来顺受，是囿于时代的无奈。很多时候，人们也不像岑卜村的那些精英村民一样，自身能力强悍，进退自由。对于精英来说，自己已然拥有的东西，做出权衡取舍时更为果断、自如。而普罗大众大多肩负着房贷、养老、下一代教育的多重压力，在这种情况下，取舍则更为困难。</p><p>“结庐在人境，而无车马喧。问君何能尔，心远地自偏。” 事实上，“新村民”并不意味着他们真的要身接乡村。庄子在肉体上也显然不能抵达他理想的彼岸。庄子一生穷困潦倒，精神却汪洋恣肆。道家讲求超凡脱俗。庄子“逍遥”的思想亦能帮助拓展“新村民”的内涵。这样，不论是在城市还是乡村，<strong>只要心足够“远”，人们都能享受重拾“自然”及“诞生于世间”的喜悦了。</strong></p><p>2022年12月于北京</p><hr><p><em><strong>ref.</strong></em></p><p>[1] 杨莉.人在囧途:大城市、小城镇，是逃离还是坚守？[J].中国大学生就业,2019(21):16-18.</p><p>[2] 一条. 上海最美水上村落,一群高学历青年抱团生活[O].新浪微博.</p><p>[3] 苏轼.《阮郎归·初夏》. “燃”字 一作 “然”。</p><p>[4] 毕淑敏.带上灵魂去旅行[M]. 北京十月文艺出版社出版，2011.</p><p>[5] 央广网. 远山的回响｜清华博士当起“新村民”：用乡村之美连接人、吸引人[O].</p><p>[6] 陈绍燕,孙功进.新论老庄[M].山东人民出版社.2020</p><p>[7] 孙君衡.中国先秦七子君子观研究[M].武汉大学出版社,2022.</p><p>[8] 詹时窗, 谢清果.中国道家之精神[M].复旦大学出版社,2009.</p><p>[9] 孟轲.《孟子·公孙丑下》.</p>]]></content>
      
      
      
        <tags>
            
            <tag> 哲学 </tag>
            
            <tag> 社会现象 </tag>
            
            <tag> 思考 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于宋庆龄</title>
      <link href="/2022/04/03/1000/"/>
      <url>/2022/04/03/1000/</url>
      
        <content type="html"><![CDATA[<p>下了什刹海站，穿越狭长的胡同，就来到了后海。沿着岸边走约百米，便是宋庆龄故居。春和景明，波澜不兴。我们来到这里的时候，路人笑着和我们说，院里的西府海棠正开得茂盛。 </p><p>宋庆龄在北京的居所十分静谧。江南的假山、流水、小桥，北方迂回的长亭、宽敞的院落，摇曳的枝条与细碎的阳光，一切都结合得恰到好处。 </p><p>在展馆的中央，是宋庆龄与孙中山的合影。四周陈满了信件和手稿。我被这样一句话吸引了：</p><blockquote><p>我是幸福的，我想尽量帮助我的丈夫处理英文信件。……对我来说，结婚就好像进了学校一样，不过没有烦人的“考试”罢了。  ——宋庆龄 </p></blockquote><p>通过阅读回忆录以及展品摘要，我们得知：在长期的相处和共同战斗之中，宋庆龄与孙中山坠入了爱河，甚至不顾父母的反对，逃离软禁。巨大的年龄差异没能成为他们爱情的鸿沟，他们携手走向永恒。 </p><p>孙中山送给宋庆龄的定情信物是一把小巧精致的手枪，她一直携带在身上。如今在展台上依旧熠熠生辉。 </p><p>1925 年，孙中山在北京逝世，她陷入了巨大的悲恸之中，但却没有因此消沉。在一年后的国民党二大上，发表了坚持孙中山三大政策的演说。她接续过丈夫身上的重担，继续为中国人民的民主与自由、和平与发展奋斗着。宋庆龄为了丈夫的遗愿，再次踏上了旅居欧洲的行程。她访问了莫斯科，寻求革命道路，在前苏联和欧洲求学，与友人积极探讨革命理论。 </p><p>宋庆龄为革命事业、和平事业和妇女儿童福利事业奋斗了终生。和孙中山一样，宋庆龄庆龄在国外接受了现代化的教育，萌生了先进的思想，在很多方面与孙中山先生相投。二人并不受封建思想观念的束缚，彼此奔赴成为眷属。早年，她谨慎热情地帮助孙中山先生处理各项事务，照顾他的生活，甚至是在危难关头毫不犹豫地挡在他地身前。体贴周到使得他得以安心的工作。在孙中山病逝后，她依然秉承着丈夫的志向，走向时代的风暴之眼。 </p><p>回顾宋庆龄先生的一生，我们很难不从中得到启迪。宋庆龄先生有着一颗赤诚的心，一是对自己的丈夫忠诚，她同他一起战斗，为他仕病、完成了他的遗愿；二是对华夏民族赤城。不论我们将目光投向哪个时间节点，宋庆龄先生永远是同中华民族的利益站在一起的，她总是不顾自己的安危，在骤变之时勇敢地批判、指责走向歧途的国民党，她所做的一切，都是为了让百姓免受苦难，让主权得以保证。 </p><p>出了展馆，再往前走十几米，就是和平鸽舍。宋庆龄先生享誉世界的另一个原因，便是她长期担任大量教育、妇女儿童等方面福利活动的要职，奔赴世界各地、前往第三世界的国家进行交流，成立大量基金会，矢志不渝地为中国和平乃至世界和平奋斗着。 </p><p>一名女性能在这样纷乱复杂、风起云涌的时代做出如此之多的贡献，是很难想象的。 </p><p>1981年5 月29日，民主与和平的斗士最终陨落了。她的故事、信件、手稿、画像、物件等被后人妥善地保存了下来，存放在这里，向公众展览。这里成为了一个爱国主义教育基地。 </p><p>心中但有信念，无处不放光芒。 </p><p><img src="/2022/04/03/1000/SongAndSun.jpg"></p><p>2022年4月于北京</p>]]></content>
      
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
            <tag> 宋庆龄 </tag>
            
            <tag> 历史 </tag>
            
            <tag> 人物 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于梦境</title>
      <link href="/1900/01/01/0000/"/>
      <url>/1900/01/01/0000/</url>
      
        <content type="html"><![CDATA[<p><code>先让时间无限倒退！此处标注的时间是计算机能够表示的最早时刻。这篇博文记录的文字没有经过加工，大多是我在半梦半醒的状态下记录下来的，读起来并不通顺。</code></p><p>梦境与大脑的进化程度高度相关，从某种不严谨的角度来看，或许哺乳动物的第一个梦，最早能够追溯到三叠纪晚期。我们的祖先在梦中遭遇了什么，有何奇遇、梦里的事物是令他们幸福还是恐惧，现如今人们已经无从得知了。梦总是消逝的飞快，从梦中惊醒，仅仅片刻所有的思绪便消失的无影无踪。近年来因为压力与作息的缘故，我常常做梦，时而引人入胜，时而荒诞离奇。<strong>为此，我开了这篇博文，若有机缘，便立刻记录下来，留待日后玩味。</strong></p><h2 id="《奇梦》（一）"><a href="#《奇梦》（一）" class="headerlink" title="《奇梦》（一）"></a>《奇梦》（一）</h2><p><strong>2023年10月13日；约莫1:00~8:28。注：自我在内蒙遭遇的事故发生后约20日。</strong></p><blockquote><p>我梦到我和几位████同学（p?w, l?g，l?y，z?l，████，小学同学罗██y）策划了一场自驾旅行，旅游路线记不清了。这是一场很伟大的旅行  瑰丽  壮阔 有部分是在空中。我们先是才空中穿过了一部分地区，我乘坐的是类似摩托车一样的黑色热气球，我坐在上面仿佛坐着摩托车，气球是需要充气的，他们好像是坐直升飞机或者跟我一样。我们从空中穿过了大半个地球，其实更像是从太空中看到的 。很震撼，我们能从太空中看到各种各样的地貌，比如内蒙的自然地理环境，但是雪顶，但是为啥看着还会带地名的呢？ 有一部分地区再闹蝗灾，我们从空中经过的时候天空到处是蝗虫流与我们逆行  虽然在出发前看新闻就有预先心理准备了，但是经过的时候还是惊讶到了 然后是地上部分   我们下来后  我将热气球放气，然后将它折叠收进书包。我们骑着各自的电车，在曾经的西南山里的一个█████出发，又好像回到了高一时上下学电车大军的时代。</p><p>我们路过████的那条街道，在对面████，然后又一次出发了。 我出发前还检查了行李，看看我的热气球还在不在。我们在红壹佰路与在江的路口左转，现在是████小学对面那条路的靠近████路的部分。我在这个地方和████聊了几句，我说我好像没带我电车的充电器。于是我开始忧虑这个，想着经过哪个地方的时候买一个。 但是因为下过雨，这里发生了路面塌陷，裹挟着泥泞的洪流遍地都是，然后在将要过马路的时候，那一部分道路塌陷比较严重，所以我花了点功夫才上去到主路，其实也就是一瞬间的事情，绿灯就走完了。但是这是突然前面有人举着爱心绿灯的牌子（是一个纸牌子但是上面有电子红绿灯和镶着光编的字）让我们这条路的人先过，就在这时，我身上有些瘙痒，然后我就醒了。</p><p>醒来以后：很难以理解的是，我们策划的路线应该是由华北平原北上然后穿过内蒙向西，为啥后面路面旅行的部分却是在家乡的这些地方呢？<br>另一个疑问是我们如何同样是一天多不到两天的时间里完成这么长的路线的旅行的？</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
            <tag> 记录 </tag>
            
            <tag> 梦境 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
