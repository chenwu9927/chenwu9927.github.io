<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Data Analysis-Week9~week13 | BlankChen</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Data Analysis-Week9~week13</h1><a id="logo" href="/.">BlankChen</a><p class="description">相逢的人会再相逢。</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home">Home</i></a><a href="/thoughts/"><i class="fa fa-lightbulb-o"> Thoughts</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Data Analysis-Week9~week13</h1><div class="post-meta">2023-05-15<span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4.7k</span><span class="post-meta-item-text"> Words</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 23</span><span class="post-meta-item-text"> Minutes</span></span></span></div><a class="disqus-comment-count" href="/2023/05/15/2239/#waline"><span class="waline-comment-count" id="/2023/05/15/2239/"></span><span> Comment</span></a><div class="post-content"><h1 id="Week-9"><a href="#Week-9" class="headerlink" title="Week 9"></a>Week 9</h1><blockquote><p>在数据分析中，常常需要迭代的内容数据量过大，无法一次性加载。例如，在图像相关的深度学习任务中，由于数据总量过大，一次性加载全部数据耗时过长、内存占用过大，因此一般会采用批量加载数据的方法。现提供文件FaceImages.zip(<a target="_blank" rel="noopener" href="http://vis-www.cs.umass.edu/fddb/originalPics.tar.gz%EF%BC%8C%E5%85%B6%E4%B8%AD%E5%8C%85%E5%90%AB5000%E4%BD%99%E5%BC%A0%E4%BA%BA%E8%84%B8%E5%9B%BE%E7%89%87%E3%80%82%E8%A6%81%E6%B1%82%E8%AE%BE%E8%AE%A1FaceDataset%E7%B1%BB%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%A0%E8%BD%BD%E3%80%82%E5%85%B7%E4%BD%93%E8%A6%81%E6%B1%82%EF%BC%9A">http://vis-www.cs.umass.edu/fddb/originalPics.tar.gz，其中包含5000余张人脸图片。要求设计FaceDataset类，实现图片数据的加载。具体要求：</a></p><ol><li>该类至少有一个数据属性_path，来接收图片目录的路径，且该属性在实例化时通过参数来初始化。</li><li>该类有一个生成器方法image_generator，能够生成一张图片数据的ndarray形式并返回（利用PIL库实现）。</li><li>实现__iter__方法，使得该类支持迭代器相关的操作。</li><li>实现__next__方法，根据类内的图片路径列表，迭代地加载并以ndarray形式返回图片数据。</li><li>对上述生成器和迭代器相关的方法进行测试。</li><li>（附加）实现__len__方法，返回数据集中图片的数量。</li><li>（附加）实现__getitem__方法，使得该类的实例fd支持fd[i]的形式来获取第i+1个图片的ndarray。</li><li>（附加）该类有一个生成器方法image_representation_generator方法，可以利有预训练模型Vgg或Restnet来生成图片的向量表示。</li><li>（附加）尝试用预训练模型生成的向量来计算图片相似性（如两个向量之间的夹角等）。</li></ol></blockquote><h4 id="库"><a href="#库" class="headerlink" title="库"></a>库</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> keras_vggface.vggface <span class="keyword">import</span> VGGFace</span><br><span class="line"><span class="keyword">from</span> keras_vggface.utils <span class="keyword">import</span> preprocess_input</span><br><span class="line"><span class="keyword">import</span> tensorflow.python.keras.engine</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> sys</span><br></pre></td></tr></table></figure><h4 id="FaceDataset-类"><a href="#FaceDataset-类" class="headerlink" title="FaceDataset 类"></a><code>FaceDataset</code> 类</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FaceDataset</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,path</span>):</span><br><span class="line">        <span class="variable language_">self</span>._path=path</span><br><span class="line">        <span class="variable language_">self</span>._file_list=[file <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(<span class="variable language_">self</span>._path)]</span><br><span class="line">        <span class="variable language_">self</span>._start=<span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>._length=<span class="built_in">len</span>(<span class="variable language_">self</span>._file_list)</span><br><span class="line">        <span class="variable language_">self</span>._idx=<span class="variable language_">self</span>._start</span><br><span class="line">        <span class="variable language_">self</span>._model=VGGFace(model=<span class="string">&#x27;vgg16&#x27;</span>)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._idx &gt;= <span class="variable language_">self</span>._length:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            imgg_array=<span class="variable language_">self</span>.__getitem__(<span class="variable language_">self</span>._idx)</span><br><span class="line">            <span class="variable language_">self</span>._idx+=<span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> imgg_array</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__len__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(<span class="variable language_">self</span>._file_list)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getitem__</span>(<span class="params">self, idx</span>):</span><br><span class="line">        imgg=Image.<span class="built_in">open</span>(os.path.join(<span class="variable language_">self</span>._path,<span class="variable language_">self</span>._file_list[idx]))</span><br><span class="line">        imgg_data=imgg.getdata()</span><br><span class="line">        <span class="keyword">return</span> np.reshape(imgg_data,(imgg.height,imgg.width,<span class="built_in">len</span>(imgg.getbands())))</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_generator</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable language_">self</span>._file_list:</span><br><span class="line">            imgg=Image.<span class="built_in">open</span>(os.path.join(<span class="variable language_">self</span>._path,file))</span><br><span class="line">            imgg_data=imgg.getdata()</span><br><span class="line">            <span class="keyword">yield</span> np.reshape(imgg_data,(imgg.height,imgg.width,<span class="built_in">len</span>(imgg.getbands())))</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_representation_generator</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> file_path <span class="keyword">in</span> <span class="variable language_">self</span>._file_list:</span><br><span class="line">            imgg=Image.<span class="built_in">open</span>(os.path.join(<span class="variable language_">self</span>._path,file_path))</span><br><span class="line">            imgg_array=np.reshape(imgg.getdata(),(imgg.height,imgg.width,<span class="built_in">len</span>(imgg.getbands())))</span><br><span class="line">            pre_processed_imgg=preprocess_input(imgg_array)</span><br><span class="line">            pre_presented_imgg=<span class="variable language_">self</span>._model.predict(pre_processed_imgg)</span><br><span class="line">            <span class="keyword">yield</span> pre_presented_imgg</span><br></pre></td></tr></table></figure><h4 id="测试-next"><a href="#测试-next" class="headerlink" title="测试  __next__"></a>测试 <code>__next__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(): 			lib_path=<span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/originalPics/2002/07/20/big&#x27;</span></span><br><span class="line">    dataset=FaceDataset(lib_path)</span><br><span class="line">    <span class="keyword">for</span> image_array <span class="keyword">in</span> dataset:</span><br><span class="line">        <span class="built_in">print</span>(image_array.shape)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="测试-image-generator"><a href="#测试-image-generator" class="headerlink" title="测试  image_generator"></a>测试 <code>image_generator</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():        lib_path=<span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/originalPics/2002/07/20/big&#x27;</span></span><br><span class="line">    dataset=FaceDataset(lib_path)</span><br><span class="line">    <span class="keyword">for</span> image_array <span class="keyword">in</span> dataset.image_generator():</span><br><span class="line">        <span class="built_in">print</span>(image_array.shape)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="测试-len-和-getitem"><a href="#测试-len-和-getitem" class="headerlink" title="测试__len__ 和__getitem__"></a>测试<code>__len__</code> 和<code>__getitem__</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">lib_path=<span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/originalPics/2002/07/20/big&#x27;</span></span><br><span class="line">    dataset=FaceDataset(lib_path)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(dataset))</span><br><span class="line">    <span class="built_in">print</span>(dataset[<span class="number">0</span>].shape)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="用预训练模型生成的向量来计算图片相似性"><a href="#用预训练模型生成的向量来计算图片相似性" class="headerlink" title="用预训练模型生成的向量来计算图片相似性"></a>用预训练模型生成的向量来计算图片相似性</h4><h6 id="增加库"><a href="#增加库" class="headerlink" title="增加库"></a>增加库</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics.pairwise <span class="keyword">import</span> cosine_similarity </span><br></pre></td></tr></table></figure><h6 id="修改FaceDataset中的部分方法"><a href="#修改FaceDataset中的部分方法" class="headerlink" title="修改FaceDataset中的部分方法"></a>修改<code>FaceDataset</code>中的部分方法</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FaceDataset</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_generator</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> <span class="variable language_">self</span>._file_list:</span><br><span class="line">            imgg=Image.<span class="built_in">open</span>(os.path.join(<span class="variable language_">self</span>._path,file))</span><br><span class="line">            imgg_data=imgg.getdata()</span><br><span class="line">            <span class="keyword">yield</span> np.reshape(imgg_data,(imgg.height,imgg.width,<span class="built_in">len</span>(imgg.getbands())))</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">image_representation_generator</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> file_path <span class="keyword">in</span> <span class="variable language_">self</span>._file_list:</span><br><span class="line">            img_path = os.path.join(<span class="variable language_">self</span>._path, file_path)</span><br><span class="line">            imgg_array = cv2.imread(img_path)</span><br><span class="line">            imgg_array = cv2.cvtColor(imgg_array, cv2.COLOR_BGR2RGB)</span><br><span class="line">            imgg_array = cv2.resize(imgg_array, (<span class="number">224</span>, <span class="number">224</span>))</span><br><span class="line">            imgg_array = np.expand_dims(imgg_array, axis=<span class="number">0</span>)</span><br><span class="line">            pre_processed_imgg = preprocess_input(imgg_array.astype(<span class="string">&#x27;float32&#x27;</span>))</span><br><span class="line">            pre_presented_imgg = <span class="variable language_">self</span>._model.predict(pre_processed_imgg)</span><br><span class="line">            <span class="keyword">yield</span> pre_presented_imgg</span><br></pre></td></tr></table></figure><h6 id="测试函数"><a href="#测试函数" class="headerlink" title="测试函数"></a>测试函数</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    lib_path = <span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/originalPics/2002/07/20/big&#x27;</span></span><br><span class="line">    dataset = FaceDataset(lib_path)</span><br><span class="line">    vector=[]</span><br><span class="line">    model=VGGFace(model=<span class="string">&#x27;vgg16&#x27;</span>,include_top=<span class="literal">False</span>,input_shape=(<span class="number">224</span>,<span class="number">224</span>,<span class="number">3</span>),pooling=<span class="string">&#x27;avg&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> ele <span class="keyword">in</span> dataset.image_representation_generator():</span><br><span class="line">        vector.append(ele)</span><br><span class="line">    <span class="keyword">for</span> ele <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(vector)):</span><br><span class="line">        <span class="keyword">for</span> tlt <span class="keyword">in</span> <span class="built_in">range</span>(ele,<span class="built_in">len</span>(vector)):</span><br><span class="line">            sim=cosine_similarity(vector[ele],vector[tlt])[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;image <span class="subst">&#123;ele+<span class="number">1</span>&#125;</span> &amp; image <span class="subst">&#123;tlt+<span class="number">1</span>&#125;</span> similarity:<span class="subst">&#123;sim:<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h1 id="Week-11"><a href="#Week-11" class="headerlink" title="Week 11"></a>Week 11</h1><blockquote><p>当需要计算多段音频统的音高等特征时，串行计算往往需要耗费较长的时间。本周作业要求利用librosa库以及Python多进程实现对多个音频的并行特征计算：</p><ol><li>主进程读取声音数据目录，得到所有声音文件的列表；</li><li>直接使用Process类构建子进程，利用libraso提供的支持来计算音高和声强，并保存计算结果到文件（一个声音一个文件 ）。</li><li>通过继承Process类来构建子进程，同样利用libraso提供的支持来计算音高和声强，并保存计算结果到文件（一个声音一个文件 ）。</li><li>在主进程中启动利用2，3中构建的子进程，并分发（如通过队列）参数（声音文件名）。</li></ol><p>5（附加）. 观察在一定数目的声音文件处理时（建议文件多一些），子进程数目变化与处理总时长的关系。</p><p>6（附加）. 如果修改2，3中的要求，不再为每个声音保存一个文件，而是将所有声音的结果保存到一个文件中，应该如何处理？比如，计算子进程会将结果写入一个队列，而一个新的Writer子进程将负责从队列里读取内容并写入一个特定的汇总文件。<br>参考资料</p><p><a target="_blank" rel="noopener" href="https://librosa.org/doc/latest/generated/librosa.yin.html#librosa.yin">https://librosa.org/doc/latest/generated/librosa.yin.html#librosa.yin</a><br><a target="_blank" rel="noopener" href="https://librosa.org/doc/latest/generated/librosa.amplitude_to_db.html#librosa.amplitude_to_db">https://librosa.org/doc/latest/generated/librosa.amplitude_to_db.html#librosa.amplitude_to_db</a></p></blockquote><h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><h3 id="库-1"><a href="#库-1" class="headerlink" title="库"></a>库</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing <span class="keyword">as</span> mp</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> librosa</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure><h3 id="基本代码"><a href="#基本代码" class="headerlink" title="基本代码"></a>基本代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main_process</span>(<span class="params">path</span>):</span><br><span class="line">    wav_doc_list = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.wav&#x27;</span>):</span><br><span class="line">            wav_doc_list.append(os.path.join(path, file))</span><br><span class="line">    <span class="keyword">return</span> wav_doc_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_process</span>(<span class="params">queue</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> queue.empty():</span><br><span class="line">        path = queue.get()</span><br><span class="line">        write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">            pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">            data = <span class="string">&#x27;pitches: &#x27;</span> + <span class="built_in">str</span>(pitches) + <span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27; magnitudes: &#x27;</span> + <span class="built_in">str</span>(magnitudes) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            f.write(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubProcess</span>(multiprocessing.Process):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, queue</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.queue = queue</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> <span class="variable language_">self</span>.queue.empty():</span><br><span class="line">            path = <span class="variable language_">self</span>.queue.get()</span><br><span class="line">            write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">                pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">                data = <span class="string">f&#x27;pitches: <span class="subst">&#123;<span class="built_in">str</span>(pitches)&#125;</span>\n magnitudes: <span class="subst">&#123;<span class="built_in">str</span>(magnitudes)&#125;</span>\n&#x27;</span></span><br><span class="line">                f.write(data)</span><br></pre></td></tr></table></figure><hr><h2 id="直接使用Process类构建子进程"><a href="#直接使用Process类构建子进程" class="headerlink" title="直接使用Process类构建子进程"></a>直接使用Process类构建子进程</h2><blockquote><ol start="2"><li><p>直接使用Process类构建子进程，利用libraso提供的支持来计算音高和声强，并保存计算结果到文件（一个声音一个文件 ）。</p></li><li><p>在主进程中启动利用2，3中构建的子进程，并分发（如通过队列）参数（声音文件名）。</p></li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main_process</span>(<span class="params">path</span>):</span><br><span class="line">    mp3_doc_list = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.wav&#x27;</span>):</span><br><span class="line">            mp3_doc_list.append(os.path.join(path, file))</span><br><span class="line">    <span class="keyword">return</span> mp3_doc_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_process</span>(<span class="params">queue</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> queue.empty():</span><br><span class="line">        path = queue.get()</span><br><span class="line">        write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">            pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">            data = <span class="string">&#x27;pitches: &#x27;</span> + <span class="built_in">str</span>(pitches) + <span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27; magnitudes: &#x27;</span> + <span class="built_in">str</span>(magnitudes) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            f.write(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/wav_list&#x27;</span></span><br><span class="line">    doc_list = main_process(path=path)</span><br><span class="line">    queue = multiprocessing.Queue()</span><br><span class="line">    processes = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> doc_list:</span><br><span class="line">        queue.put(file)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(doc_list)):</span><br><span class="line">        pro_ = multiprocessing.Process(target=sub_process, args=(queue,))</span><br><span class="line">        pro_.start()</span><br><span class="line">        processes.append(pro_)</span><br><span class="line">    <span class="keyword">for</span> ele <span class="keyword">in</span> processes:</span><br><span class="line">        ele.join()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;已完成。&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="通过继承Process类来构建子进程"><a href="#通过继承Process类来构建子进程" class="headerlink" title="通过继承Process类来构建子进程"></a>通过继承Process类来构建子进程</h2><blockquote><ol start="3"><li><p>通过继承Process类来构建子进程，同样利用libraso提供的支持来计算音高和声强，并保存计算结果到文件（一个声音一个文件 ）。</p></li><li><p>在主进程中启动利用2，3中构建的子进程，并分发（如通过队列）参数（声音文件名）。</p></li></ol></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main_process</span>(<span class="params">path</span>):</span><br><span class="line">    wav_doc_list = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.wav&#x27;</span>):</span><br><span class="line">            wav_doc_list.append(os.path.join(path, file))</span><br><span class="line">    <span class="keyword">return</span> wav_doc_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubProcess</span>(multiprocessing.Process):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, queue</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.queue = queue</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> <span class="variable language_">self</span>.queue.empty():</span><br><span class="line">            path = <span class="variable language_">self</span>.queue.get()</span><br><span class="line">            write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">                pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">                data = <span class="string">f&#x27;pitches: <span class="subst">&#123;<span class="built_in">str</span>(pitches)&#125;</span>\n magnitudes: <span class="subst">&#123;<span class="built_in">str</span>(magnitudes)&#125;</span>\n&#x27;</span></span><br><span class="line">                f.write(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/wav_list&#x27;</span></span><br><span class="line">    doc_list = main_process(path=path)</span><br><span class="line">    queue = multiprocessing.Queue()</span><br><span class="line">    processes = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> doc_list:</span><br><span class="line">        queue.put(file)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(doc_list)):</span><br><span class="line">        pro_ = SubProcess(queue=queue)</span><br><span class="line">        pro_.start()</span><br><span class="line">        processes.append(pro_)</span><br><span class="line">    <span class="keyword">for</span> ele <span class="keyword">in</span> processes:</span><br><span class="line">        ele.join()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;已完成。&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h2 id="探究子进程数目与运行时长的关系"><a href="#探究子进程数目与运行时长的关系" class="headerlink" title="探究子进程数目与运行时长的关系"></a>探究子进程数目与运行时长的关系</h2><blockquote><p>5（附加）. 观察在一定数目的声音文件处理时（建议文件多一些），子进程数目变化与处理总时长的关系。</p></blockquote><p>* <em>为了方便后续测试起见，以下代码中略去了最后一步文件写入的步骤。</em></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main_process</span>(<span class="params">path</span>):</span><br><span class="line">    wav_doc_list = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.wav&#x27;</span>):</span><br><span class="line">            wav_doc_list.append(os.path.join(path, file))</span><br><span class="line">    <span class="keyword">return</span> wav_doc_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_process</span>(<span class="params">path</span>):</span><br><span class="line">    write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">        pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">        data = <span class="string">f&#x27;pitches: <span class="subst">&#123;<span class="built_in">str</span>(pitches)&#125;</span>\n magnitudes: <span class="subst">&#123;<span class="built_in">str</span>(magnitudes)&#125;</span>\n&#x27;</span></span><br><span class="line">        <span class="comment"># f.write(data)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/wav_list&#x27;</span></span><br><span class="line">    doc_list = main_process(path=path)</span><br><span class="line">    start=time.time()</span><br><span class="line">    pool = mp.Pool(processes=<span class="number">1</span>)</span><br><span class="line">    result = pool.<span class="built_in">map</span>(sub_process, doc_list)</span><br><span class="line">    end=time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;已完成, 耗时:<span class="subst">&#123;end-start&#125;</span>s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><p>当<code>processes==1</code>时，耗时<code>9.906246900558472s</code>。</p><p>当<code>processes==3</code>时，耗时<code>4.453998327255249s</code>。</p><p>当<code>processes==5</code>时，耗时<code>4.425124406814575s</code>。</p><p>当<code>processes==7</code>时，耗时<code>4.3829286098480225s</code>。</p><p>当<code>processes==8</code>时，耗时<code>4.366180181503296s</code>。</p><p>当<code>processes==9</code>时，耗时<code>4.445085048675537s</code>。</p><p>当<code>processes==12</code>时，耗时<code>4.432607412338257s</code>。</p><p>可以初步猜测随着进程数的增加，程序耗时向下降后上升。当进程数为8时，耗时达到最小。</p><h3 id="完整测试"><a href="#完整测试" class="headerlink" title="完整测试"></a>完整测试</h3><h4 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main_process</span>(<span class="params">path</span>):</span><br><span class="line">    wav_doc_list = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">        <span class="keyword">if</span> file.endswith(<span class="string">&#x27;.wav&#x27;</span>):</span><br><span class="line">            wav_doc_list.append(os.path.join(path, file))</span><br><span class="line">    <span class="keyword">return</span> wav_doc_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_process</span>(<span class="params">path</span>):</span><br><span class="line">    write_in_path = path.replace(<span class="string">&#x27;.wav&#x27;</span>, <span class="string">&#x27;.txt&#x27;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(write_in_path, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        y, sr = librosa.load(path, sr=<span class="literal">None</span>)</span><br><span class="line">        pitches, magnitudes = librosa.piptrack(y=y, sr=sr)</span><br><span class="line">        data = <span class="string">f&#x27;pitches: <span class="subst">&#123;<span class="built_in">str</span>(pitches)&#125;</span>\n magnitudes: <span class="subst">&#123;<span class="built_in">str</span>(magnitudes)&#125;</span>\n&#x27;</span></span><br><span class="line">        <span class="comment"># f.write(data)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    path = <span class="string">&#x27;C:/Users/Administrator/Desktop/using_python/wav_list&#x27;</span></span><br><span class="line">    doc_list = main_process(path=path)</span><br><span class="line">    x_list=[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>)]</span><br><span class="line">    y_list=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> x_list:</span><br><span class="line">        start=time.time()</span><br><span class="line">        pool = mp.Pool(processes=i)</span><br><span class="line">        result = pool.<span class="built_in">map</span>(sub_process, doc_list)</span><br><span class="line">        end=time.time()</span><br><span class="line">        y_list.append(end-start)</span><br><span class="line">    plt.title(<span class="string">&quot;Points and Fitting Curve&quot;</span>)</span><br><span class="line">    plt.xlabel(<span class="string">&quot;process num/(int)&quot;</span>)</span><br><span class="line">    plt.ylabel(<span class="string">&quot;time cost/(s)&quot;</span>)</span><br><span class="line">    plt.grid(<span class="literal">True</span>)</span><br><span class="line">    plt.xlim(<span class="built_in">min</span>(x_list) - <span class="number">1</span>, <span class="built_in">max</span>(x_list) + <span class="number">1</span>)</span><br><span class="line">    plt.ylim(<span class="built_in">min</span>(y_list) - <span class="number">1</span>, <span class="built_in">max</span>(y_list) + <span class="number">1</span>)</span><br><span class="line">    plt.plot(x_list, y_list, <span class="string">&quot;ro&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x_list)):</span><br><span class="line">        plt.annotate(<span class="string">&quot;(&#123;:.1f&#125;, &#123;:.1f&#125;)&quot;</span>.<span class="built_in">format</span>(x_list[i], y_list[i]), xy=(x_list[i], y_list[i]), xytext=(-<span class="number">15</span>, <span class="number">15</span>),</span><br><span class="line">                     textcoords=<span class="string">&quot;Process num via time cost&quot;</span>, ha=<span class="string">&quot;center&quot;</span>, va=<span class="string">&quot;top&quot;</span>)</span><br><span class="line">    coefficients = np.polyfit(np.array(x_list), np.array(y_list), <span class="number">3</span>)</span><br><span class="line">    p = np.poly1d(coefficients)</span><br><span class="line">    x_range = np.linspace(<span class="built_in">min</span>(x_list) - <span class="number">1</span>, <span class="built_in">max</span>(x_list) + <span class="number">1</span>, <span class="number">1000</span>)</span><br><span class="line">    y_range = p(x_range)</span><br><span class="line">    plt.plot(x_range, y_range, <span class="string">&quot;b-&quot;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>可见，随着进程数的增加，程序耗时向下降后上升。当进程数为8时，耗时达到最小。</p><h1 id="Week-12"><a href="#Week-12" class="headerlink" title="Week 12"></a>Week 12</h1><blockquote><p>利用Python的多线程实现音频文件的采集，并计算语速。</p><ol><li>通过类继承，实现一个线程类，参考voa.py中的示例，从<a target="_blank" rel="noopener" href="https://www.51voa.com/VOA_Standard_3.html">https://www.51voa.com/VOA_Standard_3.html</a> (其中 “3”可被替换为其他数字，对应翻页操作)中获取新的链接地址列表。</li><li>通过类继承，实现一个线程类，参考voa.py中的示例，从1中获取的链接（如<a target="_blank" rel="noopener" href="https://www.51voa.com/VOA_Standard_English/u-s-supports-diversity-of-energy-sources-in-europe-79541.html%EF%BC%89%E8%8E%B7%E5%8F%96mp3%E6%96%87%E4%BB%B6%E9%93%BE%E6%8E%A5%E3%80%82">https://www.51voa.com/VOA_Standard_English/u-s-supports-diversity-of-energy-sources-in-europe-79541.html）获取mp3文件链接。</a></li><li>通过类继承，实现一个线程类，参考voa.py中的示例，利用2中的mp3文件链接（如<a target="_blank" rel="noopener" href="https://files.51voa.cn/201806/fighting-tb-in-uzbekistan.mp3%EF%BC%89%EF%BC%8C%E5%B0%86%E6%96%87%E4%BB%B6%E4%BF%9D%E5%AD%98%E5%88%B0%E6%9C%AC%E5%9C%B0%E3%80%82">https://files.51voa.cn/201806/fighting-tb-in-uzbekistan.mp3），将文件保存到本地。</a></li><li>通过类继承，实现一个线程类，参考sr.py中的示例，对存储的音频文件计算语速。</li><li>设计一种同步策略（比如用线程池，或锁，或队列等），实现1，2，3，4中几种不同功能线程的配合，实现多线程的mp3文件下载功能，并进行语速的计算和输出。</li><li>(附加)考虑到Python的多进程更适合计算密集型的任务，可否在4中不使用线程，而使用多进程来计算存储文件的语速？即主进程的多线程负责音频文件的下载与存储，另几个子进程则负责语速计算。比较一下与5中线程设计的速度差异。</li><li>（附加）音频采集如果时间过长，可能会因为外部因素（网络等）出现意外的中断，可否设计一种“断点”的记录机制，使得即使采集过程被打断，也能够从上次的断点继续开始，避免重复采集。</li></ol></blockquote><h2 id="库-2"><a href="#库-2" class="headerlink" title="库"></a>库</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> wave</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> librosa</span><br><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br></pre></td></tr></table></figure><h2 id="主体"><a href="#主体" class="headerlink" title="主体"></a>主体</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VoaThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,start_page,end_page,link_list</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.start_page=start_page</span><br><span class="line">        <span class="variable language_">self</span>.end_page=end_page</span><br><span class="line">        <span class="variable language_">self</span>.link_list=link_list</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.start_page,<span class="variable language_">self</span>.end_page):</span><br><span class="line">            url = <span class="string">f&#x27;https://www.51voa.com/VOA_Standard_<span class="subst">&#123;i&#125;</span>.html&#x27;</span></span><br><span class="line">            response=requests.get(url)</span><br><span class="line">            html=etree.HTML(response.text)</span><br><span class="line">            links=[]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">                links = links+html.xpath(<span class="string">&#x27;//*[@id=&quot;righter&quot;]/div[3]/ul/li[%s]/a/@href&#x27;</span>%<span class="built_in">str</span>(j))</span><br><span class="line">            <span class="keyword">for</span> ele <span class="keyword">in</span> links:</span><br><span class="line">                <span class="variable language_">self</span>.link_list.append(ele)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GetMP3Thread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,link_list</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.link_list=link_list</span><br><span class="line">        <span class="variable language_">self</span>.mlist=[]</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> tqdm(<span class="variable language_">self</span>.link_list[:<span class="number">5</span>]):</span><br><span class="line">            url=<span class="string">&#x27;https://www.51voa.com&#x27;</span>+link</span><br><span class="line">            response=requests.get(url,headers=<span class="variable language_">self</span>.headers)</span><br><span class="line">            <span class="variable language_">self</span>.mlist = <span class="variable language_">self</span>.mlist+<span class="built_in">list</span>(<span class="built_in">set</span>(re.findall(<span class="string">r&#x27;https://.+?\.mp3&#x27;</span>, response.text)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DownloadMP3Thread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, mlist, directory=<span class="string">&#x27;.&#x27;</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.mlist = mlist</span><br><span class="line">        <span class="variable language_">self</span>.directory = directory</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> murl <span class="keyword">in</span> tqdm(<span class="variable language_">self</span>.mlist):</span><br><span class="line">            mp3_stream = requests.get(murl, headers=<span class="variable language_">self</span>.headers).content</span><br><span class="line">            fname = murl[murl.rfind(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>:]</span><br><span class="line">            path = os.path.join(<span class="variable language_">self</span>.directory, fname)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(mp3_stream)</span><br><span class="line">                </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpeechRateThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, filename</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.filename = filename</span><br><span class="line">        <span class="variable language_">self</span>.words_per_second = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        y, sr = librosa.load(<span class="variable language_">self</span>.filename, sr=<span class="literal">None</span>)</span><br><span class="line">        onsets = librosa.onset.onset_detect(y=y, sr=sr, units=<span class="string">&quot;time&quot;</span>, hop_length=<span class="number">128</span>, backtrack=<span class="literal">False</span>)</span><br><span class="line">        number_of_words = <span class="built_in">len</span>(onsets)</span><br><span class="line">        duration = <span class="built_in">len</span>(y) / sr</span><br><span class="line">        <span class="variable language_">self</span>.words_per_second = number_of_words / duration</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_words_per_second</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.words_per_second</span><br></pre></td></tr></table></figure><h2 id="获取链接并下载MP3文件"><a href="#获取链接并下载MP3文件" class="headerlink" title="获取链接并下载MP3文件"></a>获取链接并下载MP3文件</h2><h4 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h4><blockquote><ol><li>通过类继承，实现一个线程类，参考voa.py中的示例，从<a target="_blank" rel="noopener" href="https://www.51voa.com/VOA_Standard_3.html">https://www.51voa.com/VOA_Standard_3.html</a> (其中 “3”可被替换为其他数字，对应翻页操作)中获取新的链接地址列表。</li><li>通过类继承，实现一个线程类，参考voa.py中的示例，从1中获取的链接（如<a target="_blank" rel="noopener" href="https://www.51voa.com/VOA_Standard_English/u-s-supports-diversity-of-energy-sources-in-europe-79541.html%EF%BC%89%E8%8E%B7%E5%8F%96mp3%E6%96%87%E4%BB%B6%E9%93%BE%E6%8E%A5%E3%80%82">https://www.51voa.com/VOA_Standard_English/u-s-supports-diversity-of-energy-sources-in-europe-79541.html）获取mp3文件链接。</a></li><li>通过类继承，实现一个线程类，参考voa.py中的示例，利用2中的mp3文件链接（如<a target="_blank" rel="noopener" href="https://files.51voa.cn/201806/fighting-tb-in-uzbekistan.mp3%EF%BC%89%EF%BC%8C%E5%B0%86%E6%96%87%E4%BB%B6%E4%BF%9D%E5%AD%98%E5%88%B0%E6%9C%AC%E5%9C%B0%E3%80%82">https://files.51voa.cn/201806/fighting-tb-in-uzbekistan.mp3），将文件保存到本地。</a></li></ol></blockquote><h4 id="测试代码："><a href="#测试代码：" class="headerlink" title="测试代码："></a>测试代码：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    link_list = []</span><br><span class="line">    voa_thread = VoaThread(<span class="number">1</span>, <span class="number">6</span>, link_list)</span><br><span class="line">    voa_thread.start()</span><br><span class="line">    voa_thread.join()</span><br><span class="line"></span><br><span class="line">    get_mp3_thread = GetMP3Thread(link_list)</span><br><span class="line">    get_mp3_thread.start()</span><br><span class="line">    get_mp3_thread.join()</span><br><span class="line"></span><br><span class="line">    download_mp3_thread = DownloadMP3Thread(get_mp3_thread.mlist,<span class="string">&#x27;C:/Users/Administrator/Desktop/save_path&#x27;</span>)</span><br><span class="line">    download_mp3_thread.start()</span><br><span class="line">    download_mp3_thread.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="测试结果："><a href="#测试结果：" class="headerlink" title="测试结果："></a>测试结果：</h4><h1><a href="#" class="headerlink"></a></h1><h2 id="计算对应音频文件的语速"><a href="#计算对应音频文件的语速" class="headerlink" title="计算对应音频文件的语速"></a>计算对应音频文件的语速</h2><h4 id="问题：-1"><a href="#问题：-1" class="headerlink" title="问题："></a>问题：</h4><blockquote><ol start="4"><li>通过类继承，实现一个线程类，参考sr.py中的示例，对存储的音频文件计算语速。</li></ol></blockquote><h4 id="测试代码：-1"><a href="#测试代码：-1" class="headerlink" title="测试代码："></a>测试代码：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">        link_list = []</span><br><span class="line">        voa_thread = VoaThread(<span class="number">1</span>, <span class="number">6</span>, link_list)</span><br><span class="line">        voa_thread.start()</span><br><span class="line">        voa_thread.join()</span><br><span class="line"></span><br><span class="line">        get_mp3_thread = GetMP3Thread(link_list)</span><br><span class="line">        get_mp3_thread.start()</span><br><span class="line">        get_mp3_thread.join()</span><br><span class="line"></span><br><span class="line">        download_mp3_thread = DownloadMP3Thread(get_mp3_thread.mlist)</span><br><span class="line">        download_mp3_thread.start()</span><br><span class="line">        download_mp3_thread.join()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> mp3_file <span class="keyword">in</span> get_mp3_thread.mlist:</span><br><span class="line">            speechrate_thread = SpeechRateThread(mp3_file)</span><br><span class="line">            speechrate_thread.start()</span><br><span class="line">            speechrate_thread.join()</span><br><span class="line"></span><br><span class="line">            words_per_second = speechrate_thread.get_words_per_second()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;os.path.basename(mp3_file)&#125;</span>: <span class="subst">&#123;words_per_second&#125;</span> words-per-second&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h4 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h4><h1 id="-1"><a href="#-1" class="headerlink"></a></h1><h2 id="同步策略"><a href="#同步策略" class="headerlink" title="同步策略"></a>同步策略</h2><h4 id="主体改动："><a href="#主体改动：" class="headerlink" title="主体改动："></a>主体改动：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VoaThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,start_page,end_page,link_queue</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.start_page=start_page</span><br><span class="line">        <span class="variable language_">self</span>.end_page=end_page</span><br><span class="line">        <span class="variable language_">self</span>.link_queue=link_queue</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.start_page,<span class="variable language_">self</span>.end_page):</span><br><span class="line">            url = <span class="string">f&#x27;https://www.51voa.com/VOA_Standard_<span class="subst">&#123;i&#125;</span>.html&#x27;</span></span><br><span class="line">            response=requests.get(url)</span><br><span class="line">            html=etree.HTML(response.text)</span><br><span class="line">            links=[]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">                links = links+html.xpath(<span class="string">&#x27;//*[@id=&quot;righter&quot;]/div[3]/ul/li[%s]/a/@href&#x27;</span>%<span class="built_in">str</span>(j))</span><br><span class="line">            <span class="keyword">for</span> ele <span class="keyword">in</span> links:</span><br><span class="line">                <span class="variable language_">self</span>.link_queue.put(ele)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GetMP3Thread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,link_queue, mlist_queue</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.link_queue=link_queue</span><br><span class="line">        <span class="variable language_">self</span>.mlist_queue=mlist_queue</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> <span class="variable language_">self</span>.link_queue.empty():</span><br><span class="line">            link = <span class="variable language_">self</span>.link_queue.get()</span><br><span class="line">            url=<span class="string">&#x27;https://www.51voa.com&#x27;</span>+link</span><br><span class="line">            response=requests.get(url,headers=<span class="variable language_">self</span>.headers)</span><br><span class="line">            mlist = <span class="built_in">list</span>(<span class="built_in">set</span>(re.findall(<span class="string">r&#x27;https://.+?\.mp3&#x27;</span>, response.text)))</span><br><span class="line">            <span class="keyword">for</span> murl <span class="keyword">in</span> mlist:</span><br><span class="line">                <span class="variable language_">self</span>.mlist_queue.put(murl)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DownloadMP3Thread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, mlist_queue, directory=<span class="string">&#x27;.&#x27;</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">self</span>.mlist_queue = mlist_queue</span><br><span class="line">        <span class="variable language_">self</span>.directory = directory</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> <span class="variable language_">self</span>.mlist_queue.empty():</span><br><span class="line">            murl = <span class="variable language_">self</span>.mlist_queue.get()</span><br><span class="line">            mp3_stream = requests.get(murl, headers=<span class="variable language_">self</span>.headers).content</span><br><span class="line">            fname = murl[murl.rfind(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>:]</span><br><span class="line">            path = os.path.join(<span class="variable language_">self</span>.directory, fname)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(mp3_stream)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpeechRateThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, filename, words_per_second_queue</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.filename = filename</span><br><span class="line">        <span class="variable language_">self</span>.words_per_second_queue = words_per_second_queue</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        y, sr = librosa.load(<span class="variable language_">self</span>.filename, sr=<span class="literal">None</span>)</span><br><span class="line">        onsets = librosa.onset.onset_detect(y=y, sr=sr, units=<span class="string">&quot;time&quot;</span>, hop_length=<span class="number">128</span>, backtrack=<span class="literal">False</span>)</span><br><span class="line">        number_of_words = <span class="built_in">len</span>(onsets)</span><br><span class="line">        duration = <span class="built_in">len</span>(y) / sr</span><br><span class="line">        words_per_second = number_of_words / duration</span><br><span class="line">        <span class="variable language_">self</span>.words_per_second_queue.put(words_per_second)</span><br></pre></td></tr></table></figure><h4 id="测试代码：-2"><a href="#测试代码：-2" class="headerlink" title="测试代码："></a>测试代码：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    link_queue = queue.Queue()</span><br><span class="line">    mlist_queue = queue.Queue()</span><br><span class="line">    words_per_second_queue = queue.Queue()</span><br><span class="line">    voa_thread = VoaThread(<span class="number">1</span>, <span class="number">6</span>, link_queue)</span><br><span class="line">    voa_thread.start()</span><br><span class="line">    voa_thread.join()</span><br><span class="line">    get_mp3_thread = GetMP3Thread(link_queue, mlist_queue)</span><br><span class="line">    get_mp3_thread.start()</span><br><span class="line">    download_mp3_threads = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        download_mp3_thread = DownloadMP3Thread(mlist_queue)</span><br><span class="line">        download_mp3_thread.start()</span><br><span class="line">        download_mp3_threads.append(download_mp3_thread)</span><br><span class="line">    get_mp3_thread.join()</span><br><span class="line">    speechrate_threads = []</span><br><span class="line">    <span class="keyword">for</span> mp3_file <span class="keyword">in</span> get_mp3_thread.mlist:</span><br><span class="line">        speechrate_thread = SpeechRateThread(mp3_file, words_per_second_queue)</span><br><span class="line">        speechrate_thread.start()</span><br><span class="line">        speechrate_threads.append(speechrate_thread)</span><br><span class="line">    <span class="keyword">for</span> speechrate_thread <span class="keyword">in</span> speechrate_threads:</span><br><span class="line">        speechrate_thread.join()</span><br><span class="line">    <span class="keyword">for</span> i, mp3_file <span class="keyword">in</span> <span class="built_in">enumerate</span>(get_mp3_thread.mlist):</span><br><span class="line">        words_per_second = words_per_second_queue.get()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>. <span class="subst">&#123;os.path.basename(mp3_file)&#125;</span>: <span class="subst">&#123;words_per_second:<span class="number">.2</span>f&#125;</span> words-per-second&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> download_mp3_thread <span class="keyword">in</span> download_mp3_threads:</span><br><span class="line">        download_mp3_thread.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><h1 id="Week-13"><a href="#Week-13" class="headerlink" title="Week 13"></a>Week 13</h1><h2 id="作业描述"><a href="#作业描述" class="headerlink" title="作业描述"></a>作业描述</h2><blockquote><p>协程有时被称为“微线程”，因为二者有类似的使用场景。和线程相比，协程占用资源更少、切换迅速，且实现简单（如协程是协作式调用，一般不用考虑资源的抢占，所以大部分情况下不需要通过同步原语来避免冲突）。通常协程被用在高并发的IO场景中。本周要求利用协程，实现一个协程爬虫类 VoaCrawler ，对第十二周作业的数据采集部分进行重新实现，即用协程实现Mp3音频文件的爬取（可以使用 gevent , aiohttop等第三方库），用 aiofiles 实现音频文件的存储。如果有余力，也可以继续改进 Bilibili_Crawler.py中的例子，使用 aiofiles 等进行文件存储，并测试大规模视频同时获取是否可行。</p></blockquote><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> aiofiles</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VoaCrawler</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, start_page, end_page</span>):</span><br><span class="line">        <span class="variable language_">self</span>.start_page = start_page</span><br><span class="line">        <span class="variable language_">self</span>.end_page = end_page</span><br><span class="line">        <span class="variable language_">self</span>.link_list = []</span><br><span class="line">        <span class="variable language_">self</span>.mlist = []</span><br><span class="line">        <span class="variable language_">self</span>.headers = &#123;</span><br><span class="line">            <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_links</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.start_page, <span class="variable language_">self</span>.end_page):</span><br><span class="line">            url = <span class="string">f&#x27;https://www.51voa.com/VOA_Standard_<span class="subst">&#123;i&#125;</span>.html&#x27;</span></span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">                <span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">                    html = etree.HTML(<span class="keyword">await</span> response.text())</span><br><span class="line">                    links = []</span><br><span class="line">                    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">50</span>):</span><br><span class="line">                        links = links + html.xpath(<span class="string">&#x27;//*[@id=&quot;righter&quot;]/div[3]/ul/li[%s]/a/@href&#x27;</span> % <span class="built_in">str</span>(j))</span><br><span class="line">                    <span class="keyword">for</span> ele <span class="keyword">in</span> links:</span><br><span class="line">                        <span class="variable language_">self</span>.link_list.append(ele)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">get_mp3</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> tqdm(<span class="variable language_">self</span>.link_list[:<span class="number">5</span>]):</span><br><span class="line">                url = <span class="string">&#x27;https://www.51voa.com&#x27;</span> + link</span><br><span class="line">                <span class="keyword">async</span> <span class="keyword">with</span> session.get(url, headers=<span class="variable language_">self</span>.headers) <span class="keyword">as</span> response:</span><br><span class="line">                    <span class="variable language_">self</span>.mlist = <span class="variable language_">self</span>.mlist + <span class="built_in">list</span>(<span class="built_in">set</span>(re.findall(<span class="string">r&#x27;https://.+?\.mp3&#x27;</span>, <span class="keyword">await</span> response.text())))</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">download_mp3</span>(<span class="params">self, directory=<span class="string">&#x27;.&#x27;</span></span>):</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">            <span class="keyword">for</span> murl <span class="keyword">in</span> tqdm(<span class="variable language_">self</span>.mlist):</span><br><span class="line">                mp3_stream = <span class="keyword">await</span> session.get(murl, headers=<span class="variable language_">self</span>.headers)</span><br><span class="line">                fname = murl[murl.rfind(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>:]</span><br><span class="line">                path = os.path.join(directory, fname)</span><br><span class="line">                <span class="keyword">async</span> <span class="keyword">with</span> aiofiles.<span class="built_in">open</span>(path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="keyword">await</span> f.write(<span class="keyword">await</span> mp3_stream.read())</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">self</span>.get_links()</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">self</span>.get_mp3()</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">self</span>.download_mp3()</span><br><span class="line">        </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    crawler = VoaCrawler(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    asyncio.run(crawler.run())</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="运行结果-1"><a href="#运行结果-1" class="headerlink" title="运行结果"></a>运行结果</h2><h1 id="-2"><a href="#-2" class="headerlink"></a></h1></div><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://bloggerhsx.com/2023/05/15/2239/" data-id="cmbz46ici0006czzbfht3gfgm" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABxElEQVR42u3aS27DMAwFwNz/0u4BCquPpCU3wGgVOI48zoLgR59PvK6b9fvbuyt3u312LFxc3DH3Wq71A9ZXklfKDbi4uOe5dxEj2br3+LvPf9hwcXG/irvebZ3i4OLifjs3R+cvhouL+z+5eTqSt0J6pdFjtRouLu6Am3cp933e0t/FxcVtca/iqr5SPlCJno6Li3uEO2lkJOindsPFxT3J7Q1L1o+ZlzFRCMPFxX2VW9iuVTgVmiO4uLhHuNWf5fRqs7UwyMHFxT3IXRcw+dC0d09yPy4u7hluPijNg9H24gcXF/cgNzl+kRyw6M1Jo2QIFxf3CHfS7lxfz4+Ejv4UXFzcDdwkQclDzCSJKRQ/uLi4m7nVY1WTQUh1VBNFXFxc3G3cBNpLWappTTTuxcXFPc6dNDLmzdMowcLFxT3OzZOSavirNlUL57xwcXEf5V7FlR/urKY70Uvi4uIe4faGo4VeSzximRRUuLi4O7jV4JUgqsGukDDh4uIe5OYjjTkxD3mFhikuLu6r3F7hlO/Q7Jrg4uK+yp2UPb3a67G4i4uLW+RWj1L1Dlo90HbBxcU9wq2Gkt7gJA9t88CHi4s74P4AgVxxsARNSbIAAAAASUVORK5CYII=">Share</a><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" rel="tag">数据分析</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul></div><div class="post-nav"><a class="pre" href="/2023/11/12/1620/">11月12日</a><a class="next" href="/2022/12/10/1720/">远山的回响|“新村民”现象背后的哲学皈思</a></div><div class="nofancybox" id="waline"></div><link rel="stylesheet" type="text/css" href="https://unpkg.com/@waline/client@v3/dist/waline.css"><script type="module">import{init}from"https://unpkg.com/@waline/client@v3/dist/waline.js";init({el:"#waline",comment:!0,serverURL:"comments.polarwanderer.cn",pageSize:"8",wordLimit:"120",requiredMeta:requiredMeta,emoji:["//unpkg.com/@waline/emojis@1.2.0/weibo","//unpkg.com/@waline/emojis@1.2.0/qq","//unpkg.com/@waline/emojis@1.2.0/tw-emoji"]})</script><script>let metaInfo=["nick","mail","link"],requiredMeta="nick,mail".split(",").filter(i=>metaInfo.indexOf(i)>-1)</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0" readonly></div></div><div class="search-modal" id="search-modal"><div class="search-modal-content"><div class="search-modal-header"><input class="search-modal-input" id="modal-search-input" placeholder="输入关键词搜索..." type="text" name="q"></div><div class="search-modal-body"><div id="modal-search-result"></div></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o">Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o">Tags</i></div><div class="tagcloud"><a href="/tags/408/" style="font-size:15px">408</a> <a href="/tags/Python/" style="font-size:15px">Python</a> <a href="/tags/%E4%BA%BA%E7%89%A9/" style="font-size:15px">人物</a> <a href="/tags/%E5%8E%86%E5%8F%B2/" style="font-size:15px">历史</a> <a href="/tags/%E5%93%B2%E5%AD%A6/" style="font-size:15px">哲学</a> <a href="/tags/%E5%9B%9E%E5%BF%86/" style="font-size:15px">回忆</a> <a href="/tags/%E5%A4%A7%E5%AD%A6/" style="font-size:15px">大学</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size:15px">学习笔记</a> <a href="/tags/%E5%AE%8B%E5%BA%86%E9%BE%84/" style="font-size:15px">宋庆龄</a> <a href="/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" style="font-size:15px">年终总结</a> <a href="/tags/%E6%80%9D%E8%80%83/" style="font-size:15px">思考</a> <a href="/tags/%E6%84%9F%E6%82%9F/" style="font-size:15px">感悟</a> <a href="/tags/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/" style="font-size:15px">数学建模</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" style="font-size:15px">数据分析</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size:15px">数据结构</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size:15px">机器学习</a> <a href="/tags/%E6%A2%A6%E5%A2%83/" style="font-size:15px">梦境</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size:15px">生活</a> <a href="/tags/%E7%A4%BE%E4%BC%9A%E7%8E%B0%E8%B1%A1/" style="font-size:15px">社会现象</a> <a href="/tags/%E7%AB%9E%E8%B5%9B/" style="font-size:15px">竞赛</a> <a href="/tags/%E7%AC%94%E8%AE%B0/" style="font-size:15px">笔记</a> <a href="/tags/%E7%BA%BF%E6%80%A7%E8%A1%A8/" style="font-size:15px">线性表</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%B1%82/" style="font-size:15px">网络层</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size:15px">计算机网络</a> <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%80%83%E7%A0%94/" style="font-size:15px">计算机考研</a> <a href="/tags/%E8%AE%B0%E5%BD%95/" style="font-size:15px">记录</a> <a href="/tags/%E9%9A%8F%E7%AC%94/" style="font-size:15px">随笔</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o">Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2025/03/25/1558/">【数据结构】第二章-线性表</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/25/1556/">【数据结构】第一章-基本概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/24/2121/">【计算机网络】第四章-网络层(上)</a></li><li class="post-list-item"><a class="post-list-link" href="/2025/03/24/1954/">开坑|计算机考研408专业课笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/07/29/0021/">浪迹天涯</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/07/08/2317/">寻书</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/06/25/2338/">半年志</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/02/07/2150/">2024年美赛</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/12/31/2342/">抓住2023的小尾巴</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/12/10/2113/">最后一堂课</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o">Recent Comments</i></div><div id="widget-waline-list"></div><script type="text/javascript" id="recent-comment" serverurl="comments.polarwanderer.cn" count="5" src="/js/recent-comments.js?v=1.0.0" async></script></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="/." rel="nofollow">BlankChen.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path="search.xml";0==search_path.length&&(search_path="search.xml");var path="/"+search_path;searchFunc(path,"local-search-input","local-search-result")</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script><script type="text/javascript" src="/js/sticky-header.js?v=1.0.0"></script><script type="text/javascript" src="/js/toc-generator.js?v=1.0.0"></script><script type="text/javascript" src="/js/snowfall.js?v=1.0.0"></script><script type="text/javascript" src="/js/floating-buttons.js?v=1.0.0"></script><script type="text/javascript" src="/js/thoughts-typewriter.js?v=1.0.0"></script><script type="text/javascript" src="/js/subtitle-typewriter.js?v=1.0.0"></script></div></body></html>